{"version":3,"sources":["../../../../../src/js/app.js","../../../../../src/js/templates.js","../../../../../src/js/controllers/AlbumController.js","../../../../../src/js/controllers/HeaderController.js","../../../../../src/js/controllers/HomeController.js","../../../../../src/js/controllers/ImageController.js","../../../../../src/js/controllers/LoginModalController.js","../../../../../src/js/controllers/UserController.js","../../../../../src/js/directives/annotator.js","../../../../../src/js/directives/paginator.js","../../../../../src/js/directives/stateBodyClass.js","../../../../../src/js/libraries/ArrayPrototype.js","../../../../../src/js/libraries/Doodle.js","../../../../../src/js/libraries/ImagePaster.js","../../../../../src/js/resources/AlbumResource.js","../../../../../src/js/resources/ImageResource.js","../../../../../src/js/resources/SessionResource.js","../../../../../src/js/resources/UserResource.js","../../../../../src/js/services/AuthService.js","../../../../../src/js/services/ImagePasterService.js"],"names":["app","angular","module","config","$httpProvider","$locationProvider","$stateProvider","$urlRouterProvider","localStorageServiceProvider","html5Mode","setPrefix","setStorageType","setStorageCookie","otherwise","state","url","templateUrl","controller","params","albumId","run","$rootScope","$state","AuthService","ImagePasterService","checkSession","user","getUser","$on","event","args","ev","to","toParams","from","fromParams","$","attr","name","$templateCache","put","$scope","$compile","$stateParams","AlbumResource","loadPage","page","currentPage","loading","getImages","data","images","totalPages","lastPage","console","log","title","subtitle","albums","album","go","get","username","innerHTML","changePage","$event","stopPropagation","preventDefault","notify","ModalService","login","showModal","then","modal","close","result","message","logout","signup","alert","$timeout","sprites","i","push","shuffle","join","mac","navigator","platform","test","$element","ImageResource","albumImages","image","imageId","editing","init","loadAlbumImages","response","userId","moment","createdAt","format","fromNow","showTextDialog","text","getText","inputs","showEmbedDialog","shareOnFb","encodeURIComponent","window","open","shareOnTwitter","annotating","savingAnnotation","annotationColorVisible","annotationSizeVisible","annotationColors","annotationSizes","doodle","annotate","element","document","createElement","setAttribute","annotator","append","showAnnotationColor","setAnnotationColor","color","showAnnotationSize","setAnnotationSize","px","lineThickness","saveAnnotation","annotation","getImage","base64","exitAnnotation","undoAnnotation","undo","restartAnnotation","clear","remove","cropCoords","cropping","savingCrop","jcrop","crop","Jcrop","onChange","c","saveCrop","scale","getImageScale","width","Math","round","w","height","h","x","y","exitCrop","destroy","css","rotate","rotating","revert","confirm","reverting","showPrivacyDialog","setAnon","anon","update","anonymous","res","$parent","setPassword","deleting","showReportDialog","parseInt","UserResource","loginData","password","errors","signupData","email","fb","forgot","messages","hasOwnProperty","general","save","directive","$window","debounce","restrict","imageEl","Doodle","moveAndResize","imgOffset","offset","left","top","canvas","debouncedRedraw","redraw","bind","scope","template","calculatePages","pages","paginatorHeight","spaceHeight","totalSpaces","floor","adjacent","$watchGroup","debouncedCalculatePages","link","elem","ctrl","toState","fromState","fromClassnames","isDefined","bodyClass","toClassnames","removeClass","addClass","Array","prototype","j","temp","this","length","random","drawing","history","currentData","ua","userAgent","toLowerCase","isAndroid","indexOf","appendChild","context","getContext","self","e","drawStart","draw","drawEnd","clearRect","fillStyle","toDataURL","saveHistoryState","shift","getImageData","saveCurrentData","imageData","pop","putImageData","newCanvas","drawImage","originalEvent","touches","pageX","pageY","lineWidth","lineCap","lineJoin","strokeStyle","oldX","oldY","beginPath","arc","PI","closePath","fill","moveTo","lineTo","stroke","rgbToHex","rgb","hex","isNaN","hexDigits","match","ImagePaster","debug","pasteCatcher","extra","id","body","focus","addEventListener","onPaste","on","which","ctrlKey","metaKey","trigger","clipboardData","done","JSON","stringify","msConvertURL","fileList","files","uploadBlob","items","getData","uploadText","clearPasteCatcher","type","getAsFile","setTimeout","checkPasteCatcher","child","childNodes","tagName","src","onFail","uploadImage","href","blob","reader","FileReader","onload","evt","target","readAsDataURL","upload","ajax","timeout","error","jqXHR","textStatus","responseJSON","errorType","status","statusText","success","validateURL","regex","RegExp","factory","$resource","apiUrl","sessionKey","getSessionKey","cache","transformResponse","fromJson","method","action","degrees","session","getAlbums","service","localStorageService","SessionResource","$q","onLogin","onLogout","resolve","reject","newSession","newSessionKey","set","$broadcast","viewUrl","imageUrl","find","getImageUploadUrl"],"mappings":"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","file":"ctrlv.min.js","sourcesContent":["\"use strict\";\n\n// Initialize angular\n\nvar app = angular.module('ctrlv', [\n    'ui.router',\n    'ngResource',\n    'ngSanitize',\n    'LocalStorageModule',\n    'angularModalService',\n    'ngAnimate',\n    'rt.debounce'\n]);\n\n/**\n * Angular\n */\n\n// Routes\napp.config(function($httpProvider, $locationProvider, $stateProvider, $urlRouterProvider, localStorageServiceProvider) {\n\n    /*$httpProvider.defaults.headers.common = {\n        'RemoteUser': 'billybob'\n    };*/\n\n    $locationProvider.html5Mode(true);\n\n    localStorageServiceProvider\n        .setPrefix('ctrlv')\n        .setStorageType('localStorage')\n        .setStorageCookie(0, '/');\n\n    // For any unmatched url, redirect to /\n    $urlRouterProvider.otherwise('/');\n\n    // Now set up the states\n    $stateProvider\n        .state('home', {\n            url: \"/\",\n            templateUrl: \"views/home.html\",\n            controller: 'HomeController'\n        })\n        .state('help', {\n            url: \"/help\",\n            templateUrl: \"views/help.html\",\n            controller: 'HelpController'\n        })\n        .state('image', {\n            url: \"/{imageId:int}\",\n            templateUrl: \"views/image.html\",\n            controller: 'ImageController',\n            params: {\n                albumId: null\n            },\n        })\n        .state('user', {\n            url: \"/user/{username:string}\",\n            templateUrl: \"views/user.html\",\n            controller: 'UserController'\n        })\n        .state('user-page', {\n            url: \"/user/{username:string}/{page:int}\",\n            templateUrl: \"views/user.html\",\n            controller: 'UserController'\n        })\n\n        .state('album', {\n            url: \"/album/{albumId:int}\",\n            templateUrl: \"views/album.html\",\n            controller: 'AlbumController'\n        })\n        .state('album-page', {\n            url: \"/album/{albumId:int}/{page:int}\",\n            templateUrl: \"views/album.html\",\n            controller: 'AlbumController'\n        });\n});\n\napp.run(function($rootScope, $state, AuthService, ImagePasterService) {\n    // ImagePasterService is injected here so it gets initialized\n\n\n    //$httpProvider.defaults.headers.post[\"Content-Type\"] = \"text/plain\";\n\n    $rootScope.$state = $state;\n\n\n    AuthService.checkSession();\n\n    $rootScope.user = AuthService.getUser();\n\n    $rootScope.$on('login', function(event, args) {\n        $rootScope.user = args.user;\n    });\n\n    $rootScope.$on('logout', function() {\n        $rootScope.user = false;\n    });\n\n    $rootScope.$on('$stateChangeSuccess', function (ev, to, toParams, from, fromParams) {\n        $('body').attr('data-previous', from.name);\n    });\n});\n\n","angular.module('ctrlv').run(['$templateCache', function($templateCache) {\n  'use strict';\n\n  $templateCache.put('views/album.html',\n    \"<ng-include src=\\\"'views/partials/image-list.html'\\\"></ng-include>\\n\" +\n    \"\\n\" +\n    \"<ng-include src=\\\"'views/partials/albums-sidebar.html'\\\"></ng-include>\\n\"\n  );\n\n\n  $templateCache.put('views/home.html',\n    \"<div id=\\\"uploader\\\">\\n\" +\n    \"\\n\" +\n    \"    <div id=\\\"uploader-collage\\\" ng-bind-html=\\\"sprites\\\"></div>\\n\" +\n    \"\\n\" +\n    \"    <div class=\\\"upload-status\\\" id=\\\"upload-waiting\\\">\\n\" +\n    \"        <h2>The <span class=\\\"green\\\">easiest</span> way to share photos.</h2>\\n\" +\n    \"        <h3>\\n\" +\n    \"            <span style=\\\"float:right;\\\">\\n\" +\n    \"                You can also\\n\" +\n    \"                <a href=\\\"#\\\" class=\\\"btn\\\"><i class=\\\"typ typ-cloud-storage\\\"></i> Upload Images</a>\\n\" +\n    \"                or\\n\" +\n    \"                <a href=\\\"#\\\" class=\\\"btn\\\"><i class=\\\"typ typ-camera\\\"></i> Take a Photo</a>\\n\" +\n    \"            </span>\\n\" +\n    \"\\n\" +\n    \"            <i class=\\\"spinner-waiting\\\"></i>\\n\" +\n    \"            Press <span ng-if=\\\"mac\\\" class=\\\"btn btn-cmd\\\">cmd &#8984;</span><span ng-if=\\\"!mac\\\" class=\\\"btn btn-ctrl\\\">Ctrl</span>\\n\" +\n    \"            + <span class=\\\"btn btn-v\\\">V</span> to paste an image.\\n\" +\n    \"        </h3>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"    <div class=\\\"upload-status out\\\" id=\\\"upload-loading\\\">\\n\" +\n    \"        <h3><i class=\\\"spinner-loading\\\"></i> Uploading...</h3>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"    <div class=\\\"upload-status out\\\" id=\\\"upload-error\\\">\\n\" +\n    \"        <h3>Error</h3>\\n\" +\n    \"        <p></p>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"    <div class=\\\"upload-status out\\\" id=\\\"upload-complete\\\">\\n\" +\n    \"        <h3>Uploaded!</h3>\\n\" +\n    \"        <p>\\n\" +\n    \"            <label>\\n\" +\n    \"                Here's your link\\n\" +\n    \"                <input type=\\\"text\\\" id=\\\"newImageURL\\\" class=\\\"green\\\" readonly=\\\"readonly\\\" />\\n\" +\n    \"            </label>\\n\" +\n    \"        </p>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/image.html',\n    \"<div ng-if=\\\"image\\\" class=\\\"img-wrapper\\\">\\n\" +\n    \"    <img\\n\" +\n    \"        ng-if=\\\"!loading && image\\\"\\n\" +\n    \"        ng-src=\\\"{{ image.image.url }}\\\"\\n\" +\n    \"        class=\\\"img\\\"\\n\" +\n    \"        id=\\\"img\\\"\\n\" +\n    \"        />\\n\" +\n    \"</div>\\n\" +\n    \"\\n\" +\n    \"<div\\n\" +\n    \"    ng-if=\\\"!loading && image\\\"\\n\" +\n    \"    class=\\\"sidebar sidebar-left sidebar-float img-left-sidebar\\\"\\n\" +\n    \"    ng-class=\\\"{\\n\" +\n    \"        'editable': user && user.userId === image.userId,\\n\" +\n    \"        'cropping': cropping,\\n\" +\n    \"        'annotating': annotating,\\n\" +\n    \"        'revertable': image.hasOriginal\\n\" +\n    \"    }\\\"\\n\" +\n    \"    >\\n\" +\n    \"\\n\" +\n    \"    <div ng-if=\\\"annotating\\\">\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"saveAnnotation()\\\"><i class=\\\"typ typ-tick-outline\\\" ng-hide=\\\"savingAnnotation\\\"></i><i class=\\\"spinner-loading dark\\\" ng-show=\\\"savingAnnotation\\\"></i><span>Save Annotation</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" ng-class=\\\"{'active':annotationColorVisible}\\\" href=\\\"#\\\" ng-click=\\\"showAnnotationColor()\\\"><i class=\\\"typ typ-media-record\\\"></i><span>Pen Colour</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" ng-class=\\\"{'active':annotationSizeVisible}\\\" href=\\\"#\\\" ng-click=\\\"showAnnotationSize()\\\"><i class=\\\"typ typ-brush\\\"></i><span>Pen Size</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"undoAnnotation()\\\"><i class=\\\"typ typ-arrow-back\\\"></i><span>Undo</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"restartAnnotation()\\\"><i class=\\\"typ typ-trash\\\"></i><span>Start Over</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"exitAnnotation()\\\"><i class=\\\"typ typ-times\\\"></i><span>Cancel</span></a>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"    <div ng-if=\\\"cropping\\\">\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"saveCrop()\\\"><i class=\\\"typ typ-tick-outline\\\" ng-hide=\\\"savingCrop\\\"></i><i class=\\\"spinner-loading dark\\\" ng-show=\\\"savingCrop\\\"></i><span>Save Crop</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"exitCrop()\\\"><i class=\\\"typ typ-times\\\"></i><span>Cancel</span></a>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"    <div ng-hide=\\\"cropping || annotating\\\">\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"showTextDialog()\\\"><i class=\\\"typ typ-sort-alphabetically\\\"></i><span>Text Recognition</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"showEmbedDialog()\\\"><i class=\\\"typ typ-code\\\"></i><span>Embed</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"shareOnFb()\\\"><i class=\\\"typ typ-social-facebook\\\"></i><span>Share</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"shareOnTwitter()\\\"><i class=\\\"typ typ-social-twitter\\\"></i><span>Tweet</span></a>\\n\" +\n    \"\\n\" +\n    \"        <hr/>\\n\" +\n    \"\\n\" +\n    \"        <div ng-if=\\\"user && user.userId === image.userId\\\">\\n\" +\n    \"            <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"annotate()\\\"><i class=\\\"typ typ-brush\\\"></i><span>Annotate</span></a>\\n\" +\n    \"            <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"crop()\\\"><i class=\\\"typ typ-scissors-outline\\\"></i><span>Crop</span></a>\\n\" +\n    \"            <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"rotate()\\\"><i class=\\\"typ typ-arrow-sync-outline\\\" ng-hide=\\\"rotating\\\"></i><i class=\\\"spinner-loading dark\\\" ng-show=\\\"rotating\\\"></i><span>Rotate</span></a>\\n\" +\n    \"            <a class=\\\"btn\\\" href=\\\"#\\\" ng-if=\\\"image.hasOriginal\\\" ng-click=\\\"revert()\\\"><i class=\\\"typ typ-arrow-back\\\" ng-hide=\\\"reverting\\\"></i><i class=\\\"spinner-loading dark\\\" ng-show=\\\"reverting\\\"></i><span>Revert To Original</span></a>\\n\" +\n    \"            <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"showPrivacyDialog()\\\"><i class=\\\"typ typ-lock-closed\\\"></i><span>Privacy</span></a>\\n\" +\n    \"            <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"delete()\\\"><i class=\\\"typ typ-trash\\\" ng-hide=\\\"deleting\\\"></i><i class=\\\"spinner-loading dark\\\" ng-show=\\\"deleting\\\"></i><span>Delete</span></a>\\n\" +\n    \"        </div>\\n\" +\n    \"        <div ng-if=\\\"!user || user.userId !== image.userId\\\">\\n\" +\n    \"            <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"showReportDialog()\\\"><i class=\\\"typ typ-flag\\\"></i><span>Report</span></a>\\n\" +\n    \"        </div>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"</div>\\n\" +\n    \"<div ng-if=\\\"doodle\\\" ng-show=\\\"annotationColorVisible\\\" class=\\\"ng-hide img-submenu sidebar sidebar-left sidebar-float annotation-color\\\">\\n\" +\n    \"    <a class=\\\"btn\\\" ng-repeat=\\\"color in annotationColors\\\" ng-class=\\\"{'active':doodle.color === '#'+color}\\\" ng-click=\\\"setAnnotationColor(color)\\\"><i class=\\\"typ typ-media-record\\\" ng-style=\\\"{color: '#'+color}\\\"></i></a>\\n\" +\n    \"</div>\\n\" +\n    \"<div ng-if=\\\"doodle\\\" ng-show=\\\"annotationSizeVisible\\\" class=\\\"ng-hide img-submenu sidebar sidebar-left sidebar-float annotation-size\\\">\\n\" +\n    \"    <a class=\\\"btn\\\" ng-repeat=\\\"size in annotationSizes\\\" ng-class=\\\"{'active':doodle.lineThickness === size}\\\" href=\\\"#\\\" ng-click=\\\"setAnnotationSize(size)\\\"><i ng-style=\\\"{height:size+'px'}\\\"></i></a>\\n\" +\n    \"</div>\\n\" +\n    \"\\n\" +\n    \"<div class=\\\"sidebar sidebar-right img-right-sidebar sidebar-scrolling\\\" ng-if=\\\"albumImages.length > 0\\\">\\n\" +\n    \"    <div class=\\\"scroller\\\">\\n\" +\n    \"    <ul>\\n\" +\n    \"        <li>In This Album</li>\\n\" +\n    \"        <li ng-repeat=\\\"albumImage in albumImages\\\" ng-class=\\\"{active: imageId == albumImage.imageId}\\\">\\n\" +\n    \"            <a ui-sref=\\\"image({ imageId: albumImage.imageId, albumId: albumId })\\\"><img ng-src=\\\"{{ albumImage.thumbnail.url }}\\\" /></a>\\n\" +\n    \"        </li>\\n\" +\n    \"    </ul>\\n\" +\n    \"    </div>\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/modals/image-embed.html',\n    \"<div class=\\\"modal\\\" ng-click=\\\"close()\\\" id=\\\"image-embed-modal\\\">\\n\" +\n    \"    <div class=\\\"modal-content\\\" ng-click=\\\"$event.stopPropagation()\\\">\\n\" +\n    \"\\n\" +\n    \"        <h2><i class=\\\"typ typ-export\\\"></i> Link To <small>this image.</small></h2>\\n\" +\n    \"\\n\" +\n    \"        <div class=\\\"container-fluid\\\">\\n\" +\n    \"            <div class=\\\"row\\\">\\n\" +\n    \"                <div class=\\\"col-sm-6\\\">\\n\" +\n    \"\\n\" +\n    \"                    <div class=\\\"form-group\\\">\\n\" +\n    \"                        <h4>Markdown Link <small>e.g. for Reddit comments</small></h4>\\n\" +\n    \"                        <textarea rows=\\\"2\\\" class=\\\"form-control\\\" readonly=\\\"readonly\\\">[{{image.url}}]({{image.url}}</textarea>\\n\" +\n    \"                    </div>\\n\" +\n    \"\\n\" +\n    \"                    <div class=\\\"form-group\\\">\\n\" +\n    \"                        <p><small><a href=\\\"http://redditenhancementsuite.com/\\\">Reddit Enhancement Suite</a> supports CtrlV, so you can also just use this link in Reddit comments:</small></p>\\n\" +\n    \"                        <input type=\\\"text\\\" class=\\\"form-control\\\" readonly=\\\"readonly\\\" value=\\\"{{image.url}}\\\" />\\n\" +\n    \"                    </div>\\n\" +\n    \"\\n\" +\n    \"                    <div class=\\\"form-group\\\">\\n\" +\n    \"                        <h4>Markdown Image <small>e.g. for GitHub/BitBucket READMEs</small></h4>\\n\" +\n    \"                        <textarea rows=\\\"3\\\" class=\\\"form-control\\\" readonly=\\\"readonly\\\">[![{{ image.title }}]({{image.image.url}})]({{image.url}})</textarea>\\n\" +\n    \"                    </div>\\n\" +\n    \"\\n\" +\n    \"                </div>\\n\" +\n    \"                <div class=\\\"col-sm-6\\\">\\n\" +\n    \"\\n\" +\n    \"                    <div class=\\\"form-group\\\">\\n\" +\n    \"                        <h4>BBCode <small>for forums</small></h4>\\n\" +\n    \"                        <textarea rows=\\\"3\\\" class=\\\"form-control\\\" readonly=\\\"readonly\\\">[url={{image.url}}][img]{{image.image.url}}[/img]{{image.title}}[/url]</textarea>\\n\" +\n    \"                    </div>\\n\" +\n    \"\\n\" +\n    \"                    <div class=\\\"form-group\\\">\\n\" +\n    \"                        <h4>HTML <small>for websites</small></h4>\\n\" +\n    \"                        <textarea rows=\\\"5\\\" class=\\\"form-control\\\" readonly=\\\"readonly\\\">&lt;a href=&quot;{{image.url}}&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;{{image.image.url}}&quot; style=&quot;max-width:900px;&quot; alt=&quot;CtrlV.in Image Hosting&quot; /&gt;&lt;/a&gt;</textarea>\\n\" +\n    \"                    </div>\\n\" +\n    \"\\n\" +\n    \"                </div>\\n\" +\n    \"            </div>\\n\" +\n    \"        </div>\\n\" +\n    \"\\n\" +\n    \"    </div>\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/modals/image-privacy.html',\n    \"<div class=\\\"modal\\\" ng-click=\\\"close()\\\" id=\\\"image-privacy-modal\\\">\\n\" +\n    \"    <div class=\\\"modal-content\\\" ng-click=\\\"$event.stopPropagation()\\\">\\n\" +\n    \"\\n\" +\n    \"        <div class=\\\"container-fluid\\\" >\\n\" +\n    \"\\n\" +\n    \"            <div class=\\\"alert alert-warning\\\" ng-if=\\\"image.albumId\\\">\\n\" +\n    \"                This image is part of an album. Go to the <a href=\\\"#\\\">albums settings</a> to make the album anonyous and/or password protected.\\n\" +\n    \"            </div>\\n\" +\n    \"\\n\" +\n    \"            <div class=\\\"row\\\" ng-if=\\\"!image.albumId\\\">\\n\" +\n    \"                <div class=\\\"col-sm-6\\\">\\n\" +\n    \"\\n\" +\n    \"                    <h2><i class=\\\"typ typ-user\\\"></i> Show Username <small>on this image.</small></h2>\\n\" +\n    \"\\n\" +\n    \"                    <div class=\\\"form-group\\\">\\n\" +\n    \"                        <div class=\\\"row\\\">\\n\" +\n    \"                            <div class=\\\"col-xs-6\\\">\\n\" +\n    \"                                <a ng-click=\\\"setAnon(0);\\\" class=\\\"btn btn-block\\\" ng-class=\\\"{'active': !image.anonymous}\\\"><i class=\\\"typ typ-user\\\"></i>Yes</a>\\n\" +\n    \"                            </div>\\n\" +\n    \"                            <div class=\\\"col-xs-6\\\">\\n\" +\n    \"                                <a ng-click=\\\"setAnon(1);\\\" class=\\\"btn btn-block\\\" ng-class=\\\"{'active': image.anonymous}\\\"><i class=\\\"typ typ-cancel-outline\\\"></i>No</a>\\n\" +\n    \"                            </div>\\n\" +\n    \"                        </div>\\n\" +\n    \"                    </div>\\n\" +\n    \"\\n\" +\n    \"                </div>\\n\" +\n    \"                <div class=\\\"col-sm-6\\\">\\n\" +\n    \"\\n\" +\n    \"                    <h2><i class=\\\"typ typ-lock-closed\\\"></i> Password Protect <small>this image.</small></h2>\\n\" +\n    \"\\n\" +\n    \"                    <div class=\\\"form-group\\\">\\n\" +\n    \"                        <label>Enter a password that will be required for other people to view this image.</label>\\n\" +\n    \"                        (You will always be able to see it without the password.)\\n\" +\n    \"                        <input type=\\\"password\\\" class=\\\"form-control\\\" placeholder=\\\"Password\\\" />\\n\" +\n    \"                    </div>\\n\" +\n    \"\\n\" +\n    \"                    <a class=\\\"btn btn-block\\\">Save</a>\\n\" +\n    \"\\n\" +\n    \"                </div>\\n\" +\n    \"            </div>\\n\" +\n    \"        </div>\\n\" +\n    \"\\n\" +\n    \"    </div>\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/modals/image-text.html',\n    \"<div class=\\\"modal\\\" ng-click=\\\"close()\\\" id=\\\"image-text-modal\\\">\\n\" +\n    \"    <div class=\\\"modal-content\\\" ng-click=\\\"$event.stopPropagation()\\\">\\n\" +\n    \"        <h2><i class=\\\"typ typ-sort-alphabetically\\\"></i> Text <small>found in this image.</small></h2>\\n\" +\n    \"        <div class=\\\"container-fluid\\\">\\n\" +\n    \"\\n\" +\n    \"            <p ng-if=\\\"text.text.text\\\">{{ text.text.text }}</p>\\n\" +\n    \"\\n\" +\n    \"            <div class=\\\"alert alert-warning\\\" ng-if=\\\"text.text === null\\\">\\n\" +\n    \"                <i class=\\\"spinner-loading dark\\\"></i> The image is currently being scanned for text.\\n\" +\n    \"            </div>\\n\" +\n    \"\\n\" +\n    \"            <div class=\\\"alert alert-danger\\\" ng-if=\\\"text.text.text.length < 1\\\">\\n\" +\n    \"                No text was found in the image.\\n\" +\n    \"            </div>\\n\" +\n    \"\\n\" +\n    \"        </div>\\n\" +\n    \"    </div>\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/modals/login.html',\n    \"<div class=\\\"modal\\\" ng-click=\\\"close()\\\">\\n\" +\n    \"    <div class=\\\"modal-content\\\" ng-click=\\\"$event.stopPropagation()\\\">\\n\" +\n    \"\\n\" +\n    \"        <div class=\\\"container-fluid\\\">\\n\" +\n    \"            <div class=\\\"row\\\">\\n\" +\n    \"                <div class=\\\"col-sm-6\\\">\\n\" +\n    \"                    <form ng-submit=\\\"login()\\\">\\n\" +\n    \"                        <h2>Login <small>to you CtrlV account.</small></h2>\\n\" +\n    \"\\n\" +\n    \"                        <div class=\\\"form-group\\\" ng-class=\\\"{'has-error': loginData.errors.username}\\\">\\n\" +\n    \"                            <label class=\\\"control-label\\\"><i class=\\\"typ typ-user\\\"></i> Username\\n\" +\n    \"                                <input class=\\\"form-control\\\" type=\\\"text\\\" ng-model=\\\"loginData.username\\\" name=\\\"username\\\" />\\n\" +\n    \"                            </label>\\n\" +\n    \"\\n\" +\n    \"                            <span ng-if=\\\"loginData.errors.username\\\" class=\\\"help-block\\\">{{ loginData.errors.username.join(' ') }}</span>\\n\" +\n    \"\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div class=\\\"form-group\\\" ng-class=\\\"{'has-error': loginData.errors.password}\\\">\\n\" +\n    \"                            <label class=\\\"control-label\\\"><i class=\\\"typ typ-key\\\"></i> Password\\n\" +\n    \"                                <input class=\\\"form-control\\\" type=\\\"password\\\" ng-model=\\\"loginData.password\\\" name=\\\"password\\\" />\\n\" +\n    \"                            </label>\\n\" +\n    \"\\n\" +\n    \"                            <span ng-if=\\\"loginData.errors.password\\\" class=\\\"help-block\\\">{{ loginData.errors.password.join(' ') }}</span>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div class=\\\"form-group\\\">\\n\" +\n    \"                            <label>\\n\" +\n    \"                                <a href=\\\"#\\\" ng-click=\\\"forgot()\\\"><i class=\\\"typ typ-warning-outline\\\"></i> Forgot you password?</a>\\n\" +\n    \"                            </label>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div class=\\\"form-group\\\">\\n\" +\n    \"                            <label>\\n\" +\n    \"                                <a href=\\\"#\\\" ng-click=\\\"fb()\\\"><i class=\\\"typ typ-social-facebook\\\"></i> Used to login with Facebook?</a>\\n\" +\n    \"                            </label>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div ng-if=\\\"loginData.errors.general\\\" class=\\\"form-group has-error\\\">\\n\" +\n    \"                            <span class=\\\"help-block\\\"><i class=\\\"typ typ-warning\\\"></i> {{ loginData.errors.general }}</span>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <button class=\\\"btn btn-block\\\">\\n\" +\n    \"                            <i class=\\\"spinner-loading dark\\\" ng-show=\\\"loginData.loading\\\"></i>\\n\" +\n    \"                            <span ng-hide=\\\"loginData.loading\\\">Login</span>\\n\" +\n    \"                        </button>\\n\" +\n    \"                    </form>\\n\" +\n    \"                </div>\\n\" +\n    \"\\n\" +\n    \"                <div class=\\\"col-sm-6\\\">\\n\" +\n    \"                    <form ng-submit=\\\"signup()\\\">\\n\" +\n    \"                        <h2>Create <small>a new CtrlV account.</small></h2>\\n\" +\n    \"\\n\" +\n    \"                        <div class=\\\"form-group\\\" ng-class=\\\"{'has-error': signupData.errors.username}\\\">\\n\" +\n    \"                            <label class=\\\"control-label\\\"><i class=\\\"typ typ-user\\\"></i> Username\\n\" +\n    \"                                <input class=\\\"form-control\\\" type=\\\"text\\\" ng-model=\\\"signupData.username\\\" name=\\\"username\\\" />\\n\" +\n    \"                            </label>\\n\" +\n    \"\\n\" +\n    \"                            <span ng-if=\\\"signupData.errors.username\\\" class=\\\"help-block\\\">{{ signupData.errors.username.join(' ') }}</span>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div class=\\\"form-group\\\" ng-class=\\\"{'has-error': signupData.errors.username}\\\">\\n\" +\n    \"                            <label class=\\\"control-label\\\"><i class=\\\"typ typ-key\\\"></i> Password\\n\" +\n    \"                                <input class=\\\"form-control\\\" type=\\\"password\\\" ng-model=\\\"signupData.password\\\" name=\\\"password\\\" />\\n\" +\n    \"                            </label>\\n\" +\n    \"\\n\" +\n    \"                            <span ng-if=\\\"signupData.errors.password\\\" class=\\\"help-block\\\">{{ signupData.errors.password.join(' ') }}</span>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div class=\\\"form-group\\\" ng-class=\\\"{'has-error': signupData.errors.email}\\\">\\n\" +\n    \"                            <label class=\\\"control-label\\\"><i class=\\\"typ typ-mail\\\"></i> Email Address\\n\" +\n    \"                                <input class=\\\"form-control\\\" type=\\\"email\\\" ng-model=\\\"signupData.email\\\" name=\\\"email\\\" />\\n\" +\n    \"                            </label>\\n\" +\n    \"\\n\" +\n    \"                            <span ng-if=\\\"signupData.errors.email\\\" class=\\\"help-block\\\">{{ signupData.errors.email.join(' ') }}</span>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div ng-if=\\\"signupData.errors.general\\\" class=\\\"form-group has-error\\\">\\n\" +\n    \"                            <span class=\\\"help-block\\\"><i class=\\\"typ typ-warning\\\"></i> {{ signupData.errors.general }}</span>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <button class=\\\"btn btn-block\\\">\\n\" +\n    \"                            <i class=\\\"spinner-loading dark\\\" ng-show=\\\"signupData.loading\\\"></i>\\n\" +\n    \"                            <span ng-hide=\\\"signupData.loading\\\">Signup</span>\\n\" +\n    \"                        </button>\\n\" +\n    \"                    </form>\\n\" +\n    \"                </div>\\n\" +\n    \"\\n\" +\n    \"            </div>\\n\" +\n    \"        </div>\\n\" +\n    \"    </div>\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/partials/albums-sidebar.html',\n    \"<div class=\\\"album-list-sidebar sidebar sidebar-left sidebar-scrolling\\\" ng-if=\\\"albums.length > 0\\\">\\n\" +\n    \"    <div class=\\\"scroller\\\">\\n\" +\n    \"    <ul>\\n\" +\n    \"        <li>Albums</li>\\n\" +\n    \"        <li ng-repeat=\\\"album in albums\\\" ng-class=\\\"{active: albumId == albums.albumId}\\\">\\n\" +\n    \"            <a ui-sref=\\\"album({albumId: album.albumId})\\\"><img alt=\\\"{{ album.title }}\\\" /></a>\\n\" +\n    \"        </li>\\n\" +\n    \"    </ul>\\n\" +\n    \"    </div>\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/partials/footer.html',\n    \"<footer>\\n\" +\n    \"\\n\" +\n    \"    <!--<div style=\\\"float:left;\\\">\\n\" +\n    \"        View:\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\">Grid (Classic)</a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\">Columns</a>\\n\" +\n    \"    </div>-->\\n\" +\n    \"\\n\" +\n    \"    <ul class=\\\"links\\\">\\n\" +\n    \"        <li>Created by <a href=\\\"https://themediadudes.com\\\">The Media Dudes</a></li>\\n\" +\n    \"        <li><a href=\\\"https://api.ctrlv.in/docs\\\"><i class=\\\"typ typ-flow-switch\\\"></i> API</a></li>\\n\" +\n    \"        <li><a href=\\\"mailto:help@ctrlv.in\\\"><i class=\\\"typ typ-mail\\\"></i> Contact Us</a></li>\\n\" +\n    \"        <li><a href=\\\"https://github.com/antriver/ctrlv-frontend\\\"><i class=\\\"typ typ-social-github\\\"></i> GitHub</a></li>\\n\" +\n    \"        <li><a ui-sref=\\\"help\\\"><i class=\\\"typ typ-info-large-outline\\\"></i> Help</a></li>\\n\" +\n    \"        <li><a ui-sref=\\\"privacy\\\"><i class=\\\"typ typ-lock-closed-outline\\\"></i> Privacy</a></li>\\n\" +\n    \"        <li><a ui-sref=\\\"terms\\\"><i class=\\\"typ typ-sort-alphabetically-outline\\\"></i> Terms of Use</a></li>\\n\" +\n    \"    </ul>\\n\" +\n    \"</footer>\\n\"\n  );\n\n\n  $templateCache.put('views/partials/header.html',\n    \"<header class=\\\"clearfix\\\">\\n\" +\n    \"    <a ui-sref=\\\"home\\\" id=\\\"logo-container\\\">\\n\" +\n    \"        <img src=\\\"/assets/img/ctrlv.svg\\\" id=\\\"logo\\\" />\\n\" +\n    \"    </a>\\n\" +\n    \"\\n\" +\n    \"    <h1 id=\\\"page-title\\\" ng-bind-html=\\\"title\\\" ng-class=\\\"{'with-subtitle': subtitle}\\\"></h1>\\n\" +\n    \"    <h3 id=\\\"page-subtitle\\\" ng-bind-html=\\\"subtitle\\\"></h3>\\n\" +\n    \"\\n\" +\n    \"    <div  id=\\\"current-user\\\">\\n\" +\n    \"        <div ng-if=\\\"user === false\\\">\\n\" +\n    \"            <a id=\\\"login-btn\\\" class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"login()\\\"><i class=\\\"typ typ-user\\\"></i> Login or Signup</a>\\n\" +\n    \"        </div>\\n\" +\n    \"        <div ng-if=\\\"user\\\">\\n\" +\n    \"            <h2>Hi <a ui-sref=\\\"user({ username: user.username.toLowerCase() })\\\" ng-bind=\\\"user.username\\\"></a></h2>\\n\" +\n    \"            <ul class=\\\"links\\\">\\n\" +\n    \"                <!--<li><a ui-sref=\\\"user-favourites({ username: user.username.toLowerCase() })\\\"><i class=\\\"typ typ-heart-full-outline\\\"></i> Favourites</a></li>-->\\n\" +\n    \"                <li><a ui-sref=\\\"settings\\\"><i class=\\\"typ typ-spanner\\\"></i> Options</a></li>\\n\" +\n    \"                <li><a href=\\\"#\\\" ng-click=\\\"logout()\\\"><i class=\\\"typ typ-lock-open\\\"></i> Logout</a></li>\\n\" +\n    \"            </ul>\\n\" +\n    \"        </div>\\n\" +\n    \"    </div>\\n\" +\n    \"</header>\\n\"\n  );\n\n\n  $templateCache.put('views/partials/image-list.html',\n    \"<ul ng-if=\\\"images.length > 0\\\" class=\\\"img-grid\\\">\\n\" +\n    \"    <li ng-repeat=\\\"image in images\\\">\\n\" +\n    \"        <a\\n\" +\n    \"            ui-sref=\\\"image({ imageId: image.imageId })\\\"\\n\" +\n    \"            ng-style=\\\"{'background-image': image.thumbnail ? '' : 'url('+ image.image.url + ')'}\\\"\\n\" +\n    \"            >\\n\" +\n    \"            <img ng-if=\\\"image.thumbnail\\\" class=\\\"img-thumb\\\" ng-src=\\\"{{ image.thumbnail.url }}\\\" />\\n\" +\n    \"        </a>\\n\" +\n    \"    </li>\\n\" +\n    \"</ul>\\n\" +\n    \"\\n\" +\n    \"<paginator ng-hide=\\\"totalPages === 1\\\" class=\\\"sidebar sidebar-right\\\" total-pages=\\\"totalPages\\\" current-page=\\\"currentPage\\\" url=\\\"url\\\" change-page=\\\"changePage\\\"></paginator>\\n\"\n  );\n\n\n  $templateCache.put('views/partials/paginator.html',\n    \"<ul>\\n\" +\n    \"    <li ng-repeat=\\\"page in pages track by $index\\\" ng-class=\\\"{'active':currentPage === page}\\\">\\n\" +\n    \"        <a ng-if=\\\"page != '...'\\\" ng-click=\\\"changePage($event, page)\\\" href=\\\"{{url}}/{{page}}\\\">{{ page }}</a>\\n\" +\n    \"        <span ng-if=\\\"page === '...'\\\">...</span>\\n\" +\n    \"    </li>\\n\" +\n    \"</ul>\\n\"\n  );\n\n\n  $templateCache.put('views/user.html',\n    \"<ng-include src=\\\"'views/partials/image-list.html'\\\"></ng-include>\\n\" +\n    \"\\n\" +\n    \"<ng-include src=\\\"'views/partials/albums-sidebar.html'\\\"></ng-include>\\n\"\n  );\n\n}]);\n","app.controller(\n    'AlbumController',\n    function ($scope, $rootScope, $state, $compile, $stateParams, AuthService, AlbumResource) {\n\n        console.log('AlbumController');\n\n        $rootScope.loading = true;\n        $rootScope.title = '';\n        $rootScope.subtitle = '';\n\n        $scope.images = [];\n        $scope.albums = [];\n\n        $scope.album = null;\n        $scope.albumId = $stateParams.albumId;\n\n        $scope.currentPage = 1;\n        $scope.totalPages = 0;\n        $scope.url = '/album/' + $scope.albumId;\n\n        // Redirect to just /album if we're on /album/1\n        if ($stateParams.page === 1) {\n            $state.go('user', {albumId: $scope.albumId});\n            return;\n        }\n\n        AlbumResource.get({albumId: $scope.albumId}, function(album) {\n            console.log(album);\n\n            $scope.album = album;\n            $scope.albums = album.user.albums;\n\n            $rootScope.title = '<i class=\"typ typ-folder-open\"></i> ' + album.title;\n\n            var subtitle = '<span>';\n            if (album.user) {\n                subtitle += '<i class=\"typ typ-user\"></i> An Album By <a ui-sref=\"user({username: album.user.username.toLowerCase()})\">' + album.user.username + '</a>';\n            }\n            subtitle += '</span>';\n            $rootScope.subtitle = $compile(subtitle)($scope)[0].innerHTML;\n        });\n\n        function loadPage(page) {\n            $scope.currentPage = page;\n            $rootScope.loading = true;\n            AlbumResource.getImages({albumId: $scope.albumId, page: page}, function(data) {\n                $rootScope.loading = false;\n                $scope.images = data.images;\n                $scope.totalPages = data.lastPage;\n            });\n        }\n\n        $scope.changePage = function($event, page) {\n            $event.stopPropagation();\n\t        $event.preventDefault();\n\n            $state.go('album-page', {albumId: $scope.albumId, page: page}, {notify: false});\n            loadPage(page);\n        };\n\n        loadPage($stateParams.page ? $stateParams.page : 1);\n    }\n);\n","app.controller(\n    'HeaderController',\n    function ($scope, $rootScope, ModalService, AuthService) {\n\n        $scope.login = function() {\n            // Just provide a template url, a controller and call 'showModal'.\n            ModalService.showModal({\n                templateUrl: 'views/modals/login.html',\n                controller: 'LoginModalController'\n            }).then(function(modal) {\n                // The modal object has the element built, if this is a bootstrap modal\n                // you can call 'modal' to show it, if it's a custom modal just show or hide\n                // it as you need to.\n                //modal.element.modal();\n                modal.close.then(function(result) {\n                    $scope.message = result ? \"You said Yes\" : \"You said No\";\n                });\n            });\n        };\n\n        $scope.logout = function() {\n            AuthService.logout();\n        };\n\n        $scope.signup = function() {\n            alert('signup');\n        };\n\n    }\n);\n","app.controller(\n    'HomeController',\n    function ($scope, $rootScope, $timeout) {\n\n        $rootScope.title = '';\n        $rootScope.subtitle = '';\n\n        var sprites = [];\n        for (var i = 0; i < 20; i++) {\n            sprites.push('<span class=\"homesprite homesprite-' + i + '\"></span>');\n        }\n        sprites.shuffle();\n        $scope.sprites = sprites.join('');\n\n        $scope.mac = navigator.platform === \"MacIntel\";\n\n        $timeout(function() {\n            $scope.test = true;\n        }, 1000);\n    }\n);\n","app.controller(\n    'ImageController',\n    function ($scope, $rootScope, $state, $element, $stateParams, $compile, AuthService, ImageResource, AlbumResource, ModalService) {\n\n        $scope.albumId = null;\n        $scope.albumImages = [];\n        $scope.image = null;\n        $scope.imageId = $stateParams.imageId;\n        $scope.editing = false;\n\n        $rootScope.loading = true;\n        $rootScope.title = '';\n        $rootScope.subtitle = '';\n\n        $scope.init = function () {\n\n            if ($stateParams.albumId) {\n                $scope.loadAlbumImages($stateParams.albumId);\n            }\n\n            ImageResource.get({imageId: $stateParams.imageId}, function (response) {\n                $scope.image = response.image;\n                $rootScope.loading = false;\n\n                // TODO: If the image is passworded show login prompt\n                // Show errors\n                // If anon or passworded, refresh on logout\n\n                var title = '';\n                if ($scope.image.title) {\n                    title = $scope.image.title;\n                } else {\n                    title = '<i class=\"typ typ-image\"></i> Image #' + $scope.image.imageId;\n                }\n                $rootScope.title = title;\n\n                var subtitle = '<span>';\n                if ($scope.image.userId) {\n                    subtitle += '<i class=\"typ typ-user\"></i> By <a ui-sref=\"user({username: image.user.username.toLowerCase()})\">' + $scope.image.user.username + '</a>';\n                }\n                subtitle += '<i class=\"typ typ-time\"></i> <span title=\"' + moment($scope.image.createdAt).format(\"dddd, MMMM Do YYYY, h:mm:ss a\") + '\">' + moment($scope.image.createdAt).fromNow() + '</span>';\n\n                if ($scope.image.album) {\n                    subtitle += '<i class=\"typ typ-folder-open\"></i> In <a ui-sref=\"album({albumId: image.album.albumId})\">' + $scope.image.album.title + '</a>';\n                }\n                subtitle += '</span>';\n\n                $rootScope.subtitle = $compile(subtitle)($scope)[0].innerHTML;\n\n                if ($scope.image.albumId && $scope.image.albumId !== $scope.albumId) {\n                    $scope.loadAlbumImages($scope.image.albumId);\n                }\n            });\n        };\n\n        $scope.loadAlbumImages = function (albumId) {\n            $scope.albumId = albumId;\n            // Get the images in the album to show on the left\n            AlbumResource.getImages({albumId: albumId}, function (data) {\n                $scope.albumImages = data.images;\n            });\n        };\n\n        /**\n         * Sidebar Buttons\n         */\n\n        $scope.showTextDialog = function () {\n            ModalService.showModal({\n                templateUrl: 'views/modals/image-text.html',\n                controller: function ($scope, close, image) {\n                    $scope.image = image;\n                    $scope.text = ImageResource.getText({imageId: image.imageId});\n                    $scope.close = close;\n                },\n                inputs: {\n                    image: $scope.image\n                }\n            });\n        };\n\n        $scope.showEmbedDialog = function () {\n            ModalService.showModal({\n                templateUrl: 'views/modals/image-embed.html',\n                controller: function ($scope, close, image) {\n                    $scope.image = image;\n                    $scope.close = close;\n                },\n                inputs: {\n                    image: $scope.image\n                }\n            });\n        };\n\n        $scope.shareOnFb = function () {\n            var url = 'https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent($scope.image.url);\n            window.open(url);\n        };\n\n        $scope.shareOnTwitter = function () {\n            var url = 'https://twitter.com/home?status=' + encodeURIComponent($scope.image.url);\n            window.open(url);\n        };\n\n        /**\n         * Annotating\n         */\n\n        $scope.annotating = false;\n        $scope.savingAnnotation = false;\n        $scope.annotationColorVisible = false;\n        $scope.annotationSizeVisible = false;\n        $scope.annotationColors = [\n            '000000',\n            'B2B2B2',\n            '823914',\n            'CC0000',\n            'FF7519',\n            'FFCC66',\n            'FFFF00',\n            '009933',\n            '99FF66',\n            '3333FF',\n            '99CCFF',\n            '66FFFF',\n            '9933FF',\n            'FF3399',\n            'FF99FF',\n            'ffffff',\n        ];\n        $scope.annotationSizes = [\n            2,\n            5,\n            15,\n            40\n        ];\n\n        /**\n         * @type {Doodle}\n         */\n        $scope.doodle = null;\n\n        $scope.annotate = function () {\n            var element = document.createElement('annotator');\n            element.setAttribute('doodle', 'doodle');\n            var annotator = angular.element(element);\n\n            $element.append($compile(annotator)($scope));\n            $scope.annotating = true;\n        };\n\n        $scope.showAnnotationColor = function () {\n            // Toggle display of the color picker\n            $scope.annotationColorVisible = $scope.annotationColorVisible ? false : true;\n            $scope.annotationSizeVisible = false;\n        };\n\n        $scope.setAnnotationColor = function (color) {\n            $scope.doodle.color = '#'+color;\n        };\n\n        $scope.showAnnotationSize = function () {\n            // Toggle display of the size picker\n            $scope.annotationSizeVisible = $scope.annotationSizeVisible ? false : true;\n            $scope.annotationColorVisible = false;\n        };\n\n        $scope.setAnnotationSize = function (px) {\n            $scope.doodle.lineThickness = px;\n        };\n\n        $scope.saveAnnotation = function () {\n\n            if ($scope.savingAnnotation) {\n                return false;\n            }\n\n            var annotation = $scope.doodle.getImage();\n\n            $scope.savingAnnotation = true;\n\n            ImageResource.annotate(\n                {imageId: $scope.imageId},\n                {base64:annotation},\n                function (response) {\n                    $scope.savingAnnotation = false;\n                    $scope.image = response.image;\n                    $scope.exitAnnotation();\n                }, function (response) {\n                    $scope.savingAnnotation = false;\n                    alert(response.data.message);\n                }\n            );\n        };\n\n        $scope.undoAnnotation = function () {\n            $scope.doodle.undo();\n        };\n\n        $scope.restartAnnotation = function () {\n            $scope.doodle.clear();\n        };\n\n        $scope.exitAnnotation = function () {\n            $scope.annotationColorVisible = false;\n            $scope.annotationSizeVisible = false;\n            $scope.annotating = false;\n            $scope.doodle = null;\n            $('annotator').remove();\n        };\n\n        /**\n         * Cropping\n         */\n\n        $scope.cropCoords = null;\n        $scope.cropping = false;\n        $scope.savingCrop = false;\n        $scope.jcrop = null;\n\n        $scope.crop = function () {\n            if ($scope.editing) {\n                return false;\n            }\n            $scope.cropping = true;\n            $scope.jcrop = $.Jcrop('#img', {\n                onChange: function (c) {\n                    $scope.cropCoords = c;\n                }\n            });\n        };\n\n        $scope.saveCrop = function () {\n\n            if ($scope.savingCrop) {\n                return false;\n            }\n\n            // How much is the image scaled on screen\n            var scale = $scope.getImageScale();\n\n            var params = {\n                imageId: $scope.imageId,\n                width: Math.round($scope.cropCoords.w / scale),\n                height: Math.round($scope.cropCoords.h / scale),\n                x: Math.round($scope.cropCoords.x / scale),\n                y: Math.round($scope.cropCoords.y / scale),\n            };\n            $scope.savingCrop = true;\n            ImageResource.crop(\n                params,\n                function (response) {\n                    $scope.exitCrop();\n                    $scope.image = response.image;\n                },\n                function (response) {\n                    $scope.savingCrop = false;\n                    alert(response.data.message);\n                }\n            );\n        };\n\n        $scope.exitCrop = function () {\n            $scope.jcrop.destroy();\n            $scope.cropCoords = null;\n            $scope.cropping = false;\n            $scope.jcrop = null;\n            $scope.savingCrop = false;\n            // Undo what jcrop did\n            $('#img').css({width: '', height: ''});\n        };\n\n        $scope.rotate = function () {\n            if ($scope.editing) {\n                return false;\n            }\n            $scope.editing = true;\n            $scope.rotating = true;\n            ImageResource.rotate(\n                {\n                    imageId: $scope.image.imageId\n                },\n                function (response) {\n                    $scope.editing = false;\n                    $scope.rotating = false;\n                    $scope.image = response.image;\n                },\n                function (response) {\n                    $scope.editing = false;\n                    $scope.rotating = false;\n                    alert(response.data.message);\n                }\n            );\n        };\n\n        $scope.revert = function () {\n            if ($scope.editing) {\n                return false;\n            }\n\n            if (!confirm(\"This will undo and cropping and remove any annotation. Are you sure you want to do this?\")) {\n                return false;\n            }\n\n            $scope.editing = true;\n            $scope.reverting = true;\n            ImageResource.revert(\n                {\n                    imageId: $scope.image.imageId\n                },\n                function (response) {\n                    $scope.editing = false;\n                    $scope.reverting = false;\n                    $scope.image = response.image;\n                },\n                function (response) {\n                    $scope.editing = false;\n                    $scope.reverting = false;\n                    alert(response.data.message);\n                }\n            );\n        };\n\n        $scope.showPrivacyDialog = function () {\n            ModalService.showModal({\n                templateUrl: 'views/modals/image-privacy.html',\n                controller: function ($scope, close, image) {\n                    $scope.image = image;\n                    $scope.close = close;\n\n                    $scope.setAnon = function (anon) {\n                        ImageResource.update({'imageId': $scope.image.imageId},\n                        {\n                            anonymous:anon\n                        }, function(res)\n                        {\n                            $scope.image = res.image;\n                            $scope.$parent.image = res.image;\n                        });\n                    };\n\n                    $scope.setPassword = function () {\n\n                    };\n\n                },\n                inputs: {\n                    image: $scope.image\n                }\n            });\n        };\n\n        $scope.delete = function () {\n            if ($scope.editing) {\n                return false;\n            }\n\n            if (!confirm(\"Are you sure you want to delete this image?\")) {\n                return false;\n            }\n\n            $scope.editing = true;\n            $scope.deleting = true;\n            ImageResource.delete(\n                {\n                    imageId: $scope.image.imageId\n                },\n                function () {\n                    $scope.editing = false;\n                    $scope.deleting = false;\n                    $scope.image = null;\n                },\n                function (response) {\n                    $scope.editing = false;\n                    $scope.deleting = false;\n                    alert(response.data.message);\n                }\n            );\n        };\n\n        $scope.showReportDialog = function () {\n\n        };\n\n        /**\n         * Returns how much the image is scaled to fit on the screen.\n         */\n        $scope.getImageScale = function () {\n            return parseInt($('#img').width()) / $scope.image.image.width;\n        };\n\n        $scope.init();\n    }\n);\n","app.controller(\n    'LoginModalController',\n    function ($scope, close, AuthService, UserResource) {\n\n        $scope.loginData = {\n            loading: false,\n            username: '',\n            password: '',\n            errors: {}\n        };\n\n        $scope.signupData = {\n            loading: false,\n            username: '',\n            password: '',\n            email: '',\n            errors: {}\n        };\n\n        $scope.fb = function () {\n            alert(':(');\n        };\n\n        $scope.forgot = function () {\n            alert('lol');\n        };\n\n        $scope.login = function () {\n            if ($scope.loginData.loading) {\n                return false;\n            }\n            $scope.loginData.errors = {};\n            $scope.loginData.loading = true;\n\n            AuthService\n                .login($scope.loginData.username, $scope.loginData.password)\n                .then(\n                    function (response) {\n                        $scope.loginData.loading = false;\n\n                        close();\n                    },\n                    function (response) {\n                        $scope.loginData.loading = false;\n\n                        if (\n                            response.messages\n                            &&\n                            (\n                                response.messages.hasOwnProperty('username')\n                                ||\n                                response.messages.hasOwnProperty('password')\n                            )\n                        ) {\n                            $scope.loginData.errors = response.messages;\n                        } else {\n\n                            $scope.loginData.errors = {\n                                general: response.message\n                            };\n                        }\n\n                    }\n                );\n        };\n\n\n        $scope.signup = function () {\n            if ($scope.signupData.loading) {\n                return false;\n            }\n            $scope.signupData.errors = {};\n            $scope.signupData.loading = true;\n\n            UserResource.save({\n                username: $scope.signupData.username,\n                password: $scope.signupData.password,\n                email: $scope.signupData.email,\n            }, function(response) {\n\n                AuthService\n                    .login($scope.signupData.username, $scope.signupData.password)\n                    .then(\n                        function (response) {\n                            $scope.signupData.loading = false;\n                            close();\n                        },\n                        function (response) {\n                            $scope.signupData.loading = false;\n                            $scope.signupData.errors = {\n                                general: response.message\n                            };\n                        }\n                    );\n\n            }, function (response) {\n                $scope.signupData.loading = false;\n\n                response = response.data;\n                if (\n                    response.messages\n                    &&\n                    (\n                        response.messages.hasOwnProperty('username')\n                        ||\n                        response.messages.hasOwnProperty('password')\n                        ||\n                        response.messages.hasOwnProperty('email')\n                    )\n                ) {\n                    $scope.signupData.errors = response.messages;\n                } else {\n\n                    $scope.signupData.errors = {\n                        general: response.message\n                    };\n                }\n            });\n        };\n\n        $scope.close = close;\n\n    }\n);\n","app.controller(\n    'UserController',\n    function ($scope, $rootScope, $state, $stateParams, AuthService, UserResource) {\n\n        console.log('UserController');\n\n        $rootScope.loading = true;\n        $rootScope.title = '';\n        $rootScope.subtitle = '';\n\n        $scope.images = [];\n        $scope.albums = [];\n        $scope.user = null;\n        $scope.username = $stateParams.username;\n        $scope.currentPage = 1;\n        $scope.totalPages = 0;\n        $scope.url = '#';\n\n        // Redirect to just /username if we're on /username/1\n        if ($stateParams.page === 1) {\n            $state.go('user', {username: $scope.username});\n            return;\n        }\n\n        UserResource.get({username: $scope.username}, function(user) {\n            $rootScope.title = '<i class=\"typ typ-user\"></i> ' + user.username + \"'s Images\";\n            $scope.user = user;\n            $scope.albums = user.albums;\n            $scope.url = '/user/' + user.username;\n        });\n\n        function loadPage(page) {\n            $scope.currentPage = page;\n            $rootScope.loading = true;\n            UserResource.getImages({username: $scope.username, page: page}, function(data) {\n                $rootScope.loading = false;\n                $scope.images = data.images;\n                $scope.totalPages = data.lastPage;\n            });\n        }\n\n        $scope.changePage = function($event, page) {\n            $event.stopPropagation();\n\t        $event.preventDefault();\n\n            $state.go('user-page', {username: $scope.username, page: page}, {notify: false});\n            loadPage(page);\n        };\n\n        loadPage($stateParams.page ? $stateParams.page : 1);\n    }\n);\n","app.directive('annotator', function ($window, debounce) {\n    return {\n        restrict: 'E',\n        controller: function ($scope, $element) {\n\n            var imageEl = $('#img');\n\n            $scope.doodle = new Doodle($element[0]);\n            $scope.doodle.init();\n\n            var moveAndResize = function() {\n                var imgOffset = imageEl.offset();\n                $element.css({\n                    left: imgOffset.left + 1,\n                    top: imgOffset.top + 1,\n                });\n                $scope.doodle.canvas.width = imageEl.width();\n                $scope.doodle.canvas.height = imageEl.height();\n            };\n\n            moveAndResize();\n\n            var debouncedRedraw = debounce(200, function() {\n                $scope.doodle.redraw();\n            });\n\n            angular.element($window).bind('resize', function() {\n                moveAndResize();\n                debouncedRedraw();\n            });\n\n        },\n        scope: {\n            doodle: '=',\n        },\n        template: ''\n    };\n});\n","app.directive('paginator', function factory($window, debounce) {\n    return {\n        restrict: 'E',\n        controller: function ($scope, $element) {\n            var calculatePages = function () {\n\n                // Only 1 page - don't need a paginator\n                if ($scope.totalPages <= 1) {\n                    return [1];\n                }\n\n                var pages = [];\n                var i;\n                var paginatorHeight = $element.height();\n\n                // How tall is one link in the paginator\n                var spaceHeight = 46;\n\n                var totalSpaces = Math.floor(paginatorHeight / spaceHeight);\n\n                // Round down to the next odd number\n                if (totalSpaces % 2 === 0) {\n                    totalSpaces -= 1;\n                }\n\n                // All page numbers fit on screen\n                if ($scope.totalPages <= totalSpaces) {\n                    for (i = 1; i <= $scope.totalPages; i++) {\n                        pages.push(i);\n                    }\n                    return pages;\n                }\n\n                var adjacent = Math.floor((totalSpaces - 5) / 2);\n\n                if ($scope.currentPage <= (adjacent + 3)) {\n                    // Close to the start - don't hide first pages\n                    for (i = 1; i <= totalSpaces - 2; i++) {\n                        pages.push(i);\n                    }\n                    pages.push('...');\n                    pages.push($scope.totalPages);\n\n                } else if ($scope.currentPage >= $scope.totalPages - (adjacent) - 2) {\n                    // Close to the end - don't hide last pages\n                    pages = [1, '...'];\n                    for (i = $scope.totalPages - (adjacent*2) - 2; i <= $scope.totalPages; i++) {\n                        pages.push(i);\n                    }\n\n                } else {\n                    pages = [1, '...'];\n                    for (i = $scope.currentPage - adjacent; i <= $scope.currentPage + adjacent; i++) {\n                        pages.push(i);\n                    }\n                    pages.push('...');\n                    pages.push($scope.totalPages);\n                }\n\n                return pages;\n            };\n\n            $scope.pages = calculatePages();\n\n            // Recalculate on page change\n            $scope.$watchGroup(['totalPages', 'currentPage'], function () {\n                $scope.pages = calculatePages();\n            });\n\n            // Recalculate on window resize\n            var debouncedCalculatePages = debounce(100, function() {\n                $scope.pages = calculatePages();\n            });\n            angular.element($window).bind('resize', function() {\n                debouncedCalculatePages();\n            });\n\n        },\n        scope: {\n            currentPage: '=',\n            totalPages: '=',\n            url: '=',\n            changePage: '=',\n        },\n        templateUrl: 'views/partials/paginator.html'\n    };\n});\n","/**\n * Source: http://stackoverflow.com/a/32574746/710630\n */\n(function () {\n    'use strict';\n\n    app.directive(\n        'stateBodyClass',\n        function ($rootScope) {\n            return {\n                restrict: 'A',\n                scope: {},\n                link: function (scope, elem, attr, ctrl) {\n\n                    $rootScope.$on('$stateChangeSuccess', function (event, toState, toParams, fromState, fromParams) {\n                        var fromClassnames = angular.isDefined(fromState.data) && angular.isDefined(fromState.data.bodyClass) ? fromState.data.bodyClass : null;\n                        var toClassnames = angular.isDefined(toState.data) && angular.isDefined(toState.data.bodyClass) ? toState.data.bodyClass : null;\n\n                        // don't do anything if they are the same\n                        if (fromClassnames != toClassnames) {\n                            if (fromClassnames) {\n                                elem.removeClass(fromClassnames);\n                            }\n\n                            if (toClassnames) {\n                                elem.addClass(toClassnames);\n                            }\n                        }\n                    });\n                }\n            };\n        }\n    );\n\n}());\n","/**\n * Shuffles the items in an array.\n * Source: http://stackoverflow.com/a/10142256/710630\n *\n * @returns {Array}\n */\nArray.prototype.shuffle = function() {\n    var i = this.length, j, temp;\n    if (i === 0) {\n        return this;\n    }\n    while (--i) {\n        j = Math.floor( Math.random() * ( i + 1 ) );\n        temp = this[i];\n        this[i] = this[j];\n        this[j] = temp;\n    }\n    return this;\n};\n","\"use strict\";\n\nvar Doodle = function (element) {\n    this.element = element;\n    this.canvas = null;\n\n    this.lineThickness = 5;\n    this.color = '#000000';\n    this.drawing = false;\n    this.history = [];\n    this.currentData = null;\n\n    var ua = navigator.userAgent.toLowerCase();\n    this.isAndroid = ua.indexOf(\"android\") > -1;\n};\n\n\nDoodle.prototype = {\n\n    init: function () {\n\n        this.canvas = document.createElement('canvas');\n        this.element.appendChild(this.canvas);\n\n        //this.canvas.setAttribute('width', $(this.element).width());\n        //this.canvas.setAttribute('height', $(this.element).height());\n\n        this.context = this.canvas.getContext('2d');\n\n        //Setup a fresh canvas\n        this.color = '#000000';\n        $('#currentColour').css('background-color', this.color);\n        this.clear();\n\n        var self = this;\n\n        // Mouse\n        if (!this.isAndroid) {\n            $(this.canvas).bind('mousedown', function (e) {\n                self.drawStart(e);\n            });\n            $(this.canvas).bind('mousemove', function (e) {\n                self.draw(e);\n            });\n            $(this.canvas).bind('mouseup', function (e) {\n                self.drawEnd(e);\n            });\n            $('body').bind('mouseup', function (e) {\n                self.drawEnd(e);\n            });\n        }\n\n        // Touch\n        $(this.canvas).bind('touchstart', function (e) {\n            self.drawStart(e);\n        });\n        $(this.canvas).bind('touchmove', function (e) {\n            self.draw(e);\n        });\n        $(this.canvas).bind('touchend', function (e) {\n            self.drawEnd(e);\n        });\n    },\n\n    clear: function () {\n        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);\n        this.context.fillStyle = this.color;\n        this.history = [];\n    },\n\n    getImage: function (e) {\n        if (this.history.length < 1) {\n            return false;\n        }\n        return this.canvas.toDataURL(\"image/png\");\n    },\n\n    saveHistoryState: function () {\n        // Limit history size\n        while (this.history.length >= 30) {\n            this.history.shift();\n        }\n        this.history.push(this.context.getImageData(0, 0, this.canvas.width, this.canvas.height));\n    },\n\n    saveCurrentData: function () {\n        this.currentData = this.context.getImageData(0, 0, this.canvas.width, this.canvas.height);\n    },\n\n    undo: function () {\n        if (this.history.length > 0) {\n            var imageData = this.history.pop();\n            this.putImageData(imageData);\n        } else {\n            alert('Nothing to undo!');\n        }\n    },\n\n    redraw: function () {\n        if (this.currentData) {\n            this.putImageData(this.currentData);\n        }\n    },\n\n    putImageData: function (imageData) {\n        if (imageData.width === this.canvas.width) {\n            this.context.putImageData(imageData, 0, 0);\n        } else {\n            // Draw it to a new canvas to resize it\n            var scale = this.canvas.width / imageData.width;\n\n            var newCanvas = $('<canvas>')\n                .attr('width', imageData.width)\n                .attr('height', imageData.height)[0];\n\n            newCanvas.getContext('2d').putImageData(imageData, 0, 0);\n\n            this.context.scale(scale, scale);\n            this.context.drawImage(newCanvas, 0, 0);\n            this.context.scale(1 / scale, 1 / scale);\n        }\n    },\n\n    drawStart: function (e) {\n        if (e) {\n            e.preventDefault();\n        }\n        this.saveHistoryState();\n\n        var x, y;\n        if (e.originalEvent.touches) {\n            x = e.originalEvent.touches[0].pageX - $(this.canvas).offset().left;\n            y = e.originalEvent.touches[0].pageY - $(this.canvas).offset().top;\n        }\n        else {\n            x = e.pageX - $(this.canvas).offset().left;\n            y = e.pageY - $(this.canvas).offset().top;\n        }\n\n        this.drawing = true;\n        $(this.canvas).addClass('drawing');\n\n        this.context.lineWidth = this.lineThickness;\n        this.context.lineCap = \"round\";\n        this.context.lineJoin = \"round\";\n        this.context.strokeStyle = this.color;\n        this.context.fillStyle = this.color;\n\n        this.oldX = x;\n        this.oldY = y;\n\n        // Draw a dot at the current position\n        this.context.beginPath();\n        this.context.arc(x, y, (this.lineThickness / 2), 0, 2 * Math.PI, false);\n        this.context.closePath();\n        this.context.fill();\n\n        this.context.beginPath();\n    },\n\n    draw: function (e) {\n        if (e) {\n            e.preventDefault();\n        }\n\n        var x, y;\n        if (e.originalEvent.touches) {\n            x = e.originalEvent.touches[0].pageX - $(this.canvas).offset().left;\n            y = e.originalEvent.touches[0].pageY - $(this.canvas).offset().top;\n        }\n        else {\n            x = e.pageX - $(this.canvas).offset().left;\n            y = e.pageY - $(this.canvas).offset().top;\n        }\n\n        if (this.drawing) {\n            this.context.moveTo(this.oldX, this.oldY);\n            this.context.lineTo(x, y);\n            this.context.stroke();\n        }\n\n        this.oldX = x;\n        this.oldY = y;\n    },\n\n    drawEnd: function (e) {\n        if (e) {\n            e.preventDefault();\n        }\n\n        if (this.drawing) {\n            this.context.closePath();\n            this.context.stroke();\n            this.drawing = false;\n        }\n\n        this.saveCurrentData();\n\n        $(this.canvas).removeClass('drawing');\n    },\n\n    rgbToHex: function (rgb) {\n        var hexDigits = new Array(\"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"a\", \"b\", \"c\", \"d\", \"e\", \"f\");\n\n        function hex(x) {\n            return isNaN(x) ? \"00\" : hexDigits[(x - x % 16) / 16] + hexDigits[x % 16];\n        }\n\n        rgb = rgb.match(/^rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)$/);\n        return \"#\" + hex(rgb[1]) + hex(rgb[2]) + hex(rgb[3]);\n    }\n};\n","var ImagePaster = (function () {\n    \"use strict\";\n\n    var ImagePaster = function (url) {\n        this.debug = true;\n        this.url = url;\n        this.pasteCatcher = null;\n        this.init();\n    };\n\n    ImagePaster.prototype.log = function (data, extra) {\n        if (this.debug) {\n            console.log(data, extra);\n        }\n    };\n\n    ImagePaster.prototype.init = function () {\n\n        var self = this;\n\n        /**\n         * Firefox allows images to be pasted into contenteditable elements.\n         * So create one of those on the page and make it have focus,\n         * so paste events happen into that\n         */\n\n        // Create paste catcher element\n        self.pasteCatcher = document.createElement('div');\n        self.pasteCatcher.setAttribute('contenteditable', '');\n        self.pasteCatcher.setAttribute('style', 'position:absolute; opacity:0; top:0; left:0; width:0; height:0;');\n        self.pasteCatcher.id = 'paste-catcher';\n        document.body.appendChild(self.pasteCatcher);\n        self.pasteCatcher.focus();\n\n        // Listen for the 'paste' event on the body\n        //if (browserName == 'IE') {\n        //$('body').on('paste', function(event) { self.onPaste(event); });\n        //} else {\n        document.addEventListener('paste', function (event) {\n            self.onPaste(event);\n        });\n        //}\n\n        // Watch for ctrl + v being pressed\n        $(document).on('keydown', function (e) {\n            // 86 = v\n            if (e.which === 86 && (e.ctrlKey || e.metaKey)) {\n                $(document).trigger('ctrlVPressed');\n            }\n        });\n\n        // Focus paste catcher when cmd or ctrlv is pressed\n        $(document).on('ctrlVPressed', function () {\n            self.pasteCatcher.focus();\n        });\n\n    };\n\n    ImagePaster.prototype.onPaste = function (event) {\n\n        var self = this;\n        var done = false;\n        var clipboardData;\n\n        self.log('onPaste', JSON.stringify(event));\n\n        if (event.clipboardData) {\n            // Chrome\n            clipboardData = event.clipboardData;\n        } else if (window.clipboardData) {\n            // IE\n            clipboardData = window.clipboardData;\n        } else {\n            // Firefox\n            //setTimeout(this.checkPasteCatcher, 1);\n        }\n\n        // IE\n        if (event.msConvertURL) {\n            var fileList = clipboardData.files;\n            if (fileList.length > 0) {\n                for (var i = 0; i < fileList.length; i++) {\n                    self.uploadBlob(fileList[i]);\n                    done = true;\n                }\n            }\n        }\n\n        // Check if there is something in the paste event itself\n        if (clipboardData && clipboardData.items) {\n\n            var text;\n            // If there was some text on the clipboard,\n            // it might be a URL. Try and paste that...\n            if ((text = clipboardData.getData(\"text/plain\"))) {\n                self.uploadText(text);\n                self.clearPasteCatcher();\n                return;\n            }\n\n            // Loop through all the clipboardData\n            for (var x = 0; x < clipboardData.items.length; x++) {\n                // If this clipboard item claims to be an image, upload it\n                if (clipboardData.items[x].type.indexOf('image') !== -1) {\n                    self.uploadBlob(clipboardData.items[x].getAsFile());\n                    done = true;\n                }\n            }\n        }\n\n        // If there was nothing found in the clipboard data\n        // fall back to checking if there's anything in the editable element\n        if (done) {\n            self.clearPasteCatcher();\n        } else {\n            setTimeout(\n                function () {\n                    self.checkPasteCatcher();\n                },\n                10\n            );\n        }\n    };\n\n    /**\n     * Check if anything has been pasted into the paste catcher element\n     * (Firefox + Safari?)\n     */\n    ImagePaster.prototype.checkPasteCatcher = function () {\n\n        var text = this.pasteCatcher.innerHTML;\n        var child = this.pasteCatcher.childNodes[0];\n\n        if (child) {\n            if (child.tagName === 'IMG') {\n                if (child.src.indexOf('webkit-fake-url://') != -1) {\n                    this.onFail('Sorry, Safari does not currently support pasting images.');\n                    return false;\n                }\n                this.uploadImage(child.src);\n            } else if (child.tagName === 'A') {\n                this.uploadText(child.href);\n            } else {\n                this.uploadText(text);\n            }\n        }\n\n        this.clearPasteCatcher();\n    };\n\n    ImagePaster.prototype.clearPasteCatcher = function () {\n        var self = this;\n        setTimeout(\n            function () {\n                self.pasteCatcher.innerHTML = '';\n            },\n            1\n        );\n    };\n\n    ImagePaster.prototype.uploadBlob = function (blob) {\n        if (blob) {\n            var self = this;\n            var reader = new FileReader();\n            reader.onload = function (evt) {\n                self.uploadImage(evt.target.result);\n            };\n            reader.readAsDataURL(blob);\n        }\n    };\n\n    ImagePaster.prototype.uploadText = function (text) {\n        return this.upload('text', text);\n\n        /*if (this.validateURL(url)) {\n         upload('url', url);\n         } else {\n         failedUpload(\"Can't upload that. Try pasting an image or URL.\");\n         }*/\n    };\n\n    ImagePaster.prototype.uploadImage = function (base64) {\n        return this.upload('uploadImage', base64);\n\n        /*convertImageToJpeg(base64, function(jpegBase64){\n         upload('base64', jpegBase64);\n         });*/\n    };\n\n    /*ImagePaster.prototype.convertImageToJpeg = function(base64, callback)\n     {\n     //Convert image to a JPG so it's faster to upload\n     var img = new Image();\n     img.onload = function()\n     {\n     var canvas = convertImageToCanvas(this);\n     var data = canvas.toDataURL('image/jpeg' , 0.8);\n     callback(data);\n     };\n     img.src = base64;\n     };*/\n\n    /*ImagePaster.prototype.convertImageToCanvas = function(image)\n     {\n     var canvas = document.createElement(\"canvas\");\n     canvas.width = image.width;\n     canvas.height = image.height;\n\n     var context = canvas.getContext(\"2d\");\n     context.fillStyle = \"#ffffff\";\n     context.fillRect(0,0,image.width,image.height);\n     context.drawImage(image, 0, 0);\n\n     return canvas;\n     };*/\n\n    ImagePaster.prototype.upload = function (format, data) {\n\n        var self = this;\n        $(document).trigger('ctrlvuploadstart');\n\n        var url = this.url;\n        if (typeof url === 'function') {\n            url = url();\n        }\n\n        $.ajax({\n            url: url,\n            timeout: 90000,\n            type: 'POST',\n            data: {\n                format: format,\n                base64: data\n            },\n            error: function (jqXHR, textStatus) {\n                // Turn this error message into something useful\n                var message;\n                switch (textStatus) {\n                    case 'timeout':\n                        message = 'The image took too long to upload';\n                        break;\n                    case 'error':\n\n                        if (jqXHR.responseJSON && jqXHR.responseJSON.message) {\n                            message = 'CtrlV server error (' + jqXHR.responseJSON.errorType + ' ' + jqXHR.responseJSON.message + ')';\n                        } else if (jqXHR.status !== 0) {\n                            message = 'CtrlV server error (' + jqXHR.status + ' ' + jqXHR.statusText + ')';\n                        } else {\n                            message = 'Can\\'t connect to the CtrlV server';\n                        }\n                        break;\n                    case 'abort':\n                        message = 'The upload was cancelled';\n                        break;\n                    case 'parsererror':\n                        message = 'Error uploading: couldn\\'t decode the response from the server';\n                        break;\n                    default:\n                        message = textStatus;\n                        break;\n                }\n\n                self.onFail(message);\n            },\n            success: function (res) {\n                if (res.image) {\n                    $(document).trigger({\n                        type: 'ctrlvuploadcomplete',\n                        image: res.image\n                    });\n                } else {\n                    self.onFail(res.message);\n                }\n            }\n        });\n    };\n\n    ImagePaster.prototype.onFail = function (message) {\n        $(document).trigger({\n            type: 'ctrlvuploaderror',\n            message: message ? message : false\n        });\n    };\n\n    ImagePaster.prototype.validateURL = function (text) {\n        var regex = new RegExp(\"^(http|https|ftp)\\://([a-zA-Z0-9\\.\\-]+(\\:[a-zA-Z0-9\\.&amp;%\\$\\-]+)*@)*((25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9])\\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])|([a-zA-Z0-9\\-]+\\.)*[a-zA-Z0-9\\-]+\\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(\\:[0-9]+)*(/($|[a-zA-Z0-9\\.\\,\\?\\'\\\\\\+&amp;%\\$#\\=~_\\-]+))*$\");\n        return regex.test(text);\n    };\n\n    return ImagePaster;\n}());\n","app.factory(\n    'AlbumResource',\n    function ($resource, AuthService) {\n        return $resource(\n            apiUrl + 'albums/:albumId',\n            {\n                albumId: '@albumId',\n                sessionKey: function() {\n                    return AuthService.getSessionKey() || null;\n                }\n            },\n            {\n                get: {\n                    cache: true,\n                    transformResponse: function(data) {\n                        data = angular.fromJson(data);\n                        return data.album;\n                    }\n                },\n\n                getImages: {\n                    cache: true,\n                    url: apiUrl + 'albums/:albumId/images',\n                    //isArray: true,\n                    transformResponse: function(data) {\n                        var data = angular.fromJson(data);\n                        return data;\n                    }\n                }\n\n            }\n        );\n    }\n);\n","app.factory(\n    'ImageResource',\n    function ($resource, AuthService) {\n        return $resource(\n            apiUrl + 'images/:imageId',\n            {\n                imageId: '@imageId',\n                sessionKey: function() {\n                    return AuthService.getSessionKey() || null;\n                }\n            },\n            {\n                get: {\n                    cache: true,\n                },\n\n                update: {\n                    method: 'PUT'\n                },\n\n                getText: {\n                    url: apiUrl + 'images/:imageId/text',\n                    method: 'GET'\n                },\n\n                annotate: {\n                    url: apiUrl + 'images/:imageId/image',\n                    method: 'PUT',\n                    params: {\n                        action: 'annotate'\n                    }\n                },\n\n                crop: {\n                    url: apiUrl + 'images/:imageId/image',\n                    method: 'PUT',\n                    params: {\n                        action: 'crop'\n                    }\n                },\n\n                revert: {\n                    url: apiUrl + 'images/:imageId/image',\n                    method: 'PUT',\n                    params: {\n                        action: 'revert'\n                    }\n                },\n\n                rotate: {\n                    url: apiUrl + 'images/:imageId/image',\n                    method: 'PUT',\n                    params: {\n                        action: 'rotate',\n                        degrees: 90\n                    }\n                },\n            }\n        );\n    }\n);\n","app.factory(\n    'SessionResource',\n    function ($resource) {\n        return $resource(\n            apiUrl + 'sessions/:sessionKey',\n            {},\n            {\n                get: {\n                    transformResponse: function(data) {\n                        data = angular.fromJson(data);\n                        return data.session;\n                    }\n                }\n            }\n        );\n    }\n);\n","app.factory(\n    'UserResource',\n    function ($resource, AuthService) {\n        return $resource(\n            apiUrl + 'users/:username',\n            {\n                username: '@username',\n                sessionKey: function() {\n                    return AuthService.getSessionKey() || null;\n                }\n            },\n            {\n                get: {\n                    cache: true,\n                    transformResponse: function(data) {\n                        var data = angular.fromJson(data);\n                        return data.user;\n                    }\n                },\n\n                save: {\n                    method: 'POST',\n                    url: apiUrl + 'users'\n                },\n\n                getImages: {\n                    cache: true,\n                    url: apiUrl + 'users/:username/images?page=:page',\n                    /*isArray: true,\n                    transformResponse: function(data) {\n                        var data = angular.fromJson(data);\n                        return data.images;\n                    }*/\n                },\n\n                getAlbums: {\n                    cache: true,\n                    url: apiUrl + 'users/:username/albums',\n                    /*isArray: true,\n                    transformResponse: function(data) {\n                        var data = angular.fromJson(data);\n                        return data;\n                    }*/\n                }\n            }\n        );\n    }\n);\n","app.service(\n    'AuthService',\n    function (localStorageService, SessionResource, $q, $rootScope) {\n\n        var session = null;\n        var sessionKey = null;\n\n        return {\n\n            checkSession: function() {\n                var self = this;\n\n                if (sessionKey = localStorageService.get('sessionKey')) {\n                    SessionResource.get(\n                        {sessionKey: sessionKey},\n                        function (session) {\n                            self.onLogin(session, sessionKey);\n                        },\n                        function() {\n                            self.onLogout();\n                        }\n                    );\n                } else {\n                    self.onLogout();\n                }\n            },\n\n            /**\n             * @param username\n             * @param password\n             * @returns $q\n             */\n            login: function(username, password) {\n                var self = this;\n\n                return $q(function(resolve, reject) {\n\n                    SessionResource.save({\n                        username: username,\n                        password: password\n                    }, function(response) {\n\n                        self.onLogin(response.session, response.sessionKey);\n\n                        // Resolve promise (sends back user)\n                        resolve(response.session.user);\n\n                    }, function (response) {\n                        reject(response.data);\n                    });\n\n                });\n            },\n\n            onLogin: function(newSession, newSessionKey) {\n\n                session = newSession;\n                sessionKey = newSessionKey;\n                localStorageService.set('sessionKey', newSessionKey);\n\n                // Tell everybody we're logged in\n                $rootScope.$broadcast('login', {user: newSession.user});\n\n            },\n\n            logout: function() {\n                var self = this;\n\n                SessionResource.delete({\n                    sessionKey: sessionKey\n                });\n\n                self.onLogout();\n\n            },\n\n            onLogout: function() {\n\n                session = false;\n                sessionKey = false;\n                localStorageService.remove('sessionKey');\n\n                // Tell everybody we're logged in\n                $rootScope.$broadcast('logout');\n\n            },\n\n            getSessionKey: function() {\n                return sessionKey;\n            },\n\n            getUser: function() {\n                if (session === null) {\n                    return null;\n                }\n\n                return session && session.user ? session.user : false;\n            }\n        };\n    }\n);\n","app.service(\n    'ImagePasterService',\n    function($state, AuthService) {\n\n        /**\n         * Add listeners for events that ImagePaster broadcasts.\n         */\n        $(document).on('ctrlvuploadstart', function () {\n            $('.upload-status').addClass('out');\n            $('#upload-loading').removeClass('out');\n        });\n\n        $(document).on('ctrlvuploadcomplete', function (e) {\n            $('.upload-status').addClass('out');\n            $('#upload-complete').removeClass('out');\n            var viewUrl = e.image.url;\n            var imageUrl = e.image.image.url;\n            $('#view-btn').attr('href', viewUrl);\n            $('#uploader').css('background-image', 'url(' + imageUrl + ')');\n\n            $state.go('image', {imageId: e.image.imageId});\n\n        });\n\n        $(document).on('ctrlvuploaderror', function (e) {\n            $('.upload-status').addClass('out');\n            $('#upload-error').removeClass('out').find('p').text(e.message);\n        });\n\n        $(document).on('keyup', function (e) {\n            // Highlighting keys when pressing\n            if (e.which == 91 || e.which === 224) { // cmd\n                $('.btn-cmd').removeClass('active');\n            } else if (e.which == 17) { // ctrl\n                $('.btn-ctrl').removeClass('active');\n            } else if (e.which == 86) { // v\n                $('.btn-v').removeClass('active');\n            }\n        });\n\n        $(document).on('keydown', function (e) {\n            // Highlighting keys when pressing\n            if (e.which == 91 || e.which === 224) { // cmd (91 in\n                $('.btn-cmd').addClass('active');\n            } else if (e.which == 17) { // ctrl\n                $('.btn-ctrl').addClass('active');\n            } else if (e.which == 86) { // v\n                $('.btn-v').addClass('active');\n            }\n        });\n\n        var getImageUploadUrl = function() {\n            var url = apiUrl + 'images';\n\n            var sessionKey;\n            if (sessionKey = AuthService.getSessionKey()) {\n                url += '?sessionKey=' + sessionKey;\n            }\n            return url;\n        };\n\n        return new ImagePaster(getImageUploadUrl);\n    }\n);\n"]}