"use strict";var app=angular.module("ctrlv",["ui.router","ngResource","ngSanitize","LocalStorageModule","angularModalService","ngAnimate"]);app.config(function($locationProvider,$stateProvider,$urlRouterProvider,localStorageServiceProvider){$locationProvider.html5Mode(!0),localStorageServiceProvider.setPrefix("ctrlv").setStorageType("localStorage").setStorageCookie(0,"/"),$urlRouterProvider.otherwise("/"),$stateProvider.state("home",{url:"/",templateUrl:"views/home.html",controller:"HomeController",data:{bodyClass:"home"}}).state("help",{url:"/help",templateUrl:"views/help.html",controller:"HelpController"}).state("image",{url:"/{imageId:int}",templateUrl:"views/image.html",controller:"ImageController"}).state("user",{url:"/user/{username:string}",templateUrl:"views/user.html",controller:"UserController"}).state("user-favourites",{url:"/user/{username:string}/favourites",templateUrl:"views/user/favourites.html",controller:"UserFavouritesController"})}),app.run(function($rootScope,AuthService,ImagePasterService){AuthService.checkSession(),console.log("ImagePasterService",ImagePasterService)}),angular.module("ctrlv").run(["$templateCache",function($templateCache){$templateCache.put("views/home.html",'<div id="uploader">\n\n    <div id="uploader-collage" ng-bind-html="sprites"></div>\n\n    <div class="upload-status" id="upload-waiting">\n        <h2>The <span class="green">easiest</span> way to share photos.</h2>\n        <h3>\n            <i class="spinner-waiting"></i>\n            Press <span ng-if="mac" class="btn btn-cmd">cmd &#8984;</span><span ng-if="!mac" class="btn btn-ctrl">Ctrl</span>\n            + <span class="btn btn-v">V</span> to paste an image,\n            or <a href="#" class="btn"><i class="typ typ-cloud-storage"></i> select files to upload</a>\n        </h3>\n    </div>\n\n    <div class="upload-status out" id="upload-loading">\n        <h3><i class="spinner-loading"></i> Uploading...</h3>\n    </div>\n\n    <div class="upload-status out" id="upload-error">\n        <h3>Error</h3>\n        <p></p>\n    </div>\n\n    <div class="upload-status out" id="upload-complete">\n        <h3>Uploaded!</h3>\n        <p>\n            <label>\n                Here\'s your link\n                <input type="text" id="newImageURL" class="green" readonly="readonly" />\n            </label>\n        </p>\n    </div>\n\n</div>\n'),$templateCache.put("views/image.html",'\n\n<div class="img-wrapper">\n\n    <div ng-if="loading">\n        <i class="spinner-loading dark"></i>\n    </div>\n\n    <img\n        ng-if="!loading && image"\n        ng-src="{{ image.image.url }}"\n        class="img"\n        />\n\n    <div ng-if="!loading" class="img-details">\n        Uploaded by <a href="#">Jimmenybillybob</a>\n        <div class="img-tools">\n            <a class="btn">Crop</a>\n            <a class="btn">Rotate</a>\n            <a class="btn">Delete</a>\n        </div>\n    </div>\n\n</div>\n'),$templateCache.put("views/modals/login.html",'<div class="modal" ng-click="close()">\n    <div class="modal-content" ng-click="$event.stopPropagation()">\n\n        <label>Username <input type="text" ng-model="username" name="username" /></label>\n        <label>Password <input type="password" ng-model="password" name="password" /></label>\n\n        <span ng-bind="username"></span>\n        <span ng-bind="password"></span>\n\n        <a class="btn" ng-click="login()">Login</a>\n        <a class="btn" ng-click="close()">Close</a>\n    </div>\n</div>\n'),$templateCache.put("views/partials/album-sidebar.html",'<div class="album-sidebar">\n    <ul ng-if="albumImages.length > 0" ng->\n        <li ng-repeat="image in albumImages">\n            <img ng-src="{{ image.thumbnail.url }}" />\n        </li>\n    </ul>\n</div>\n'),$templateCache.put("views/partials/footer.html",'<footer>\n\n    <!--<div style="float:left;">\n        View:\n        <a class="btn" href="#">Grid (Classic)</a>\n        <a class="btn" href="#">Columns</a>\n    </div>-->\n\n    <ul class="links">\n        <li>Created by <a href="https://themediadudes.com">The Media Dudes</a></li>\n        <li><a href="mailto:help@ctrlv.in"><i class="typ typ-mail"></i> Contact Us</a></li>\n        <li><a ui-sref="terms"><i class="typ typ-sort-alphabetically-outline"></i> Terms of Use</a></li>\n        <li><a ui-sref="privacy"><i class="typ typ-lock-closed-outline"></i> Privacy</a></li>\n        <li><a ui-sref="help"><i class="typ typ-info-large-outline"></i> Help</a></li>\n        <li><a href="https://api.ctrlv.in/docs"><i class="typ typ-flow-switch"></i> API</a></li>\n    </ul>\n</footer>\n'),$templateCache.put("views/partials/header.html",'<header class="clearfix">\n    <a ui-sref="home" id="logo-container">\n        <img src="/assets/img/ctrlv.svg" id="logo" />\n    </a>\n\n    <h1 ng-bind-html="title"></h1>\n\n    <div  id="current-user">\n        <div ng-if="user === false">\n            <a id="login-btn" class="btn" href="#" ng-click="login()"><i class="typ typ-user"></i> Login or Signup</a>\n        </div>\n        <div ng-if="user">\n            <h2>Hi <a ui-sref="user({ username: user.username.toLowerCase() })" ng-bind="user.username"></a></h2>\n            <ul class="links">\n                <li><a ui-sref="user-favourites({ username: user.username.toLowerCase() })"><i class="typ typ-heart-full-outline"></i> Favourites</a></li>\n                <li><a ui-sref="settings"><i class="typ typ-spanner"></i> Options</a></li>\n                <li><a ui-sref="help"><i class="typ typ-info-large-outline"></i> Help</a></li>\n                <li><a href="#" ng-click="logout()"><i class="typ typ-lock-open"></i> Logout</a></li>\n            </ul>\n        </div>\n    </div>\n</header>\n'),$templateCache.put("views/partials/image-list.html",'\n<ul ng-if="images.length > 0" class="img-grid">\n    <li ng-repeat="image in images">\n        <a\n            ui-sref="image({ imageId: image.imageId })"\n            ng-style="{\'background-image\': image.thumbnail ? \'\' : \'url(\'+ image.image.url + \')\'}"\n            >\n            <img ng-if="image.thumbnail" class="img-thumb" ng-src="{{ image.thumbnail.url }}" />\n        </a>\n    </li>\n</ul>\n'),$templateCache.put("views/user.html",'<div class="content">\n    <ng-include src="\'views/partials/image-list.html\'"></ng-include>\n</div>\n')}]),app.controller("HeaderController",function($scope,$rootScope,ModalService,AuthService){$scope.user=AuthService.getUser(),console.log($scope.user),$rootScope.$on("login",function(event,args){$scope.user=args.user,console.log($scope.user)}),$rootScope.$on("logout",function(event,args){$scope.user=!1,console.log($scope.user)}),$scope.login=function(){ModalService.showModal({templateUrl:"views/modals/login.html",controller:"LoginModalController"}).then(function(modal){modal.close.then(function(result){$scope.message=result?"You said Yes":"You said No"})})},$scope.logout=function(){AuthService.logout()},$scope.signup=function(){alert("signup")}}),app.controller("HomeController",function($scope,$timeout){for(var sprites=[],i=0;20>i;i++)sprites.push('<span class="homesprite homesprite-'+i+'"></span>');sprites.shuffle(),$scope.sprites=sprites.join(""),$scope.mac="MacIntel"===navigator.platform,$timeout(function(){$scope.test=!0},1e3)}),app.controller("ImageController",function($scope,$rootScope,$stateParams,ImageResource,AlbumResource){console.log("begin image controller!"),console.log($scope,$rootScope),$scope.loading=!0,$scope.imageOrientation="l",$scope.imageId=$stateParams.imageId,$scope.albumImages=[],ImageResource.get({imageId:$stateParams.imageId},function(image){console.log("loaded"),$scope.loading=!1,$scope.image=image,$rootScope.title=image.title,image.albumId&&AlbumResource.getImages({albumId:image.albumId},function(images){$scope.albumImages=images,console.log($scope.albumImages)}),image.image&&$scope.image.image.height>$scope.image.image.width&&($scope.imageOrientation="h")}),console.log("image controller!")}),app.controller("LoginModalController",function($scope,close,AuthService){$scope.username="",$scope.password="",$scope.login=function(){AuthService.login($scope.username,$scope.password).then(function(response){console.log("Aww yeah, hi",response.session,response.sessionKey)},function(error){console.log("poop",error)})},$scope.close=close}),app.controller("UserController",function($scope,$rootScope,$stateParams,UserResource){$scope.username=$stateParams.username,$scope.loading=!0,$scope.images=[],UserResource.get({username:$scope.username},function(user){$rootScope.title='<i class="typ typ-image"></i> '+user.username+"'s Images"}),UserResource.getImages({username:$scope.username},function(images){$scope.loading=!1,$scope.images=images}),console.log("user controller!")}),function(){app.directive("stateBodyClass",function($rootScope){return{restrict:"A",scope:{},link:function(scope,elem,attr,ctrl){$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){var fromClassnames=angular.isDefined(fromState.data)&&angular.isDefined(fromState.data.bodyClass)?fromState.data.bodyClass:null,toClassnames=angular.isDefined(toState.data)&&angular.isDefined(toState.data.bodyClass)?toState.data.bodyClass:null;fromClassnames!=toClassnames&&(fromClassnames&&elem.removeClass(fromClassnames),toClassnames&&elem.addClass(toClassnames))})}}})}(),Array.prototype.shuffle=function(){var j,temp,i=this.length;if(0===i)return this;for(;--i;)j=Math.floor(Math.random()*(i+1)),temp=this[i],this[i]=this[j],this[j]=temp;return this};var ImagePaster=function(){var ImagePaster=function(url){console.log("new ImagePaster",url),this.debug=!0,this.url=url,this.pasteCatcher=null,this.init()};return ImagePaster.prototype.log=function(data,extra){this.debug&&console.log(data,extra)},ImagePaster.prototype.init=function(){var self=this;self.pasteCatcher=document.createElement("div"),self.pasteCatcher.setAttribute("contenteditable",""),self.pasteCatcher.setAttribute("style","position:absolute; opacity:0; top:0; left:0; width:0; height:0;"),self.pasteCatcher.id="paste-catcher",document.body.appendChild(self.pasteCatcher),self.pasteCatcher.focus(),document.addEventListener("paste",function(event){self.onPaste(event)}),$(document).on("keydown",function(e){86===e.which&&(e.ctrlKey||e.metaKey)&&$(document).trigger("ctrlVPressed")}),$(document).on("ctrlVPressed",function(){self.pasteCatcher.focus()})},ImagePaster.prototype.onPaste=function(event){var clipboardData,self=this,done=!1;if(self.log("onPaste",JSON.stringify(event)),event.clipboardData?clipboardData=event.clipboardData:window.clipboardData&&(clipboardData=window.clipboardData),event.msConvertURL){var fileList=clipboardData.files;if(fileList.length>0)for(var i=0;i<fileList.length;i++)self.uploadBlob(fileList[i]),done=!0}if(clipboardData&&clipboardData.items){var text;if(text=clipboardData.getData("text/plain"))return self.uploadText(text),void self.clearPasteCatcher();for(var x=0;x<clipboardData.items.length;x++)-1!==clipboardData.items[x].type.indexOf("image")&&(self.uploadBlob(clipboardData.items[x].getAsFile()),done=!0)}done?self.clearPasteCatcher():setTimeout(function(){self.checkPasteCatcher()},10)},ImagePaster.prototype.checkPasteCatcher=function(){var text=this.pasteCatcher.innerHTML,child=this.pasteCatcher.childNodes[0];if(child)if("IMG"===child.tagName){if(-1!=child.src.indexOf("webkit-fake-url://"))return this.onFail("Sorry, Safari does not currently support pasting images."),!1;this.uploadImage(child.src)}else"A"===child.tagName?this.uploadText(child.href):this.uploadText(text);this.clearPasteCatcher()},ImagePaster.prototype.clearPasteCatcher=function(){var self=this;setTimeout(function(){self.pasteCatcher.innerHTML=""},1)},ImagePaster.prototype.uploadBlob=function(blob){if(blob){var self=this,reader=new FileReader;reader.onload=function(evt){self.uploadImage(evt.target.result)},reader.readAsDataURL(blob)}},ImagePaster.prototype.uploadText=function(text){return console.log("uploadText",text),this.upload("text",text)},ImagePaster.prototype.uploadImage=function(base64){return this.upload("uploadImage",base64)},ImagePaster.prototype.upload=function(format,data){var self=this;$(document).trigger("ctrlvuploadstart"),$.ajax({url:this.url,timeout:9e4,type:"POST",data:{format:format,base64:data},error:function(jqXHR,textStatus){var message;switch(textStatus){case"timeout":message="The image took too long to upload";break;case"error":message=jqXHR.responseJSON&&jqXHR.responseJSON.message?"CtrlV server error ("+jqXHR.responseJSON.errorType+" "+jqXHR.responseJSON.message+")":0!==jqXHR.status?"CtrlV server error ("+jqXHR.status+" "+jqXHR.statusText+")":"Can't connect to the CtrlV server";break;case"abort":message="The upload was cancelled";break;case"parsererror":message="Error uploading: couldn't decode the response from the server";break;default:message=textStatus}self.onFail(message)},success:function(res){res.image?$(document).trigger({type:"ctrlvuploadcomplete",image:res.image}):self.onFail(res.message)}})},ImagePaster.prototype.onFail=function(message){$(document).trigger({type:"ctrlvuploaderror",message:message?message:!1})},ImagePaster.prototype.validateURL=function(text){var regex=new RegExp("^(http|https|ftp)://([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&amp;%$-]+)*@)*((25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]).(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0).(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0).(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])|([a-zA-Z0-9-]+.)*[a-zA-Z0-9-]+.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(/($|[a-zA-Z0-9.,?'\\+&amp;%$#=~_-]+))*$");return regex.test(text)},ImagePaster}();app.factory("AlbumResource",function($resource){return $resource(apiUrl+"albums/:albumId",{},{get:{cache:!0,transformResponse:function(data){return data=angular.fromJson(data),data.image}},getImages:{url:apiUrl+"albums/:albumId/images",isArray:!0,transformResponse:function(data){var data=angular.fromJson(data);return data.images}}})}),app.factory("ImageResource",function($resource){return $resource(apiUrl+"images/:imageId",{},{get:{cache:!0,transformResponse:function(data){return data=angular.fromJson(data),data.image}}})}),app.factory("SessionResource",function($resource){return $resource(apiUrl+"sessions/:sessionKey",{},{get:{transformResponse:function(data){return data=angular.fromJson(data),data.session}}})}),app.factory("UserResource",function($resource){return $resource(apiUrl+"users/:username",{},{get:{cache:!0,transformResponse:function(data){var data=angular.fromJson(data);return data.user}},getImages:{cache:!0,url:apiUrl+"users/:username/images",isArray:!0,transformResponse:function(data){var data=angular.fromJson(data);return data.images}},getAlbums:{cache:!0,url:apiUrl+"users/:username/albums",isArray:!0,transformResponse:function(data){var data=angular.fromJson(data);return data.images}}})}),app.service("AuthService",function(localStorageService,UserResource,SessionResource,$q,$rootScope){var session=null,sessionKey=null;return{checkSession:function(){var self=this;(sessionKey=localStorageService.get("sessionKey"))?SessionResource.get({sessionKey:sessionKey},function(session){self.onLogin(session,sessionKey)},function(){self.onLogout()}):self.onLogout()},login:function(username,password){var self=this;return $q(function(resolve,reject){SessionResource.save({username:username,password:password},function(result){self.onLogin(result.session,result.sessionKey),resolve(result.session.user)},function(result){console.log(result),reject(result.data.message)})})},onLogin:function(newSession,newSessionKey){session=newSession,sessionKey=newSessionKey,localStorageService.set("sessionKey",newSessionKey),$rootScope.$broadcast("login",{user:newSession.user})},logout:function(){var self=this;SessionResource["delete"]({sessionKey:sessionKey}),self.onLogout()},onLogout:function(){session=!1,sessionKey=!1,localStorageService.remove("sessionKey"),$rootScope.$broadcast("logout")},getSessionKey:function(){return sessionKey},getUser:function(){return null===session?null:session&&session.user?session.user:!1}}}),app.service("ImagePasterService",function($state){return $(document).on("ctrlvuploadstart",function(){$(".upload-status").addClass("out"),$("#upload-loading").removeClass("out")}),$(document).on("ctrlvuploadcomplete",function(e){$(".upload-status").addClass("out"),$("#upload-complete").removeClass("out");var viewUrl=e.image.url,imageUrl=e.image.image.url;$("#view-btn").attr("href",viewUrl),$("#uploader").css("background-image","url("+imageUrl+")"),$state.go("image",{imageId:e.image.imageId})}),$(document).on("ctrlvuploaderror",function(e){$(".upload-status").addClass("out"),$("#upload-error").removeClass("out").find("p").text(e.message)}),$(document).on("keyup",function(e){91==e.which||224===e.which?$(".btn-cmd").removeClass("active"):17==e.which?$(".btn-ctrl").removeClass("active"):86==e.which&&$(".btn-v").removeClass("active")}),$(document).on("keydown",function(e){91==e.which||224===e.which?$(".btn-cmd").addClass("active"):17==e.which?$(".btn-ctrl").addClass("active"):86==e.which&&$(".btn-v").addClass("active")}),new ImagePaster(apiUrl+"images")});
//# sourceMappingURL=ctrlv.min.js.map