{"version":3,"sources":["../../../../../src/js/app.js","../../../../../src/js/templates.js","../../../../../src/js/controllers/HeaderController.js","../../../../../src/js/controllers/HomeController.js","../../../../../src/js/controllers/ImageController.js","../../../../../src/js/controllers/LoginModalController.js","../../../../../src/js/controllers/UserController.js","../../../../../src/js/directives/stateBodyClass.js","../../../../../src/js/libraries/ArrayPrototype.js","../../../../../src/js/libraries/ImagePaster.js","../../../../../src/js/resources/AlbumResource.js","../../../../../src/js/resources/ImageResource.js","../../../../../src/js/resources/SessionResource.js","../../../../../src/js/resources/UserResource.js","../../../../../src/js/services/AuthService.js","../../../../../src/js/services/ImagePasterService.js"],"names":["app","angular","module","config","$locationProvider","$stateProvider","$urlRouterProvider","localStorageServiceProvider","html5Mode","setPrefix","setStorageType","setStorageCookie","otherwise","state","url","templateUrl","controller","data","bodyClass","run","$rootScope","AuthService","ImagePasterService","checkSession","console","log","$templateCache","put","$scope","ModalService","user","getUser","$on","event","args","login","showModal","then","modal","close","result","message","logout","signup","alert","$timeout","sprites","i","push","shuffle","join","mac","navigator","platform","test","$stateParams","ImageResource","AlbumResource","loading","imageOrientation","imageId","albumImages","get","image","title","albumId","getImages","images","height","width","username","password","response","session","sessionKey","error","UserResource","directive","restrict","scope","link","elem","attr","ctrl","toState","toParams","fromState","fromParams","fromClassnames","isDefined","toClassnames","removeClass","addClass","Array","prototype","j","temp","this","length","Math","floor","random","ImagePaster","debug","pasteCatcher","init","extra","self","document","createElement","setAttribute","id","body","appendChild","focus","addEventListener","onPaste","$","on","e","which","ctrlKey","metaKey","trigger","clipboardData","done","JSON","stringify","window","msConvertURL","fileList","files","uploadBlob","items","text","getData","uploadText","clearPasteCatcher","x","type","indexOf","getAsFile","setTimeout","checkPasteCatcher","innerHTML","child","childNodes","tagName","src","onFail","uploadImage","href","blob","reader","FileReader","onload","evt","target","readAsDataURL","upload","base64","format","ajax","timeout","jqXHR","textStatus","responseJSON","errorType","status","statusText","success","res","validateURL","regex","RegExp","factory","$resource","apiUrl","cache","transformResponse","fromJson","isArray","getAlbums","service","localStorageService","SessionResource","$q","onLogin","onLogout","resolve","reject","save","newSession","newSessionKey","set","$broadcast","remove","getSessionKey","$state","viewUrl","imageUrl","css","go","find"],"mappings":"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","file":"ctrlv.min.js","sourcesContent":["\"use strict\";\n\n// Initialize angular\n\nvar app = angular.module('ctrlv', [\n    'ui.router',\n    'ngResource',\n    'ngSanitize',\n    'LocalStorageModule',\n    'angularModalService',\n    'ngAnimate'\n]);\n\n/**\n * Angular\n */\n\n// Routes\napp.config(function($locationProvider, $stateProvider, $urlRouterProvider, localStorageServiceProvider) {\n\n    $locationProvider.html5Mode(true);\n\n    localStorageServiceProvider\n        .setPrefix('ctrlv')\n        .setStorageType('localStorage')\n        .setStorageCookie(0, '/');\n\n    // For any unmatched url, redirect to /\n    $urlRouterProvider.otherwise('/');\n\n    // Now set up the states\n    $stateProvider\n        .state('home', {\n            url: \"/\",\n            templateUrl: \"views/home.html\",\n            controller: 'HomeController',\n            data : {\n                bodyClass : 'home'\n            }\n        })\n        .state('help', {\n            url: \"/help\",\n            templateUrl: \"views/help.html\",\n            controller: 'HelpController'\n        })\n        .state('image', {\n            url: \"/{imageId:int}\",\n            templateUrl: \"views/image.html\",\n            controller: 'ImageController'\n        })\n        .state('user', {\n            url: \"/user/{username:string}\",\n            templateUrl: \"views/user.html\",\n            controller: 'UserController'\n        })\n        .state('user-favourites', {\n            url: \"/user/{username:string}/favourites\",\n            templateUrl: \"views/user/favourites.html\",\n            controller: 'UserFavouritesController'\n        });\n});\n\napp.run(function($rootScope, AuthService, ImagePasterService) {\n\n    AuthService.checkSession();\n    console.log('ImagePasterService', ImagePasterService);\n});\n\n","angular.module('ctrlv').run(['$templateCache', function($templateCache) {\n  'use strict';\n\n  $templateCache.put('views/home.html',\n    \"<div id=\\\"uploader\\\">\\n\" +\n    \"\\n\" +\n    \"    <div id=\\\"uploader-collage\\\" ng-bind-html=\\\"sprites\\\"></div>\\n\" +\n    \"\\n\" +\n    \"    <div class=\\\"upload-status\\\" id=\\\"upload-waiting\\\">\\n\" +\n    \"        <h2>The <span class=\\\"green\\\">easiest</span> way to share photos.</h2>\\n\" +\n    \"        <h3>\\n\" +\n    \"            <i class=\\\"spinner-waiting\\\"></i>\\n\" +\n    \"            Press <span ng-if=\\\"mac\\\" class=\\\"btn btn-cmd\\\">cmd &#8984;</span><span ng-if=\\\"!mac\\\" class=\\\"btn btn-ctrl\\\">Ctrl</span>\\n\" +\n    \"            + <span class=\\\"btn btn-v\\\">V</span> to paste an image,\\n\" +\n    \"            or <a href=\\\"#\\\" class=\\\"btn\\\"><i class=\\\"typ typ-cloud-storage\\\"></i> select files to upload</a>\\n\" +\n    \"        </h3>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"    <div class=\\\"upload-status out\\\" id=\\\"upload-loading\\\">\\n\" +\n    \"        <h3><i class=\\\"spinner-loading\\\"></i> Uploading...</h3>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"    <div class=\\\"upload-status out\\\" id=\\\"upload-error\\\">\\n\" +\n    \"        <h3>Error</h3>\\n\" +\n    \"        <p></p>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"    <div class=\\\"upload-status out\\\" id=\\\"upload-complete\\\">\\n\" +\n    \"        <h3>Uploaded!</h3>\\n\" +\n    \"        <p>\\n\" +\n    \"            <label>\\n\" +\n    \"                Here's your link\\n\" +\n    \"                <input type=\\\"text\\\" id=\\\"newImageURL\\\" class=\\\"green\\\" readonly=\\\"readonly\\\" />\\n\" +\n    \"            </label>\\n\" +\n    \"        </p>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/image.html',\n    \"\\n\" +\n    \"\\n\" +\n    \"<div class=\\\"img-wrapper\\\">\\n\" +\n    \"\\n\" +\n    \"    <div ng-if=\\\"loading\\\">\\n\" +\n    \"        <i class=\\\"spinner-loading dark\\\"></i>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"    <img\\n\" +\n    \"        ng-if=\\\"!loading && image\\\"\\n\" +\n    \"        ng-src=\\\"{{ image.image.url }}\\\"\\n\" +\n    \"        class=\\\"img\\\"\\n\" +\n    \"        />\\n\" +\n    \"\\n\" +\n    \"    <div ng-if=\\\"!loading\\\" class=\\\"img-details\\\">\\n\" +\n    \"        Uploaded by <a href=\\\"#\\\">Jimmenybillybob</a>\\n\" +\n    \"        <div class=\\\"img-tools\\\">\\n\" +\n    \"            <a class=\\\"btn\\\">Crop</a>\\n\" +\n    \"            <a class=\\\"btn\\\">Rotate</a>\\n\" +\n    \"            <a class=\\\"btn\\\">Delete</a>\\n\" +\n    \"        </div>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/modals/login.html',\n    \"<div class=\\\"modal\\\" ng-click=\\\"close()\\\">\\n\" +\n    \"    <div class=\\\"modal-content\\\" ng-click=\\\"$event.stopPropagation()\\\">\\n\" +\n    \"\\n\" +\n    \"        <label>Username <input type=\\\"text\\\" ng-model=\\\"username\\\" name=\\\"username\\\" /></label>\\n\" +\n    \"        <label>Password <input type=\\\"password\\\" ng-model=\\\"password\\\" name=\\\"password\\\" /></label>\\n\" +\n    \"\\n\" +\n    \"        <span ng-bind=\\\"username\\\"></span>\\n\" +\n    \"        <span ng-bind=\\\"password\\\"></span>\\n\" +\n    \"\\n\" +\n    \"        <a class=\\\"btn\\\" ng-click=\\\"login()\\\">Login</a>\\n\" +\n    \"        <a class=\\\"btn\\\" ng-click=\\\"close()\\\">Close</a>\\n\" +\n    \"    </div>\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/partials/album-sidebar.html',\n    \"<div class=\\\"album-sidebar\\\">\\n\" +\n    \"    <ul ng-if=\\\"albumImages.length > 0\\\" ng->\\n\" +\n    \"        <li ng-repeat=\\\"image in albumImages\\\">\\n\" +\n    \"            <img ng-src=\\\"{{ image.thumbnail.url }}\\\" />\\n\" +\n    \"        </li>\\n\" +\n    \"    </ul>\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/partials/footer.html',\n    \"<footer>\\n\" +\n    \"\\n\" +\n    \"    <!--<div style=\\\"float:left;\\\">\\n\" +\n    \"        View:\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\">Grid (Classic)</a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\">Columns</a>\\n\" +\n    \"    </div>-->\\n\" +\n    \"\\n\" +\n    \"    <ul class=\\\"links\\\">\\n\" +\n    \"        <li>Created by <a href=\\\"https://themediadudes.com\\\">The Media Dudes</a></li>\\n\" +\n    \"        <li><a href=\\\"mailto:help@ctrlv.in\\\"><i class=\\\"typ typ-mail\\\"></i> Contact Us</a></li>\\n\" +\n    \"        <li><a ui-sref=\\\"terms\\\"><i class=\\\"typ typ-sort-alphabetically-outline\\\"></i> Terms of Use</a></li>\\n\" +\n    \"        <li><a ui-sref=\\\"privacy\\\"><i class=\\\"typ typ-lock-closed-outline\\\"></i> Privacy</a></li>\\n\" +\n    \"        <li><a ui-sref=\\\"help\\\"><i class=\\\"typ typ-info-large-outline\\\"></i> Help</a></li>\\n\" +\n    \"        <li><a href=\\\"https://api.ctrlv.in/docs\\\"><i class=\\\"typ typ-flow-switch\\\"></i> API</a></li>\\n\" +\n    \"    </ul>\\n\" +\n    \"</footer>\\n\"\n  );\n\n\n  $templateCache.put('views/partials/header.html',\n    \"<header class=\\\"clearfix\\\">\\n\" +\n    \"    <a ui-sref=\\\"home\\\" id=\\\"logo-container\\\">\\n\" +\n    \"        <img src=\\\"/assets/img/ctrlv.svg\\\" id=\\\"logo\\\" />\\n\" +\n    \"    </a>\\n\" +\n    \"\\n\" +\n    \"    <h1 ng-bind-html=\\\"title\\\"></h1>\\n\" +\n    \"\\n\" +\n    \"    <div  id=\\\"current-user\\\">\\n\" +\n    \"        <div ng-if=\\\"user === false\\\">\\n\" +\n    \"            <a id=\\\"login-btn\\\" class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"login()\\\"><i class=\\\"typ typ-user\\\"></i> Login or Signup</a>\\n\" +\n    \"        </div>\\n\" +\n    \"        <div ng-if=\\\"user\\\">\\n\" +\n    \"            <h2>Hi <a ui-sref=\\\"user({ username: user.username.toLowerCase() })\\\" ng-bind=\\\"user.username\\\"></a></h2>\\n\" +\n    \"            <ul class=\\\"links\\\">\\n\" +\n    \"                <li><a ui-sref=\\\"user-favourites({ username: user.username.toLowerCase() })\\\"><i class=\\\"typ typ-heart-full-outline\\\"></i> Favourites</a></li>\\n\" +\n    \"                <li><a ui-sref=\\\"settings\\\"><i class=\\\"typ typ-spanner\\\"></i> Options</a></li>\\n\" +\n    \"                <li><a ui-sref=\\\"help\\\"><i class=\\\"typ typ-info-large-outline\\\"></i> Help</a></li>\\n\" +\n    \"                <li><a href=\\\"#\\\" ng-click=\\\"logout()\\\"><i class=\\\"typ typ-lock-open\\\"></i> Logout</a></li>\\n\" +\n    \"            </ul>\\n\" +\n    \"        </div>\\n\" +\n    \"    </div>\\n\" +\n    \"</header>\\n\"\n  );\n\n\n  $templateCache.put('views/partials/image-list.html',\n    \"\\n\" +\n    \"<ul ng-if=\\\"images.length > 0\\\" class=\\\"img-grid\\\">\\n\" +\n    \"    <li ng-repeat=\\\"image in images\\\">\\n\" +\n    \"        <a\\n\" +\n    \"            ui-sref=\\\"image({ imageId: image.imageId })\\\"\\n\" +\n    \"            ng-style=\\\"{'background-image': image.thumbnail ? '' : 'url('+ image.image.url + ')'}\\\"\\n\" +\n    \"            >\\n\" +\n    \"            <img ng-if=\\\"image.thumbnail\\\" class=\\\"img-thumb\\\" ng-src=\\\"{{ image.thumbnail.url }}\\\" />\\n\" +\n    \"        </a>\\n\" +\n    \"    </li>\\n\" +\n    \"</ul>\\n\"\n  );\n\n\n  $templateCache.put('views/user.html',\n    \"<div class=\\\"content\\\">\\n\" +\n    \"    <ng-include src=\\\"'views/partials/image-list.html'\\\"></ng-include>\\n\" +\n    \"</div>\\n\"\n  );\n\n}]);\n","app.controller(\n    'HeaderController',\n    function ($scope, $rootScope, ModalService, AuthService) {\n\n        $scope.user = AuthService.getUser();\n        console.log($scope.user);\n\n        $rootScope.$on('login', function(event, args) {\n            $scope.user = args.user;\n            console.log($scope.user);\n        });\n\n        $rootScope.$on('logout', function(event, args) {\n            $scope.user = false;\n            console.log($scope.user);\n        });\n\n        $scope.login = function() {\n            // Just provide a template url, a controller and call 'showModal'.\n            ModalService.showModal({\n                templateUrl: 'views/modals/login.html',\n                controller: 'LoginModalController'\n            }).then(function(modal) {\n                // The modal object has the element built, if this is a bootstrap modal\n                // you can call 'modal' to show it, if it's a custom modal just show or hide\n                // it as you need to.\n                //modal.element.modal();\n                modal.close.then(function(result) {\n                    $scope.message = result ? \"You said Yes\" : \"You said No\";\n                });\n            });\n        };\n\n        $scope.logout = function() {\n            AuthService.logout();\n        };\n\n        $scope.signup = function() {\n            alert('signup');\n        };\n\n    }\n);\n","app.controller(\n    'HomeController',\n    function ($scope, $timeout) {\n\n        var sprites = [];\n        for (var i = 0; i < 20; i++) {\n            sprites.push('<span class=\"homesprite homesprite-' + i + '\"></span>');\n        }\n        sprites.shuffle();\n        $scope.sprites = sprites.join('');\n\n        $scope.mac = navigator.platform === \"MacIntel\";\n\n        $timeout(function() {\n            $scope.test = true;\n        }, 1000);\n    }\n);\n","app.controller(\n    'ImageController',\n    function ($scope, $rootScope, $stateParams, ImageResource, AlbumResource) {\n\n        console.log('begin image controller!');\n\n        console.log($scope, $rootScope);\n\n        $scope.loading = true;\n        $scope.imageOrientation = 'l';\n        $scope.imageId = $stateParams.imageId;\n        $scope.albumImages = [];\n\n        ImageResource.get({imageId: $stateParams.imageId}, function(image) {\n            console.log('loaded');\n            $scope.loading = false;\n            $scope.image = image;\n            $rootScope.title = image.title;\n\n            if (image.albumId) {\n                // Get the images in the album to show on the left\n                AlbumResource.getImages({albumId: image.albumId}, function(images) {\n                    $scope.albumImages = images;\n                    console.log($scope.albumImages);\n                });\n            }\n\n            if (image.image) {\n                if ($scope.image.image.height > $scope.image.image.width) {\n                    $scope.imageOrientation = 'h';\n                }\n            }\n\n        });\n\n        console.log('image controller!');\n    }\n);\n","app.controller(\n    'LoginModalController',\n    function ($scope, close, AuthService) {\n\n        $scope.username = '';\n        $scope.password = '';\n\n        $scope.login = function () {\n            AuthService\n                .login($scope.username, $scope.password)\n                .then(\n                    function (response) {\n                        console.log(\"Aww yeah, hi\", response.session, response.sessionKey)\n                    },\n                    function (error) {\n                        console.log(\"poop\", error);\n                    }\n                );\n        };\n\n        $scope.close = close;\n\n    }\n);\n","app.controller(\n    'UserController',\n    function ($scope, $rootScope, $stateParams, UserResource) {\n\n        $scope.username = $stateParams.username;\n\n        $scope.loading = true;\n        $scope.images = [];\n\n        UserResource.get({username: $scope.username}, function(user) {\n           $rootScope.title = '<i class=\"typ typ-image\"></i> ' + user.username + \"'s Images\";\n        });\n\n        UserResource.getImages({username: $scope.username}, function(images) {\n            $scope.loading = false;\n            $scope.images = images;\n        });\n\n        console.log('user controller!');\n\n    }\n);\n","/**\n * Source: http://stackoverflow.com/a/32574746/710630\n */\n(function () {\n    'use strict';\n\n    app.directive(\n        'stateBodyClass',\n        function ($rootScope) {\n            return {\n                restrict: 'A',\n                scope: {},\n                link: function (scope, elem, attr, ctrl) {\n\n                    $rootScope.$on('$stateChangeSuccess', function (event, toState, toParams, fromState, fromParams) {\n                        var fromClassnames = angular.isDefined(fromState.data) && angular.isDefined(fromState.data.bodyClass) ? fromState.data.bodyClass : null;\n                        var toClassnames = angular.isDefined(toState.data) && angular.isDefined(toState.data.bodyClass) ? toState.data.bodyClass : null;\n\n                        // don't do anything if they are the same\n                        if (fromClassnames != toClassnames) {\n                            if (fromClassnames) {\n                                elem.removeClass(fromClassnames);\n                            }\n\n                            if (toClassnames) {\n                                elem.addClass(toClassnames);\n                            }\n                        }\n                    });\n                }\n            };\n        }\n    );\n\n}());\n","/**\n * Shuffles the items in an array.\n * Source: http://stackoverflow.com/a/10142256/710630\n *\n * @returns {Array}\n */\nArray.prototype.shuffle = function() {\n    var i = this.length, j, temp;\n    if (i === 0) {\n        return this;\n    }\n    while (--i) {\n        j = Math.floor( Math.random() * ( i + 1 ) );\n        temp = this[i];\n        this[i] = this[j];\n        this[j] = temp;\n    }\n    return this;\n};\n","var ImagePaster = (function () {\n    \"use strict\";\n\n    var ImagePaster = function (url) {\n        console.log('new ImagePaster', url);\n        this.debug = true;\n        this.url = url;\n        this.pasteCatcher = null;\n        this.init();\n    };\n\n    ImagePaster.prototype.log = function (data, extra) {\n        if (this.debug) {\n            console.log(data, extra);\n        }\n    };\n\n    ImagePaster.prototype.init = function () {\n\n        var self = this;\n\n        /**\n         * Firefox allows images to be pasted into contenteditable elements.\n         * So create one of those on the page and make it have focus,\n         * so paste events happen into that\n         */\n\n        // Create paste catcher element\n        self.pasteCatcher = document.createElement('div');\n        self.pasteCatcher.setAttribute('contenteditable', '');\n        self.pasteCatcher.setAttribute('style', 'position:absolute; opacity:0; top:0; left:0; width:0; height:0;');\n        self.pasteCatcher.id = 'paste-catcher';\n        document.body.appendChild(self.pasteCatcher);\n        self.pasteCatcher.focus();\n\n        // Listen for the 'paste' event on the body\n        //if (browserName == 'IE') {\n        //$('body').on('paste', function(event) { self.onPaste(event); });\n        //} else {\n        document.addEventListener('paste', function (event) {\n            self.onPaste(event);\n        });\n        //}\n\n        // Watch for ctrl + v being pressed\n        $(document).on('keydown', function (e) {\n            // 86 = v\n            if (e.which === 86 && (e.ctrlKey || e.metaKey)) {\n                $(document).trigger('ctrlVPressed');\n            }\n        });\n\n        // Focus paste catcher when cmd or ctrlv is pressed\n        $(document).on('ctrlVPressed', function () {\n            self.pasteCatcher.focus();\n        });\n\n    };\n\n    ImagePaster.prototype.onPaste = function (event) {\n\n        var self = this;\n        var done = false;\n        var clipboardData;\n\n        self.log('onPaste', JSON.stringify(event));\n\n        if (event.clipboardData) {\n            // Chrome\n            clipboardData = event.clipboardData;\n        } else if (window.clipboardData) {\n            // IE\n            clipboardData = window.clipboardData;\n        } else {\n            // Firefox\n            //setTimeout(this.checkPasteCatcher, 1);\n        }\n\n        // IE\n        if (event.msConvertURL) {\n            var fileList = clipboardData.files;\n            if (fileList.length > 0) {\n                for (var i = 0; i < fileList.length; i++) {\n                    self.uploadBlob(fileList[i]);\n                    done = true;\n                }\n            }\n        }\n\n        // Check if there is something in the paste event itself\n        if (clipboardData && clipboardData.items) {\n\n            var text;\n            // If there was some text on the clipboard,\n            // it might be a URL. Try and paste that...\n            if ((text = clipboardData.getData(\"text/plain\"))) {\n                self.uploadText(text);\n                self.clearPasteCatcher();\n                return;\n            }\n\n            // Loop through all the clipboardData\n            for (var x = 0; x < clipboardData.items.length; x++) {\n                // If this clipboard item claims to be an image, upload it\n                if (clipboardData.items[x].type.indexOf('image') !== -1) {\n                    self.uploadBlob(clipboardData.items[x].getAsFile());\n                    done = true;\n                }\n            }\n        }\n\n        // If there was nothing found in the clipboard data\n        // fall back to checking if there's anything in the editable element\n        if (done) {\n            self.clearPasteCatcher();\n        } else {\n            setTimeout(\n                function () {\n                    self.checkPasteCatcher();\n                },\n                10\n            );\n        }\n    };\n\n    /**\n     * Check if anything has been pasted into the paste catcher element\n     * (Firefox + Safari?)\n     */\n    ImagePaster.prototype.checkPasteCatcher = function () {\n\n        var text = this.pasteCatcher.innerHTML;\n        var child = this.pasteCatcher.childNodes[0];\n\n        if (child) {\n            if (child.tagName === 'IMG') {\n                if (child.src.indexOf('webkit-fake-url://') != -1) {\n                    this.onFail('Sorry, Safari does not currently support pasting images.');\n                    return false;\n                }\n                this.uploadImage(child.src);\n            } else if (child.tagName === 'A') {\n                this.uploadText(child.href);\n            } else {\n                this.uploadText(text);\n            }\n        }\n\n        this.clearPasteCatcher();\n    };\n\n    ImagePaster.prototype.clearPasteCatcher = function () {\n        var self = this;\n        setTimeout(\n            function () {\n                self.pasteCatcher.innerHTML = '';\n            },\n            1\n        );\n    };\n\n    ImagePaster.prototype.uploadBlob = function (blob) {\n        if (blob) {\n            var self = this;\n            var reader = new FileReader();\n            reader.onload = function (evt) {\n                self.uploadImage(evt.target.result);\n            };\n            reader.readAsDataURL(blob);\n        }\n    };\n\n    ImagePaster.prototype.uploadText = function (text) {\n        console.log('uploadText', text);\n        return this.upload('text', text);\n\n        /*if (this.validateURL(url)) {\n         upload('url', url);\n         } else {\n         failedUpload(\"Can't upload that. Try pasting an image or URL.\");\n         }*/\n    };\n\n    ImagePaster.prototype.uploadImage = function (base64) {\n        return this.upload('uploadImage', base64);\n\n        /*convertImageToJpeg(base64, function(jpegBase64){\n         upload('base64', jpegBase64);\n         });*/\n    };\n\n    /*ImagePaster.prototype.convertImageToJpeg = function(base64, callback)\n     {\n     //Convert image to a JPG so it's faster to upload\n     var img = new Image();\n     img.onload = function()\n     {\n     var canvas = convertImageToCanvas(this);\n     var data = canvas.toDataURL('image/jpeg' , 0.8);\n     callback(data);\n     };\n     img.src = base64;\n     };*/\n\n    /*ImagePaster.prototype.convertImageToCanvas = function(image)\n     {\n     var canvas = document.createElement(\"canvas\");\n     canvas.width = image.width;\n     canvas.height = image.height;\n\n     var context = canvas.getContext(\"2d\");\n     context.fillStyle = \"#ffffff\";\n     context.fillRect(0,0,image.width,image.height);\n     context.drawImage(image, 0, 0);\n\n     return canvas;\n     };*/\n\n    ImagePaster.prototype.upload = function (format, data) {\n\n        var self = this;\n        $(document).trigger('ctrlvuploadstart');\n\n        $.ajax({\n            url: this.url,\n            timeout: 90000,\n            type: 'POST',\n            data: {\n                format: format,\n                base64: data\n            },\n            error: function (jqXHR, textStatus) {\n                // Turn this error message into something useful\n                var message;\n                switch (textStatus) {\n                    case 'timeout':\n                        message = 'The image took too long to upload';\n                        break;\n                    case 'error':\n\n                        if (jqXHR.responseJSON && jqXHR.responseJSON.message) {\n                            message = 'CtrlV server error (' + jqXHR.responseJSON.errorType + ' ' + jqXHR.responseJSON.message + ')';\n                        } else if (jqXHR.status !== 0) {\n                            message = 'CtrlV server error (' + jqXHR.status + ' ' + jqXHR.statusText + ')';\n                        } else {\n                            message = 'Can\\'t connect to the CtrlV server';\n                        }\n                        break;\n                    case 'abort':\n                        message = 'The upload was cancelled';\n                        break;\n                    case 'parsererror':\n                        message = 'Error uploading: couldn\\'t decode the response from the server';\n                        break;\n                    default:\n                        message = textStatus;\n                        break;\n                }\n\n                self.onFail(message);\n            },\n            success: function (res) {\n                if (res.image) {\n                    $(document).trigger({\n                        type: 'ctrlvuploadcomplete',\n                        image: res.image\n                    });\n                } else {\n                    self.onFail(res.message);\n                }\n            }\n        });\n    };\n\n    ImagePaster.prototype.onFail = function (message) {\n        $(document).trigger({\n            type: 'ctrlvuploaderror',\n            message: message ? message : false\n        });\n    };\n\n    ImagePaster.prototype.validateURL = function (text) {\n        var regex = new RegExp(\"^(http|https|ftp)\\://([a-zA-Z0-9\\.\\-]+(\\:[a-zA-Z0-9\\.&amp;%\\$\\-]+)*@)*((25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9])\\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])|([a-zA-Z0-9\\-]+\\.)*[a-zA-Z0-9\\-]+\\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(\\:[0-9]+)*(/($|[a-zA-Z0-9\\.\\,\\?\\'\\\\\\+&amp;%\\$#\\=~_\\-]+))*$\");\n        return regex.test(text);\n    };\n\n    return ImagePaster;\n}());\n","app.factory(\n    'AlbumResource',\n    function ($resource) {\n        return $resource(\n            apiUrl + 'albums/:albumId',\n            {},\n            {\n                get: {\n                    cache: true,\n                    transformResponse: function(data) {\n                        data = angular.fromJson(data);\n                        return data.image;\n                    }\n                },\n\n                getImages: {\n                    url: apiUrl + 'albums/:albumId/images',\n                    isArray: true,\n                    transformResponse: function(data) {\n                        var data = angular.fromJson(data);\n                        return data.images;\n                    }\n                }\n\n            }\n        );\n    }\n);\n","app.factory(\n    'ImageResource',\n    function ($resource) {\n        return $resource(\n            apiUrl + 'images/:imageId',\n            {},\n            {\n                get: {\n                    cache: true,\n                    transformResponse: function(data) {\n                        data = angular.fromJson(data);\n                        return data.image;\n                    }\n                }\n\n            }\n        );\n    }\n);\n","app.factory(\n    'SessionResource',\n    function ($resource) {\n        return $resource(\n            apiUrl + 'sessions/:sessionKey',\n            {},\n            {\n                get: {\n                    transformResponse: function(data) {\n                        data = angular.fromJson(data);\n                        return data.session;\n                    }\n                }\n            }\n        );\n    }\n);\n","app.factory(\n    'UserResource',\n    function ($resource) {\n        return $resource(\n            apiUrl + 'users/:username',\n            {},\n            {\n                get: {\n                    cache: true,\n                    transformResponse: function(data) {\n                        var data = angular.fromJson(data);\n                        return data.user;\n                    }\n                },\n\n                getImages: {\n                    cache: true,\n                    url: apiUrl + 'users/:username/images',\n                    isArray: true,\n                    transformResponse: function(data) {\n                        var data = angular.fromJson(data);\n                        return data.images;\n                    }\n                },\n\n                getAlbums: {\n                    cache: true,\n                    url: apiUrl + 'users/:username/albums',\n                    isArray: true,\n                    transformResponse: function(data) {\n                        var data = angular.fromJson(data);\n                        return data.images;\n                    }\n                }\n\n            }\n        );\n    }\n);\n","app.service(\n    'AuthService',\n    function (localStorageService, UserResource, SessionResource, $q, $rootScope) {\n\n        var session = null;\n        var sessionKey = null;\n\n        return {\n\n            checkSession: function() {\n                var self = this;\n\n                if (sessionKey = localStorageService.get('sessionKey')) {\n                    SessionResource.get(\n                        {sessionKey: sessionKey},\n                        function (session) {\n                            self.onLogin(session, sessionKey);\n                        },\n                        function() {\n                            self.onLogout();\n                        }\n                    );\n                } else {\n                    self.onLogout();\n                }\n            },\n\n            /**\n             * @param username\n             * @param password\n             * @returns $q\n             */\n            login: function(username, password) {\n                var self = this;\n\n                return $q(function(resolve, reject) {\n\n                    SessionResource.save({\n                        username: username,\n                        password: password\n                    }, function(result) {\n\n                        self.onLogin(result.session, result.sessionKey);\n\n                        // Resolve promise (sends back user)\n                        resolve(result.session.user);\n\n                    }, function (result) {\n                        console.log(result);\n                        reject(result.data.message);\n                    });\n\n                });\n            },\n\n            onLogin: function(newSession, newSessionKey) {\n\n                session = newSession;\n                sessionKey = newSessionKey;\n                localStorageService.set('sessionKey', newSessionKey);\n\n                // Tell everybody we're logged in\n                $rootScope.$broadcast('login', {user: newSession.user});\n\n            },\n\n            logout: function() {\n                var self = this;\n\n                SessionResource.delete({\n                    sessionKey: sessionKey\n                });\n\n                self.onLogout();\n\n            },\n\n            onLogout: function() {\n\n                session = false;\n                sessionKey = false;\n                localStorageService.remove('sessionKey');\n\n                // Tell everybody we're logged in\n                $rootScope.$broadcast('logout');\n\n            },\n\n            getSessionKey: function() {\n                return sessionKey;\n            },\n\n            getUser: function() {\n                if (session === null) {\n                    return null;\n                }\n\n                return session && session.user ? session.user : false;\n            }\n        };\n    }\n);\n","app.service(\n    'ImagePasterService',\n    function($state) {\n\n        /**\n         * Add listeners for events that ImagePaster broadcasts.\n         */\n        $(document).on('ctrlvuploadstart', function () {\n            $('.upload-status').addClass('out');\n            $('#upload-loading').removeClass('out');\n        });\n\n        $(document).on('ctrlvuploadcomplete', function (e) {\n            $('.upload-status').addClass('out');\n            $('#upload-complete').removeClass('out');\n            var viewUrl = e.image.url;\n            var imageUrl = e.image.image.url;\n            $('#view-btn').attr('href', viewUrl);\n            $('#uploader').css('background-image', 'url(' + imageUrl + ')');\n\n            $state.go('image', {imageId: e.image.imageId});\n\n        });\n\n        $(document).on('ctrlvuploaderror', function (e) {\n            $('.upload-status').addClass('out');\n            $('#upload-error').removeClass('out').find('p').text(e.message);\n        });\n\n        $(document).on('keyup', function (e) {\n            // Highlighting keys when pressing\n            if (e.which == 91 || e.which === 224) { // cmd\n                $('.btn-cmd').removeClass('active');\n            } else if (e.which == 17) { // ctrl\n                $('.btn-ctrl').removeClass('active');\n            } else if (e.which == 86) { // v\n                $('.btn-v').removeClass('active');\n            }\n        });\n\n        $(document).on('keydown', function (e) {\n            // Highlighting keys when pressing\n            if (e.which == 91 || e.which === 224) { // cmd (91 in\n                $('.btn-cmd').addClass('active');\n            } else if (e.which == 17) { // ctrl\n                $('.btn-ctrl').addClass('active');\n            } else if (e.which == 86) { // v\n                $('.btn-v').addClass('active');\n            }\n        });\n\n        return new ImagePaster(apiUrl + 'images');\n    }\n);\n"]}