{"version":3,"sources":["../../../../../src/js/app.js","../../../../../src/js/templates.js","../../../../../src/js/controllers/HeaderController.js","../../../../../src/js/controllers/HomeController.js","../../../../../src/js/controllers/ImageController.js","../../../../../src/js/controllers/LoginModalController.js","../../../../../src/js/controllers/UserController.js","../../../../../src/js/directives/annotator.js","../../../../../src/js/directives/paginator.js","../../../../../src/js/directives/stateBodyClass.js","../../../../../src/js/libraries/ArrayPrototype.js","../../../../../src/js/libraries/Doodle.js","../../../../../src/js/libraries/ImagePaster.js","../../../../../src/js/resources/AlbumResource.js","../../../../../src/js/resources/ImageResource.js","../../../../../src/js/resources/SessionResource.js","../../../../../src/js/resources/UserResource.js","../../../../../src/js/services/AuthService.js","../../../../../src/js/services/ImagePasterService.js"],"names":["app","angular","module","config","$httpProvider","$locationProvider","$stateProvider","$urlRouterProvider","localStorageServiceProvider","html5Mode","setPrefix","setStorageType","setStorageCookie","otherwise","state","url","templateUrl","controller","params","albumId","run","$rootScope","$state","AuthService","ImagePasterService","checkSession","user","getUser","$on","event","args","ev","to","toParams","from","fromParams","$","attr","name","$templateCache","put","$scope","ModalService","login","showModal","then","modal","close","result","message","logout","signup","alert","$timeout","title","subtitle","sprites","i","push","shuffle","join","mac","navigator","platform","test","$element","$stateParams","$compile","ImageResource","AlbumResource","albumImages","image","imageId","editing","loading","init","loadAlbumImages","get","response","userId","username","moment","createdAt","format","fromNow","album","console","log","innerHTML","getImages","images","showTextDialog","text","getText","inputs","showEmbedDialog","shareOnFb","encodeURIComponent","window","open","shareOnTwitter","annotating","savingAnnotation","annotationColorVisible","annotationSizeVisible","annotationColors","annotationSizes","doodle","annotate","element","document","createElement","setAttribute","annotator","append","showAnnotationColor","setAnnotationColor","color","showAnnotationSize","setAnnotationSize","px","lineThickness","saveAnnotation","annotation","getImage","base64","exitAnnotation","data","undoAnnotation","undo","restartAnnotation","clear","remove","cropCoords","cropping","savingCrop","jcrop","crop","Jcrop","onChange","c","saveCrop","scale","getImageScale","width","Math","round","w","height","h","x","y","exitCrop","destroy","css","rotate","rotating","revert","confirm","reverting","showPrivacyDialog","setAnon","anon","update","anonymous","res","$parent","setPassword","deleting","showReportDialog","parseInt","UserResource","loginData","password","errors","signupData","email","fb","forgot","messages","hasOwnProperty","general","save","page","go","currentPage","totalPages","getAlbums","albums","lastPage","directive","$window","debounce","restrict","imageEl","Doodle","moveAndResize","imgOffset","offset","left","top","canvas","debouncedRedraw","redraw","bind","scope","template","calculatePages","pages","paginatorHeight","spaceHeight","totalSpaces","floor","adjacent","$watchGroup","debouncedCalculatePages","link","elem","ctrl","toState","fromState","fromClassnames","isDefined","bodyClass","toClassnames","removeClass","addClass","Array","prototype","j","temp","this","length","random","drawing","history","currentData","ua","userAgent","toLowerCase","isAndroid","indexOf","appendChild","context","getContext","self","e","drawStart","draw","drawEnd","clearRect","fillStyle","toDataURL","saveHistoryState","shift","getImageData","saveCurrentData","imageData","pop","putImageData","newCanvas","drawImage","preventDefault","originalEvent","touches","pageX","pageY","lineWidth","lineCap","lineJoin","strokeStyle","oldX","oldY","beginPath","arc","PI","closePath","fill","moveTo","lineTo","stroke","rgbToHex","rgb","hex","isNaN","hexDigits","match","ImagePaster","debug","pasteCatcher","extra","id","body","focus","addEventListener","onPaste","on","which","ctrlKey","metaKey","trigger","clipboardData","done","JSON","stringify","msConvertURL","fileList","files","uploadBlob","items","getData","uploadText","clearPasteCatcher","type","getAsFile","setTimeout","checkPasteCatcher","child","childNodes","tagName","src","onFail","uploadImage","href","blob","reader","FileReader","onload","evt","target","readAsDataURL","upload","ajax","timeout","error","jqXHR","textStatus","responseJSON","errorType","status","statusText","success","validateURL","regex","RegExp","factory","$resource","apiUrl","sessionKey","getSessionKey","cache","transformResponse","fromJson","isArray","method","action","degrees","session","service","localStorageService","SessionResource","$q","onLogin","onLogout","resolve","reject","newSession","newSessionKey","set","$broadcast","viewUrl","imageUrl","find","getImageUploadUrl"],"mappings":"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","file":"ctrlv.min.js","sourcesContent":["\"use strict\";\n\n// Initialize angular\n\nvar app = angular.module('ctrlv', [\n    'ui.router',\n    'ngResource',\n    'ngSanitize',\n    'LocalStorageModule',\n    'angularModalService',\n    'ngAnimate',\n    'rt.debounce'\n]);\n\n/**\n * Angular\n */\n\n// Routes\napp.config(function($httpProvider, $locationProvider, $stateProvider, $urlRouterProvider, localStorageServiceProvider) {\n\n    /*$httpProvider.defaults.headers.common = {\n        'RemoteUser': 'billybob'\n    };*/\n\n    $locationProvider.html5Mode(true);\n\n    localStorageServiceProvider\n        .setPrefix('ctrlv')\n        .setStorageType('localStorage')\n        .setStorageCookie(0, '/');\n\n    // For any unmatched url, redirect to /\n    $urlRouterProvider.otherwise('/');\n\n    // Now set up the states\n    $stateProvider\n        .state('home', {\n            url: \"/\",\n            templateUrl: \"views/home.html\",\n            controller: 'HomeController'\n        })\n        .state('help', {\n            url: \"/help\",\n            templateUrl: \"views/help.html\",\n            controller: 'HelpController'\n        })\n        .state('image', {\n            url: \"/{imageId:int}\",\n            templateUrl: \"views/image.html\",\n            controller: 'ImageController',\n            params: {\n                albumId: null\n            },\n        })\n        .state('user', {\n            url: \"/user/{username:string}\",\n            templateUrl: \"views/user.html\",\n            controller: 'UserController'\n        })\n        .state('user-page', {\n            url: \"/user/{username:string}/{page:int}\",\n            templateUrl: \"views/user.html\",\n            controller: 'UserController'\n        })\n        .state('user-favourites', {\n            url: \"/user/{username:string}/favourites\",\n            templateUrl: \"views/user/favourites.html\",\n            controller: 'UserFavouritesController'\n        });\n});\n\napp.run(function($rootScope, $state, AuthService, ImagePasterService) {\n    // ImagePasterService is injected here so it gets initialized\n\n\n    //$httpProvider.defaults.headers.post[\"Content-Type\"] = \"text/plain\";\n\n    $rootScope.$state = $state;\n\n\n    AuthService.checkSession();\n\n    $rootScope.user = AuthService.getUser();\n\n    $rootScope.$on('login', function(event, args) {\n        $rootScope.user = args.user;\n    });\n\n    $rootScope.$on('logout', function() {\n        $rootScope.user = false;\n    });\n\n    $rootScope.$on('$stateChangeSuccess', function (ev, to, toParams, from, fromParams) {\n        $('body').attr('data-previous', from.name);\n    });\n});\n\n","angular.module('ctrlv').run(['$templateCache', function($templateCache) {\n  'use strict';\n\n  $templateCache.put('views/home.html',\n    \"<div id=\\\"uploader\\\">\\n\" +\n    \"\\n\" +\n    \"    <div id=\\\"uploader-collage\\\" ng-bind-html=\\\"sprites\\\"></div>\\n\" +\n    \"\\n\" +\n    \"    <div class=\\\"upload-status\\\" id=\\\"upload-waiting\\\">\\n\" +\n    \"        <h2>The <span class=\\\"green\\\">easiest</span> way to share photos.</h2>\\n\" +\n    \"        <h3>\\n\" +\n    \"            <span style=\\\"float:right;\\\">\\n\" +\n    \"                You can also\\n\" +\n    \"                <a href=\\\"#\\\" class=\\\"btn\\\"><i class=\\\"typ typ-cloud-storage\\\"></i> Upload Images</a>\\n\" +\n    \"                or\\n\" +\n    \"                <a href=\\\"#\\\" class=\\\"btn\\\"><i class=\\\"typ typ-camera\\\"></i> Take a Photo</a>\\n\" +\n    \"            </span>\\n\" +\n    \"\\n\" +\n    \"            <i class=\\\"spinner-waiting\\\"></i>\\n\" +\n    \"            Press <span ng-if=\\\"mac\\\" class=\\\"btn btn-cmd\\\">cmd &#8984;</span><span ng-if=\\\"!mac\\\" class=\\\"btn btn-ctrl\\\">Ctrl</span>\\n\" +\n    \"            + <span class=\\\"btn btn-v\\\">V</span> to paste an image.\\n\" +\n    \"        </h3>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"    <div class=\\\"upload-status out\\\" id=\\\"upload-loading\\\">\\n\" +\n    \"        <h3><i class=\\\"spinner-loading\\\"></i> Uploading...</h3>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"    <div class=\\\"upload-status out\\\" id=\\\"upload-error\\\">\\n\" +\n    \"        <h3>Error</h3>\\n\" +\n    \"        <p></p>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"    <div class=\\\"upload-status out\\\" id=\\\"upload-complete\\\">\\n\" +\n    \"        <h3>Uploaded!</h3>\\n\" +\n    \"        <p>\\n\" +\n    \"            <label>\\n\" +\n    \"                Here's your link\\n\" +\n    \"                <input type=\\\"text\\\" id=\\\"newImageURL\\\" class=\\\"green\\\" readonly=\\\"readonly\\\" />\\n\" +\n    \"            </label>\\n\" +\n    \"        </p>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/image.html',\n    \"<div ng-if=\\\"image\\\" class=\\\"img-wrapper\\\">\\n\" +\n    \"    <img\\n\" +\n    \"        ng-if=\\\"!loading && image\\\"\\n\" +\n    \"        ng-src=\\\"{{ image.image.url }}\\\"\\n\" +\n    \"        class=\\\"img\\\"\\n\" +\n    \"        id=\\\"img\\\"\\n\" +\n    \"        />\\n\" +\n    \"</div>\\n\" +\n    \"\\n\" +\n    \"<div\\n\" +\n    \"    ng-if=\\\"!loading && image\\\"\\n\" +\n    \"    class=\\\"sidebar img-left-sidebar\\\"\\n\" +\n    \"    ng-class=\\\"{\\n\" +\n    \"        'editable': user && user.userId === image.userId,\\n\" +\n    \"        'cropping': cropping,\\n\" +\n    \"        'annotating': annotating,\\n\" +\n    \"        'revertable': image.hasOriginal\\n\" +\n    \"    }\\\"\\n\" +\n    \"    >\\n\" +\n    \"\\n\" +\n    \"    <div ng-if=\\\"annotating\\\">\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"saveAnnotation()\\\"><i class=\\\"typ typ-tick-outline\\\" ng-hide=\\\"savingAnnotation\\\"></i><i class=\\\"spinner-loading dark\\\" ng-show=\\\"savingAnnotation\\\"></i><span>Save Annotation</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" ng-class=\\\"{'active':annotationColorVisible}\\\" href=\\\"#\\\" ng-click=\\\"showAnnotationColor()\\\"><i class=\\\"typ typ-media-record\\\"></i><span>Pen Colour</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" ng-class=\\\"{'active':annotationSizeVisible}\\\" href=\\\"#\\\" ng-click=\\\"showAnnotationSize()\\\"><i class=\\\"typ typ-brush\\\"></i><span>Pen Size</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"undoAnnotation()\\\"><i class=\\\"typ typ-arrow-back\\\"></i><span>Undo</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"restartAnnotation()\\\"><i class=\\\"typ typ-trash\\\"></i><span>Start Over</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"exitAnnotation()\\\"><i class=\\\"typ typ-times\\\"></i><span>Cancel</span></a>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"    <div ng-if=\\\"cropping\\\">\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"saveCrop()\\\"><i class=\\\"typ typ-tick-outline\\\" ng-hide=\\\"savingCrop\\\"></i><i class=\\\"spinner-loading dark\\\" ng-show=\\\"savingCrop\\\"></i><span>Save Crop</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"exitCrop()\\\"><i class=\\\"typ typ-times\\\"></i><span>Cancel</span></a>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"    <div ng-hide=\\\"cropping || annotating\\\">\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"showTextDialog()\\\"><i class=\\\"typ typ-sort-alphabetically\\\"></i><span>Text Recognition</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"showEmbedDialog()\\\"><i class=\\\"typ typ-code\\\"></i><span>Embed</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"shareOnFb()\\\"><i class=\\\"typ typ-social-facebook\\\"></i><span>Share</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"shareOnTwitter()\\\"><i class=\\\"typ typ-social-twitter\\\"></i><span>Tweet</span></a>\\n\" +\n    \"\\n\" +\n    \"        <hr/>\\n\" +\n    \"\\n\" +\n    \"        <div ng-if=\\\"user && user.userId === image.userId\\\">\\n\" +\n    \"            <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"annotate()\\\"><i class=\\\"typ typ-brush\\\"></i><span>Annotate</span></a>\\n\" +\n    \"            <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"crop()\\\"><i class=\\\"typ typ-scissors-outline\\\"></i><span>Crop</span></a>\\n\" +\n    \"            <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"rotate()\\\"><i class=\\\"typ typ-arrow-sync-outline\\\" ng-hide=\\\"rotating\\\"></i><i class=\\\"spinner-loading dark\\\" ng-show=\\\"rotating\\\"></i><span>Rotate</span></a>\\n\" +\n    \"            <a class=\\\"btn\\\" href=\\\"#\\\" ng-if=\\\"image.hasOriginal\\\" ng-click=\\\"revert()\\\"><i class=\\\"typ typ-arrow-back\\\" ng-hide=\\\"reverting\\\"></i><i class=\\\"spinner-loading dark\\\" ng-show=\\\"reverting\\\"></i><span>Revert To Original</span></a>\\n\" +\n    \"            <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"showPrivacyDialog()\\\"><i class=\\\"typ typ-lock-closed\\\"></i><span>Privacy</span></a>\\n\" +\n    \"            <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"delete()\\\"><i class=\\\"typ typ-trash\\\" ng-hide=\\\"deleting\\\"></i><i class=\\\"spinner-loading dark\\\" ng-show=\\\"deleting\\\"></i><span>Delete</span></a>\\n\" +\n    \"        </div>\\n\" +\n    \"        <div ng-if=\\\"!user || user.userId !== image.userId\\\">\\n\" +\n    \"            <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"showReportDialog()\\\"><i class=\\\"typ typ-flag\\\"></i><span>Report</span></a>\\n\" +\n    \"        </div>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"</div>\\n\" +\n    \"<div ng-if=\\\"doodle\\\" ng-show=\\\"annotationColorVisible\\\" class=\\\"ng-hide img-submenu sidebar annotation-color\\\">\\n\" +\n    \"    <a class=\\\"btn\\\" ng-repeat=\\\"color in annotationColors\\\" ng-class=\\\"{'active':doodle.color === '#'+color}\\\" ng-click=\\\"setAnnotationColor(color)\\\"><i class=\\\"typ typ-media-record\\\" ng-style=\\\"{color: '#'+color}\\\"></i></a>\\n\" +\n    \"</div>\\n\" +\n    \"<div ng-if=\\\"doodle\\\" ng-show=\\\"annotationSizeVisible\\\" class=\\\"ng-hide img-submenu sidebar annotation-size\\\">\\n\" +\n    \"    <a class=\\\"btn\\\" ng-repeat=\\\"size in annotationSizes\\\" ng-class=\\\"{'active':doodle.lineThickness === size}\\\" href=\\\"#\\\" ng-click=\\\"setAnnotationSize(size)\\\"><i ng-style=\\\"{height:size+'px'}\\\"></i></a>\\n\" +\n    \"</div>\\n\" +\n    \"\\n\" +\n    \"<div class=\\\"sidebar img-right-sidebar\\\" ng-if=\\\"albumImages.length > 0\\\">\\n\" +\n    \"    <ul>\\n\" +\n    \"        <li>In This Album</li>\\n\" +\n    \"        <li ng-repeat=\\\"albumImage in albumImages\\\" ng-class=\\\"{active: imageId == albumImage.imageId}\\\">\\n\" +\n    \"            <a ui-sref=\\\"image({ imageId: albumImage.imageId, albumId: albumId })\\\"><img ng-src=\\\"{{ albumImage.thumbnail.url }}\\\" /></a>\\n\" +\n    \"        </li>\\n\" +\n    \"    </ul>\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/modals/image-embed.html',\n    \"<div class=\\\"modal\\\" ng-click=\\\"close()\\\" id=\\\"image-embed-modal\\\">\\n\" +\n    \"    <div class=\\\"modal-content\\\" ng-click=\\\"$event.stopPropagation()\\\">\\n\" +\n    \"\\n\" +\n    \"        <h2><i class=\\\"typ typ-export\\\"></i> Link To <small>this image.</small></h2>\\n\" +\n    \"\\n\" +\n    \"        <div class=\\\"container-fluid\\\">\\n\" +\n    \"            <div class=\\\"row\\\">\\n\" +\n    \"                <div class=\\\"col-sm-6\\\">\\n\" +\n    \"\\n\" +\n    \"                    <div class=\\\"form-group\\\">\\n\" +\n    \"                        <h4>Markdown Link <small>e.g. for Reddit comments</small></h4>\\n\" +\n    \"                        <textarea rows=\\\"2\\\" class=\\\"form-control\\\" readonly=\\\"readonly\\\">[{{image.url}}]({{image.url}}</textarea>\\n\" +\n    \"                    </div>\\n\" +\n    \"\\n\" +\n    \"                    <div class=\\\"form-group\\\">\\n\" +\n    \"                        <p><small><a href=\\\"http://redditenhancementsuite.com/\\\">Reddit Enhancement Suite</a> supports CtrlV, so you can also just use this link in Reddit comments:</small></p>\\n\" +\n    \"                        <input type=\\\"text\\\" class=\\\"form-control\\\" readonly=\\\"readonly\\\" value=\\\"{{image.url}}\\\" />\\n\" +\n    \"                    </div>\\n\" +\n    \"\\n\" +\n    \"                    <div class=\\\"form-group\\\">\\n\" +\n    \"                        <h4>Markdown Image <small>e.g. for GitHub/BitBucket READMEs</small></h4>\\n\" +\n    \"                        <textarea rows=\\\"3\\\" class=\\\"form-control\\\" readonly=\\\"readonly\\\">[![{{ image.title }}]({{image.image.url}})]({{image.url}})</textarea>\\n\" +\n    \"                    </div>\\n\" +\n    \"\\n\" +\n    \"                </div>\\n\" +\n    \"                <div class=\\\"col-sm-6\\\">\\n\" +\n    \"\\n\" +\n    \"                    <div class=\\\"form-group\\\">\\n\" +\n    \"                        <h4>BBCode <small>for forums</small></h4>\\n\" +\n    \"                        <textarea rows=\\\"3\\\" class=\\\"form-control\\\" readonly=\\\"readonly\\\">[url={{image.url}}][img]{{image.image.url}}[/img]{{image.title}}[/url]</textarea>\\n\" +\n    \"                    </div>\\n\" +\n    \"\\n\" +\n    \"                    <div class=\\\"form-group\\\">\\n\" +\n    \"                        <h4>HTML <small>for websites</small></h4>\\n\" +\n    \"                        <textarea rows=\\\"5\\\" class=\\\"form-control\\\" readonly=\\\"readonly\\\">&lt;a href=&quot;{{image.url}}&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;{{image.image.url}}&quot; style=&quot;max-width:900px;&quot; alt=&quot;CtrlV.in Image Hosting&quot; /&gt;&lt;/a&gt;</textarea>\\n\" +\n    \"                    </div>\\n\" +\n    \"\\n\" +\n    \"                </div>\\n\" +\n    \"            </div>\\n\" +\n    \"        </div>\\n\" +\n    \"\\n\" +\n    \"    </div>\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/modals/image-privacy.html',\n    \"<div class=\\\"modal\\\" ng-click=\\\"close()\\\" id=\\\"image-privacy-modal\\\">\\n\" +\n    \"    <div class=\\\"modal-content\\\" ng-click=\\\"$event.stopPropagation()\\\">\\n\" +\n    \"\\n\" +\n    \"        <div class=\\\"container-fluid\\\" >\\n\" +\n    \"\\n\" +\n    \"            <div class=\\\"alert alert-warning\\\" ng-if=\\\"image.albumId\\\">\\n\" +\n    \"                This image is part of an album. Go to the <a href=\\\"#\\\">albums settings</a> to make the album anonyous and/or password protected.\\n\" +\n    \"            </div>\\n\" +\n    \"\\n\" +\n    \"            <div class=\\\"row\\\" ng-if=\\\"!image.albumId\\\">\\n\" +\n    \"                <div class=\\\"col-sm-6\\\">\\n\" +\n    \"\\n\" +\n    \"                    <h2><i class=\\\"typ typ-user\\\"></i> Show Username <small>on this image.</small></h2>\\n\" +\n    \"\\n\" +\n    \"                    <div class=\\\"form-group\\\">\\n\" +\n    \"                        <div class=\\\"row\\\">\\n\" +\n    \"                            <div class=\\\"col-xs-6\\\">\\n\" +\n    \"                                <a ng-click=\\\"setAnon(0);\\\" class=\\\"btn btn-block\\\" ng-class=\\\"{'active': !image.anonymous}\\\"><i class=\\\"typ typ-user\\\"></i>Yes</a>\\n\" +\n    \"                            </div>\\n\" +\n    \"                            <div class=\\\"col-xs-6\\\">\\n\" +\n    \"                                <a ng-click=\\\"setAnon(1);\\\" class=\\\"btn btn-block\\\" ng-class=\\\"{'active': image.anonymous}\\\"><i class=\\\"typ typ-cancel-outline\\\"></i>No</a>\\n\" +\n    \"                            </div>\\n\" +\n    \"                        </div>\\n\" +\n    \"                    </div>\\n\" +\n    \"\\n\" +\n    \"                </div>\\n\" +\n    \"                <div class=\\\"col-sm-6\\\">\\n\" +\n    \"\\n\" +\n    \"                    <h2><i class=\\\"typ typ-lock-closed\\\"></i> Password Protect <small>this image.</small></h2>\\n\" +\n    \"\\n\" +\n    \"                    <div class=\\\"form-group\\\">\\n\" +\n    \"                        <label>Enter a password that will be required for other people to view this image.</label>\\n\" +\n    \"                        (You will always be able to see it without the password.)\\n\" +\n    \"                        <input type=\\\"password\\\" class=\\\"form-control\\\" placeholder=\\\"Password\\\" />\\n\" +\n    \"                    </div>\\n\" +\n    \"\\n\" +\n    \"                    <a class=\\\"btn btn-block\\\">Save</a>\\n\" +\n    \"\\n\" +\n    \"                </div>\\n\" +\n    \"            </div>\\n\" +\n    \"        </div>\\n\" +\n    \"\\n\" +\n    \"    </div>\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/modals/image-text.html',\n    \"<div class=\\\"modal\\\" ng-click=\\\"close()\\\" id=\\\"image-text-modal\\\">\\n\" +\n    \"    <div class=\\\"modal-content\\\" ng-click=\\\"$event.stopPropagation()\\\">\\n\" +\n    \"        <h2><i class=\\\"typ typ-sort-alphabetically\\\"></i> Text <small>found in this image.</small></h2>\\n\" +\n    \"        <div class=\\\"container-fluid\\\">\\n\" +\n    \"\\n\" +\n    \"            <p ng-if=\\\"text.text.text\\\">{{ text.text.text }}</p>\\n\" +\n    \"\\n\" +\n    \"            <div class=\\\"alert alert-warning\\\" ng-if=\\\"text.text === null\\\">\\n\" +\n    \"                <i class=\\\"spinner-loading dark\\\"></i> The image is currently being scanned for text.\\n\" +\n    \"            </div>\\n\" +\n    \"\\n\" +\n    \"            <div class=\\\"alert alert-danger\\\" ng-if=\\\"text.text.text.length < 1\\\">\\n\" +\n    \"                No text was found in the image.\\n\" +\n    \"            </div>\\n\" +\n    \"\\n\" +\n    \"        </div>\\n\" +\n    \"    </div>\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/modals/login.html',\n    \"<div class=\\\"modal\\\" ng-click=\\\"close()\\\">\\n\" +\n    \"    <div class=\\\"modal-content\\\" ng-click=\\\"$event.stopPropagation()\\\">\\n\" +\n    \"\\n\" +\n    \"        <div class=\\\"container-fluid\\\">\\n\" +\n    \"            <div class=\\\"row\\\">\\n\" +\n    \"                <div class=\\\"col-sm-6\\\">\\n\" +\n    \"                    <form ng-submit=\\\"login()\\\">\\n\" +\n    \"                        <h2>Login <small>to you CtrlV account.</small></h2>\\n\" +\n    \"\\n\" +\n    \"                        <div class=\\\"form-group\\\" ng-class=\\\"{'has-error': loginData.errors.username}\\\">\\n\" +\n    \"                            <label class=\\\"control-label\\\"><i class=\\\"typ typ-user\\\"></i> Username\\n\" +\n    \"                                <input class=\\\"form-control\\\" type=\\\"text\\\" ng-model=\\\"loginData.username\\\" name=\\\"username\\\" />\\n\" +\n    \"                            </label>\\n\" +\n    \"\\n\" +\n    \"                            <span ng-if=\\\"loginData.errors.username\\\" class=\\\"help-block\\\">{{ loginData.errors.username.join(' ') }}</span>\\n\" +\n    \"\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div class=\\\"form-group\\\" ng-class=\\\"{'has-error': loginData.errors.password}\\\">\\n\" +\n    \"                            <label class=\\\"control-label\\\"><i class=\\\"typ typ-key\\\"></i> Password\\n\" +\n    \"                                <input class=\\\"form-control\\\" type=\\\"password\\\" ng-model=\\\"loginData.password\\\" name=\\\"password\\\" />\\n\" +\n    \"                            </label>\\n\" +\n    \"\\n\" +\n    \"                            <span ng-if=\\\"loginData.errors.password\\\" class=\\\"help-block\\\">{{ loginData.errors.password.join(' ') }}</span>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div class=\\\"form-group\\\">\\n\" +\n    \"                            <label>\\n\" +\n    \"                                <a href=\\\"#\\\" ng-click=\\\"forgot()\\\"><i class=\\\"typ typ-warning-outline\\\"></i> Forgot you password?</a>\\n\" +\n    \"                            </label>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div class=\\\"form-group\\\">\\n\" +\n    \"                            <label>\\n\" +\n    \"                                <a href=\\\"#\\\" ng-click=\\\"fb()\\\"><i class=\\\"typ typ-social-facebook\\\"></i> Used to login with Facebook?</a>\\n\" +\n    \"                            </label>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div ng-if=\\\"loginData.errors.general\\\" class=\\\"form-group has-error\\\">\\n\" +\n    \"                            <span class=\\\"help-block\\\"><i class=\\\"typ typ-warning\\\"></i> {{ loginData.errors.general }}</span>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <button class=\\\"btn btn-block\\\">\\n\" +\n    \"                            <i class=\\\"spinner-loading dark\\\" ng-show=\\\"loginData.loading\\\"></i>\\n\" +\n    \"                            <span ng-hide=\\\"loginData.loading\\\">Login</span>\\n\" +\n    \"                        </button>\\n\" +\n    \"                    </form>\\n\" +\n    \"                </div>\\n\" +\n    \"\\n\" +\n    \"                <div class=\\\"col-sm-6\\\">\\n\" +\n    \"                    <form ng-submit=\\\"signup()\\\">\\n\" +\n    \"                        <h2>Create <small>a new CtrlV account.</small></h2>\\n\" +\n    \"\\n\" +\n    \"                        <div class=\\\"form-group\\\" ng-class=\\\"{'has-error': signupData.errors.username}\\\">\\n\" +\n    \"                            <label class=\\\"control-label\\\"><i class=\\\"typ typ-user\\\"></i> Username\\n\" +\n    \"                                <input class=\\\"form-control\\\" type=\\\"text\\\" ng-model=\\\"signupData.username\\\" name=\\\"username\\\" />\\n\" +\n    \"                            </label>\\n\" +\n    \"\\n\" +\n    \"                            <span ng-if=\\\"signupData.errors.username\\\" class=\\\"help-block\\\">{{ signupData.errors.username.join(' ') }}</span>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div class=\\\"form-group\\\" ng-class=\\\"{'has-error': signupData.errors.username}\\\">\\n\" +\n    \"                            <label class=\\\"control-label\\\"><i class=\\\"typ typ-key\\\"></i> Password\\n\" +\n    \"                                <input class=\\\"form-control\\\" type=\\\"password\\\" ng-model=\\\"signupData.password\\\" name=\\\"password\\\" />\\n\" +\n    \"                            </label>\\n\" +\n    \"\\n\" +\n    \"                            <span ng-if=\\\"signupData.errors.password\\\" class=\\\"help-block\\\">{{ signupData.errors.password.join(' ') }}</span>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div class=\\\"form-group\\\" ng-class=\\\"{'has-error': signupData.errors.email}\\\">\\n\" +\n    \"                            <label class=\\\"control-label\\\"><i class=\\\"typ typ-mail\\\"></i> Email Address\\n\" +\n    \"                                <input class=\\\"form-control\\\" type=\\\"email\\\" ng-model=\\\"signupData.email\\\" name=\\\"email\\\" />\\n\" +\n    \"                            </label>\\n\" +\n    \"\\n\" +\n    \"                            <span ng-if=\\\"signupData.errors.email\\\" class=\\\"help-block\\\">{{ signupData.errors.email.join(' ') }}</span>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div ng-if=\\\"signupData.errors.general\\\" class=\\\"form-group has-error\\\">\\n\" +\n    \"                            <span class=\\\"help-block\\\"><i class=\\\"typ typ-warning\\\"></i> {{ signupData.errors.general }}</span>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <button class=\\\"btn btn-block\\\">\\n\" +\n    \"                            <i class=\\\"spinner-loading dark\\\" ng-show=\\\"signupData.loading\\\"></i>\\n\" +\n    \"                            <span ng-hide=\\\"signupData.loading\\\">Signup</span>\\n\" +\n    \"                        </button>\\n\" +\n    \"                    </form>\\n\" +\n    \"                </div>\\n\" +\n    \"\\n\" +\n    \"            </div>\\n\" +\n    \"        </div>\\n\" +\n    \"    </div>\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/partials/footer.html',\n    \"<footer>\\n\" +\n    \"\\n\" +\n    \"    <!--<div style=\\\"float:left;\\\">\\n\" +\n    \"        View:\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\">Grid (Classic)</a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\">Columns</a>\\n\" +\n    \"    </div>-->\\n\" +\n    \"\\n\" +\n    \"    <ul class=\\\"links\\\">\\n\" +\n    \"        <li>Created by <a href=\\\"https://themediadudes.com\\\">The Media Dudes</a></li>\\n\" +\n    \"        <li><a href=\\\"https://api.ctrlv.in/docs\\\"><i class=\\\"typ typ-flow-switch\\\"></i> API</a></li>\\n\" +\n    \"        <li><a href=\\\"mailto:help@ctrlv.in\\\"><i class=\\\"typ typ-mail\\\"></i> Contact Us</a></li>\\n\" +\n    \"        <li><a href=\\\"https://github.com/antriver/ctrlv-frontend\\\"><i class=\\\"typ typ-social-github\\\"></i> GitHub</a></li>\\n\" +\n    \"        <li><a ui-sref=\\\"help\\\"><i class=\\\"typ typ-info-large-outline\\\"></i> Help</a></li>\\n\" +\n    \"        <li><a ui-sref=\\\"privacy\\\"><i class=\\\"typ typ-lock-closed-outline\\\"></i> Privacy</a></li>\\n\" +\n    \"        <li><a ui-sref=\\\"terms\\\"><i class=\\\"typ typ-sort-alphabetically-outline\\\"></i> Terms of Use</a></li>\\n\" +\n    \"    </ul>\\n\" +\n    \"</footer>\\n\"\n  );\n\n\n  $templateCache.put('views/partials/header.html',\n    \"<header class=\\\"clearfix\\\">\\n\" +\n    \"    <a ui-sref=\\\"home\\\" id=\\\"logo-container\\\">\\n\" +\n    \"        <img src=\\\"/assets/img/ctrlv.svg\\\" id=\\\"logo\\\" />\\n\" +\n    \"    </a>\\n\" +\n    \"\\n\" +\n    \"    <h1 id=\\\"page-title\\\" ng-bind-html=\\\"title\\\" ng-class=\\\"{'with-subtitle': subtitle}\\\"></h1>\\n\" +\n    \"    <h3 id=\\\"page-subtitle\\\" ng-bind-html=\\\"subtitle\\\"></h3>\\n\" +\n    \"\\n\" +\n    \"    <div  id=\\\"current-user\\\">\\n\" +\n    \"        <div ng-if=\\\"user === false\\\">\\n\" +\n    \"            <a id=\\\"login-btn\\\" class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"login()\\\"><i class=\\\"typ typ-user\\\"></i> Login or Signup</a>\\n\" +\n    \"        </div>\\n\" +\n    \"        <div ng-if=\\\"user\\\">\\n\" +\n    \"            <h2>Hi <a ui-sref=\\\"user({ username: user.username.toLowerCase() })\\\" ng-bind=\\\"user.username\\\"></a></h2>\\n\" +\n    \"            <ul class=\\\"links\\\">\\n\" +\n    \"                <li><a ui-sref=\\\"user-favourites({ username: user.username.toLowerCase() })\\\"><i class=\\\"typ typ-heart-full-outline\\\"></i> Favourites</a></li>\\n\" +\n    \"                <li><a ui-sref=\\\"settings\\\"><i class=\\\"typ typ-spanner\\\"></i> Options</a></li>\\n\" +\n    \"                <li><a href=\\\"#\\\" ng-click=\\\"logout()\\\"><i class=\\\"typ typ-lock-open\\\"></i> Logout</a></li>\\n\" +\n    \"            </ul>\\n\" +\n    \"        </div>\\n\" +\n    \"    </div>\\n\" +\n    \"</header>\\n\"\n  );\n\n\n  $templateCache.put('views/partials/image-list.html',\n    \"<ul ng-if=\\\"images.length > 0\\\" class=\\\"img-grid\\\">\\n\" +\n    \"    <li ng-repeat=\\\"image in images\\\">\\n\" +\n    \"        <a\\n\" +\n    \"            ui-sref=\\\"image({ imageId: image.imageId })\\\"\\n\" +\n    \"            ng-style=\\\"{'background-image': image.thumbnail ? '' : 'url('+ image.image.url + ')'}\\\"\\n\" +\n    \"            >\\n\" +\n    \"            <img ng-if=\\\"image.thumbnail\\\" class=\\\"img-thumb\\\" ng-src=\\\"{{ image.thumbnail.url }}\\\" />\\n\" +\n    \"        </a>\\n\" +\n    \"    </li>\\n\" +\n    \"</ul>\\n\" +\n    \"\\n\" +\n    \"<paginator ng-hide=\\\"totalPages === 1\\\" class=\\\"sidebar\\\" total-pages=\\\"totalPages\\\" current-page=\\\"currentPage\\\" url=\\\"url\\\"></paginator>\\n\"\n  );\n\n\n  $templateCache.put('views/partials/paginator.html',\n    \"<ul>\\n\" +\n    \"    <li ng-repeat=\\\"page in pages track by $index\\\" ng-class=\\\"{'active':currentPage === page}\\\">\\n\" +\n    \"        <a ng-if=\\\"page != '...'\\\" href=\\\"{{url}}/{{page}}\\\">{{ page }}</a>\\n\" +\n    \"        <span ng-if=\\\"page === '...'\\\">...</span>\\n\" +\n    \"    </li>\\n\" +\n    \"</ul>\\n\"\n  );\n\n\n  $templateCache.put('views/user.html',\n    \"<ng-include src=\\\"'views/partials/image-list.html'\\\"></ng-include>\\n\" +\n    \"\\n\" +\n    \"<div class=\\\"album-sidebar\\\" ng-if=\\\"albums.length > 0\\\">\\n\" +\n    \"    <ul>\\n\" +\n    \"        <li>Albums</li>\\n\" +\n    \"        <li ng-repeat=\\\"album in albums\\\" ng-class=\\\"{active: albumId == albums.albumId}\\\">\\n\" +\n    \"            <a ui-sref=\\\"image({ imageId: albumImage.imageId, albumId: albumId })\\\">{{ album.title }}</a>\\n\" +\n    \"        </li>\\n\" +\n    \"    </ul>\\n\" +\n    \"</div>\\n\"\n  );\n\n}]);\n","app.controller(\n    'HeaderController',\n    function ($scope, $rootScope, ModalService, AuthService) {\n\n        $scope.login = function() {\n            // Just provide a template url, a controller and call 'showModal'.\n            ModalService.showModal({\n                templateUrl: 'views/modals/login.html',\n                controller: 'LoginModalController'\n            }).then(function(modal) {\n                // The modal object has the element built, if this is a bootstrap modal\n                // you can call 'modal' to show it, if it's a custom modal just show or hide\n                // it as you need to.\n                //modal.element.modal();\n                modal.close.then(function(result) {\n                    $scope.message = result ? \"You said Yes\" : \"You said No\";\n                });\n            });\n        };\n\n        $scope.logout = function() {\n            AuthService.logout();\n        };\n\n        $scope.signup = function() {\n            alert('signup');\n        };\n\n    }\n);\n","app.controller(\n    'HomeController',\n    function ($scope, $rootScope, $timeout) {\n\n        $rootScope.title = '';\n        $rootScope.subtitle = '';\n\n        var sprites = [];\n        for (var i = 0; i < 20; i++) {\n            sprites.push('<span class=\"homesprite homesprite-' + i + '\"></span>');\n        }\n        sprites.shuffle();\n        $scope.sprites = sprites.join('');\n\n        $scope.mac = navigator.platform === \"MacIntel\";\n\n        $timeout(function() {\n            $scope.test = true;\n        }, 1000);\n    }\n);\n","app.controller(\n    'ImageController',\n    function ($scope, $rootScope, $state, $element, $stateParams, $compile, AuthService, ImageResource, AlbumResource, ModalService) {\n\n        $scope.albumId = null;\n        $scope.albumImages = [];\n        $scope.image = null;\n        $scope.imageId = $stateParams.imageId;\n        $scope.editing = false;\n\n        $rootScope.loading = true;\n        $rootScope.title = '';\n        $rootScope.subtitle = '';\n\n        $scope.init = function () {\n\n            if ($stateParams.albumId) {\n                $scope.loadAlbumImages($stateParams.albumId);\n            }\n\n            ImageResource.get({imageId: $stateParams.imageId}, function (response) {\n                $scope.image = response.image;\n                $rootScope.loading = false;\n\n                // TODO: If the image is passworded show login prompt\n                // Show errors\n                // If anon or passworded, refresh on logout\n\n                var title = '';\n                if ($scope.image.title) {\n                    title = $scope.image.title;\n                } else {\n                    title = 'Image #' + $scope.image.imageId;\n                }\n                $rootScope.title = title;\n\n                var subtitle = '<span>';\n                if ($scope.image.userId) {\n                    subtitle += '<i class=\"typ typ-user\"></i> By <a ui-sref=\"user({username: image.user.username.toLowerCase()})\">' + $scope.image.user.username + '</a>';\n                }\n                subtitle += '<i class=\"typ typ-time\"></i> <span title=\"' + moment($scope.image.createdAt).format(\"dddd, MMMM Do YYYY, h:mm:ss a\") + '\">' + moment($scope.image.createdAt).fromNow() + '</span>';\n\n                if ($scope.image.album) {\n                    subtitle += '<i class=\"typ typ-folder-open\"></i> In <a ui-sref=\"album({albumId: image.album.albumId})\">' + $scope.image.album.title + '</a>';\n                }\n                subtitle += '</span>';\n\n                console.log($compile(subtitle)($scope));\n                $rootScope.subtitle = $compile(subtitle)($scope)[0].innerHTML;\n\n                if ($scope.image.albumId && $scope.image.albumId !== $scope.albumId) {\n                    $scope.loadAlbumImages($scope.image.albumId);\n                }\n            });\n        };\n\n        $scope.loadAlbumImages = function (albumId) {\n            $scope.albumId = albumId;\n            // Get the images in the album to show on the left\n            AlbumResource.getImages({albumId: albumId}, function (images) {\n                $scope.albumImages = images;\n            });\n        };\n\n        /**\n         * Sidebar Buttons\n         */\n\n        $scope.showTextDialog = function () {\n            ModalService.showModal({\n                templateUrl: 'views/modals/image-text.html',\n                controller: function ($scope, close, image) {\n                    $scope.image = image;\n                    $scope.text = ImageResource.getText({imageId: image.imageId});\n                    $scope.close = close;\n                },\n                inputs: {\n                    image: $scope.image\n                }\n            });\n        };\n\n        $scope.showEmbedDialog = function () {\n            ModalService.showModal({\n                templateUrl: 'views/modals/image-embed.html',\n                controller: function ($scope, close, image) {\n                    $scope.image = image;\n                    $scope.close = close;\n                },\n                inputs: {\n                    image: $scope.image\n                }\n            });\n        };\n\n        $scope.shareOnFb = function () {\n            var url = 'https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent($scope.image.url);\n            window.open(url);\n        };\n\n        $scope.shareOnTwitter = function () {\n            var url = 'https://twitter.com/home?status=' + encodeURIComponent($scope.image.url);\n            window.open(url);\n        };\n\n        /**\n         * Annotating\n         */\n\n        $scope.annotating = false;\n        $scope.savingAnnotation = false;\n        $scope.annotationColorVisible = false;\n        $scope.annotationSizeVisible = false;\n        $scope.annotationColors = [\n            '000000',\n            'B2B2B2',\n            '823914',\n            'CC0000',\n            'FF7519',\n            'FFCC66',\n            'FFFF00',\n            '009933',\n            '99FF66',\n            '3333FF',\n            '99CCFF',\n            '66FFFF',\n            '9933FF',\n            'FF3399',\n            'FF99FF',\n            'ffffff',\n        ];\n        $scope.annotationSizes = [\n            2,\n            5,\n            15,\n            40\n        ];\n\n        /**\n         * @type {Doodle}\n         */\n        $scope.doodle = null;\n\n        $scope.annotate = function () {\n\n            var element = document.createElement('annotator');\n            element.setAttribute('doodle', 'doodle');\n            var annotator = angular.element(element);\n\n            $element.append($compile(annotator)($scope));\n            $scope.annotating = true;\n\n            console.log($scope.doodle);\n        };\n\n        $scope.showAnnotationColor = function () {\n            // Toggle display of the color picker\n            $scope.annotationColorVisible = $scope.annotationColorVisible ? false : true;\n            $scope.annotationSizeVisible = false;\n        };\n\n        $scope.setAnnotationColor = function (color) {\n            $scope.doodle.color = '#'+color;\n        };\n\n        $scope.showAnnotationSize = function () {\n            // Toggle display of the size picker\n            $scope.annotationSizeVisible = $scope.annotationSizeVisible ? false : true;\n            $scope.annotationColorVisible = false;\n        };\n\n        $scope.setAnnotationSize = function (px) {\n            $scope.doodle.lineThickness = px;\n        };\n\n        $scope.saveAnnotation = function () {\n\n            if ($scope.savingAnnotation) {\n                return false;\n            }\n\n            var annotation = $scope.doodle.getImage();\n\n            $scope.savingAnnotation = true;\n\n            ImageResource.annotate(\n                {imageId: $scope.imageId},\n                {base64:annotation},\n                function (response) {\n                    $scope.savingAnnotation = false;\n                    console.log(response);\n                    $scope.image = response.image;\n                    $scope.exitAnnotation();\n                }, function (response) {\n                    $scope.savingAnnotation = false;\n                    alert(response.data.message);\n                }\n            );\n        };\n\n        $scope.undoAnnotation = function () {\n            $scope.doodle.undo();\n        };\n\n        $scope.restartAnnotation = function () {\n            $scope.doodle.clear();\n        };\n\n        $scope.exitAnnotation = function () {\n            $scope.annotationColorVisible = false;\n            $scope.annotationSizeVisible = false;\n            $scope.annotating = false;\n            $scope.doodle = null;\n            $('annotator').remove();\n        };\n\n        /**\n         * Cropping\n         */\n\n        $scope.cropCoords = null;\n        $scope.cropping = false;\n        $scope.savingCrop = false;\n        $scope.jcrop = null;\n\n        $scope.crop = function () {\n            if ($scope.editing) {\n                return false;\n            }\n            $scope.cropping = true;\n            $scope.jcrop = $.Jcrop('#img', {\n                onChange: function (c) {\n                    console.log(c);\n                    $scope.cropCoords = c;\n                }\n            });\n        };\n\n        $scope.saveCrop = function () {\n\n            if ($scope.savingCrop) {\n                return false;\n            }\n\n            // How much is the image scaled on screen\n            var scale = $scope.getImageScale();\n\n            var params = {\n                imageId: $scope.imageId,\n                width: Math.round($scope.cropCoords.w / scale),\n                height: Math.round($scope.cropCoords.h / scale),\n                x: Math.round($scope.cropCoords.x / scale),\n                y: Math.round($scope.cropCoords.y / scale),\n            };\n            $scope.savingCrop = true;\n            ImageResource.crop(\n                params,\n                function (response) {\n                    $scope.exitCrop();\n                    $scope.image = response.image;\n                },\n                function (response) {\n                    $scope.savingCrop = false;\n                    alert(response.data.message);\n                }\n            );\n        };\n\n        $scope.exitCrop = function () {\n            $scope.jcrop.destroy();\n            $scope.cropCoords = null;\n            $scope.cropping = false;\n            $scope.jcrop = null;\n            $scope.savingCrop = false;\n            // Undo what jcrop did\n            $('#img').css({width: '', height: ''});\n        };\n\n        $scope.rotate = function () {\n            if ($scope.editing) {\n                return false;\n            }\n            $scope.editing = true;\n            $scope.rotating = true;\n            ImageResource.rotate(\n                {\n                    imageId: $scope.image.imageId\n                },\n                function (response) {\n                    $scope.editing = false;\n                    $scope.rotating = false;\n                    $scope.image = response.image;\n                },\n                function (response) {\n                    $scope.editing = false;\n                    $scope.rotating = false;\n                    alert(response.data.message);\n                }\n            );\n        };\n\n        $scope.revert = function () {\n            if ($scope.editing) {\n                return false;\n            }\n\n            if (!confirm(\"This will undo and cropping and remove any annotation. Are you sure you want to do this?\")) {\n                return false;\n            }\n\n            $scope.editing = true;\n            $scope.reverting = true;\n            ImageResource.revert(\n                {\n                    imageId: $scope.image.imageId\n                },\n                function (response) {\n                    $scope.editing = false;\n                    $scope.reverting = false;\n                    $scope.image = response.image;\n                },\n                function (response) {\n                    $scope.editing = false;\n                    $scope.reverting = false;\n                    alert(response.data.message);\n                }\n            );\n        };\n\n        $scope.showPrivacyDialog = function () {\n            ModalService.showModal({\n                templateUrl: 'views/modals/image-privacy.html',\n                controller: function ($scope, close, image) {\n                    $scope.image = image;\n                    $scope.close = close;\n\n                    $scope.setAnon = function (anon) {\n                        ImageResource.update({'imageId': $scope.image.imageId},\n                        {\n                            anonymous:anon\n                        }, function(res)\n                        {\n                            console.log(res);\n                            $scope.image = res.image;\n                            $scope.$parent.image = res.image;\n                        });\n                    };\n\n                    $scope.setPassword = function () {\n\n                    };\n\n                },\n                inputs: {\n                    image: $scope.image\n                }\n            });\n        };\n\n        $scope.delete = function () {\n            if ($scope.editing) {\n                return false;\n            }\n\n            if (!confirm(\"Are you sure you want to delete this image?\")) {\n                return false;\n            }\n\n            $scope.editing = true;\n            $scope.deleting = true;\n            ImageResource.delete(\n                {\n                    imageId: $scope.image.imageId\n                },\n                function () {\n                    $scope.editing = false;\n                    $scope.deleting = false;\n                    $scope.image = null;\n                },\n                function (response) {\n                    $scope.editing = false;\n                    $scope.deleting = false;\n                    alert(response.data.message);\n                }\n            );\n        };\n\n        $scope.showReportDialog = function () {\n\n        };\n\n        /**\n         * Returns how much the image is scaled to fit on the screen.\n         */\n        $scope.getImageScale = function () {\n            return parseInt($('#img').width()) / $scope.image.image.width;\n        };\n\n        $scope.init();\n    }\n);\n","app.controller(\n    'LoginModalController',\n    function ($scope, close, AuthService, UserResource) {\n\n        $scope.loginData = {\n            loading: false,\n            username: '',\n            password: '',\n            errors: {}\n        };\n\n        $scope.signupData = {\n            loading: false,\n            username: '',\n            password: '',\n            email: '',\n            errors: {}\n        };\n\n        $scope.fb = function () {\n            alert(':(');\n        };\n\n        $scope.forgot = function () {\n            alert('lol');\n        };\n\n        $scope.login = function () {\n            if ($scope.loginData.loading) {\n                return false;\n            }\n            $scope.loginData.errors = {};\n            $scope.loginData.loading = true;\n\n            AuthService\n                .login($scope.loginData.username, $scope.loginData.password)\n                .then(\n                    function (response) {\n                        $scope.loginData.loading = false;\n\n                        close();\n                    },\n                    function (response) {\n                        $scope.loginData.loading = false;\n\n                        if (\n                            response.messages\n                            &&\n                            (\n                                response.messages.hasOwnProperty('username')\n                                ||\n                                response.messages.hasOwnProperty('password')\n                            )\n                        ) {\n                            $scope.loginData.errors = response.messages;\n                        } else {\n\n                            $scope.loginData.errors = {\n                                general: response.message\n                            };\n                        }\n\n                    }\n                );\n        };\n\n\n        $scope.signup = function () {\n            if ($scope.signupData.loading) {\n                return false;\n            }\n            $scope.signupData.errors = {};\n            $scope.signupData.loading = true;\n\n            UserResource.save({\n                username: $scope.signupData.username,\n                password: $scope.signupData.password,\n                email: $scope.signupData.email,\n            }, function(response) {\n\n                AuthService\n                    .login($scope.signupData.username, $scope.signupData.password)\n                    .then(\n                        function (response) {\n                            $scope.signupData.loading = false;\n                            close();\n                        },\n                        function (response) {\n                            $scope.signupData.loading = false;\n                            $scope.signupData.errors = {\n                                general: response.message\n                            };\n                        }\n                    );\n\n            }, function (response) {\n                $scope.signupData.loading = false;\n\n                response = response.data;\n                if (\n                    response.messages\n                    &&\n                    (\n                        response.messages.hasOwnProperty('username')\n                        ||\n                        response.messages.hasOwnProperty('password')\n                        ||\n                        response.messages.hasOwnProperty('email')\n                    )\n                ) {\n                    $scope.signupData.errors = response.messages;\n                } else {\n\n                    $scope.signupData.errors = {\n                        general: response.message\n                    };\n                }\n            });\n        };\n\n        $scope.close = close;\n\n    }\n);\n","app.controller(\n    'UserController',\n    function ($scope, $rootScope, $state, $stateParams, AuthService, UserResource) {\n\n        $scope.images = [];\n        $rootScope.loading = true;\n        $scope.username = $stateParams.username;\n\n        if ($stateParams.page === 1) {\n            $state.go('user', {username: $scope.username});\n            return;\n        }\n\n        $scope.currentPage = $stateParams.page ? $stateParams.page : 1;\n        $scope.totalPages = 0;\n        $scope.url = '#';\n\n        $rootScope.title = '';\n        $rootScope.subtitle = '';\n\n        UserResource.get({username: $scope.username}, function(user) {\n            $rootScope.title = '<i class=\"typ typ-image\"></i> ' + user.username + \"'s Images\";\n\n            $scope.url = '/user/' + user.username;\n\n            // FIXME: happens too fast when loading directly on /user/username page\n            if ($rootScope.user && $rootScope.user.userId === user.userId) {\n                UserResource.getAlbums({username: $scope.username}, function (albums) {\n                    $scope.albums = albums;\n                });\n            }\n        });\n\n        UserResource.getImages({username: $scope.username, page: $scope.currentPage}, function(data) {\n            $rootScope.loading = false;\n            $scope.images = data.images;\n            $scope.totalPages = data.lastPage;\n            console.log(data);\n        });\n    }\n);\n","app.directive('annotator', function ($window, debounce) {\n    return {\n        restrict: 'E',\n        controller: function ($scope, $element) {\n\n            console.log($scope.doodle);\n            var imageEl = $('#img');\n\n            $scope.doodle = new Doodle($element[0]);\n            $scope.doodle.init();\n\n            var moveAndResize = function() {\n                var imgOffset = imageEl.offset();\n                $element.css({\n                    left: imgOffset.left + 1,\n                    top: imgOffset.top + 1,\n                });\n                $scope.doodle.canvas.width = imageEl.width();\n                $scope.doodle.canvas.height = imageEl.height();\n            };\n\n            moveAndResize();\n\n            var debouncedRedraw = debounce(200, function() {\n                console.log('debouncedRedraw');\n                $scope.doodle.redraw();\n            });\n\n            angular.element($window).bind('resize', function() {\n                console.log('resize');\n                moveAndResize();\n                debouncedRedraw();\n            });\n\n        },\n        scope: {\n            doodle: '=',\n        },\n        template: ''\n    };\n});\n","app.directive('paginator', function factory($window, debounce) {\n    return {\n        restrict: 'E',\n        controller: function ($scope, $element) {\n            console.log('$scope', $scope);\n\n            var calculatePages = function () {\n\n                // Only 1 page - don't need a paginator\n                if ($scope.totalPages <= 3) {\n                    return [1];\n                }\n\n                var pages = [];\n                var i;\n                var paginatorHeight = $element.height();\n\n                // How tall is one link in the paginator\n                var spaceHeight = 46;\n\n                var totalSpaces = Math.floor(paginatorHeight / spaceHeight);\n\n                // Round down to the next odd number\n                if (totalSpaces % 2 === 0) {\n                    totalSpaces -= 1;\n                }\n\n                // All page numbers fit on screen\n                if ($scope.totalPages <= totalSpaces) {\n                    for (i = 1; i <= $scope.totalPages; i++) {\n                        pages.push(i);\n                    }\n                    return pages;\n                }\n\n                var adjacent = Math.floor((totalSpaces - 5) / 2);\n\n                if ($scope.currentPage <= (adjacent + 3)) {\n                    // Close to the start - don't hide first pages\n                    for (i = 1; i <= totalSpaces - 2; i++) {\n                        pages.push(i);\n                    }\n                    pages.push('...');\n                    pages.push($scope.totalPages);\n\n                } else if ($scope.currentPage >= $scope.totalPages - (adjacent) - 2) {\n                    // Close to the end - don't hide last pages\n                    pages = [1, '...'];\n                    for (i = $scope.totalPages - (adjacent*2) - 2; i <= $scope.totalPages; i++) {\n                        pages.push(i);\n                    }\n\n                } else {\n                    pages = [1, '...'];\n                    for (i = $scope.currentPage - adjacent; i <= $scope.currentPage + adjacent; i++) {\n                        pages.push(i);\n                    }\n                    pages.push('...');\n                    pages.push($scope.totalPages);\n                }\n\n                return pages;\n            };\n\n            $scope.pages = calculatePages();\n\n            // Recalculate on page change\n            $scope.$watchGroup(['totalPages', 'currentPage'], function () {\n                $scope.pages = calculatePages();\n            });\n\n            // Recalculate on window resize\n            var debouncedCalculatePages = debounce(100, function() {\n                $scope.pages = calculatePages();\n            });\n            angular.element($window).bind('resize', function() {\n                debouncedCalculatePages();\n            });\n\n        },\n        scope: {\n            currentPage: '=',\n            totalPages: '=',\n            url: '=',\n        },\n        templateUrl: 'views/partials/paginator.html'\n    };\n});\n","/**\n * Source: http://stackoverflow.com/a/32574746/710630\n */\n(function () {\n    'use strict';\n\n    app.directive(\n        'stateBodyClass',\n        function ($rootScope) {\n            return {\n                restrict: 'A',\n                scope: {},\n                link: function (scope, elem, attr, ctrl) {\n\n                    $rootScope.$on('$stateChangeSuccess', function (event, toState, toParams, fromState, fromParams) {\n                        var fromClassnames = angular.isDefined(fromState.data) && angular.isDefined(fromState.data.bodyClass) ? fromState.data.bodyClass : null;\n                        var toClassnames = angular.isDefined(toState.data) && angular.isDefined(toState.data.bodyClass) ? toState.data.bodyClass : null;\n\n                        // don't do anything if they are the same\n                        if (fromClassnames != toClassnames) {\n                            if (fromClassnames) {\n                                elem.removeClass(fromClassnames);\n                            }\n\n                            if (toClassnames) {\n                                elem.addClass(toClassnames);\n                            }\n                        }\n                    });\n                }\n            };\n        }\n    );\n\n}());\n","/**\n * Shuffles the items in an array.\n * Source: http://stackoverflow.com/a/10142256/710630\n *\n * @returns {Array}\n */\nArray.prototype.shuffle = function() {\n    var i = this.length, j, temp;\n    if (i === 0) {\n        return this;\n    }\n    while (--i) {\n        j = Math.floor( Math.random() * ( i + 1 ) );\n        temp = this[i];\n        this[i] = this[j];\n        this[j] = temp;\n    }\n    return this;\n};\n","\"use strict\";\n\nvar Doodle = function (element) {\n    this.element = element;\n    this.canvas = null;\n\n    this.lineThickness = 5;\n    this.color = '#000000';\n    this.drawing = false;\n    this.history = [];\n    this.currentData = null;\n\n    var ua = navigator.userAgent.toLowerCase();\n    this.isAndroid = ua.indexOf(\"android\") > -1;\n};\n\n\nDoodle.prototype = {\n\n    init: function () {\n\n        this.canvas = document.createElement('canvas');\n        this.element.appendChild(this.canvas);\n\n        //this.canvas.setAttribute('width', $(this.element).width());\n        //this.canvas.setAttribute('height', $(this.element).height());\n\n        this.context = this.canvas.getContext('2d');\n\n        //Setup a fresh canvas\n        this.color = '#000000';\n        $('#currentColour').css('background-color', this.color);\n        this.clear();\n\n        var self = this;\n\n        // Mouse\n        if (!this.isAndroid) {\n            $(this.canvas).bind('mousedown', function (e) {\n                self.drawStart(e);\n            });\n            $(this.canvas).bind('mousemove', function (e) {\n                self.draw(e);\n            });\n            $(this.canvas).bind('mouseup', function (e) {\n                self.drawEnd(e);\n            });\n            $('body').bind('mouseup', function (e) {\n                self.drawEnd(e);\n            });\n        }\n\n        // Touch\n        $(this.canvas).bind('touchstart', function (e) {\n            self.drawStart(e);\n        });\n        $(this.canvas).bind('touchmove', function (e) {\n            self.draw(e);\n        });\n        $(this.canvas).bind('touchend', function (e) {\n            self.drawEnd(e);\n        });\n    },\n\n    clear: function () {\n        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);\n        this.context.fillStyle = this.color;\n        this.history = [];\n    },\n\n    getImage: function (e) {\n        if (this.history.length < 1) {\n            return false;\n        }\n        return this.canvas.toDataURL(\"image/png\");\n    },\n\n    saveHistoryState: function () {\n        // Limit history size\n        while (this.history.length >= 30) {\n            this.history.shift();\n        }\n        this.history.push(this.context.getImageData(0, 0, this.canvas.width, this.canvas.height));\n    },\n\n    saveCurrentData: function () {\n        this.currentData = this.context.getImageData(0, 0, this.canvas.width, this.canvas.height);\n    },\n\n    undo: function () {\n        if (this.history.length > 0) {\n            var imageData = this.history.pop();\n            this.putImageData(imageData);\n        } else {\n            alert('Nothing to undo!');\n        }\n    },\n\n    redraw: function () {\n        if (this.currentData) {\n            this.putImageData(this.currentData);\n        }\n    },\n\n    putImageData: function (imageData) {\n        console.log(imageData);\n\n        if (imageData.width === this.canvas.width) {\n            this.context.putImageData(imageData, 0, 0);\n        } else {\n            // Draw it to a new canvas to resize it\n            var scale = this.canvas.width / imageData.width;\n\n            var newCanvas = $('<canvas>')\n                .attr('width', imageData.width)\n                .attr('height', imageData.height)[0];\n\n            newCanvas.getContext('2d').putImageData(imageData, 0, 0);\n\n            this.context.scale(scale, scale);\n            this.context.drawImage(newCanvas, 0, 0);\n            this.context.scale(1 / scale, 1 / scale);\n        }\n    },\n\n    drawStart: function (e) {\n        if (e) {\n            e.preventDefault();\n        }\n        this.saveHistoryState();\n\n        var x, y;\n        if (e.originalEvent.touches) {\n            x = e.originalEvent.touches[0].pageX - $(this.canvas).offset().left;\n            y = e.originalEvent.touches[0].pageY - $(this.canvas).offset().top;\n        }\n        else {\n            x = e.pageX - $(this.canvas).offset().left;\n            y = e.pageY - $(this.canvas).offset().top;\n        }\n\n        this.drawing = true;\n        $(this.canvas).addClass('drawing');\n\n        this.context.lineWidth = this.lineThickness;\n        this.context.lineCap = \"round\";\n        this.context.lineJoin = \"round\";\n        this.context.strokeStyle = this.color;\n        this.context.fillStyle = this.color;\n\n        this.oldX = x;\n        this.oldY = y;\n\n        // Draw a dot at the current position\n        this.context.beginPath();\n        this.context.arc(x, y, (this.lineThickness / 2), 0, 2 * Math.PI, false);\n        this.context.closePath();\n        this.context.fill();\n\n        this.context.beginPath();\n    },\n\n    draw: function (e) {\n        if (e) {\n            e.preventDefault();\n        }\n\n        var x, y;\n        if (e.originalEvent.touches) {\n            x = e.originalEvent.touches[0].pageX - $(this.canvas).offset().left;\n            y = e.originalEvent.touches[0].pageY - $(this.canvas).offset().top;\n        }\n        else {\n            x = e.pageX - $(this.canvas).offset().left;\n            y = e.pageY - $(this.canvas).offset().top;\n        }\n\n        if (this.drawing) {\n            this.context.moveTo(this.oldX, this.oldY);\n            this.context.lineTo(x, y);\n            this.context.stroke();\n        }\n\n        this.oldX = x;\n        this.oldY = y;\n    },\n\n    drawEnd: function (e) {\n        if (e) {\n            e.preventDefault();\n        }\n\n        if (this.drawing) {\n            this.context.closePath();\n            this.context.stroke();\n            this.drawing = false;\n        }\n\n        this.saveCurrentData();\n\n        $(this.canvas).removeClass('drawing');\n    },\n\n    rgbToHex: function (rgb) {\n        var hexDigits = new Array(\"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"a\", \"b\", \"c\", \"d\", \"e\", \"f\");\n\n        function hex(x) {\n            return isNaN(x) ? \"00\" : hexDigits[(x - x % 16) / 16] + hexDigits[x % 16];\n        }\n\n        rgb = rgb.match(/^rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)$/);\n        return \"#\" + hex(rgb[1]) + hex(rgb[2]) + hex(rgb[3]);\n    }\n};\n","var ImagePaster = (function () {\n    \"use strict\";\n\n    var ImagePaster = function (url) {\n        console.log('ImagePaster', url);\n        this.debug = true;\n        this.url = url;\n        this.pasteCatcher = null;\n        this.init();\n    };\n\n    ImagePaster.prototype.log = function (data, extra) {\n        if (this.debug) {\n            console.log(data, extra);\n        }\n    };\n\n    ImagePaster.prototype.init = function () {\n\n        var self = this;\n\n        /**\n         * Firefox allows images to be pasted into contenteditable elements.\n         * So create one of those on the page and make it have focus,\n         * so paste events happen into that\n         */\n\n        // Create paste catcher element\n        self.pasteCatcher = document.createElement('div');\n        self.pasteCatcher.setAttribute('contenteditable', '');\n        self.pasteCatcher.setAttribute('style', 'position:absolute; opacity:0; top:0; left:0; width:0; height:0;');\n        self.pasteCatcher.id = 'paste-catcher';\n        document.body.appendChild(self.pasteCatcher);\n        self.pasteCatcher.focus();\n\n        // Listen for the 'paste' event on the body\n        //if (browserName == 'IE') {\n        //$('body').on('paste', function(event) { self.onPaste(event); });\n        //} else {\n        document.addEventListener('paste', function (event) {\n            self.onPaste(event);\n        });\n        //}\n\n        // Watch for ctrl + v being pressed\n        $(document).on('keydown', function (e) {\n            // 86 = v\n            if (e.which === 86 && (e.ctrlKey || e.metaKey)) {\n                $(document).trigger('ctrlVPressed');\n            }\n        });\n\n        // Focus paste catcher when cmd or ctrlv is pressed\n        $(document).on('ctrlVPressed', function () {\n            self.pasteCatcher.focus();\n        });\n\n    };\n\n    ImagePaster.prototype.onPaste = function (event) {\n\n        var self = this;\n        var done = false;\n        var clipboardData;\n\n        self.log('onPaste', JSON.stringify(event));\n\n        if (event.clipboardData) {\n            // Chrome\n            clipboardData = event.clipboardData;\n        } else if (window.clipboardData) {\n            // IE\n            clipboardData = window.clipboardData;\n        } else {\n            // Firefox\n            //setTimeout(this.checkPasteCatcher, 1);\n        }\n\n        // IE\n        if (event.msConvertURL) {\n            var fileList = clipboardData.files;\n            if (fileList.length > 0) {\n                for (var i = 0; i < fileList.length; i++) {\n                    self.uploadBlob(fileList[i]);\n                    done = true;\n                }\n            }\n        }\n\n        // Check if there is something in the paste event itself\n        if (clipboardData && clipboardData.items) {\n\n            var text;\n            // If there was some text on the clipboard,\n            // it might be a URL. Try and paste that...\n            if ((text = clipboardData.getData(\"text/plain\"))) {\n                self.uploadText(text);\n                self.clearPasteCatcher();\n                return;\n            }\n\n            // Loop through all the clipboardData\n            for (var x = 0; x < clipboardData.items.length; x++) {\n                // If this clipboard item claims to be an image, upload it\n                if (clipboardData.items[x].type.indexOf('image') !== -1) {\n                    self.uploadBlob(clipboardData.items[x].getAsFile());\n                    done = true;\n                }\n            }\n        }\n\n        // If there was nothing found in the clipboard data\n        // fall back to checking if there's anything in the editable element\n        if (done) {\n            self.clearPasteCatcher();\n        } else {\n            setTimeout(\n                function () {\n                    self.checkPasteCatcher();\n                },\n                10\n            );\n        }\n    };\n\n    /**\n     * Check if anything has been pasted into the paste catcher element\n     * (Firefox + Safari?)\n     */\n    ImagePaster.prototype.checkPasteCatcher = function () {\n\n        var text = this.pasteCatcher.innerHTML;\n        var child = this.pasteCatcher.childNodes[0];\n\n        if (child) {\n            if (child.tagName === 'IMG') {\n                if (child.src.indexOf('webkit-fake-url://') != -1) {\n                    this.onFail('Sorry, Safari does not currently support pasting images.');\n                    return false;\n                }\n                this.uploadImage(child.src);\n            } else if (child.tagName === 'A') {\n                this.uploadText(child.href);\n            } else {\n                this.uploadText(text);\n            }\n        }\n\n        this.clearPasteCatcher();\n    };\n\n    ImagePaster.prototype.clearPasteCatcher = function () {\n        var self = this;\n        setTimeout(\n            function () {\n                self.pasteCatcher.innerHTML = '';\n            },\n            1\n        );\n    };\n\n    ImagePaster.prototype.uploadBlob = function (blob) {\n        if (blob) {\n            var self = this;\n            var reader = new FileReader();\n            reader.onload = function (evt) {\n                self.uploadImage(evt.target.result);\n            };\n            reader.readAsDataURL(blob);\n        }\n    };\n\n    ImagePaster.prototype.uploadText = function (text) {\n        console.log('uploadText', text);\n        return this.upload('text', text);\n\n        /*if (this.validateURL(url)) {\n         upload('url', url);\n         } else {\n         failedUpload(\"Can't upload that. Try pasting an image or URL.\");\n         }*/\n    };\n\n    ImagePaster.prototype.uploadImage = function (base64) {\n        return this.upload('uploadImage', base64);\n\n        /*convertImageToJpeg(base64, function(jpegBase64){\n         upload('base64', jpegBase64);\n         });*/\n    };\n\n    /*ImagePaster.prototype.convertImageToJpeg = function(base64, callback)\n     {\n     //Convert image to a JPG so it's faster to upload\n     var img = new Image();\n     img.onload = function()\n     {\n     var canvas = convertImageToCanvas(this);\n     var data = canvas.toDataURL('image/jpeg' , 0.8);\n     callback(data);\n     };\n     img.src = base64;\n     };*/\n\n    /*ImagePaster.prototype.convertImageToCanvas = function(image)\n     {\n     var canvas = document.createElement(\"canvas\");\n     canvas.width = image.width;\n     canvas.height = image.height;\n\n     var context = canvas.getContext(\"2d\");\n     context.fillStyle = \"#ffffff\";\n     context.fillRect(0,0,image.width,image.height);\n     context.drawImage(image, 0, 0);\n\n     return canvas;\n     };*/\n\n    ImagePaster.prototype.upload = function (format, data) {\n\n        var self = this;\n        $(document).trigger('ctrlvuploadstart');\n\n        var url = this.url;\n        if (typeof url === 'function') {\n            url = url();\n        }\n\n        $.ajax({\n            url: url,\n            timeout: 90000,\n            type: 'POST',\n            data: {\n                format: format,\n                base64: data\n            },\n            error: function (jqXHR, textStatus) {\n                // Turn this error message into something useful\n                var message;\n                switch (textStatus) {\n                    case 'timeout':\n                        message = 'The image took too long to upload';\n                        break;\n                    case 'error':\n\n                        if (jqXHR.responseJSON && jqXHR.responseJSON.message) {\n                            message = 'CtrlV server error (' + jqXHR.responseJSON.errorType + ' ' + jqXHR.responseJSON.message + ')';\n                        } else if (jqXHR.status !== 0) {\n                            message = 'CtrlV server error (' + jqXHR.status + ' ' + jqXHR.statusText + ')';\n                        } else {\n                            message = 'Can\\'t connect to the CtrlV server';\n                        }\n                        break;\n                    case 'abort':\n                        message = 'The upload was cancelled';\n                        break;\n                    case 'parsererror':\n                        message = 'Error uploading: couldn\\'t decode the response from the server';\n                        break;\n                    default:\n                        message = textStatus;\n                        break;\n                }\n\n                self.onFail(message);\n            },\n            success: function (res) {\n                if (res.image) {\n                    $(document).trigger({\n                        type: 'ctrlvuploadcomplete',\n                        image: res.image\n                    });\n                } else {\n                    self.onFail(res.message);\n                }\n            }\n        });\n    };\n\n    ImagePaster.prototype.onFail = function (message) {\n        $(document).trigger({\n            type: 'ctrlvuploaderror',\n            message: message ? message : false\n        });\n    };\n\n    ImagePaster.prototype.validateURL = function (text) {\n        var regex = new RegExp(\"^(http|https|ftp)\\://([a-zA-Z0-9\\.\\-]+(\\:[a-zA-Z0-9\\.&amp;%\\$\\-]+)*@)*((25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9])\\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])|([a-zA-Z0-9\\-]+\\.)*[a-zA-Z0-9\\-]+\\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(\\:[0-9]+)*(/($|[a-zA-Z0-9\\.\\,\\?\\'\\\\\\+&amp;%\\$#\\=~_\\-]+))*$\");\n        return regex.test(text);\n    };\n\n    return ImagePaster;\n}());\n","app.factory(\n    'AlbumResource',\n    function ($resource, AuthService) {\n        return $resource(\n            apiUrl + 'albums/:albumId',\n            {\n                albumId: '@albumId',\n                sessionKey: function() {\n                    return AuthService.getSessionKey() || null;\n                }\n            },\n            {\n                get: {\n                    cache: true,\n                    transformResponse: function(data) {\n                        data = angular.fromJson(data);\n                        return data.image;\n                    }\n                },\n\n                getImages: {\n                    cache: true,\n                    url: apiUrl + 'albums/:albumId/images',\n                    isArray: true,\n                    transformResponse: function(data) {\n                        var data = angular.fromJson(data);\n                        return data.images;\n                    }\n                }\n\n            }\n        );\n    }\n);\n","app.factory(\n    'ImageResource',\n    function ($resource, AuthService) {\n        return $resource(\n            apiUrl + 'images/:imageId',\n            {\n                imageId: '@imageId',\n                sessionKey: function() {\n                    return AuthService.getSessionKey() || null;\n                }\n            },\n            {\n                get: {\n                    cache: true,\n                },\n\n                update: {\n                    method: 'PUT'\n                },\n\n                getText: {\n                    url: apiUrl + 'images/:imageId/text',\n                    method: 'GET'\n                },\n\n                annotate: {\n                    url: apiUrl + 'images/:imageId/image',\n                    method: 'PUT',\n                    params: {\n                        action: 'annotate'\n                    }\n                },\n\n                crop: {\n                    url: apiUrl + 'images/:imageId/image',\n                    method: 'PUT',\n                    params: {\n                        action: 'crop'\n                    }\n                },\n\n                revert: {\n                    url: apiUrl + 'images/:imageId/image',\n                    method: 'PUT',\n                    params: {\n                        action: 'revert'\n                    }\n                },\n\n                rotate: {\n                    url: apiUrl + 'images/:imageId/image',\n                    method: 'PUT',\n                    params: {\n                        action: 'rotate',\n                        degrees: 90\n                    }\n                },\n            }\n        );\n    }\n);\n","app.factory(\n    'SessionResource',\n    function ($resource) {\n        return $resource(\n            apiUrl + 'sessions/:sessionKey',\n            {},\n            {\n                get: {\n                    transformResponse: function(data) {\n                        data = angular.fromJson(data);\n                        return data.session;\n                    }\n                }\n            }\n        );\n    }\n);\n","app.factory(\n    'UserResource',\n    function ($resource, AuthService) {\n        return $resource(\n            apiUrl + 'users/:username',\n            {\n                username: '@username',\n                sessionKey: function() {\n                    return AuthService.getSessionKey() || null;\n                }\n            },\n            {\n                get: {\n                    cache: true,\n                    transformResponse: function(data) {\n                        var data = angular.fromJson(data);\n                        return data.user;\n                    }\n                },\n\n                save: {\n                    method: 'POST',\n                    url: apiUrl + 'users'\n                },\n\n                getImages: {\n                    cache: true,\n                    url: apiUrl + 'users/:username/images?page=:page',\n                    /*isArray: true,\n                    transformResponse: function(data) {\n                        var data = angular.fromJson(data);\n                        return data.images;\n                    }*/\n                },\n\n                getAlbums: {\n                    cache: true,\n                    url: apiUrl + 'users/:username/albums',\n                    /*isArray: true,\n                    transformResponse: function(data) {\n                        var data = angular.fromJson(data);\n                        return data;\n                    }*/\n                }\n            }\n        );\n    }\n);\n","app.service(\n    'AuthService',\n    function (localStorageService, SessionResource, $q, $rootScope) {\n\n        var session = null;\n        var sessionKey = null;\n\n        return {\n\n            checkSession: function() {\n                var self = this;\n\n                if (sessionKey = localStorageService.get('sessionKey')) {\n                    SessionResource.get(\n                        {sessionKey: sessionKey},\n                        function (session) {\n                            self.onLogin(session, sessionKey);\n                        },\n                        function() {\n                            self.onLogout();\n                        }\n                    );\n                } else {\n                    self.onLogout();\n                }\n            },\n\n            /**\n             * @param username\n             * @param password\n             * @returns $q\n             */\n            login: function(username, password) {\n                var self = this;\n\n                return $q(function(resolve, reject) {\n\n                    SessionResource.save({\n                        username: username,\n                        password: password\n                    }, function(response) {\n\n                        self.onLogin(response.session, response.sessionKey);\n\n                        // Resolve promise (sends back user)\n                        resolve(response.session.user);\n\n                    }, function (response) {\n                        reject(response.data);\n                    });\n\n                });\n            },\n\n            onLogin: function(newSession, newSessionKey) {\n\n                session = newSession;\n                sessionKey = newSessionKey;\n                localStorageService.set('sessionKey', newSessionKey);\n\n                // Tell everybody we're logged in\n                $rootScope.$broadcast('login', {user: newSession.user});\n\n            },\n\n            logout: function() {\n                var self = this;\n\n                SessionResource.delete({\n                    sessionKey: sessionKey\n                });\n\n                self.onLogout();\n\n            },\n\n            onLogout: function() {\n\n                session = false;\n                sessionKey = false;\n                localStorageService.remove('sessionKey');\n\n                // Tell everybody we're logged in\n                $rootScope.$broadcast('logout');\n\n            },\n\n            getSessionKey: function() {\n                return sessionKey;\n            },\n\n            getUser: function() {\n                if (session === null) {\n                    return null;\n                }\n\n                return session && session.user ? session.user : false;\n            }\n        };\n    }\n);\n","app.service(\n    'ImagePasterService',\n    function($state, AuthService) {\n\n        /**\n         * Add listeners for events that ImagePaster broadcasts.\n         */\n        $(document).on('ctrlvuploadstart', function () {\n            $('.upload-status').addClass('out');\n            $('#upload-loading').removeClass('out');\n        });\n\n        $(document).on('ctrlvuploadcomplete', function (e) {\n            $('.upload-status').addClass('out');\n            $('#upload-complete').removeClass('out');\n            var viewUrl = e.image.url;\n            var imageUrl = e.image.image.url;\n            $('#view-btn').attr('href', viewUrl);\n            $('#uploader').css('background-image', 'url(' + imageUrl + ')');\n\n            $state.go('image', {imageId: e.image.imageId});\n\n        });\n\n        $(document).on('ctrlvuploaderror', function (e) {\n            $('.upload-status').addClass('out');\n            $('#upload-error').removeClass('out').find('p').text(e.message);\n        });\n\n        $(document).on('keyup', function (e) {\n            // Highlighting keys when pressing\n            if (e.which == 91 || e.which === 224) { // cmd\n                $('.btn-cmd').removeClass('active');\n            } else if (e.which == 17) { // ctrl\n                $('.btn-ctrl').removeClass('active');\n            } else if (e.which == 86) { // v\n                $('.btn-v').removeClass('active');\n            }\n        });\n\n        $(document).on('keydown', function (e) {\n            // Highlighting keys when pressing\n            if (e.which == 91 || e.which === 224) { // cmd (91 in\n                $('.btn-cmd').addClass('active');\n            } else if (e.which == 17) { // ctrl\n                $('.btn-ctrl').addClass('active');\n            } else if (e.which == 86) { // v\n                $('.btn-v').addClass('active');\n            }\n        });\n\n        var getImageUploadUrl = function() {\n            var url = apiUrl + 'images';\n\n            var sessionKey;\n            if (sessionKey = AuthService.getSessionKey()) {\n                url += '?sessionKey=' + sessionKey;\n            }\n            return url;\n        };\n\n        return new ImagePaster(getImageUploadUrl);\n    }\n);\n"]}