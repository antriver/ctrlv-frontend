{"version":3,"sources":["../../../../../src/js/app.js","../../../../../src/js/alerts.js","../../../../../src/js/templates.js","../../../../../src/js/controllers/HeaderController.js","../../../../../src/js/controllers/HomeController.js","../../../../../src/js/controllers/ImageController.js","../../../../../src/js/controllers/ImageListController.js","../../../../../src/js/controllers/LoginModalController.js","../../../../../src/js/directives/annotator.js","../../../../../src/js/directives/paginator.js","../../../../../src/js/directives/stateBodyClass.js","../../../../../src/js/libraries/ArrayPrototype.js","../../../../../src/js/libraries/Doodle.js","../../../../../src/js/libraries/ImagePaster.js","../../../../../src/js/resources/AlbumResource.js","../../../../../src/js/resources/ImageResource.js","../../../../../src/js/resources/SessionResource.js","../../../../../src/js/resources/UserResource.js","../../../../../src/js/services/AuthService.js","../../../../../src/js/services/ImagePasterService.js"],"names":["alertSuccess","message","keep","Messenger","post","type","showCloseButton","hideAfter","alertInfo","alertSpinner","alertError","app","angular","module","config","$httpProvider","$locationProvider","$stateProvider","$urlRouterProvider","localStorageServiceProvider","html5Mode","setPrefix","setStorageType","setStorageCookie","otherwise","state","url","templateUrl","controller","params","albumId","mode","run","$rootScope","$state","AuthService","ImagePasterService","checkSession","user","getUser","$on","event","args","ev","to","toParams","from","fromParams","$","attr","name","$templateCache","put","options","extraClasses","theme","$scope","ModalService","login","showModal","then","modal","close","result","logout","signup","alert","$timeout","title","subtitle","sprites","i","push","shuffle","join","mac","navigator","platform","test","$element","$stateParams","$compile","ImageResource","AlbumResource","loadImage","imageId","loading","get","response","image","userId","username","moment","createdAt","format","fromNow","album","innerHTML","loadAlbumImages","console","log","albumImages","editing","init","changeImage","$event","stopPropagation","preventDefault","cleanup","go","notify","exitAnnotation","exitCrop","getImages","data","images","showTextDialog","text","getText","inputs","showEmbedDialog","shareOnFb","encodeURIComponent","window","open","shareOnTwitter","annotating","savingAnnotation","annotationColorVisible","annotationSizeVisible","annotationColors","annotationSizes","doodle","annotate","element","document","createElement","setAttribute","annotator","append","showAnnotationColor","setAnnotationColor","color","showAnnotationSize","setAnnotationSize","px","lineThickness","saveAnnotation","annotation","getImage","base64","undoAnnotation","undo","restartAnnotation","clear","remove","cropCoords","cropping","savingCrop","jcrop","crop","Jcrop","onChange","c","saveCrop","scale","getImageScale","width","Math","round","w","height","h","x","y","destroy","css","rotate","rotating","rotateCcw","rotatingCcw","direction","revert","confirm","reverting","showPrivacyDialog","passwordData","password","setAnon","anon","showLoader","update","anonymous","res","$parent","setPassword","removePassword","deleting","showReportDialog","parseInt","UserResource","loadAlbum","albums","loadUser","loadImages","page","imagesLoadedCallback","totalPages","lastPage","currentPage","changeAlbum","changeUser","changePage","loginData","errors","signupData","email","fb","forgot","messages","hasOwnProperty","general","save","directive","$window","debounce","restrict","imageEl","Doodle","moveAndResize","imgOffset","offset","left","top","canvas","debouncedRedraw","redraw","bind","scope","template","showPageJump","pageNumber","prompt","location","calculatePages","pages","paginatorHeight","spaceHeight","totalSpaces","floor","adjacent","$watchGroup","debouncedCalculatePages","link","elem","ctrl","toState","fromState","fromClassnames","isDefined","bodyClass","toClassnames","removeClass","addClass","Array","prototype","j","temp","this","length","random","drawing","history","currentData","ua","userAgent","toLowerCase","isAndroid","indexOf","appendChild","context","getContext","self","e","drawStart","draw","drawEnd","clearRect","fillStyle","toDataURL","saveHistoryState","shift","getImageData","saveCurrentData","imageData","pop","putImageData","newCanvas","drawImage","originalEvent","touches","pageX","pageY","lineWidth","lineCap","lineJoin","strokeStyle","oldX","oldY","beginPath","arc","PI","closePath","fill","moveTo","lineTo","stroke","rgbToHex","rgb","hex","isNaN","hexDigits","match","ImagePaster","debug","pasteCatcher","extra","id","body","focus","addEventListener","onPaste","on","which","ctrlKey","metaKey","trigger","clipboardData","done","JSON","stringify","msConvertURL","fileList","files","uploadBlob","items","getData","uploadText","clearPasteCatcher","getAsFile","setTimeout","checkPasteCatcher","child","childNodes","tagName","src","onFail","uploadImage","href","blob","reader","FileReader","onload","evt","target","readAsDataURL","upload","generateId","ajax","timeout","error","jqXHR","textStatus","responseJSON","errorType","status","statusText","success","validateURL","regex","RegExp","replace","r","crypto","getRandomValues","Uint8Array","v","toString","factory","$resource","apiUrl","sessionKey","getSessionKey","cache","transformResponse","fromJson","method","action","degrees","session","getAlbums","service","localStorageService","SessionResource","$q","onLogin","onLogout","resolve","reject","newSession","newSessionKey","set","$broadcast","viewUrl","imageUrl","find","getImageUploadUrl"],"mappings":"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","file":"ctrlv.min.js","sourcesContent":["\"use strict\";\n\n// Initialize angular\n\nvar app = angular.module('ctrlv', [\n    'ui.router',\n    'ngResource',\n    'ngSanitize',\n    'LocalStorageModule',\n    'angularModalService',\n    'ngAnimate',\n    'rt.debounce'\n]);\n\n/**\n * Angular\n */\n\n// Routes\napp.config(function($httpProvider, $locationProvider, $stateProvider, $urlRouterProvider, localStorageServiceProvider) {\n\n    /*$httpProvider.defaults.headers.common = {\n        'RemoteUser': 'billybob'\n    };*/\n\n    $locationProvider.html5Mode(true);\n\n    localStorageServiceProvider\n        .setPrefix('ctrlv')\n        .setStorageType('localStorage')\n        .setStorageCookie(0, '/');\n\n    // For any unmatched url, redirect to /\n    $urlRouterProvider.otherwise('/');\n\n    // Now set up the states\n    $stateProvider\n        .state('home', {\n            url: \"/\",\n            templateUrl: \"views/home.html\",\n            controller: 'HomeController'\n        })\n        .state('help', {\n            url: \"/help\",\n            templateUrl: \"views/help.html\",\n            controller: 'HelpController'\n        })\n        .state('image', {\n            url: \"/{imageId:int}\",\n            templateUrl: \"views/image.html\",\n            controller: 'ImageController',\n            params: {\n                albumId: null\n            },\n        })\n        .state('user', {\n            url: \"/user/{username:string}\",\n            templateUrl: \"views/image-list.html\",\n            controller: 'ImageListController',\n            params: {\n                mode: 'user'\n            },\n        })\n        .state('user-page', {\n            url: \"/user/{username:string}/{page:int}\",\n            templateUrl: \"views/image-list.html\",\n            controller: 'ImageListController',\n            params: {\n                mode: 'user'\n            }\n        })\n\n        .state('album', {\n            url: \"/album/{albumId:int}\",\n            templateUrl: \"views/image-list.html\",\n            controller: 'ImageListController',\n            params: {\n                mode: 'album'\n            }\n\n        })\n        .state('album-page', {\n            url: \"/album/{albumId:int}/{page:int}\",\n            templateUrl: \"views/image-list.html\",\n            controller: 'ImageListController',\n            params: {\n                mode: 'album'\n            }\n        });\n});\n\napp.run(function($rootScope, $state, AuthService, ImagePasterService) {\n    // ImagePasterService is injected here so it gets initialized\n\n\n    //$httpProvider.defaults.headers.post[\"Content-Type\"] = \"text/plain\";\n\n    $rootScope.$state = $state;\n\n\n    AuthService.checkSession();\n\n    $rootScope.user = AuthService.getUser();\n\n    $rootScope.$on('login', function(event, args) {\n        $rootScope.user = args.user;\n    });\n\n    $rootScope.$on('logout', function() {\n        $rootScope.user = false;\n    });\n\n    $rootScope.$on('$stateChangeSuccess', function (ev, to, toParams, from, fromParams) {\n        $('body').attr('data-previous', from.name);\n    });\n});\n\n","Messenger.options = {\n    extraClasses: 'messenger-fixed messenger-on-bottom messenger-on-middle',\n    theme: 'ctrlv'\n};\n\nfunction alertSuccess(message, keep)\n{\n    return Messenger().post({\n        message: message,\n        type: 'success',\n        showCloseButton: true,\n        hideAfter: keep ? 0 : 3\n    });\n}\n\nfunction alertInfo(message)\n{\n    return Messenger().post({\n        message: message,\n        type: 'info',\n        showCloseButton: true,\n        hideAfter: 3\n    });\n}\n\nfunction alertSpinner(message)\n{\n    return Messenger().post({\n        message: message + '<i class=\"spinner-loading\"></i>',\n        type: 'spinner',\n        hideAfter: 0\n    });\n}\n\nfunction alertError(message, keep)\n{\n    return Messenger().post({\n        message: message,\n        type: 'error',\n        showCloseButton: true,\n        hideAfter: keep ? 0 : 5\n    });\n}\n\n","angular.module('ctrlv').run(['$templateCache', function($templateCache) {\n  'use strict';\n\n  $templateCache.put('views/album.html',\n    \"<ng-include src=\\\"'views/partials/image-list.html'\\\"></ng-include>\\n\" +\n    \"\\n\" +\n    \"<ng-include src=\\\"'views/partials/albums-sidebar.html'\\\"></ng-include>\\n\"\n  );\n\n\n  $templateCache.put('views/home.html',\n    \"<div id=\\\"uploader\\\">\\n\" +\n    \"\\n\" +\n    \"    <div id=\\\"uploader-collage\\\" ng-bind-html=\\\"sprites\\\"></div>\\n\" +\n    \"\\n\" +\n    \"    <div class=\\\"upload-status\\\" id=\\\"upload-waiting\\\">\\n\" +\n    \"        <h2>The <span class=\\\"green\\\">easiest</span> way to share photos.</h2>\\n\" +\n    \"        <h3>\\n\" +\n    \"            <span style=\\\"float:right;\\\">\\n\" +\n    \"                You can also\\n\" +\n    \"                <a href=\\\"#\\\" class=\\\"btn\\\"><i class=\\\"typ typ-cloud-storage\\\"></i> Upload Images</a>\\n\" +\n    \"                or\\n\" +\n    \"                <a href=\\\"#\\\" class=\\\"btn\\\"><i class=\\\"typ typ-camera\\\"></i> Take a Photo</a>\\n\" +\n    \"            </span>\\n\" +\n    \"\\n\" +\n    \"            <i class=\\\"spinner-waiting\\\"></i>\\n\" +\n    \"            Press <span ng-if=\\\"mac\\\" class=\\\"btn btn-cmd\\\">cmd &#8984;</span><span ng-if=\\\"!mac\\\" class=\\\"btn btn-ctrl\\\">Ctrl</span>\\n\" +\n    \"            + <span class=\\\"btn btn-v\\\">V</span> to paste an image.\\n\" +\n    \"        </h3>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"    <div class=\\\"upload-status out\\\" id=\\\"upload-loading\\\">\\n\" +\n    \"        <h3><i class=\\\"spinner-loading\\\"></i> Uploading...</h3>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"    <div class=\\\"upload-status out\\\" id=\\\"upload-error\\\">\\n\" +\n    \"        <h3>Error</h3>\\n\" +\n    \"        <p></p>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"    <div class=\\\"upload-status out\\\" id=\\\"upload-complete\\\">\\n\" +\n    \"        <h3>Uploaded!</h3>\\n\" +\n    \"        <p>\\n\" +\n    \"            <label>\\n\" +\n    \"                Here's your link\\n\" +\n    \"                <input type=\\\"text\\\" id=\\\"newImageURL\\\" class=\\\"green\\\" readonly=\\\"readonly\\\" />\\n\" +\n    \"            </label>\\n\" +\n    \"        </p>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/image-list.html',\n    \"<ng-include src=\\\"'views/partials/albums-sidebar.html'\\\"></ng-include>\\n\" +\n    \"\\n\" +\n    \"<ul ng-if=\\\"!loading && images.length > 0\\\" class=\\\"img-grid\\\">\\n\" +\n    \"    <li ng-repeat=\\\"image in images\\\">\\n\" +\n    \"        <a\\n\" +\n    \"            ui-sref=\\\"image({ imageId: image.imageId })\\\"\\n\" +\n    \"            ng-style=\\\"{'background-image': image.thumbnail ? '' : 'url('+ image.image.url + ')'}\\\"\\n\" +\n    \"            >\\n\" +\n    \"            <img ng-if=\\\"image.thumbnail\\\" class=\\\"img-thumb\\\" ng-src=\\\"{{ image.thumbnail.url }}\\\" />\\n\" +\n    \"\\n\" +\n    \"            <span>\\n\" +\n    \"                <i ng-if=\\\"image.passwordProtected\\\" class=\\\"typ typ-lock-closed\\\"></i>\\n\" +\n    \"                <i ng-if=\\\"image.anonymous\\\" class=\\\"typ typ-cancel-outline\\\"></i>\\n\" +\n    \"           </span>\\n\" +\n    \"        </a>\\n\" +\n    \"    </li>\\n\" +\n    \"</ul>\\n\" +\n    \"\\n\" +\n    \"<paginator ng-hide=\\\"totalPages < 2\\\" class=\\\"sidebar sidebar-right\\\" total-pages=\\\"totalPages\\\" current-page=\\\"currentPage\\\" url=\\\"url\\\" change-page=\\\"changePage\\\"></paginator>\\n\"\n  );\n\n\n  $templateCache.put('views/image.html',\n    \"<div ng-if=\\\"image\\\" class=\\\"img-wrapper\\\">\\n\" +\n    \"    <img\\n\" +\n    \"        ng-if=\\\"!loading && image\\\"\\n\" +\n    \"        ng-src=\\\"{{ image.image.url }}\\\"\\n\" +\n    \"        class=\\\"img\\\"\\n\" +\n    \"        id=\\\"img\\\"\\n\" +\n    \"        />\\n\" +\n    \"</div>\\n\" +\n    \"\\n\" +\n    \"<div\\n\" +\n    \"    ng-if=\\\"!loading && image\\\"\\n\" +\n    \"    class=\\\"sidebar sidebar-left sidebar-float img-left-sidebar\\\"\\n\" +\n    \"    ng-class=\\\"{\\n\" +\n    \"        'editable': user && user.userId === image.userId,\\n\" +\n    \"        'cropping': cropping,\\n\" +\n    \"        'annotating': annotating,\\n\" +\n    \"        'revertable': image.hasOriginal\\n\" +\n    \"    }\\\"\\n\" +\n    \"    >\\n\" +\n    \"\\n\" +\n    \"    <div ng-if=\\\"annotating\\\">\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"saveAnnotation()\\\"><i class=\\\"typ typ-tick-outline\\\" ng-hide=\\\"savingAnnotation\\\"></i><i class=\\\"spinner-loading dark\\\" ng-show=\\\"savingAnnotation\\\"></i><span>Save Annotation</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" ng-class=\\\"{'active':annotationColorVisible}\\\" href=\\\"#\\\" ng-click=\\\"showAnnotationColor()\\\"><i class=\\\"typ typ-media-record\\\"></i><span>Pen Colour</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" ng-class=\\\"{'active':annotationSizeVisible}\\\" href=\\\"#\\\" ng-click=\\\"showAnnotationSize()\\\"><i class=\\\"typ typ-brush\\\"></i><span>Pen Size</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"undoAnnotation()\\\"><i class=\\\"typ typ-arrow-back\\\"></i><span>Undo</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"restartAnnotation()\\\"><i class=\\\"typ typ-trash\\\"></i><span>Start Over</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"exitAnnotation()\\\"><i class=\\\"typ typ-times\\\"></i><span>Cancel</span></a>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"    <div ng-if=\\\"cropping\\\">\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"saveCrop()\\\"><i class=\\\"typ typ-tick-outline\\\" ng-hide=\\\"savingCrop\\\"></i><i class=\\\"spinner-loading dark\\\" ng-show=\\\"savingCrop\\\"></i><span>Save Crop</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"exitCrop()\\\"><i class=\\\"typ typ-times\\\"></i><span>Cancel</span></a>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"    <div ng-hide=\\\"cropping || annotating\\\">\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"showTextDialog()\\\"><i class=\\\"typ typ-sort-alphabetically\\\"></i><span>Text Recognition</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"showEmbedDialog()\\\"><i class=\\\"typ typ-code\\\"></i><span>Embed</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"shareOnFb()\\\"><i class=\\\"typ typ-social-facebook\\\"></i><span>Share</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"shareOnTwitter()\\\"><i class=\\\"typ typ-social-twitter\\\"></i><span>Tweet</span></a>\\n\" +\n    \"\\n\" +\n    \"        <hr/>\\n\" +\n    \"\\n\" +\n    \"        <div ng-if=\\\"user && user.userId === image.userId\\\">\\n\" +\n    \"            <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"annotate()\\\"><i class=\\\"typ typ-brush\\\"></i><span>Annotate</span></a>\\n\" +\n    \"            <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"crop()\\\"><i class=\\\"typ typ-scissors-outline\\\"></i><span>Crop</span></a>\\n\" +\n    \"\\n\" +\n    \"            <a class=\\\"btn rotate-ccw-btn\\\" href=\\\"#\\\" ng-click=\\\"rotateCcw()\\\"><img src=\\\"/assets/img/rotate.svg\\\" ng-hide=\\\"rotatingCcw\\\" /><i class=\\\"spinner-loading dark\\\" ng-show=\\\"rotatingCcw\\\"></i></a>\\n\" +\n    \"\\n\" +\n    \"            <a class=\\\"btn rotate-btn\\\" href=\\\"#\\\" ng-click=\\\"rotate()\\\"><img src=\\\"/assets/img/rotate.svg\\\" ng-hide=\\\"rotating\\\" /><i class=\\\"spinner-loading dark\\\" ng-show=\\\"rotating\\\"></i><span>Rotate</span></a>\\n\" +\n    \"\\n\" +\n    \"            <a class=\\\"btn\\\" href=\\\"#\\\" ng-if=\\\"image.hasOriginal\\\" ng-click=\\\"revert()\\\"><i class=\\\"typ typ-arrow-back\\\" ng-hide=\\\"reverting\\\"></i><i class=\\\"spinner-loading dark\\\" ng-show=\\\"reverting\\\"></i><span>Revert To Original</span></a>\\n\" +\n    \"            <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"showPrivacyDialog()\\\"><i class=\\\"typ typ-lock-closed\\\"></i><span>Privacy</span></a>\\n\" +\n    \"            <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"delete()\\\"><i class=\\\"typ typ-trash\\\" ng-hide=\\\"deleting\\\"></i><i class=\\\"spinner-loading dark\\\" ng-show=\\\"deleting\\\"></i><span>Delete</span></a>\\n\" +\n    \"        </div>\\n\" +\n    \"        <div ng-if=\\\"!user || user.userId !== image.userId\\\">\\n\" +\n    \"            <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"showReportDialog()\\\"><i class=\\\"typ typ-flag\\\"></i><span>Report</span></a>\\n\" +\n    \"        </div>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"</div>\\n\" +\n    \"<div ng-if=\\\"doodle\\\" ng-show=\\\"annotationColorVisible\\\" class=\\\"ng-hide img-submenu sidebar sidebar-left sidebar-float annotation-color\\\">\\n\" +\n    \"    <a class=\\\"btn\\\" ng-repeat=\\\"color in annotationColors\\\" ng-class=\\\"{'active':doodle.color === '#'+color}\\\" ng-click=\\\"setAnnotationColor(color)\\\"><i class=\\\"typ typ-media-record\\\" ng-style=\\\"{color: '#'+color}\\\"></i></a>\\n\" +\n    \"</div>\\n\" +\n    \"<div ng-if=\\\"doodle\\\" ng-show=\\\"annotationSizeVisible\\\" class=\\\"ng-hide img-submenu sidebar sidebar-left sidebar-float annotation-size\\\">\\n\" +\n    \"    <a class=\\\"btn\\\" ng-repeat=\\\"size in annotationSizes\\\" ng-class=\\\"{'active':doodle.lineThickness === size}\\\" href=\\\"#\\\" ng-click=\\\"setAnnotationSize(size)\\\"><i ng-style=\\\"{height:size+'px'}\\\"></i></a>\\n\" +\n    \"</div>\\n\" +\n    \"\\n\" +\n    \"<div class=\\\"sidebar sidebar-right img-right-sidebar sidebar-scrolling\\\" ng-if=\\\"albumImages.length > 0\\\">\\n\" +\n    \"    <div class=\\\"scroller\\\">\\n\" +\n    \"    <ul>\\n\" +\n    \"        <li>In This Album</li>\\n\" +\n    \"        <li ng-repeat=\\\"albumImage in albumImages\\\" ng-class=\\\"{active: imageId === albumImage.imageId}\\\">\\n\" +\n    \"            <a ng-click=\\\"changeImage($event, albumImage.imageId)\\\" ui-sref=\\\"image({ imageId: albumImage.imageId, albumId: albumId })\\\"><img ng-src=\\\"{{ albumImage.thumbnail.url }}\\\" /></a>\\n\" +\n    \"        </li>\\n\" +\n    \"    </ul>\\n\" +\n    \"    </div>\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/modals/image-embed.html',\n    \"<div class=\\\"modal\\\" ng-click=\\\"close()\\\" id=\\\"image-embed-modal\\\">\\n\" +\n    \"    <div class=\\\"modal-content\\\" ng-click=\\\"$event.stopPropagation()\\\">\\n\" +\n    \"\\n\" +\n    \"        <h2><i class=\\\"typ typ-export\\\"></i> Link To <small>this image.</small></h2>\\n\" +\n    \"\\n\" +\n    \"        <div class=\\\"container-fluid\\\">\\n\" +\n    \"            <div class=\\\"row\\\">\\n\" +\n    \"                <div class=\\\"col-sm-6\\\">\\n\" +\n    \"\\n\" +\n    \"                    <div class=\\\"form-group\\\">\\n\" +\n    \"                        <h4>Markdown Link <small>e.g. for Reddit comments</small></h4>\\n\" +\n    \"                        <textarea rows=\\\"2\\\" class=\\\"form-control\\\" readonly=\\\"readonly\\\">[{{image.url}}]({{image.url}}</textarea>\\n\" +\n    \"                    </div>\\n\" +\n    \"\\n\" +\n    \"                    <div class=\\\"form-group\\\">\\n\" +\n    \"                        <p><small><a href=\\\"http://redditenhancementsuite.com/\\\">Reddit Enhancement Suite</a> supports CtrlV, so you can also just use this link in Reddit comments:</small></p>\\n\" +\n    \"                        <input type=\\\"text\\\" class=\\\"form-control\\\" readonly=\\\"readonly\\\" value=\\\"{{image.url}}\\\" />\\n\" +\n    \"                    </div>\\n\" +\n    \"\\n\" +\n    \"                    <div class=\\\"form-group\\\">\\n\" +\n    \"                        <h4>Markdown Image <small>e.g. for GitHub/BitBucket READMEs</small></h4>\\n\" +\n    \"                        <textarea rows=\\\"3\\\" class=\\\"form-control\\\" readonly=\\\"readonly\\\">[![{{ image.title }}]({{image.image.url}})]({{image.url}})</textarea>\\n\" +\n    \"                    </div>\\n\" +\n    \"\\n\" +\n    \"                </div>\\n\" +\n    \"                <div class=\\\"col-sm-6\\\">\\n\" +\n    \"\\n\" +\n    \"                    <div class=\\\"form-group\\\">\\n\" +\n    \"                        <h4>BBCode <small>for forums</small></h4>\\n\" +\n    \"                        <textarea rows=\\\"3\\\" class=\\\"form-control\\\" readonly=\\\"readonly\\\">[url={{image.url}}][img]{{image.image.url}}[/img]{{image.title}}[/url]</textarea>\\n\" +\n    \"                    </div>\\n\" +\n    \"\\n\" +\n    \"                    <div class=\\\"form-group\\\">\\n\" +\n    \"                        <h4>HTML <small>for websites</small></h4>\\n\" +\n    \"                        <textarea rows=\\\"5\\\" class=\\\"form-control\\\" readonly=\\\"readonly\\\">&lt;a href=&quot;{{image.url}}&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;{{image.image.url}}&quot; style=&quot;max-width:900px;&quot; alt=&quot;CtrlV.in Image Hosting&quot; /&gt;&lt;/a&gt;</textarea>\\n\" +\n    \"                    </div>\\n\" +\n    \"\\n\" +\n    \"                </div>\\n\" +\n    \"            </div>\\n\" +\n    \"        </div>\\n\" +\n    \"\\n\" +\n    \"    </div>\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/modals/image-privacy.html',\n    \"<div class=\\\"modal img-privacy-modal\\\" ng-click=\\\"close()\\\">\\n\" +\n    \"    <div class=\\\"modal-content\\\" ng-click=\\\"$event.stopPropagation()\\\">\\n\" +\n    \"\\n\" +\n    \"        <div class=\\\"container-fluid\\\">\\n\" +\n    \"\\n\" +\n    \"            <div class=\\\"alert alert-warning\\\" ng-if=\\\"image.albumId\\\">\\n\" +\n    \"                This image is part of the album <strong><a ui-sref=\\\"album({albumId:image.albumId})\\\" ng-click=\\\"close()\\\">{{ image.album.title }}</a></strong>. Go to the <strong><a ui-sref=\\\"album({albumId:image.albumId})\\\" ng-click=\\\"close()\\\">album settings</a></strong> to make the album and its\\n\" +\n    \"                images anonymous and/or password protected.\\n\" +\n    \"            </div>\\n\" +\n    \"\\n\" +\n    \"            <div class=\\\"row\\\" ng-if=\\\"!image.albumId\\\">\\n\" +\n    \"                <div class=\\\"col-sm-6 img-privacy-col\\\">\\n\" +\n    \"\\n\" +\n    \"                    <h2><i class=\\\"typ typ-user\\\"></i> Show Username\\n\" +\n    \"                        <small>on this image.</small>\\n\" +\n    \"                    </h2>\\n\" +\n    \"\\n\" +\n    \"                    <div class=\\\"form-group\\\">\\n\" +\n    \"                        <div class=\\\"row\\\">\\n\" +\n    \"                            <div class=\\\"col-xs-6\\\">\\n\" +\n    \"                                <a ng-click=\\\"setAnon(0);\\\" class=\\\"btn btn-block\\\" ng-class=\\\"{'active': !image.anonymous}\\\">\\n\" +\n    \"                                    <i class=\\\"typ typ-user\\\"></i>Yes</a>\\n\" +\n    \"                            </div>\\n\" +\n    \"                            <div class=\\\"col-xs-6\\\">\\n\" +\n    \"                                <a ng-click=\\\"setAnon(1);\\\" class=\\\"btn btn-block\\\"\\n\" +\n    \"                                   ng-class=\\\"{'active': image.anonymous}\\\">\\n\" +\n    \"                                    <i class=\\\"typ typ-cancel-outline\\\"></i>No</a>\\n\" +\n    \"                            </div>\\n\" +\n    \"                        </div>\\n\" +\n    \"                    </div>\\n\" +\n    \"\\n\" +\n    \"                </div>\\n\" +\n    \"                <div class=\\\"col-sm-6 img-password-col\\\">\\n\" +\n    \"\\n\" +\n    \"                    <form action=\\\"#\\\" ng-submit=\\\"setPassword($event)\\\">\\n\" +\n    \"\\n\" +\n    \"                        <h2>\\n\" +\n    \"                            <i class=\\\"typ typ-lock-closed\\\"></i> Password Protect\\n\" +\n    \"                            <small>this image.</small>\\n\" +\n    \"                        </h2>\\n\" +\n    \"\\n\" +\n    \"                        <div ng-if=\\\"!image.passwordProtected\\\" class=\\\"form-group\\\">\\n\" +\n    \"                            <label>Enter a password that will be required for other people to view this image. (You will\\n\" +\n    \"                                always be able to see it without the password.)</label>\\n\" +\n    \"\\n\" +\n    \"                            <input type=\\\"password\\\" class=\\\"form-control\\\" placeholder=\\\"Password\\\"\\n\" +\n    \"                                   ng-model=\\\"passwordData.password\\\"/>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div ng-if=\\\"!image.passwordProtected\\\" class=\\\"form-group\\\">\\n\" +\n    \"                            <button class=\\\"btn btn-block\\\"><i class=\\\"typ typ-lock-closed-outline\\\"></i> Save Password\\n\" +\n    \"                            </button>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"\\n\" +\n    \"                        <div ng-if=\\\"image.passwordProtected\\\" class=\\\"form-group\\\">\\n\" +\n    \"                            <label>This image is currently password protected. Enter a new password if you wish to\\n\" +\n    \"                                change it. (You will always be able to see it without the password.)</label>\\n\" +\n    \"\\n\" +\n    \"                            <input type=\\\"password\\\" class=\\\"form-control\\\" placeholder=\\\"New Password\\\"\\n\" +\n    \"                                   ng-model=\\\"passwordData.password\\\"/>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div ng-if=\\\"image.passwordProtected\\\" class=\\\"form-group\\\">\\n\" +\n    \"                            <button class=\\\"btn btn-block\\\"><i class=\\\"typ typ-lock-closed-outline\\\"></i> Update Password\\n\" +\n    \"                            </button>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div ng-if=\\\"image.passwordProtected\\\" class=\\\"form-group\\\">\\n\" +\n    \"                            <button class=\\\"btn btn-block\\\"><i class=\\\"typ typ-lock-open-outline\\\"></i> Remove Password\\n\" +\n    \"                            </button>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                    </form>\\n\" +\n    \"\\n\" +\n    \"                </div>\\n\" +\n    \"            </div>\\n\" +\n    \"        </div>\\n\" +\n    \"\\n\" +\n    \"    </div>\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/modals/image-text.html',\n    \"<div class=\\\"modal img-text-modal\\\" ng-click=\\\"close()\\\">\\n\" +\n    \"    <div class=\\\"modal-content\\\" ng-click=\\\"$event.stopPropagation()\\\">\\n\" +\n    \"        <h2><i class=\\\"typ typ-sort-alphabetically\\\"></i> Text <small>found in this image.</small></h2>\\n\" +\n    \"        <div class=\\\"container-fluid\\\">\\n\" +\n    \"\\n\" +\n    \"            <p ng-if=\\\"text.text.text\\\">{{ text.text.text }}</p>\\n\" +\n    \"\\n\" +\n    \"            <div class=\\\"alert alert-warning\\\" ng-if=\\\"text.text === null\\\">\\n\" +\n    \"                <i class=\\\"spinner-loading dark\\\"></i> The image is currently being scanned for text.\\n\" +\n    \"            </div>\\n\" +\n    \"\\n\" +\n    \"            <div class=\\\"alert alert-danger\\\" ng-if=\\\"text.text.text.length < 1\\\">\\n\" +\n    \"                No text was found in the image.\\n\" +\n    \"            </div>\\n\" +\n    \"\\n\" +\n    \"        </div>\\n\" +\n    \"    </div>\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/modals/login.html',\n    \"<div class=\\\"modal\\\" ng-click=\\\"close()\\\">\\n\" +\n    \"    <div class=\\\"modal-content\\\" ng-click=\\\"$event.stopPropagation()\\\">\\n\" +\n    \"\\n\" +\n    \"        <div class=\\\"container-fluid\\\">\\n\" +\n    \"            <div class=\\\"row\\\">\\n\" +\n    \"                <div class=\\\"col-sm-6\\\">\\n\" +\n    \"                    <form ng-submit=\\\"login()\\\">\\n\" +\n    \"                        <h2>Login <small>to you CtrlV account.</small></h2>\\n\" +\n    \"\\n\" +\n    \"                        <div class=\\\"form-group\\\" ng-class=\\\"{'has-error': loginData.errors.username}\\\">\\n\" +\n    \"                            <label class=\\\"control-label\\\"><i class=\\\"typ typ-user\\\"></i> Username\\n\" +\n    \"                                <input class=\\\"form-control\\\" type=\\\"text\\\" ng-model=\\\"loginData.username\\\" name=\\\"username\\\" />\\n\" +\n    \"                            </label>\\n\" +\n    \"\\n\" +\n    \"                            <span ng-if=\\\"loginData.errors.username\\\" class=\\\"help-block\\\">{{ loginData.errors.username.join(' ') }}</span>\\n\" +\n    \"\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div class=\\\"form-group\\\" ng-class=\\\"{'has-error': loginData.errors.password}\\\">\\n\" +\n    \"                            <label class=\\\"control-label\\\"><i class=\\\"typ typ-key\\\"></i> Password\\n\" +\n    \"                                <input class=\\\"form-control\\\" type=\\\"password\\\" ng-model=\\\"loginData.password\\\" name=\\\"password\\\" />\\n\" +\n    \"                            </label>\\n\" +\n    \"\\n\" +\n    \"                            <span ng-if=\\\"loginData.errors.password\\\" class=\\\"help-block\\\">{{ loginData.errors.password.join(' ') }}</span>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div class=\\\"form-group\\\">\\n\" +\n    \"                            <label>\\n\" +\n    \"                                <a href=\\\"#\\\" ng-click=\\\"forgot()\\\"><i class=\\\"typ typ-warning-outline\\\"></i> Forgot you password?</a>\\n\" +\n    \"                            </label>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div class=\\\"form-group\\\">\\n\" +\n    \"                            <label>\\n\" +\n    \"                                <a href=\\\"#\\\" ng-click=\\\"fb()\\\"><i class=\\\"typ typ-social-facebook\\\"></i> Used to login with Facebook?</a>\\n\" +\n    \"                            </label>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div ng-if=\\\"loginData.errors.general\\\" class=\\\"form-group has-error\\\">\\n\" +\n    \"                            <span class=\\\"help-block\\\"><i class=\\\"typ typ-warning\\\"></i> {{ loginData.errors.general }}</span>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <button class=\\\"btn btn-block\\\">\\n\" +\n    \"                            <i class=\\\"spinner-loading dark\\\" ng-show=\\\"loginData.loading\\\"></i>\\n\" +\n    \"                            <span ng-hide=\\\"loginData.loading\\\">Login</span>\\n\" +\n    \"                        </button>\\n\" +\n    \"                    </form>\\n\" +\n    \"                </div>\\n\" +\n    \"\\n\" +\n    \"                <div class=\\\"col-sm-6\\\">\\n\" +\n    \"                    <form ng-submit=\\\"signup()\\\">\\n\" +\n    \"                        <h2>Create <small>a new CtrlV account.</small></h2>\\n\" +\n    \"\\n\" +\n    \"                        <div class=\\\"form-group\\\" ng-class=\\\"{'has-error': signupData.errors.username}\\\">\\n\" +\n    \"                            <label class=\\\"control-label\\\"><i class=\\\"typ typ-user\\\"></i> Username\\n\" +\n    \"                                <input class=\\\"form-control\\\" type=\\\"text\\\" ng-model=\\\"signupData.username\\\" name=\\\"username\\\" />\\n\" +\n    \"                            </label>\\n\" +\n    \"\\n\" +\n    \"                            <span ng-if=\\\"signupData.errors.username\\\" class=\\\"help-block\\\">{{ signupData.errors.username.join(' ') }}</span>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div class=\\\"form-group\\\" ng-class=\\\"{'has-error': signupData.errors.username}\\\">\\n\" +\n    \"                            <label class=\\\"control-label\\\"><i class=\\\"typ typ-key\\\"></i> Password\\n\" +\n    \"                                <input class=\\\"form-control\\\" type=\\\"password\\\" ng-model=\\\"signupData.password\\\" name=\\\"password\\\" />\\n\" +\n    \"                            </label>\\n\" +\n    \"\\n\" +\n    \"                            <span ng-if=\\\"signupData.errors.password\\\" class=\\\"help-block\\\">{{ signupData.errors.password.join(' ') }}</span>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div class=\\\"form-group\\\" ng-class=\\\"{'has-error': signupData.errors.email}\\\">\\n\" +\n    \"                            <label class=\\\"control-label\\\"><i class=\\\"typ typ-mail\\\"></i> Email Address\\n\" +\n    \"                                <input class=\\\"form-control\\\" type=\\\"email\\\" ng-model=\\\"signupData.email\\\" name=\\\"email\\\" />\\n\" +\n    \"                            </label>\\n\" +\n    \"\\n\" +\n    \"                            <span ng-if=\\\"signupData.errors.email\\\" class=\\\"help-block\\\">{{ signupData.errors.email.join(' ') }}</span>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div ng-if=\\\"signupData.errors.general\\\" class=\\\"form-group has-error\\\">\\n\" +\n    \"                            <span class=\\\"help-block\\\"><i class=\\\"typ typ-warning\\\"></i> {{ signupData.errors.general }}</span>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <button class=\\\"btn btn-block\\\">\\n\" +\n    \"                            <i class=\\\"spinner-loading dark\\\" ng-show=\\\"signupData.loading\\\"></i>\\n\" +\n    \"                            <span ng-hide=\\\"signupData.loading\\\">Signup</span>\\n\" +\n    \"                        </button>\\n\" +\n    \"                    </form>\\n\" +\n    \"                </div>\\n\" +\n    \"\\n\" +\n    \"            </div>\\n\" +\n    \"        </div>\\n\" +\n    \"    </div>\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/partials/albums-sidebar.html',\n    \"<div class=\\\"album-list-sidebar sidebar sidebar-left sidebar-scrolling\\\" ng-if=\\\"albums.length > 0\\\">\\n\" +\n    \"    <div class=\\\"scroller\\\">\\n\" +\n    \"    <ul>\\n\" +\n    \"        <li>Albums</li>\\n\" +\n    \"\\n\" +\n    \"        <li>\\n\" +\n    \"            <a ng-click=\\\"changeUser($event, user.username)\\\" ui-sref=\\\"user({username: user.username})\\\">\\n\" +\n    \"                <span>Unsorted</span>\\n\" +\n    \"            </a>\\n\" +\n    \"        </li>\\n\" +\n    \"\\n\" +\n    \"        <li ng-repeat=\\\"album in albums\\\" ng-class=\\\"{active: albumId == albums.albumId}\\\">\\n\" +\n    \"            <a ng-click=\\\"changeAlbum($event, album.albumId)\\\" ui-sref=\\\"album({albumId: album.albumId})\\\" ng-style=\\\"{'background-image': album.thumbnail ? 'url('+album.thumbnail.url+')' : ''}\\\">\\n\" +\n    \"                <span>{{ album.title }}</span>\\n\" +\n    \"            </a>\\n\" +\n    \"        </li>\\n\" +\n    \"    </ul>\\n\" +\n    \"    </div>\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/partials/footer.html',\n    \"<footer>\\n\" +\n    \"\\n\" +\n    \"    <!--<div style=\\\"float:left;\\\">\\n\" +\n    \"        View:\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\">Grid (Classic)</a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\">Columns</a>\\n\" +\n    \"    </div>-->\\n\" +\n    \"\\n\" +\n    \"    <ul class=\\\"links\\\">\\n\" +\n    \"        <li><a href=\\\"https://api.ctrlv.in/docs\\\"><i class=\\\"typ typ-flow-switch\\\"></i> API</a></li>\\n\" +\n    \"        <li><a href=\\\"mailto:help@ctrlv.in\\\"><i class=\\\"typ typ-mail\\\"></i> Contact Us</a></li>\\n\" +\n    \"        <li><a href=\\\"https://github.com/antriver/ctrlv-frontend\\\"><i class=\\\"typ typ-social-github\\\"></i> GitHub</a></li>\\n\" +\n    \"        <li><a ui-sref=\\\"help\\\"><i class=\\\"typ typ-info-large-outline\\\"></i> Help</a></li>\\n\" +\n    \"        <li><a ui-sref=\\\"privacy\\\"><i class=\\\"typ typ-lock-closed-outline\\\"></i> Privacy</a></li>\\n\" +\n    \"        <li><a ui-sref=\\\"terms\\\"><i class=\\\"typ typ-sort-alphabetically-outline\\\"></i> Terms of Use</a></li>\\n\" +\n    \"    </ul>\\n\" +\n    \"</footer>\\n\"\n  );\n\n\n  $templateCache.put('views/partials/header.html',\n    \"<header class=\\\"clearfix\\\">\\n\" +\n    \"    <a ui-sref=\\\"home\\\" id=\\\"logo-container\\\">\\n\" +\n    \"        <img src=\\\"/assets/img/ctrlv.svg\\\" id=\\\"logo\\\" />\\n\" +\n    \"    </a>\\n\" +\n    \"\\n\" +\n    \"    <h1 id=\\\"page-title\\\" ng-bind-html=\\\"title\\\" ng-class=\\\"{'with-subtitle': subtitle}\\\"></h1>\\n\" +\n    \"    <h3 id=\\\"page-subtitle\\\" ng-bind-html=\\\"subtitle\\\"></h3>\\n\" +\n    \"\\n\" +\n    \"    <div  id=\\\"current-user\\\">\\n\" +\n    \"        <div ng-if=\\\"user === false\\\">\\n\" +\n    \"            <a id=\\\"login-btn\\\" class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"login()\\\"><i class=\\\"typ typ-user\\\"></i> Login or Signup</a>\\n\" +\n    \"        </div>\\n\" +\n    \"        <div ng-if=\\\"user\\\">\\n\" +\n    \"            <h2>Hi <a ui-sref=\\\"user({ username: user.username.toLowerCase() })\\\" ng-bind=\\\"user.username\\\"></a></h2>\\n\" +\n    \"            <ul class=\\\"links\\\">\\n\" +\n    \"                <!--<li><a ui-sref=\\\"user-favourites({ username: user.username.toLowerCase() })\\\"><i class=\\\"typ typ-heart-full-outline\\\"></i> Favourites</a></li>-->\\n\" +\n    \"                <li><a ui-sref=\\\"settings\\\"><i class=\\\"typ typ-spanner\\\"></i> Options</a></li>\\n\" +\n    \"                <li><a href=\\\"#\\\" ng-click=\\\"logout()\\\"><i class=\\\"typ typ-lock-open\\\"></i> Logout</a></li>\\n\" +\n    \"            </ul>\\n\" +\n    \"        </div>\\n\" +\n    \"    </div>\\n\" +\n    \"</header>\\n\"\n  );\n\n\n  $templateCache.put('views/partials/paginator.html',\n    \"<ul>\\n\" +\n    \"    <li ng-repeat=\\\"page in pages track by $index\\\" ng-class=\\\"{'active':currentPage === page}\\\">\\n\" +\n    \"        <a ng-if=\\\"page != '...'\\\" ng-click=\\\"changePage($event, page)\\\" href=\\\"{{url}}/{{page}}\\\">{{ page }}</a>\\n\" +\n    \"        <a ng-if=\\\"page === '...'\\\" ng-click=\\\"showPageJump($event)\\\" href=\\\"#\\\">...</a>\\n\" +\n    \"    </li>\\n\" +\n    \"</ul>\\n\"\n  );\n\n\n  $templateCache.put('views/user.html',\n    \"<ng-include src=\\\"'views/partials/image-list.html'\\\"></ng-include>\\n\" +\n    \"\\n\" +\n    \"<ng-include src=\\\"'views/partials/albums-sidebar.html'\\\"></ng-include>\\n\"\n  );\n\n}]);\n","app.controller(\n    'HeaderController',\n    function ($scope, $rootScope, ModalService, AuthService) {\n\n        $scope.login = function() {\n            // Just provide a template url, a controller and call 'showModal'.\n            ModalService.showModal({\n                templateUrl: 'views/modals/login.html',\n                controller: 'LoginModalController'\n            }).then(function(modal) {\n                // The modal object has the element built, if this is a bootstrap modal\n                // you can call 'modal' to show it, if it's a custom modal just show or hide\n                // it as you need to.\n                //modal.element.modal();\n                modal.close.then(function(result) {\n                    $scope.message = result ? \"You said Yes\" : \"You said No\";\n                });\n            });\n        };\n\n        $scope.logout = function() {\n            AuthService.logout();\n        };\n\n        $scope.signup = function() {\n            alert('signup');\n        };\n\n    }\n);\n","app.controller(\n    'HomeController',\n    function ($scope, $rootScope, $timeout) {\n\n        $rootScope.title = '';\n        $rootScope.subtitle = '';\n\n        var sprites = [];\n        for (var i = 0; i < 20; i++) {\n            sprites.push('<span class=\"homesprite homesprite-' + i + '\"></span>');\n        }\n        sprites.shuffle();\n        $scope.sprites = sprites.join('');\n\n        $scope.mac = navigator.platform === \"MacIntel\";\n\n        $timeout(function() {\n            $scope.test = true;\n        }, 1000);\n    }\n);\n","app.controller(\n    'ImageController',\n    function ($scope, $rootScope, $state, $element, $stateParams, $compile, AuthService, ImageResource, AlbumResource, ModalService) {\n\n        console.log('ImageController');\n\n        $scope.albumId = null;\n        $scope.albumImages = [];\n        $scope.image = null;\n        $scope.imageId = $stateParams.imageId;\n        $scope.editing = false;\n\n        $rootScope.title = '';\n        $rootScope.subtitle = '';\n\n        function loadImage(imageId) {\n            $rootScope.loading = true;\n            ImageResource.get({imageId: imageId}, function (response) {\n                $scope.imageId = imageId;\n\n                $scope.image = response.image;\n                $rootScope.loading = false;\n\n                // TODO: If the image is passworded show login prompt\n                // Show errors\n                // If anon or passworded, refresh on logout\n\n                var title = '';\n                if ($scope.image.title) {\n                    title = $scope.image.title;\n                } else {\n                    title = '<i class=\"typ typ-image\"></i> Image #' + $scope.image.imageId;\n                }\n                $rootScope.title = title;\n\n                var subtitle = '<span>';\n                if ($scope.image.userId) {\n                    subtitle += '<i class=\"typ typ-user\"></i> By <a ui-sref=\"user({username: image.user.username.toLowerCase()})\">' + $scope.image.user.username + '</a>';\n                }\n                subtitle += '<i class=\"typ typ-time\"></i> <span title=\"' + moment($scope.image.createdAt).format(\"dddd, MMMM Do YYYY, h:mm:ss a\") + '\">' + moment($scope.image.createdAt).fromNow() + '</span>';\n\n                if ($scope.image.album) {\n                    subtitle += '<i class=\"typ typ-folder-open\"></i> In <a ui-sref=\"album({albumId: image.album.albumId})\">' + $scope.image.album.title + '</a>';\n                }\n                subtitle += '</span>';\n\n                $rootScope.subtitle = $compile(subtitle)($scope)[0].innerHTML;\n\n                if ($scope.image.albumId && $scope.image.albumId !== $scope.albumId) {\n                    $scope.loadAlbumImages($scope.image.albumId);\n                }\n            });\n        }\n\n        $scope.init = function () {\n            if ($stateParams.albumId) {\n                $scope.loadAlbumImages($stateParams.albumId);\n            }\n            loadImage($scope.imageId);\n        };\n\n        $scope.changeImage = function ($event, imageId) {\n            $event.stopPropagation();\n            $event.preventDefault();\n\n            $scope.cleanup();\n\n            $state.go('image', {imageId: imageId}, {notify: false});\n            loadImage(imageId);\n        };\n\n        $scope.cleanup = function() {\n            $scope.exitAnnotation();\n            $scope.exitCrop();\n        };\n\n        $scope.loadAlbumImages = function (albumId) {\n            $scope.albumId = albumId;\n            // Get the images in the album to show on the left\n            AlbumResource.getImages({albumId: albumId}, function (data) {\n                $scope.albumImages = data.images;\n            });\n        };\n\n        /**\n         * Sidebar Buttons\n         */\n\n        $scope.showTextDialog = function () {\n            ModalService.showModal({\n                templateUrl: 'views/modals/image-text.html',\n                controller: function ($scope, close, image) {\n                    $scope.image = image;\n                    $scope.text = ImageResource.getText({imageId: image.imageId});\n                    $scope.close = close;\n                },\n                inputs: {\n                    image: $scope.image\n                }\n            });\n        };\n\n        $scope.showEmbedDialog = function () {\n            ModalService.showModal({\n                templateUrl: 'views/modals/image-embed.html',\n                controller: function ($scope, close, image) {\n                    $scope.image = image;\n                    $scope.close = close;\n                },\n                inputs: {\n                    image: $scope.image\n                }\n            });\n        };\n\n        $scope.shareOnFb = function () {\n            var url = 'https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent($scope.image.url);\n            window.open(url);\n        };\n\n        $scope.shareOnTwitter = function () {\n            var url = 'https://twitter.com/home?status=' + encodeURIComponent($scope.image.url);\n            window.open(url);\n        };\n\n        /**\n         * Annotating\n         */\n\n        $scope.annotating = false;\n        $scope.savingAnnotation = false;\n        $scope.annotationColorVisible = false;\n        $scope.annotationSizeVisible = false;\n        $scope.annotationColors = [\n            '000000',\n            'B2B2B2',\n            '823914',\n            'CC0000',\n            'FF7519',\n            'FFCC66',\n            'FFFF00',\n            '009933',\n            '99FF66',\n            '3333FF',\n            '99CCFF',\n            '66FFFF',\n            '9933FF',\n            'FF3399',\n            'FF99FF',\n            'ffffff',\n        ];\n        $scope.annotationSizes = [\n            2,\n            5,\n            15,\n            40\n        ];\n\n        /**\n         * @type {Doodle}\n         */\n        $scope.doodle = null;\n\n        $scope.annotate = function () {\n            var element = document.createElement('annotator');\n            element.setAttribute('doodle', 'doodle');\n            var annotator = angular.element(element);\n\n            $element.append($compile(annotator)($scope));\n            $scope.annotating = true;\n\n            alertInfo(\"Draw on the image to annotate it\");\n        };\n\n        $scope.showAnnotationColor = function () {\n            // Toggle display of the color picker\n            $scope.annotationColorVisible = $scope.annotationColorVisible ? false : true;\n            $scope.annotationSizeVisible = false;\n        };\n\n        $scope.setAnnotationColor = function (color) {\n            $scope.doodle.color = '#'+color;\n        };\n\n        $scope.showAnnotationSize = function () {\n            // Toggle display of the size picker\n            $scope.annotationSizeVisible = $scope.annotationSizeVisible ? false : true;\n            $scope.annotationColorVisible = false;\n        };\n\n        $scope.setAnnotationSize = function (px) {\n            $scope.doodle.lineThickness = px;\n        };\n\n        $scope.saveAnnotation = function () {\n\n            if ($scope.savingAnnotation) {\n                return false;\n            }\n\n            var annotation = $scope.doodle.getImage();\n\n            $scope.savingAnnotation = true;\n\n            ImageResource.annotate(\n                {imageId: $scope.imageId},\n                {base64:annotation},\n                function (response) {\n                    $scope.savingAnnotation = false;\n                    $scope.image = response.image;\n                    $scope.exitAnnotation();\n                    alertSuccess(\"Annotation saved\");\n                }, function (response) {\n                    $scope.savingAnnotation = false;\n                    alertError(response.data.message);\n                }\n            );\n        };\n\n        $scope.undoAnnotation = function () {\n            $scope.doodle.undo();\n        };\n\n        $scope.restartAnnotation = function () {\n            $scope.doodle.clear();\n        };\n\n        $scope.exitAnnotation = function () {\n            $scope.annotationColorVisible = false;\n            $scope.annotationSizeVisible = false;\n            $scope.annotating = false;\n            $scope.doodle = null;\n            $('annotator').remove();\n        };\n\n        /**\n         * Cropping\n         */\n\n        $scope.cropCoords = null;\n        $scope.cropping = false;\n        $scope.savingCrop = false;\n        $scope.jcrop = null;\n\n        $scope.crop = function () {\n            if ($scope.editing) {\n                return false;\n            }\n            $scope.cropping = true;\n            $scope.jcrop = $.Jcrop('#img', {\n                onChange: function (c) {\n                    $scope.cropCoords = c;\n                }\n            });\n            alertInfo(\"Drag a box on image to choose where to crop\");\n        };\n\n        $scope.saveCrop = function () {\n\n            if ($scope.savingCrop) {\n                return false;\n            }\n\n            // How much is the image scaled on screen\n            var scale = $scope.getImageScale();\n\n            var params = {\n                imageId: $scope.imageId,\n                width: Math.round($scope.cropCoords.w / scale),\n                height: Math.round($scope.cropCoords.h / scale),\n                x: Math.round($scope.cropCoords.x / scale),\n                y: Math.round($scope.cropCoords.y / scale),\n            };\n            $scope.savingCrop = true;\n            ImageResource.crop(\n                params,\n                function (response) {\n                    $scope.exitCrop();\n                    $scope.image = response.image;\n                    alertSuccess(\"Image has been cropped\");\n                },\n                function (response) {\n                    $scope.savingCrop = false;\n                    alertError(response.data.message);\n                }\n            );\n        };\n\n        $scope.exitCrop = function () {\n            if ($scope.jcrop) {\n                $scope.jcrop.destroy();\n            }\n            $scope.cropCoords = null;\n            $scope.cropping = false;\n            $scope.jcrop = null;\n            $scope.savingCrop = false;\n            // Undo what jcrop did\n            $('#img').css({width: '', height: ''});\n        };\n\n        $scope.rotate = function () {\n            if ($scope.editing) {\n                return false;\n            }\n            $scope.editing = true;\n            $scope.rotating = true;\n            ImageResource.rotate(\n                {\n                    imageId: $scope.image.imageId\n                },\n                function (response) {\n                    $scope.editing = false;\n                    $scope.rotating = false;\n                    $scope.image = response.image;\n                    alertSuccess(\"Image has been rotated\");\n                },\n                function (response) {\n                    $scope.editing = false;\n                    $scope.rotating = false;\n                    alertError(response.data.message);\n                }\n            );\n        };\n\n        $scope.rotateCcw = function () {\n            if ($scope.editing) {\n                return false;\n            }\n            $scope.editing = true;\n            $scope.rotatingCcw = true;\n            ImageResource.rotate(\n                {\n                    imageId: $scope.image.imageId,\n                    direction: 'ccw'\n                },\n                function (response) {\n                    $scope.editing = false;\n                    $scope.rotatingCcw = false;\n                    $scope.image = response.image;\n                    alertSuccess(\"Image has been rotated\");\n                },\n                function (response) {\n                    $scope.editing = false;\n                    $scope.rotatingCcw = false;\n                    alertError(response.data.message);\n                }\n            );\n        };\n\n        $scope.revert = function () {\n            if ($scope.editing) {\n                return false;\n            }\n\n            if (!confirm(\"This will undo and cropping and remove any annotation. Are you sure you want to do this?\")) {\n                return false;\n            }\n\n            $scope.editing = true;\n            $scope.reverting = true;\n            ImageResource.revert(\n                {\n                    imageId: $scope.image.imageId\n                },\n                function (response) {\n                    $scope.editing = false;\n                    $scope.reverting = false;\n                    $scope.image = response.image;\n                    alertSuccess(\"Image has been reverted\");\n                },\n                function (response) {\n                    $scope.editing = false;\n                    $scope.reverting = false;\n                    alertError(response.data.message);\n                }\n            );\n        };\n\n        $scope.showPrivacyDialog = function () {\n            ModalService.showModal({\n                templateUrl: 'views/modals/image-privacy.html',\n                controller: function ($scope, close, image) {\n                    $scope.image = image;\n                    $scope.close = close;\n\n                    $scope.passwordData = {\n                        password: ''\n                    };\n\n                    $scope.setAnon = function (anon) {\n                        $rootScope.showLoader = true;\n                        ImageResource.update({'imageId': $scope.image.imageId},\n                        {\n                            anonymous:anon\n                        }, function(res)\n                        {\n                            if (anon) {\n                                alertSuccess(\"The image is now anonymous\");\n                            } else {\n                                alertSuccess(\"The image now shows your name\");\n                            }\n                            $rootScope.showLoader = false;\n                            $scope.image = res.image;\n                            $scope.$parent.image = res.image;\n                        });\n                    };\n\n                    $scope.setPassword = function ($event) {\n                        $event.preventDefault();\n                        $rootScope.showLoader = true;\n                        ImageResource.update({'imageId': $scope.image.imageId},\n                        {\n                            password:$scope.passwordData.password\n                        }, function(res)\n                        {\n                            alertSuccess(\"Password removed\");\n                            $rootScope.showLoader = false;\n                            $scope.image = res.image;\n                            $scope.$parent.image = res.image;\n                        });\n                    };\n\n                    $scope.removePassword = function ($event) {\n                        $event.preventDefault();\n                        $rootScope.showLoader = true;\n                        ImageResource.update({'imageId': $scope.image.imageId},\n                        {\n                            password:''\n                        }, function(res)\n                        {\n                            alertSuccess(\"Password removed\");\n                            $rootScope.showLoader = false;\n                            $scope.image = res.image;\n                            $scope.$parent.image = res.image;\n                        });\n                    };\n\n                },\n                inputs: {\n                    image: $scope.image\n                }\n            });\n        };\n\n        $scope.delete = function () {\n            if ($scope.editing) {\n                return false;\n            }\n\n            if (!confirm(\"Are you sure you want to delete this image?\")) {\n                return false;\n            }\n\n            $scope.editing = true;\n            $scope.deleting = true;\n            ImageResource.delete(\n                {\n                    imageId: $scope.image.imageId\n                },\n                function () {\n                    $scope.editing = false;\n                    $scope.deleting = false;\n                    $scope.image = null;\n                    alertSuccess(\"Image deleted\");\n                },\n                function (response) {\n                    $scope.editing = false;\n                    $scope.deleting = false;\n                    alertError(response.data.message);\n                }\n            );\n        };\n\n        $scope.showReportDialog = function () {\n\n        };\n\n        /**\n         * Returns how much the image is scaled to fit on the screen.\n         */\n        $scope.getImageScale = function () {\n            return parseInt($('#img').width()) / $scope.image.image.width;\n        };\n\n        $scope.init();\n    }\n);\n","app.controller(\n    'ImageListController',\n    function ($scope, $rootScope, $state, $stateParams, $compile, AuthService, AlbumResource, UserResource) {\n\n        console.log('ImageListController');\n\n        $rootScope.loading = true;\n        $rootScope.title = '';\n        $rootScope.subtitle = '';\n\n        $scope.mode = $stateParams.mode;\n\n\n        /**\n         * Load the user\n         */\n\n        $scope.user = null;\n        $scope.username = $stateParams.username;\n\n        $scope.album = null;\n        $scope.albumId = $stateParams.albumId;\n\n        $scope.albums = [];\n\n\n        function loadAlbum(albumId) {\n            AlbumResource.get({albumId: albumId}, function (album) {\n                console.log(album);\n\n                $scope.album = album;\n                $scope.user = album.user;\n                $scope.albumId = albumId;\n                $scope.albums = album.user.albums;\n\n                $rootScope.title = '<i class=\"typ typ-folder-open\"></i> ' + album.title;\n\n                var subtitle = '<span>';\n                if (album.user) {\n                    subtitle += '<i class=\"typ typ-user\"></i> An Album By <a ng-click=\"changeUser($event, album.user.username)\" ui-sref=\"user({username: album.user.username.toLowerCase()})\">' + album.user.username + '</a>';\n                }\n                subtitle += '</span>';\n                $rootScope.subtitle = $compile(subtitle)($scope)[0].innerHTML;\n            });\n        }\n\n        $scope.changeAlbum = function ($event, albumId) {\n            $event.stopPropagation();\n            $event.preventDefault();\n\n            $scope.mode = 'album';\n            $scope.albumId = albumId;\n            $state.go('album', {albumId: albumId}, {notify: false});\n            loadAlbum(albumId);\n            loadImages(1);\n        };\n\n        function loadUser(username) {\n            $scope.username = username;\n            UserResource.get({username: username}, function (user) {\n                $rootScope.title = '<i class=\"typ typ-user\"></i> ' + user.username + \"'s Images\";\n                $scope.user = user;\n                $scope.albums = user.albums;\n                $scope.url = '/user/' + user.username;\n            });\n        }\n\n        $scope.changeUser = function ($event, username) {\n            $event.stopPropagation();\n            $event.preventDefault();\n\n            $scope.mode = 'user';\n            $scope.username = username;\n            $state.go('user', {username: username}, {notify: false});\n            loadUser(username);\n            loadImages(1);\n        };\n\n        // On pageload\n        switch ($scope.mode) {\n            case 'album':\n                loadAlbum($scope.albumId);\n                break;\n            case 'user':\n                loadUser($scope.username);\n                break;\n        }\n\n\n\n        /**\n         * Load the page of images\n         */\n\n        $scope.images = [];\n        $scope.currentPage = 1;\n        $scope.totalPages = 0;\n\n        function loadImages(page) {\n            $rootScope.loading = true;\n\n            switch ($scope.mode) {\n                case 'album':\n                    AlbumResource.getImages({albumId: $scope.albumId, page: page}, imagesLoadedCallback);\n                    break;\n                case 'user':\n                    UserResource.getImages({username: $scope.username, page: page}, imagesLoadedCallback);\n                    break;\n            }\n        }\n\n        function imagesLoadedCallback(data) {\n            $rootScope.loading = false;\n            $scope.images = data.images;\n            $scope.totalPages = data.lastPage;\n            $scope.currentPage = data.currentPage;\n        }\n\n        $scope.changePage = function ($event, page) {\n            $event.stopPropagation();\n            $event.preventDefault();\n\n            switch ($scope.mode) {\n                case 'album':\n                    $state.go('album-page', {albumId: $scope.albumId, page: page}, {notify: false});\n                    break;\n\n                case 'user':\n                    $state.go('user-page', {username: $scope.username, page: page}, {notify: false});\n                    break;\n            }\n\n            loadImages(page);\n        };\n\n        loadImages($stateParams.page ? $stateParams.page : 1);\n    }\n);\n","app.controller(\n    'LoginModalController',\n    function ($scope, close, AuthService, UserResource) {\n\n        $scope.loginData = {\n            loading: false,\n            username: '',\n            password: '',\n            errors: {}\n        };\n\n        $scope.signupData = {\n            loading: false,\n            username: '',\n            password: '',\n            email: '',\n            errors: {}\n        };\n\n        $scope.fb = function () {\n            alert(':(');\n        };\n\n        $scope.forgot = function () {\n            alert('lol');\n        };\n\n        $scope.login = function () {\n            if ($scope.loginData.loading) {\n                return false;\n            }\n            $scope.loginData.errors = {};\n            $scope.loginData.loading = true;\n\n            AuthService\n                .login($scope.loginData.username, $scope.loginData.password)\n                .then(\n                    function (response) {\n                        $scope.loginData.loading = false;\n\n                        close();\n                    },\n                    function (response) {\n                        $scope.loginData.loading = false;\n\n                        if (\n                            response.messages\n                            &&\n                            (\n                                response.messages.hasOwnProperty('username')\n                                ||\n                                response.messages.hasOwnProperty('password')\n                            )\n                        ) {\n                            $scope.loginData.errors = response.messages;\n                        } else {\n\n                            $scope.loginData.errors = {\n                                general: response.message\n                            };\n                        }\n\n                    }\n                );\n        };\n\n\n        $scope.signup = function () {\n            if ($scope.signupData.loading) {\n                return false;\n            }\n            $scope.signupData.errors = {};\n            $scope.signupData.loading = true;\n\n            UserResource.save({\n                username: $scope.signupData.username,\n                password: $scope.signupData.password,\n                email: $scope.signupData.email,\n            }, function(response) {\n\n                AuthService\n                    .login($scope.signupData.username, $scope.signupData.password)\n                    .then(\n                        function (response) {\n                            $scope.signupData.loading = false;\n                            close();\n                        },\n                        function (response) {\n                            $scope.signupData.loading = false;\n                            $scope.signupData.errors = {\n                                general: response.message\n                            };\n                        }\n                    );\n\n            }, function (response) {\n                $scope.signupData.loading = false;\n\n                response = response.data;\n                if (\n                    response.messages\n                    &&\n                    (\n                        response.messages.hasOwnProperty('username')\n                        ||\n                        response.messages.hasOwnProperty('password')\n                        ||\n                        response.messages.hasOwnProperty('email')\n                    )\n                ) {\n                    $scope.signupData.errors = response.messages;\n                } else {\n\n                    $scope.signupData.errors = {\n                        general: response.message\n                    };\n                }\n            });\n        };\n\n        $scope.close = close;\n\n    }\n);\n","app.directive('annotator', function ($window, debounce) {\n    return {\n        restrict: 'E',\n        controller: function ($scope, $element) {\n\n            var imageEl = $('#img');\n\n            $scope.doodle = new Doodle($element[0]);\n            $scope.doodle.init();\n\n            var moveAndResize = function() {\n                var imgOffset = imageEl.offset();\n                $element.css({\n                    left: imgOffset.left + 1,\n                    top: imgOffset.top + 1,\n                });\n                $scope.doodle.canvas.width = imageEl.width();\n                $scope.doodle.canvas.height = imageEl.height();\n            };\n\n            moveAndResize();\n\n            var debouncedRedraw = debounce(200, function() {\n                $scope.doodle.redraw();\n            });\n\n            angular.element($window).bind('resize', function() {\n                moveAndResize();\n                debouncedRedraw();\n            });\n\n        },\n        scope: {\n            doodle: '=',\n        },\n        template: ''\n    };\n});\n","app.directive('paginator', function factory($window, $state, $timeout, debounce) {\n    return {\n        restrict: 'E',\n        controller: function ($scope, $element) {\n\n            $scope.showPageJump = function ($event) {\n                $event.preventDefault();\n                $event.stopPropagation();\n\n                var pageNumber  = prompt(\"Enter a page number to jump to.\");\n                if (pageNumber) {\n                    window.location = $scope.url + '/' + pageNumber;\n                }\n            };\n\n            var calculatePages = function () {\n\n                console.log('calculatePages', $scope.currentPage, $scope.totalPages);\n\n                // Only 1 page - don't need a paginator\n                if ($scope.totalPages <= 1) {\n                    return [1];\n                }\n\n                var pages = [];\n                var i;\n                var paginatorHeight = $element.height();\n\n                // How tall is one link in the paginator\n                var spaceHeight = 46;\n\n                var totalSpaces = Math.floor(paginatorHeight / spaceHeight);\n\n                console.log('paginatorHeight', paginatorHeight);\n                console.log('totalSpaces', totalSpaces);\n\n                // Round down to the next odd number\n                if (totalSpaces % 2 === 0) {\n                    totalSpaces -= 1;\n                }\n\n                // All page numbers fit on screen\n                if ($scope.totalPages <= totalSpaces) {\n                    for (i = 1; i <= $scope.totalPages; i++) {\n                        pages.push(i);\n                    }\n                    return pages;\n                }\n\n                var adjacent = Math.floor((totalSpaces - 5) / 2);\n\n                if ($scope.currentPage <= (adjacent + 3)) {\n                    // Close to the start - don't hide first pages\n                    for (i = 1; i <= totalSpaces - 2; i++) {\n                        pages.push(i);\n                    }\n                    pages.push('...');\n                    pages.push($scope.totalPages);\n\n                } else if ($scope.currentPage >= $scope.totalPages - (adjacent) - 2) {\n                    // Close to the end - don't hide last pages\n                    pages = [1, '...'];\n                    for (i = $scope.totalPages - (adjacent*2) - 2; i <= $scope.totalPages; i++) {\n                        pages.push(i);\n                    }\n\n                } else {\n                    pages = [1, '...'];\n                    for (i = $scope.currentPage - adjacent; i <= $scope.currentPage + adjacent; i++) {\n                        pages.push(i);\n                    }\n                    pages.push('...');\n                    pages.push($scope.totalPages);\n                }\n\n                return pages;\n            };\n\n            $timeout(function() {\n                $scope.pages = calculatePages();\n            }, 50);\n\n            // Recalculate on page change\n            $scope.$watchGroup(['totalPages', 'currentPage'], function () {\n                $timeout(function() {\n                    $scope.pages = calculatePages();\n                }, 50);\n            });\n\n            // Recalculate on window resize\n            var debouncedCalculatePages = debounce(100, function() {\n                $scope.pages = calculatePages();\n            });\n            angular.element($window).bind('resize', function() {\n                debouncedCalculatePages();\n            });\n\n        },\n        scope: {\n            currentPage: '=',\n            totalPages: '=',\n            url: '=',\n            changePage: '=',\n        },\n        templateUrl: 'views/partials/paginator.html'\n    };\n});\n","/**\n * Source: http://stackoverflow.com/a/32574746/710630\n */\n(function () {\n    'use strict';\n\n    app.directive(\n        'stateBodyClass',\n        function ($rootScope) {\n            return {\n                restrict: 'A',\n                scope: {},\n                link: function (scope, elem, attr, ctrl) {\n\n                    $rootScope.$on('$stateChangeSuccess', function (event, toState, toParams, fromState, fromParams) {\n                        var fromClassnames = angular.isDefined(fromState.data) && angular.isDefined(fromState.data.bodyClass) ? fromState.data.bodyClass : null;\n                        var toClassnames = angular.isDefined(toState.data) && angular.isDefined(toState.data.bodyClass) ? toState.data.bodyClass : null;\n\n                        // don't do anything if they are the same\n                        if (fromClassnames != toClassnames) {\n                            if (fromClassnames) {\n                                elem.removeClass(fromClassnames);\n                            }\n\n                            if (toClassnames) {\n                                elem.addClass(toClassnames);\n                            }\n                        }\n                    });\n                }\n            };\n        }\n    );\n\n}());\n","/**\n * Shuffles the items in an array.\n * Source: http://stackoverflow.com/a/10142256/710630\n *\n * @returns {Array}\n */\nArray.prototype.shuffle = function() {\n    var i = this.length, j, temp;\n    if (i === 0) {\n        return this;\n    }\n    while (--i) {\n        j = Math.floor( Math.random() * ( i + 1 ) );\n        temp = this[i];\n        this[i] = this[j];\n        this[j] = temp;\n    }\n    return this;\n};\n","\"use strict\";\n\nvar Doodle = function (element) {\n    this.element = element;\n    this.canvas = null;\n\n    this.lineThickness = 5;\n    this.color = '#000000';\n    this.drawing = false;\n    this.history = [];\n    this.currentData = null;\n\n    var ua = navigator.userAgent.toLowerCase();\n    this.isAndroid = ua.indexOf(\"android\") > -1;\n};\n\n\nDoodle.prototype = {\n\n    init: function () {\n\n        this.canvas = document.createElement('canvas');\n        this.element.appendChild(this.canvas);\n\n        //this.canvas.setAttribute('width', $(this.element).width());\n        //this.canvas.setAttribute('height', $(this.element).height());\n\n        this.context = this.canvas.getContext('2d');\n\n        //Setup a fresh canvas\n        this.color = '#000000';\n        $('#currentColour').css('background-color', this.color);\n        this.clear();\n\n        var self = this;\n\n        // Mouse\n        if (!this.isAndroid) {\n            $(this.canvas).bind('mousedown', function (e) {\n                self.drawStart(e);\n            });\n            $(this.canvas).bind('mousemove', function (e) {\n                self.draw(e);\n            });\n            $(this.canvas).bind('mouseup', function (e) {\n                self.drawEnd(e);\n            });\n            $('body').bind('mouseup', function (e) {\n                self.drawEnd(e);\n            });\n        }\n\n        // Touch\n        $(this.canvas).bind('touchstart', function (e) {\n            self.drawStart(e);\n        });\n        $(this.canvas).bind('touchmove', function (e) {\n            self.draw(e);\n        });\n        $(this.canvas).bind('touchend', function (e) {\n            self.drawEnd(e);\n        });\n    },\n\n    clear: function () {\n        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);\n        this.context.fillStyle = this.color;\n        this.history = [];\n    },\n\n    getImage: function (e) {\n        if (this.history.length < 1) {\n            return false;\n        }\n        return this.canvas.toDataURL(\"image/png\");\n    },\n\n    saveHistoryState: function () {\n        // Limit history size\n        while (this.history.length >= 30) {\n            this.history.shift();\n        }\n        this.history.push(this.context.getImageData(0, 0, this.canvas.width, this.canvas.height));\n    },\n\n    saveCurrentData: function () {\n        this.currentData = this.context.getImageData(0, 0, this.canvas.width, this.canvas.height);\n    },\n\n    undo: function () {\n        if (this.history.length > 0) {\n            var imageData = this.history.pop();\n            this.putImageData(imageData);\n        } else {\n            alert('Nothing to undo!');\n        }\n    },\n\n    redraw: function () {\n        if (this.currentData) {\n            this.putImageData(this.currentData);\n        }\n    },\n\n    putImageData: function (imageData) {\n        if (imageData.width === this.canvas.width) {\n            this.context.putImageData(imageData, 0, 0);\n        } else {\n            // Draw it to a new canvas to resize it\n            var scale = this.canvas.width / imageData.width;\n\n            var newCanvas = $('<canvas>')\n                .attr('width', imageData.width)\n                .attr('height', imageData.height)[0];\n\n            newCanvas.getContext('2d').putImageData(imageData, 0, 0);\n\n            this.context.scale(scale, scale);\n            this.context.drawImage(newCanvas, 0, 0);\n            this.context.scale(1 / scale, 1 / scale);\n        }\n    },\n\n    drawStart: function (e) {\n        if (e) {\n            e.preventDefault();\n        }\n        this.saveHistoryState();\n\n        var x, y;\n        if (e.originalEvent.touches) {\n            x = e.originalEvent.touches[0].pageX - $(this.canvas).offset().left;\n            y = e.originalEvent.touches[0].pageY - $(this.canvas).offset().top;\n        }\n        else {\n            x = e.pageX - $(this.canvas).offset().left;\n            y = e.pageY - $(this.canvas).offset().top;\n        }\n\n        this.drawing = true;\n        $(this.canvas).addClass('drawing');\n\n        this.context.lineWidth = this.lineThickness;\n        this.context.lineCap = \"round\";\n        this.context.lineJoin = \"round\";\n        this.context.strokeStyle = this.color;\n        this.context.fillStyle = this.color;\n\n        this.oldX = x;\n        this.oldY = y;\n\n        // Draw a dot at the current position\n        this.context.beginPath();\n        this.context.arc(x, y, (this.lineThickness / 2), 0, 2 * Math.PI, false);\n        this.context.closePath();\n        this.context.fill();\n\n        this.context.beginPath();\n    },\n\n    draw: function (e) {\n        if (e) {\n            e.preventDefault();\n        }\n\n        var x, y;\n        if (e.originalEvent.touches) {\n            x = e.originalEvent.touches[0].pageX - $(this.canvas).offset().left;\n            y = e.originalEvent.touches[0].pageY - $(this.canvas).offset().top;\n        }\n        else {\n            x = e.pageX - $(this.canvas).offset().left;\n            y = e.pageY - $(this.canvas).offset().top;\n        }\n\n        if (this.drawing) {\n            this.context.moveTo(this.oldX, this.oldY);\n            this.context.lineTo(x, y);\n            this.context.stroke();\n        }\n\n        this.oldX = x;\n        this.oldY = y;\n    },\n\n    drawEnd: function (e) {\n        if (e) {\n            e.preventDefault();\n        }\n\n        if (this.drawing) {\n            this.context.closePath();\n            this.context.stroke();\n            this.drawing = false;\n        }\n\n        this.saveCurrentData();\n\n        $(this.canvas).removeClass('drawing');\n    },\n\n    rgbToHex: function (rgb) {\n        var hexDigits = new Array(\"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"a\", \"b\", \"c\", \"d\", \"e\", \"f\");\n\n        function hex(x) {\n            return isNaN(x) ? \"00\" : hexDigits[(x - x % 16) / 16] + hexDigits[x % 16];\n        }\n\n        rgb = rgb.match(/^rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)$/);\n        return \"#\" + hex(rgb[1]) + hex(rgb[2]) + hex(rgb[3]);\n    }\n};\n","var ImagePaster = (function () {\n    \"use strict\";\n\n    var ImagePaster = function (url) {\n        this.debug = true;\n        this.url = url;\n        this.pasteCatcher = null;\n        this.init();\n    };\n\n    ImagePaster.prototype.log = function (data, extra) {\n        if (this.debug) {\n            console.log(data, extra);\n        }\n    };\n\n    ImagePaster.prototype.init = function () {\n\n        var self = this;\n\n        /**\n         * Firefox allows images to be pasted into contenteditable elements.\n         * So create one of those on the page and make it have focus,\n         * so paste events happen into that\n         */\n\n            // Create paste catcher element\n        self.pasteCatcher = document.createElement('div');\n        self.pasteCatcher.setAttribute('contenteditable', '');\n        self.pasteCatcher.setAttribute('style', 'position:absolute; opacity:0; top:0; left:0; width:0; height:0;');\n        self.pasteCatcher.id = 'paste-catcher';\n        document.body.appendChild(self.pasteCatcher);\n        self.pasteCatcher.focus();\n\n        // Listen for the 'paste' event on the body\n        //if (browserName == 'IE') {\n        //$('body').on('paste', function(event) { self.onPaste(event); });\n        //} else {\n        document.addEventListener('paste', function (event) {\n            self.onPaste(event);\n        });\n        //}\n\n        // Watch for ctrl + v being pressed\n        $(document).on('keydown', function (e) {\n            // 86 = v\n            if (e.which === 86 && (e.ctrlKey || e.metaKey)) {\n                $(document).trigger('ctrlVPressed');\n            }\n        });\n\n        // Focus paste catcher when cmd or ctrlv is pressed\n        $(document).on('ctrlVPressed', function () {\n            self.pasteCatcher.focus();\n        });\n\n    };\n\n    ImagePaster.prototype.onPaste = function (event) {\n\n        var self = this;\n        var done = false;\n        var clipboardData;\n\n        self.log('onPaste', JSON.stringify(event));\n\n        if (event.clipboardData) {\n            // Chrome\n            clipboardData = event.clipboardData;\n        } else if (window.clipboardData) {\n            // IE\n            clipboardData = window.clipboardData;\n        } else {\n            // Firefox\n            //setTimeout(this.checkPasteCatcher, 1);\n        }\n\n        // IE\n        if (event.msConvertURL) {\n            var fileList = clipboardData.files;\n            if (fileList.length > 0) {\n                for (var i = 0; i < fileList.length; i++) {\n                    self.uploadBlob(fileList[i]);\n                    done = true;\n                }\n            }\n        }\n\n        // Check if there is something in the paste event itself\n        if (clipboardData && clipboardData.items) {\n\n            var text;\n            // If there was some text on the clipboard,\n            // it might be a URL. Try and paste that...\n            if ((text = clipboardData.getData(\"text/plain\"))) {\n                self.uploadText(text);\n                self.clearPasteCatcher();\n                return;\n            }\n\n            // Loop through all the clipboardData\n            for (var x = 0; x < clipboardData.items.length; x++) {\n                // If this clipboard item claims to be an image, upload it\n                if (clipboardData.items[x].type.indexOf('image') !== -1) {\n                    self.uploadBlob(clipboardData.items[x].getAsFile());\n                    done = true;\n                }\n            }\n        }\n\n        // If there was nothing found in the clipboard data\n        // fall back to checking if there's anything in the editable element\n        if (done) {\n            self.clearPasteCatcher();\n        } else {\n            setTimeout(\n                function () {\n                    self.checkPasteCatcher();\n                },\n                10\n            );\n        }\n    };\n\n    /**\n     * Check if anything has been pasted into the paste catcher element\n     * (Firefox + Safari?)\n     */\n    ImagePaster.prototype.checkPasteCatcher = function () {\n\n        var text = this.pasteCatcher.innerHTML;\n        var child = this.pasteCatcher.childNodes[0];\n\n        if (child) {\n            if (child.tagName === 'IMG') {\n                if (child.src.indexOf('webkit-fake-url://') != -1) {\n                    this.onFail('Sorry, Safari does not currently support pasting images.');\n                    return false;\n                }\n                this.uploadImage(child.src);\n            } else if (child.tagName === 'A') {\n                this.uploadText(child.href);\n            } else {\n                this.uploadText(text);\n            }\n        }\n\n        this.clearPasteCatcher();\n    };\n\n    ImagePaster.prototype.clearPasteCatcher = function () {\n        var self = this;\n        setTimeout(\n            function () {\n                self.pasteCatcher.innerHTML = '';\n            },\n            1\n        );\n    };\n\n    ImagePaster.prototype.uploadBlob = function (blob) {\n        if (blob) {\n            var self = this;\n            var reader = new FileReader();\n            reader.onload = function (evt) {\n                self.uploadImage(evt.target.result);\n            };\n            reader.readAsDataURL(blob);\n        }\n    };\n\n    ImagePaster.prototype.uploadText = function (text) {\n        return this.upload('text', text);\n\n        /*if (this.validateURL(url)) {\n         upload('url', url);\n         } else {\n         failedUpload(\"Can't upload that. Try pasting an image or URL.\");\n         }*/\n    };\n\n    ImagePaster.prototype.uploadImage = function (base64) {\n        return this.upload('uploadImage', base64);\n\n        /*convertImageToJpeg(base64, function(jpegBase64){\n         upload('base64', jpegBase64);\n         });*/\n    };\n\n    /*ImagePaster.prototype.convertImageToJpeg = function(base64, callback)\n     {\n     //Convert image to a JPG so it's faster to upload\n     var img = new Image();\n     img.onload = function()\n     {\n     var canvas = convertImageToCanvas(this);\n     var data = canvas.toDataURL('image/jpeg' , 0.8);\n     callback(data);\n     };\n     img.src = base64;\n     };*/\n\n    /*ImagePaster.prototype.convertImageToCanvas = function(image)\n     {\n     var canvas = document.createElement(\"canvas\");\n     canvas.width = image.width;\n     canvas.height = image.height;\n\n     var context = canvas.getContext(\"2d\");\n     context.fillStyle = \"#ffffff\";\n     context.fillRect(0,0,image.width,image.height);\n     context.drawImage(image, 0, 0);\n\n     return canvas;\n     };*/\n\n    ImagePaster.prototype.upload = function (format, data) {\n\n        var self = this;\n\n        var id = this.generateId();\n\n        $(document).trigger({\n            type: 'ctrlvuploadstart',\n            id: id\n        });\n\n        var url = this.url;\n        if (typeof url === 'function') {\n            url = url();\n        }\n\n        $.ajax({\n            url: url,\n            timeout: 90000,\n            type: 'POST',\n            data: {\n                format: format,\n                base64: data\n            },\n            error: function (jqXHR, textStatus) {\n                // Turn this error message into something useful\n                var message;\n                switch (textStatus) {\n                    case 'timeout':\n                        message = 'The image took too long to upload';\n                        break;\n                    case 'error':\n\n                        if (jqXHR.responseJSON && jqXHR.responseJSON.message) {\n                            message = 'CtrlV server error (' + jqXHR.responseJSON.errorType + ' ' + jqXHR.responseJSON.message + ')';\n                        } else if (jqXHR.status !== 0) {\n                            message = 'CtrlV server error (' + jqXHR.status + ' ' + jqXHR.statusText + ')';\n                        } else {\n                            message = 'Can\\'t connect to the CtrlV server';\n                        }\n                        break;\n                    case 'abort':\n                        message = 'The upload was cancelled';\n                        break;\n                    case 'parsererror':\n                        message = 'Error uploading: couldn\\'t decode the response from the server';\n                        break;\n                    default:\n                        message = textStatus;\n                        break;\n                }\n\n                self.onFail(message, id);\n            },\n            success: function (res) {\n                if (res.image) {\n                    $(document).trigger({\n                        type: 'ctrlvuploadcomplete',\n                        image: res.image,\n                        id: id\n                    });\n                } else {\n                    self.onFail(res.message, id);\n                }\n            }\n        });\n    };\n\n    ImagePaster.prototype.onFail = function (message, id) {\n        $(document).trigger({\n            type: 'ctrlvuploaderror',\n            message: message ? message : false,\n            id: id\n        });\n    };\n\n    ImagePaster.prototype.validateURL = function (text) {\n        var regex = new RegExp(\"^(http|https|ftp)\\://([a-zA-Z0-9\\.\\-]+(\\:[a-zA-Z0-9\\.&amp;%\\$\\-]+)*@)*((25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9])\\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])|([a-zA-Z0-9\\-]+\\.)*[a-zA-Z0-9\\-]+\\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(\\:[0-9]+)*(/($|[a-zA-Z0-9\\.\\,\\?\\'\\\\\\+&amp;%\\$#\\=~_\\-]+))*$\");\n        return regex.test(text);\n    };\n\n    ImagePaster.prototype.generateId = function () {\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n            var r = crypto.getRandomValues(new Uint8Array(1))[0] % 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n            return v.toString(16);\n        });\n    };\n\n    return ImagePaster;\n}());\n","app.factory(\n    'AlbumResource',\n    function ($resource, AuthService) {\n        return $resource(\n            apiUrl + 'albums/:albumId',\n            {\n                albumId: '@albumId',\n                sessionKey: function() {\n                    return AuthService.getSessionKey() || null;\n                }\n            },\n            {\n                get: {\n                    cache: true,\n                    transformResponse: function(data) {\n                        data = angular.fromJson(data);\n                        return data.album;\n                    }\n                },\n\n                getImages: {\n                    cache: true,\n                    url: apiUrl + 'albums/:albumId/images',\n                    //isArray: true,\n                    transformResponse: function(data) {\n                        var data = angular.fromJson(data);\n                        return data;\n                    }\n                }\n\n            }\n        );\n    }\n);\n","app.factory(\n    'ImageResource',\n    function ($resource, AuthService) {\n        return $resource(\n            apiUrl + 'images/:imageId',\n            {\n                imageId: '@imageId',\n                sessionKey: function() {\n                    return AuthService.getSessionKey() || null;\n                }\n            },\n            {\n                get: {\n                    cache: true,\n                },\n\n                update: {\n                    method: 'PUT'\n                },\n\n                getText: {\n                    url: apiUrl + 'images/:imageId/text',\n                    method: 'GET'\n                },\n\n                annotate: {\n                    url: apiUrl + 'images/:imageId/image',\n                    method: 'PUT',\n                    params: {\n                        action: 'annotate'\n                    }\n                },\n\n                crop: {\n                    url: apiUrl + 'images/:imageId/image',\n                    method: 'PUT',\n                    params: {\n                        action: 'crop'\n                    }\n                },\n\n                revert: {\n                    url: apiUrl + 'images/:imageId/image',\n                    method: 'PUT',\n                    params: {\n                        action: 'revert'\n                    }\n                },\n\n                rotate: {\n                    url: apiUrl + 'images/:imageId/image',\n                    method: 'PUT',\n                    params: {\n                        action: 'rotate',\n                        degrees: 90\n                    }\n                },\n            }\n        );\n    }\n);\n","app.factory(\n    'SessionResource',\n    function ($resource) {\n        return $resource(\n            apiUrl + 'sessions/:sessionKey',\n            {},\n            {\n                get: {\n                    transformResponse: function(data) {\n                        data = angular.fromJson(data);\n                        return data.session;\n                    }\n                }\n            }\n        );\n    }\n);\n","app.factory(\n    'UserResource',\n    function ($resource, AuthService) {\n        return $resource(\n            apiUrl + 'users/:username',\n            {\n                username: '@username',\n                sessionKey: function() {\n                    return AuthService.getSessionKey() || null;\n                }\n            },\n            {\n                get: {\n                    cache: true,\n                    transformResponse: function(data) {\n                        var data = angular.fromJson(data);\n                        return data.user;\n                    }\n                },\n\n                save: {\n                    method: 'POST',\n                    url: apiUrl + 'users'\n                },\n\n                getImages: {\n                    cache: true,\n                    url: apiUrl + 'users/:username/images?page=:page',\n                    /*isArray: true,\n                    transformResponse: function(data) {\n                        var data = angular.fromJson(data);\n                        return data.images;\n                    }*/\n                },\n\n                getAlbums: {\n                    cache: true,\n                    url: apiUrl + 'users/:username/albums',\n                    /*isArray: true,\n                    transformResponse: function(data) {\n                        var data = angular.fromJson(data);\n                        return data;\n                    }*/\n                }\n            }\n        );\n    }\n);\n","app.service(\n    'AuthService',\n    function (localStorageService, SessionResource, $q, $rootScope) {\n\n        var session = null;\n        var sessionKey = null;\n\n        return {\n\n            checkSession: function() {\n                var self = this;\n\n                if (sessionKey = localStorageService.get('sessionKey')) {\n                    SessionResource.get(\n                        {sessionKey: sessionKey},\n                        function (session) {\n                            self.onLogin(session, sessionKey);\n                        },\n                        function() {\n                            self.onLogout();\n                        }\n                    );\n                } else {\n                    self.onLogout();\n                }\n            },\n\n            /**\n             * @param username\n             * @param password\n             * @returns $q\n             */\n            login: function(username, password) {\n                var self = this;\n\n                return $q(function(resolve, reject) {\n\n                    SessionResource.save({\n                        username: username,\n                        password: password\n                    }, function(response) {\n\n                        self.onLogin(response.session, response.sessionKey);\n\n                        // Resolve promise (sends back user)\n                        resolve(response.session.user);\n\n                    }, function (response) {\n                        reject(response.data);\n                    });\n\n                });\n            },\n\n            onLogin: function(newSession, newSessionKey) {\n\n                session = newSession;\n                sessionKey = newSessionKey;\n                localStorageService.set('sessionKey', newSessionKey);\n\n                // Tell everybody we're logged in\n                $rootScope.$broadcast('login', {user: newSession.user});\n\n            },\n\n            logout: function() {\n                var self = this;\n\n                SessionResource.delete({\n                    sessionKey: sessionKey\n                });\n\n                self.onLogout();\n\n            },\n\n            onLogout: function() {\n\n                session = false;\n                sessionKey = false;\n                localStorageService.remove('sessionKey');\n\n                // Tell everybody we're logged in\n                $rootScope.$broadcast('logout');\n\n            },\n\n            getSessionKey: function() {\n                return sessionKey;\n            },\n\n            getUser: function() {\n                if (session === null) {\n                    return null;\n                }\n\n                return session && session.user ? session.user : false;\n            }\n        };\n    }\n);\n","app.service(\n    'ImagePasterService',\n    function($state, AuthService) {\n\n        var messages = {};\n\n        /**\n         * Add listeners for events that ImagePaster broadcasts.\n         */\n        $(document).on('ctrlvuploadstart', function (e) {\n            $('.upload-status').addClass('out');\n            $('#upload-loading').removeClass('out');\n\n            messages[e.id] = alertSpinner(\"Uploading image...\");\n        });\n\n        $(document).on('ctrlvuploadcomplete', function (e) {\n            $('.upload-status').addClass('out');\n            $('#upload-complete').removeClass('out');\n            var viewUrl = e.image.url;\n            var imageUrl = e.image.image.url;\n            $('#view-btn').attr('href', viewUrl);\n            $('#uploader').css('background-image', 'url(' + imageUrl + ')');\n\n            if (messages.hasOwnProperty(e.id)) {\n                messages[e.id].update({\n                    type: \"success\",\n                    message: \"Image uploaded! \" + e.image.url\n                })\n            } else {\n                alertSuccess(\"Image uploaded! \" + e.image.url, true);\n            }\n\n            $state.go('image', {imageId: e.image.imageId});\n\n        });\n\n        $(document).on('ctrlvuploaderror', function (e) {\n            $('.upload-status').addClass('out');\n            $('#upload-error').removeClass('out').find('p').text(e.message);\n\n            if (messages.hasOwnProperty(e.id)) {\n                messages[e.id].update({\n                    type: \"error\",\n                    message: e.message\n                })\n            } else {\n                alertError(e.message, true);\n            }\n\n        });\n\n        $(document).on('keyup', function (e) {\n            // Highlighting keys when pressing\n            if (e.which == 91 || e.which === 224) { // cmd\n                $('.btn-cmd').removeClass('active');\n            } else if (e.which == 17) { // ctrl\n                $('.btn-ctrl').removeClass('active');\n            } else if (e.which == 86) { // v\n                $('.btn-v').removeClass('active');\n            }\n        });\n\n        $(document).on('keydown', function (e) {\n            // Highlighting keys when pressing\n            if (e.which == 91 || e.which === 224) { // cmd (91 in\n                $('.btn-cmd').addClass('active');\n            } else if (e.which == 17) { // ctrl\n                $('.btn-ctrl').addClass('active');\n            } else if (e.which == 86) { // v\n                $('.btn-v').addClass('active');\n            }\n        });\n\n        var getImageUploadUrl = function() {\n            var url = apiUrl + 'images';\n\n            var sessionKey;\n            if (sessionKey = AuthService.getSessionKey()) {\n                url += '?sessionKey=' + sessionKey;\n            }\n            return url;\n        };\n\n        return new ImagePaster(getImageUploadUrl);\n    }\n);\n"]}