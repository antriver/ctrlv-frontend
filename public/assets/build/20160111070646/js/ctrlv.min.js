"use strict";var app=angular.module("ctrlv",["ui.router","ngResource","ngSanitize","LocalStorageModule","angularModalService","ngAnimate"]);app.config(function($httpProvider,$locationProvider,$stateProvider,$urlRouterProvider,localStorageServiceProvider){$httpProvider.defaults.headers.common={RemoteUser:"billybob"},$locationProvider.html5Mode(!0),localStorageServiceProvider.setPrefix("ctrlv").setStorageType("localStorage").setStorageCookie(0,"/"),$urlRouterProvider.otherwise("/"),$stateProvider.state("home",{url:"/",templateUrl:"views/home.html",controller:"HomeController"}).state("help",{url:"/help",templateUrl:"views/help.html",controller:"HelpController"}).state("image",{url:"/{imageId:int}",templateUrl:"views/image.html",controller:"ImageController",params:{albumId:null}}).state("user",{url:"/user/{username:string}",templateUrl:"views/user.html",controller:"UserController"}).state("user-page",{url:"/user/{username:string}/{page:int}",templateUrl:"views/user.html",controller:"UserController"}).state("user-favourites",{url:"/user/{username:string}/favourites",templateUrl:"views/user/favourites.html",controller:"UserFavouritesController"})}),app.run(function($rootScope,$state,AuthService,ImagePasterService){$rootScope.$state=$state,AuthService.checkSession(),$rootScope.user=AuthService.getUser(),$rootScope.$on("login",function(event,args){$rootScope.user=args.user}),$rootScope.$on("logout",function(){$rootScope.user=!1}),$rootScope.$on("$stateChangeSuccess",function(ev,to,toParams,from,fromParams){$("body").attr("data-previous",from.name)})}),angular.module("ctrlv").run(["$templateCache",function($templateCache){$templateCache.put("views/home.html",'<div id="uploader">\n\n    <div id="uploader-collage" ng-bind-html="sprites"></div>\n\n    <div class="upload-status" id="upload-waiting">\n        <h2>The <span class="green">easiest</span> way to share photos.</h2>\n        <h3>\n            <span style="float:right;">\n                You can also\n                <a href="#" class="btn"><i class="typ typ-cloud-storage"></i> Upload Images</a>\n                or\n                <a href="#" class="btn"><i class="typ typ-camera"></i> Take a Photo</a>\n            </span>\n\n            <i class="spinner-waiting"></i>\n            Press <span ng-if="mac" class="btn btn-cmd">cmd &#8984;</span><span ng-if="!mac" class="btn btn-ctrl">Ctrl</span>\n            + <span class="btn btn-v">V</span> to paste an image.\n        </h3>\n    </div>\n\n    <div class="upload-status out" id="upload-loading">\n        <h3><i class="spinner-loading"></i> Uploading...</h3>\n    </div>\n\n    <div class="upload-status out" id="upload-error">\n        <h3>Error</h3>\n        <p></p>\n    </div>\n\n    <div class="upload-status out" id="upload-complete">\n        <h3>Uploaded!</h3>\n        <p>\n            <label>\n                Here\'s your link\n                <input type="text" id="newImageURL" class="green" readonly="readonly" />\n            </label>\n        </p>\n    </div>\n\n</div>\n'),$templateCache.put("views/image.html",'<div ng-if="image" class="img-wrapper">\n\n    <div id="doodle" style="width:500px; height:500px;"></div>\n\n    <img\n        ng-if="!loading && image"\n        ng-src="{{ image.image.url }}"\n        class="img"\n        id="img"\n        />\n\n</div>\n\n<div\n    ng-if="!loading && image"\n    class="sidebar img-left-sidebar"\n    ng-class="{\n        \'editable\': user && user.userId === image.userId,\n        \'cropping\': cropping,\n        \'revertable\': image.hasOriginal\n    }"\n    >\n\n    <div ng-if="cropping">\n        <a class="btn" href="#" ng-click="saveCrop()"><i class="typ typ-scissors" ng-hide="savingCrop"></i><i class="spinner-loading dark" ng-show="savingCrop"></i><span>Save Crop</span></a>\n        <a class="btn" href="#" ng-click="exitCrop()"><i class="typ typ-times"></i><span>Cancel</span></a>\n    </div>\n\n    <div ng-hide="cropping">\n        <a class="btn" href="#" ng-click="showTextDialog()"><i class="typ typ-sort-alphabetically"></i><span>Text Recognition</span></a>\n        <a class="btn" href="#" ng-click="showEmbedDialog()"><i class="typ typ-code"></i><span>Embed</span></a>\n        <a class="btn" href="#" ng-click="shareOnFb()"><i class="typ typ-social-facebook"></i><span>Share</span></a>\n        <a class="btn" href="#" ng-click="shareOnTwitter()"><i class="typ typ-social-twitter"></i><span>Tweet</span></a>\n\n        <hr/>\n\n        <div ng-if="user && user.userId === image.userId">\n            <a class="btn" href="#" ng-click="annotate()"><i class="typ typ-brush"></i><span>Annotate</span></a>\n            <a class="btn" href="#" ng-click="crop()"><i class="typ typ-scissors-outline"></i><span>Crop</span></a>\n            <a class="btn" href="#" ng-click="rotate()"><i class="typ typ-arrow-sync-outline" ng-hide="rotating"></i><i class="spinner-loading dark" ng-show="rotating"></i><span>Rotate</span></a>\n            <a class="btn" href="#" ng-if="image.hasOriginal" ng-click="revert()"><i class="typ typ-arrow-back" ng-hide="reverting"></i><i class="spinner-loading dark" ng-show="reverting"></i><span>Revert To Original</span></a>\n            <a class="btn" href="#" ng-click="showPrivacyDialog()"><i class="typ typ-lock-closed"></i><span>Privacy</span></a>\n            <a class="btn" href="#" ng-click="delete()"><i class="typ typ-trash" ng-hide="deleting"></i><i class="spinner-loading dark" ng-show="deleting"></i><span>Delete</span></a>\n        </div>\n        <div ng-if="!user || user.userId !== image.userId">\n            <a class="btn" href="#" ng-click="showReportDialog()"><i class="typ typ-flag"></i><span>Report</span></a>\n        </div>\n    </div>\n\n</div>\n\n<div class="sidebar img-right-sidebar" ng-if="albumImages.length > 0">\n    <ul>\n        <li>In This Album</li>\n        <li ng-repeat="albumImage in albumImages" ng-class="{active: imageId == albumImage.imageId}">\n            <a ui-sref="image({ imageId: albumImage.imageId, albumId: albumId })"><img ng-src="{{ albumImage.thumbnail.url }}" /></a>\n        </li>\n    </ul>\n</div>\n'),$templateCache.put("views/modals/image-embed.html",'<div class="modal" ng-click="close()" id="image-embed-modal">\n    <div class="modal-content" ng-click="$event.stopPropagation()">\n\n        <h2><i class="typ typ-export"></i> Link To <small>this image.</small></h2>\n\n        <div class="container-fluid">\n            <div class="row">\n                <div class="col-sm-6">\n\n                    <div class="form-group">\n                        <h4>Markdown Link <small>e.g. for Reddit comments</small></h4>\n                        <textarea rows="2" class="form-control" readonly="readonly">[{{image.url}}]({{image.url}}</textarea>\n                    </div>\n\n                    <div class="form-group">\n                        <p><small><a href="http://redditenhancementsuite.com/">Reddit Enhancement Suite</a> supports CtrlV, so you can also just use this link in Reddit comments:</small></p>\n                        <input type="text" class="form-control" readonly="readonly" value="{{image.url}}" />\n                    </div>\n\n                    <div class="form-group">\n                        <h4>Markdown Image <small>e.g. for GitHub/BitBucket READMEs</small></h4>\n                        <textarea rows="3" class="form-control" readonly="readonly">[![{{ image.title }}]({{image.image.url}})]({{image.url}})</textarea>\n                    </div>\n\n                </div>\n                <div class="col-sm-6">\n\n                    <div class="form-group">\n                        <h4>BBCode <small>for forums</small></h4>\n                        <textarea rows="3" class="form-control" readonly="readonly">[url={{image.url}}][img]{{image.image.url}}[/img]{{image.title}}[/url]</textarea>\n                    </div>\n\n                    <div class="form-group">\n                        <h4>HTML <small>for websites</small></h4>\n                        <textarea rows="5" class="form-control" readonly="readonly">&lt;a href=&quot;{{image.url}}&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;{{image.image.url}}&quot; style=&quot;max-width:900px;&quot; alt=&quot;CtrlV.in Image Hosting&quot; /&gt;&lt;/a&gt;</textarea>\n                    </div>\n\n                </div>\n            </div>\n        </div>\n\n    </div>\n</div>\n'),$templateCache.put("views/modals/image-privacy.html",'<div class="modal" ng-click="close()" id="image-privacy-modal">\n    <div class="modal-content" ng-click="$event.stopPropagation()">\n\n        <div class="container-fluid" >\n\n            <div class="alert alert-warning" ng-if="image.albumId">\n                This image is part of an album. Go to the <a href="#">albums settings</a> to make the album anonyous and/or password protected.\n            </div>\n\n            <div class="row" ng-if="!image.albumId">\n                <div class="col-sm-6">\n\n                    <h2><i class="typ typ-user"></i> Show Username <small>on this image.</small></h2>\n\n                    <div class="form-group">\n                        <div class="row">\n                            <div class="col-xs-6">\n                                <a ng-click="setAnon(0);" class="btn btn-block" ng-class="{\'active\': !image.anonymous}"><i class="typ typ-user"></i>Yes</a>\n                            </div>\n                            <div class="col-xs-6">\n                                <a ng-click="setAnon(1);" class="btn btn-block" ng-class="{\'active\': image.anonymous}"><i class="typ typ-cancel-outline"></i>No</a>\n                            </div>\n                        </div>\n                    </div>\n\n                </div>\n                <div class="col-sm-6">\n\n                    <h2><i class="typ typ-lock-closed"></i> Password Protect <small>this image.</small></h2>\n\n                    <div class="form-group">\n                        <label>Enter a password that will be required for other people to view this image.</label>\n                        (You will always be able to see it without the password.)\n                        <input type="password" class="form-control" placeholder="Password" />\n                    </div>\n\n                    <a class="btn btn-block">Save</a>\n\n                </div>\n            </div>\n        </div>\n\n    </div>\n</div>\n'),$templateCache.put("views/modals/image-text.html",'<div class="modal" ng-click="close()" id="image-text-modal">\n    <div class="modal-content" ng-click="$event.stopPropagation()">\n        <h2><i class="typ typ-sort-alphabetically"></i> Text <small>found in this image.</small></h2>\n        <div class="container-fluid">\n\n            <p ng-if="text.text.text">{{ text.text.text }}</p>\n\n            <div class="alert alert-warning" ng-if="text.text === null">\n                <i class="spinner-loading dark"></i> The image is currently being scanned for text.\n            </div>\n\n            <div class="alert alert-danger" ng-if="text.text.text.length < 1">\n                No text was found in the image.\n            </div>\n\n        </div>\n    </div>\n</div>\n'),$templateCache.put("views/modals/login.html",'<div class="modal" ng-click="close()">\n    <div class="modal-content" ng-click="$event.stopPropagation()">\n\n        <div class="container-fluid">\n            <div class="row">\n                <div class="col-sm-6">\n                    <form ng-submit="login()">\n                        <h2>Login <small>to you CtrlV account.</small></h2>\n\n                        <div class="form-group" ng-class="{\'has-error\': loginData.errors.username}">\n                            <label class="control-label"><i class="typ typ-user"></i> Username\n                                <input class="form-control" type="text" ng-model="loginData.username" name="username" />\n                            </label>\n\n                            <span ng-if="loginData.errors.username" class="help-block">{{ loginData.errors.username.join(\' \') }}</span>\n\n                        </div>\n\n                        <div class="form-group" ng-class="{\'has-error\': loginData.errors.password}">\n                            <label class="control-label"><i class="typ typ-key"></i> Password\n                                <input class="form-control" type="password" ng-model="loginData.password" name="password" />\n                            </label>\n\n                            <span ng-if="loginData.errors.password" class="help-block">{{ loginData.errors.password.join(\' \') }}</span>\n                        </div>\n\n                        <div class="form-group">\n                            <label>\n                                <a href="#" ng-click="forgot()"><i class="typ typ-warning-outline"></i> Forgot you password?</a>\n                            </label>\n                        </div>\n\n                        <div class="form-group">\n                            <label>\n                                <a href="#" ng-click="fb()"><i class="typ typ-social-facebook"></i> Used to login with Facebook?</a>\n                            </label>\n                        </div>\n\n                        <div ng-if="loginData.errors.general" class="form-group has-error">\n                            <span class="help-block"><i class="typ typ-warning"></i> {{ loginData.errors.general }}</span>\n                        </div>\n\n                        <button class="btn btn-block">\n                            <i class="spinner-loading dark" ng-show="loginData.loading"></i>\n                            <span ng-hide="loginData.loading">Login</span>\n                        </button>\n                    </form>\n                </div>\n\n                <div class="col-sm-6">\n                    <form ng-submit="signup()">\n                        <h2>Create <small>a new CtrlV account.</small></h2>\n\n                        <div class="form-group" ng-class="{\'has-error\': signupData.errors.username}">\n                            <label class="control-label"><i class="typ typ-user"></i> Username\n                                <input class="form-control" type="text" ng-model="signupData.username" name="username" />\n                            </label>\n\n                            <span ng-if="signupData.errors.username" class="help-block">{{ signupData.errors.username.join(\' \') }}</span>\n                        </div>\n\n                        <div class="form-group" ng-class="{\'has-error\': signupData.errors.username}">\n                            <label class="control-label"><i class="typ typ-key"></i> Password\n                                <input class="form-control" type="password" ng-model="signupData.password" name="password" />\n                            </label>\n\n                            <span ng-if="signupData.errors.password" class="help-block">{{ signupData.errors.password.join(\' \') }}</span>\n                        </div>\n\n                        <div class="form-group" ng-class="{\'has-error\': signupData.errors.email}">\n                            <label class="control-label"><i class="typ typ-mail"></i> Email Address\n                                <input class="form-control" type="email" ng-model="signupData.email" name="email" />\n                            </label>\n\n                            <span ng-if="signupData.errors.email" class="help-block">{{ signupData.errors.email.join(\' \') }}</span>\n                        </div>\n\n                        <div ng-if="signupData.errors.general" class="form-group has-error">\n                            <span class="help-block"><i class="typ typ-warning"></i> {{ signupData.errors.general }}</span>\n                        </div>\n\n                        <button class="btn btn-block">\n                            <i class="spinner-loading dark" ng-show="signupData.loading"></i>\n                            <span ng-hide="signupData.loading">Signup</span>\n                        </button>\n                    </form>\n                </div>\n\n            </div>\n        </div>\n    </div>\n</div>\n'),$templateCache.put("views/partials/footer.html",'<footer>\n\n    <!--<div style="float:left;">\n        View:\n        <a class="btn" href="#">Grid (Classic)</a>\n        <a class="btn" href="#">Columns</a>\n    </div>-->\n\n    <ul class="links">\n        <li>Created by <a href="https://themediadudes.com">The Media Dudes</a></li>\n        <li><a href="https://api.ctrlv.in/docs"><i class="typ typ-flow-switch"></i> API</a></li>\n        <li><a href="mailto:help@ctrlv.in"><i class="typ typ-mail"></i> Contact Us</a></li>\n        <li><a href="https://github.com/antriver/ctrlv-frontend"><i class="typ typ-social-github"></i> GitHub</a></li>\n        <li><a ui-sref="help"><i class="typ typ-info-large-outline"></i> Help</a></li>\n        <li><a ui-sref="privacy"><i class="typ typ-lock-closed-outline"></i> Privacy</a></li>\n        <li><a ui-sref="terms"><i class="typ typ-sort-alphabetically-outline"></i> Terms of Use</a></li>\n    </ul>\n</footer>\n'),$templateCache.put("views/partials/header.html",'<header class="clearfix">\n    <a ui-sref="home" id="logo-container">\n        <img src="/assets/img/ctrlv.svg" id="logo" />\n    </a>\n\n    <h1 id="page-title" ng-bind-html="title" ng-class="{\'with-subtitle\': subtitle}"></h1>\n    <h3 id="page-subtitle" ng-bind-html="subtitle"></h3>\n\n    <div  id="current-user">\n        <div ng-if="user === false">\n            <a id="login-btn" class="btn" href="#" ng-click="login()"><i class="typ typ-user"></i> Login or Signup</a>\n        </div>\n        <div ng-if="user">\n            <h2>Hi <a ui-sref="user({ username: user.username.toLowerCase() })" ng-bind="user.username"></a></h2>\n            <ul class="links">\n                <li><a ui-sref="user-favourites({ username: user.username.toLowerCase() })"><i class="typ typ-heart-full-outline"></i> Favourites</a></li>\n                <li><a ui-sref="settings"><i class="typ typ-spanner"></i> Options</a></li>\n                <li><a href="#" ng-click="logout()"><i class="typ typ-lock-open"></i> Logout</a></li>\n            </ul>\n        </div>\n    </div>\n</header>\n'),$templateCache.put("views/partials/image-list.html",'<ul ng-if="images.length > 0" class="img-grid">\n    <li ng-repeat="image in images">\n        <a\n            ui-sref="image({ imageId: image.imageId })"\n            ng-style="{\'background-image\': image.thumbnail ? \'\' : \'url(\'+ image.image.url + \')\'}"\n            >\n            <img ng-if="image.thumbnail" class="img-thumb" ng-src="{{ image.thumbnail.url }}" />\n        </a>\n    </li>\n</ul>\n\n{{ currentPage }} / {{ totalPages }}\n\n<paginator total-pages="totalPages" current-page="currentPage"></paginator>\n'),$templateCache.put("views/partials/paginator.html",'<ul class="sidebar paginator">\n{{ currentPage }} / {{ totalPages }}\n    <li><a href="#" ng-bind="page">{{ currentPage }}</a></li>\n    <li><a href="2">2</a></li>\n    <li><a href="3">3</a></li>\n    <li><a href="4">4</a></li>\n    <li><a href="5">5</a></li>\n</ul>\n'),$templateCache.put("views/user.html",'<ng-include src="\'views/partials/image-list.html\'"></ng-include>\n\n<div class="album-sidebar" ng-if="albums.length > 0">\n    <ul>\n        <li>Albums</li>\n        <li ng-repeat="album in albums" ng-class="{active: albumId == albums.albumId}">\n            <a ui-sref="image({ imageId: albumImage.imageId, albumId: albumId })">{{ album.title }}</a>\n        </li>\n    </ul>\n</div>\n')}]),app.controller("HeaderController",function($scope,$rootScope,ModalService,AuthService){$scope.login=function(){ModalService.showModal({templateUrl:"views/modals/login.html",controller:"LoginModalController"}).then(function(modal){modal.close.then(function(result){$scope.message=result?"You said Yes":"You said No"})})},$scope.logout=function(){AuthService.logout()},$scope.signup=function(){alert("signup")}}),app.controller("HomeController",function($scope,$rootScope,$timeout){$rootScope.title="",$rootScope.subtitle="";for(var sprites=[],i=0;20>i;i++)sprites.push('<span class="homesprite homesprite-'+i+'"></span>');sprites.shuffle(),$scope.sprites=sprites.join(""),$scope.mac="MacIntel"===navigator.platform,$timeout(function(){$scope.test=!0},1e3)}),app.controller("ImageController",function($scope,$rootScope,$state,$stateParams,$compile,AuthService,ImageResource,AlbumResource,ModalService){$scope.albumId=null,$scope.albumImages=[],$scope.image=null,$scope.imageId=$stateParams.imageId,$scope.editing=!1,$rootScope.loading=!0,$rootScope.title="",$rootScope.subtitle="",$scope.init=function(){$stateParams.albumId&&$scope.loadAlbumImages($stateParams.albumId),ImageResource.get({imageId:$stateParams.imageId},function(response){$scope.image=response.image,$rootScope.loading=!1;var title="";title=$scope.image.title?$scope.image.title:"Image #"+$scope.image.imageId,$rootScope.title=title;var subtitle="<span>";$scope.image.userId&&(subtitle+='<i class="typ typ-user"></i> By <a ui-sref="user({username: image.user.username.toLowerCase()})">'+$scope.image.user.username+"</a>"),subtitle+='<i class="typ typ-time"></i> <span title="'+moment($scope.image.createdAt).format("dddd, MMMM Do YYYY, h:mm:ss a")+'">'+moment($scope.image.createdAt).fromNow()+"</span>",$scope.image.album&&(subtitle+='<i class="typ typ-folder-open"></i> In <a ui-sref="album({albumId: image.album.albumId})">'+$scope.image.album.title+"</a>"),subtitle+="</span>",console.log($compile(subtitle)($scope)),$rootScope.subtitle=$compile(subtitle)($scope)[0].innerHTML,$scope.image.albumId&&$scope.image.albumId!==$scope.albumId&&$scope.loadAlbumImages($scope.image.albumId)})},$scope.loadAlbumImages=function(albumId){$scope.albumId=albumId,AlbumResource.getImages({albumId:albumId},function(images){$scope.albumImages=images})},$scope.showTextDialog=function(){ModalService.showModal({templateUrl:"views/modals/image-text.html",controller:function($scope,close,image){$scope.image=image,$scope.text=ImageResource.getText({imageId:image.imageId}),$scope.close=close},inputs:{image:$scope.image}})},$scope.showEmbedDialog=function(){ModalService.showModal({templateUrl:"views/modals/image-embed.html",controller:function($scope,close,image){$scope.image=image,$scope.close=close},inputs:{image:$scope.image}})},$scope.shareOnFb=function(){var url="https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent($scope.image.url);window.open(url)},$scope.shareOnTwitter=function(){var url="https://twitter.com/home?status="+encodeURIComponent($scope.image.url);window.open(url)},$scope.annotate=function(){},$scope.cropCoords=null,$scope.cropping=!1,$scope.savingCrop=!1,$scope.jcrop=null,$scope.crop=function(){return $scope.editing?!1:($scope.cropping=!0,void($scope.jcrop=$.Jcrop("#img",{onChange:function(c){console.log(c),$scope.cropCoords=c}})))},$scope.saveCrop=function(){var scale=$scope.getImageScale(),params={imageId:$scope.imageId,width:Math.round($scope.cropCoords.w/scale),height:Math.round($scope.cropCoords.h/scale),x:Math.round($scope.cropCoords.x/scale),y:Math.round($scope.cropCoords.y/scale)};$scope.savingCrop=!0,ImageResource.crop(params,function(response){$scope.exitCrop(),$scope.image=response.image},function(response){$scope.savingCrop=!1,alert(response.data.message)})},$scope.exitCrop=function(){$scope.jcrop.destroy(),$scope.cropCoords=null,$scope.cropping=!1,$scope.jcrop=null,$scope.savingCrop=!1,$("#img").css({width:"",height:""})},$scope.rotate=function(){return $scope.editing?!1:($scope.editing=!0,$scope.rotating=!0,void ImageResource.rotate({imageId:$scope.image.imageId},function(response){$scope.editing=!1,$scope.rotating=!1,$scope.image=response.image},function(response){$scope.editing=!1,$scope.rotating=!1,alert(response.data.message)}))},$scope.revert=function(){return $scope.editing?!1:confirm("This will undo and cropping and remove any annotation. Are you sure you want to do this?")?($scope.editing=!0,$scope.reverting=!0,void ImageResource.revert({imageId:$scope.image.imageId},function(response){$scope.editing=!1,$scope.reverting=!1,$scope.image=response.image},function(response){$scope.editing=!1,$scope.reverting=!1,alert(response.data.message)})):!1},$scope.showPrivacyDialog=function(){ModalService.showModal({templateUrl:"views/modals/image-privacy.html",controller:function($scope,close,image){$scope.image=image,$scope.close=close,$scope.setAnon=function(anon){ImageResource.update({imageId:$scope.image.imageId},{anonymous:anon},function(res){console.log(res),$scope.image=res.image,$scope.$parent.image=res.image})},$scope.setPassword=function(){}},inputs:{image:$scope.image}})},$scope["delete"]=function(){return $scope.editing?!1:confirm("Are you sure you want to delete this image?")?($scope.editing=!0,$scope.deleting=!0,void ImageResource["delete"]({imageId:$scope.image.imageId},function(){$scope.editing=!1,$scope.deleting=!1,$scope.image=null},function(response){$scope.editing=!1,$scope.deleting=!1,alert(response.data.message)})):!1},$scope.showReportDialog=function(){},$scope.getImageScale=function(){return parseInt($("#img").width())/$scope.image.image.width},$scope.init()}),app.controller("LoginModalController",function($scope,close,AuthService,UserResource){$scope.loginData={loading:!1,username:"",password:"",errors:{}},$scope.signupData={loading:!1,username:"",password:"",email:"",errors:{}},$scope.fb=function(){alert(":(")},$scope.forgot=function(){alert("lol")},$scope.login=function(){return $scope.loginData.loading?!1:($scope.loginData.errors={},$scope.loginData.loading=!0,void AuthService.login($scope.loginData.username,$scope.loginData.password).then(function(response){$scope.loginData.loading=!1,close()},function(response){$scope.loginData.loading=!1,response.messages&&(response.messages.hasOwnProperty("username")||response.messages.hasOwnProperty("password"))?$scope.loginData.errors=response.messages:$scope.loginData.errors={general:response.message}}))},$scope.signup=function(){return $scope.signupData.loading?!1:($scope.signupData.errors={},$scope.signupData.loading=!0,void UserResource.save({username:$scope.signupData.username,password:$scope.signupData.password,email:$scope.signupData.email},function(response){AuthService.login($scope.signupData.username,$scope.signupData.password).then(function(response){$scope.signupData.loading=!1,close()},function(response){$scope.signupData.loading=!1,$scope.signupData.errors={general:response.message}})},function(response){$scope.signupData.loading=!1,response=response.data,response.messages&&(response.messages.hasOwnProperty("username")||response.messages.hasOwnProperty("password")||response.messages.hasOwnProperty("email"))?$scope.signupData.errors=response.messages:$scope.signupData.errors={general:response.message}}))},$scope.close=close}),app.controller("UserController",function($scope,$rootScope,$state,$stateParams,AuthService,UserResource){return $scope.images=[],$rootScope.loading=!0,$scope.username=$stateParams.username,1===$stateParams.page?void $state.go("user",{username:$scope.username}):($scope.currentPage=$stateParams.page?$stateParams.page:1,$scope.totalPages=0,$rootScope.title="",$rootScope.subtitle="",UserResource.get({username:$scope.username},function(user){$rootScope.title='<i class="typ typ-image"></i> '+user.username+"'s Images",$rootScope.user&&$rootScope.user.userId===user.userId&&UserResource.getAlbums({username:$scope.username},function(albums){$scope.albums=albums})}),void UserResource.getImages({username:$scope.username,page:$scope.currentPage},function(data){$rootScope.loading=!1,$scope.images=data.images,$scope.totalPages=data.lastPage,console.log(data)}))}),app.directive("paginator",function(){return{restrict:"E",controller:function($scope){console.log("$scope",$scope)},scope:{currentPage:"=",totalPages:"="},templateUrl:"views/partials/paginator.html"}}),function(){app.directive("stateBodyClass",function($rootScope){return{restrict:"A",scope:{},link:function(scope,elem,attr,ctrl){$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){var fromClassnames=angular.isDefined(fromState.data)&&angular.isDefined(fromState.data.bodyClass)?fromState.data.bodyClass:null,toClassnames=angular.isDefined(toState.data)&&angular.isDefined(toState.data.bodyClass)?toState.data.bodyClass:null;fromClassnames!=toClassnames&&(fromClassnames&&elem.removeClass(fromClassnames),toClassnames&&elem.addClass(toClassnames))})}}})}(),Array.prototype.shuffle=function(){var j,temp,i=this.length;if(0===i)return this;for(;--i;)j=Math.floor(Math.random()*(i+1)),temp=this[i],this[i]=this[j],this[j]=temp;return this};var Doodle=function(element){this.element=element,this.canvas=null,this.lineThickness=8,this.color="#000000",this.drawing=!1,this.history=[];var ua=navigator.userAgent.toLowerCase();this.isAndroid=ua.indexOf("android")>-1};Doodle.prototype={init:function(){this.canvas=document.createElement("canvas"),this.element.appendChild(this.canvas),this.canvas.setAttribute("width",$(this.element).width()),this.canvas.setAttribute("height",$(this.element).height()),this.context=this.canvas.getContext("2d"),this.color="#000000",$("#currentColour").css("background-color",this.color),this.clear();var self=this;this.isAndroid||($(this.canvas).bind("mousedown",function(e){self.drawStart(e)}),$(this.canvas).bind("mousemove",function(e){self.draw(e)}),$(this.canvas).bind("mouseup",function(e){self.drawEnd(e)}),$("body").bind("mouseup",function(e){self.drawEnd(e)})),$(this.canvas).bind("touchstart",function(e){self.drawStart(e)}),$(this.canvas).bind("touchmove",function(e){self.draw(e)}),$(this.canvas).bind("touchend",function(e){self.drawEnd(e)})},clear:function(e){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=this.color,this.history=[]},getImage:function(e){return this.history.length<1?!1:this.canvas.toDataURL("image/png")},saveHistoryState:function(){for(;this.history.length>=30;)this.history.shift();this.history.push(this.context.getImageData(0,0,this.canvas.width,this.canvas.height))},undo:function(){this.history.length>0?(this.context.putImageData(this.history[this.history.length-1],0,0),this.history.pop()):alert("Nothing to undo!")},drawStart:function(e){e&&e.preventDefault(),this.saveHistoryState();var x,y;e.originalEvent.touches?(x=e.originalEvent.touches[0].pageX-$(this.canvas).offset().left,y=e.originalEvent.touches[0].pageY-$(this.canvas).offset().top):(x=e.pageX-$(this.canvas).offset().left,y=e.pageY-$(this.canvas).offset().top),this.drawing=!0,$(this.canvas).addClass("drawing"),this.context.lineWidth=this.lineThickness,this.context.lineCap="round",this.context.lineJoin="round",this.context.strokeStyle=this.color,this.context.fillStyle=this.color,this.oldX=x,this.oldY=y,this.context.beginPath(),this.context.arc(x,y,this.lineThickness/2,0,2*Math.PI,!1),this.context.closePath(),this.context.fill(),this.context.beginPath()},draw:function(e){e&&e.preventDefault();var x,y;e.originalEvent.touches?(x=e.originalEvent.touches[0].pageX-$(this.canvas).offset().left,y=e.originalEvent.touches[0].pageY-$(this.canvas).offset().top):(x=e.pageX-$(this.canvas).offset().left,y=e.pageY-$(this.canvas).offset().top),this.drawing&&(this.context.moveTo(this.oldX,this.oldY),this.context.lineTo(x,y),this.context.stroke()),this.oldX=x,this.oldY=y},drawEnd:function(e){e&&e.preventDefault(),this.drawing&&(this.context.closePath(),this.context.stroke(),this.drawing=!1),$(this.canvas).removeClass("drawing")},rgbToHex:function(rgb){function hex(x){return isNaN(x)?"00":hexDigits[(x-x%16)/16]+hexDigits[x%16]}var hexDigits=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f");return rgb=rgb.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),"#"+hex(rgb[1])+hex(rgb[2])+hex(rgb[3])}};var ImagePaster=function(){var ImagePaster=function(url){console.log("ImagePaster",url),
this.debug=!0,this.url=url,this.pasteCatcher=null,this.init()};return ImagePaster.prototype.log=function(data,extra){this.debug&&console.log(data,extra)},ImagePaster.prototype.init=function(){var self=this;self.pasteCatcher=document.createElement("div"),self.pasteCatcher.setAttribute("contenteditable",""),self.pasteCatcher.setAttribute("style","position:absolute; opacity:0; top:0; left:0; width:0; height:0;"),self.pasteCatcher.id="paste-catcher",document.body.appendChild(self.pasteCatcher),self.pasteCatcher.focus(),document.addEventListener("paste",function(event){self.onPaste(event)}),$(document).on("keydown",function(e){86===e.which&&(e.ctrlKey||e.metaKey)&&$(document).trigger("ctrlVPressed")}),$(document).on("ctrlVPressed",function(){self.pasteCatcher.focus()})},ImagePaster.prototype.onPaste=function(event){var clipboardData,self=this,done=!1;if(self.log("onPaste",JSON.stringify(event)),event.clipboardData?clipboardData=event.clipboardData:window.clipboardData&&(clipboardData=window.clipboardData),event.msConvertURL){var fileList=clipboardData.files;if(fileList.length>0)for(var i=0;i<fileList.length;i++)self.uploadBlob(fileList[i]),done=!0}if(clipboardData&&clipboardData.items){var text;if(text=clipboardData.getData("text/plain"))return self.uploadText(text),void self.clearPasteCatcher();for(var x=0;x<clipboardData.items.length;x++)-1!==clipboardData.items[x].type.indexOf("image")&&(self.uploadBlob(clipboardData.items[x].getAsFile()),done=!0)}done?self.clearPasteCatcher():setTimeout(function(){self.checkPasteCatcher()},10)},ImagePaster.prototype.checkPasteCatcher=function(){var text=this.pasteCatcher.innerHTML,child=this.pasteCatcher.childNodes[0];if(child)if("IMG"===child.tagName){if(-1!=child.src.indexOf("webkit-fake-url://"))return this.onFail("Sorry, Safari does not currently support pasting images."),!1;this.uploadImage(child.src)}else"A"===child.tagName?this.uploadText(child.href):this.uploadText(text);this.clearPasteCatcher()},ImagePaster.prototype.clearPasteCatcher=function(){var self=this;setTimeout(function(){self.pasteCatcher.innerHTML=""},1)},ImagePaster.prototype.uploadBlob=function(blob){if(blob){var self=this,reader=new FileReader;reader.onload=function(evt){self.uploadImage(evt.target.result)},reader.readAsDataURL(blob)}},ImagePaster.prototype.uploadText=function(text){return console.log("uploadText",text),this.upload("text",text)},ImagePaster.prototype.uploadImage=function(base64){return this.upload("uploadImage",base64)},ImagePaster.prototype.upload=function(format,data){var self=this;$(document).trigger("ctrlvuploadstart");var url=this.url;"function"==typeof url&&(url=url()),$.ajax({url:url,timeout:9e4,type:"POST",data:{format:format,base64:data},error:function(jqXHR,textStatus){var message;switch(textStatus){case"timeout":message="The image took too long to upload";break;case"error":message=jqXHR.responseJSON&&jqXHR.responseJSON.message?"CtrlV server error ("+jqXHR.responseJSON.errorType+" "+jqXHR.responseJSON.message+")":0!==jqXHR.status?"CtrlV server error ("+jqXHR.status+" "+jqXHR.statusText+")":"Can't connect to the CtrlV server";break;case"abort":message="The upload was cancelled";break;case"parsererror":message="Error uploading: couldn't decode the response from the server";break;default:message=textStatus}self.onFail(message)},success:function(res){res.image?$(document).trigger({type:"ctrlvuploadcomplete",image:res.image}):self.onFail(res.message)}})},ImagePaster.prototype.onFail=function(message){$(document).trigger({type:"ctrlvuploaderror",message:message?message:!1})},ImagePaster.prototype.validateURL=function(text){var regex=new RegExp("^(http|https|ftp)://([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&amp;%$-]+)*@)*((25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]).(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0).(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0).(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])|([a-zA-Z0-9-]+.)*[a-zA-Z0-9-]+.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(/($|[a-zA-Z0-9.,?'\\+&amp;%$#=~_-]+))*$");return regex.test(text)},ImagePaster}();app.factory("AlbumResource",function($resource,AuthService){return $resource(apiUrl+"albums/:albumId",{albumId:"@albumId",sessionKey:function(){return AuthService.getSessionKey()||null}},{get:{cache:!0,transformResponse:function(data){return data=angular.fromJson(data),data.image}},getImages:{cache:!0,url:apiUrl+"albums/:albumId/images",isArray:!0,transformResponse:function(data){var data=angular.fromJson(data);return data.images}}})}),app.factory("ImageResource",function($resource,AuthService){return $resource(apiUrl+"images/:imageId",{imageId:"@imageId",sessionKey:function(){return AuthService.getSessionKey()||null}},{get:{cache:!0},update:{method:"PUT"},revert:{url:apiUrl+"images/:imageId/image",method:"PUT",params:{action:"revert"}},rotate:{url:apiUrl+"images/:imageId/image",method:"PUT",params:{action:"rotate",degrees:90}},crop:{url:apiUrl+"images/:imageId/crop",method:"POST"},getText:{url:apiUrl+"images/:imageId/text",method:"GET"}})}),app.factory("SessionResource",function($resource){return $resource(apiUrl+"sessions/:sessionKey",{},{get:{transformResponse:function(data){return data=angular.fromJson(data),data.session}}})}),app.factory("UserResource",function($resource,AuthService){return $resource(apiUrl+"users/:username",{username:"@username",sessionKey:function(){return AuthService.getSessionKey()||null}},{get:{cache:!0,transformResponse:function(data){var data=angular.fromJson(data);return data.user}},save:{method:"POST",url:apiUrl+"users"},getImages:{cache:!0,url:apiUrl+"users/:username/images?page=:page"},getAlbums:{cache:!0,url:apiUrl+"users/:username/albums"}})}),app.service("AuthService",function(localStorageService,SessionResource,$q,$rootScope){var session=null,sessionKey=null;return{checkSession:function(){var self=this;(sessionKey=localStorageService.get("sessionKey"))?SessionResource.get({sessionKey:sessionKey},function(session){self.onLogin(session,sessionKey)},function(){self.onLogout()}):self.onLogout()},login:function(username,password){var self=this;return $q(function(resolve,reject){SessionResource.save({username:username,password:password},function(response){self.onLogin(response.session,response.sessionKey),resolve(response.session.user)},function(response){reject(response.data)})})},onLogin:function(newSession,newSessionKey){session=newSession,sessionKey=newSessionKey,localStorageService.set("sessionKey",newSessionKey),$rootScope.$broadcast("login",{user:newSession.user})},logout:function(){var self=this;SessionResource["delete"]({sessionKey:sessionKey}),self.onLogout()},onLogout:function(){session=!1,sessionKey=!1,localStorageService.remove("sessionKey"),$rootScope.$broadcast("logout")},getSessionKey:function(){return sessionKey},getUser:function(){return null===session?null:session&&session.user?session.user:!1}}}),app.service("ImagePasterService",function($state,AuthService){$(document).on("ctrlvuploadstart",function(){$(".upload-status").addClass("out"),$("#upload-loading").removeClass("out")}),$(document).on("ctrlvuploadcomplete",function(e){$(".upload-status").addClass("out"),$("#upload-complete").removeClass("out");var viewUrl=e.image.url,imageUrl=e.image.image.url;$("#view-btn").attr("href",viewUrl),$("#uploader").css("background-image","url("+imageUrl+")"),$state.go("image",{imageId:e.image.imageId})}),$(document).on("ctrlvuploaderror",function(e){$(".upload-status").addClass("out"),$("#upload-error").removeClass("out").find("p").text(e.message)}),$(document).on("keyup",function(e){91==e.which||224===e.which?$(".btn-cmd").removeClass("active"):17==e.which?$(".btn-ctrl").removeClass("active"):86==e.which&&$(".btn-v").removeClass("active")}),$(document).on("keydown",function(e){91==e.which||224===e.which?$(".btn-cmd").addClass("active"):17==e.which?$(".btn-ctrl").addClass("active"):86==e.which&&$(".btn-v").addClass("active")});var getImageUploadUrl=function(){var sessionKey,url=apiUrl+"images";return(sessionKey=AuthService.getSessionKey())&&(url+="?sessionKey="+sessionKey),url};return new ImagePaster(getImageUploadUrl)});
//# sourceMappingURL=ctrlv.min.js.map