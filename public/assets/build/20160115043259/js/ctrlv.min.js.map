{"version":3,"sources":["../../../../../src/js/app.js","../../../../../src/js/templates.js","../../../../../src/js/controllers/HeaderController.js","../../../../../src/js/controllers/HomeController.js","../../../../../src/js/controllers/ImageController.js","../../../../../src/js/controllers/ImageListController.js","../../../../../src/js/controllers/LoginModalController.js","../../../../../src/js/directives/annotator.js","../../../../../src/js/directives/paginator.js","../../../../../src/js/directives/stateBodyClass.js","../../../../../src/js/libraries/ArrayPrototype.js","../../../../../src/js/libraries/Doodle.js","../../../../../src/js/libraries/ImagePaster.js","../../../../../src/js/resources/AlbumResource.js","../../../../../src/js/resources/ImageResource.js","../../../../../src/js/resources/SessionResource.js","../../../../../src/js/resources/UserResource.js","../../../../../src/js/services/AuthService.js","../../../../../src/js/services/ImagePasterService.js"],"names":["app","angular","module","config","$httpProvider","$locationProvider","$stateProvider","$urlRouterProvider","localStorageServiceProvider","html5Mode","setPrefix","setStorageType","setStorageCookie","otherwise","state","url","templateUrl","controller","params","albumId","mode","run","$rootScope","$state","AuthService","ImagePasterService","checkSession","user","getUser","$on","event","args","ev","to","toParams","from","fromParams","$","attr","name","$templateCache","put","$scope","ModalService","login","showModal","then","modal","close","result","message","logout","signup","alert","$timeout","title","subtitle","sprites","i","push","shuffle","join","mac","navigator","platform","test","$element","$stateParams","$compile","ImageResource","AlbumResource","albumImages","image","imageId","editing","loading","init","loadAlbumImages","get","response","userId","username","moment","createdAt","format","fromNow","album","innerHTML","getImages","data","images","showTextDialog","text","getText","inputs","showEmbedDialog","shareOnFb","encodeURIComponent","window","open","shareOnTwitter","annotating","savingAnnotation","annotationColorVisible","annotationSizeVisible","annotationColors","annotationSizes","doodle","annotate","element","document","createElement","setAttribute","annotator","append","showAnnotationColor","setAnnotationColor","color","showAnnotationSize","setAnnotationSize","px","lineThickness","saveAnnotation","annotation","getImage","base64","exitAnnotation","undoAnnotation","undo","restartAnnotation","clear","remove","cropCoords","cropping","savingCrop","jcrop","crop","Jcrop","onChange","c","saveCrop","scale","getImageScale","width","Math","round","w","height","h","x","y","exitCrop","destroy","css","rotate","rotating","revert","confirm","reverting","showPrivacyDialog","setAnon","anon","update","anonymous","res","$parent","setPassword","deleting","showReportDialog","parseInt","UserResource","loadAlbum","console","log","albums","loadUser","loadImages","page","imagesLoadedCallback","totalPages","lastPage","currentPage","go","changeAlbum","$event","stopPropagation","preventDefault","notify","changeUser","changePage","loginData","password","errors","signupData","email","fb","forgot","messages","hasOwnProperty","general","save","directive","$window","debounce","restrict","imageEl","Doodle","moveAndResize","imgOffset","offset","left","top","canvas","debouncedRedraw","redraw","bind","scope","template","calculatePages","pages","paginatorHeight","spaceHeight","totalSpaces","floor","adjacent","$watchGroup","debouncedCalculatePages","link","elem","ctrl","toState","fromState","fromClassnames","isDefined","bodyClass","toClassnames","removeClass","addClass","Array","prototype","j","temp","this","length","random","drawing","history","currentData","ua","userAgent","toLowerCase","isAndroid","indexOf","appendChild","context","getContext","self","e","drawStart","draw","drawEnd","clearRect","fillStyle","toDataURL","saveHistoryState","shift","getImageData","saveCurrentData","imageData","pop","putImageData","newCanvas","drawImage","originalEvent","touches","pageX","pageY","lineWidth","lineCap","lineJoin","strokeStyle","oldX","oldY","beginPath","arc","PI","closePath","fill","moveTo","lineTo","stroke","rgbToHex","rgb","hex","isNaN","hexDigits","match","ImagePaster","debug","pasteCatcher","extra","id","body","focus","addEventListener","onPaste","on","which","ctrlKey","metaKey","trigger","clipboardData","done","JSON","stringify","msConvertURL","fileList","files","uploadBlob","items","getData","uploadText","clearPasteCatcher","type","getAsFile","setTimeout","checkPasteCatcher","child","childNodes","tagName","src","onFail","uploadImage","href","blob","reader","FileReader","onload","evt","target","readAsDataURL","upload","ajax","timeout","error","jqXHR","textStatus","responseJSON","errorType","status","statusText","success","validateURL","regex","RegExp","factory","$resource","apiUrl","sessionKey","getSessionKey","cache","transformResponse","fromJson","method","action","degrees","session","getAlbums","service","localStorageService","SessionResource","$q","onLogin","onLogout","resolve","reject","newSession","newSessionKey","set","$broadcast","viewUrl","imageUrl","find","getImageUploadUrl"],"mappings":"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","file":"ctrlv.min.js","sourcesContent":["\"use strict\";\n\n// Initialize angular\n\nvar app = angular.module('ctrlv', [\n    'ui.router',\n    'ngResource',\n    'ngSanitize',\n    'LocalStorageModule',\n    'angularModalService',\n    'ngAnimate',\n    'rt.debounce'\n]);\n\n/**\n * Angular\n */\n\n// Routes\napp.config(function($httpProvider, $locationProvider, $stateProvider, $urlRouterProvider, localStorageServiceProvider) {\n\n    /*$httpProvider.defaults.headers.common = {\n        'RemoteUser': 'billybob'\n    };*/\n\n    $locationProvider.html5Mode(true);\n\n    localStorageServiceProvider\n        .setPrefix('ctrlv')\n        .setStorageType('localStorage')\n        .setStorageCookie(0, '/');\n\n    // For any unmatched url, redirect to /\n    $urlRouterProvider.otherwise('/');\n\n    // Now set up the states\n    $stateProvider\n        .state('home', {\n            url: \"/\",\n            templateUrl: \"views/home.html\",\n            controller: 'HomeController'\n        })\n        .state('help', {\n            url: \"/help\",\n            templateUrl: \"views/help.html\",\n            controller: 'HelpController'\n        })\n        .state('image', {\n            url: \"/{imageId:int}\",\n            templateUrl: \"views/image.html\",\n            controller: 'ImageController',\n            params: {\n                albumId: null\n            },\n        })\n        .state('user', {\n            url: \"/user/{username:string}\",\n            templateUrl: \"views/image-list.html\",\n            controller: 'ImageListController',\n            params: {\n                mode: 'user'\n            },\n        })\n        .state('user-page', {\n            url: \"/user/{username:string}/{page:int}\",\n            templateUrl: \"views/image-list.html\",\n            controller: 'ImageListController',\n            params: {\n                mode: 'user'\n            }\n        })\n\n        .state('album', {\n            url: \"/album/{albumId:int}\",\n            templateUrl: \"views/image-list.html\",\n            controller: 'ImageListController',\n            params: {\n                mode: 'album'\n            }\n\n        })\n        .state('album-page', {\n            url: \"/album/{albumId:int}/{page:int}\",\n            templateUrl: \"views/image-list.html\",\n            controller: 'ImageListController',\n            params: {\n                mode: 'album'\n            }\n        });\n});\n\napp.run(function($rootScope, $state, AuthService, ImagePasterService) {\n    // ImagePasterService is injected here so it gets initialized\n\n\n    //$httpProvider.defaults.headers.post[\"Content-Type\"] = \"text/plain\";\n\n    $rootScope.$state = $state;\n\n\n    AuthService.checkSession();\n\n    $rootScope.user = AuthService.getUser();\n\n    $rootScope.$on('login', function(event, args) {\n        $rootScope.user = args.user;\n    });\n\n    $rootScope.$on('logout', function() {\n        $rootScope.user = false;\n    });\n\n    $rootScope.$on('$stateChangeSuccess', function (ev, to, toParams, from, fromParams) {\n        $('body').attr('data-previous', from.name);\n    });\n});\n\n","angular.module('ctrlv').run(['$templateCache', function($templateCache) {\n  'use strict';\n\n  $templateCache.put('views/album.html',\n    \"<ng-include src=\\\"'views/partials/image-list.html'\\\"></ng-include>\\n\" +\n    \"\\n\" +\n    \"<ng-include src=\\\"'views/partials/albums-sidebar.html'\\\"></ng-include>\\n\"\n  );\n\n\n  $templateCache.put('views/home.html',\n    \"<div id=\\\"uploader\\\">\\n\" +\n    \"\\n\" +\n    \"    <div id=\\\"uploader-collage\\\" ng-bind-html=\\\"sprites\\\"></div>\\n\" +\n    \"\\n\" +\n    \"    <div class=\\\"upload-status\\\" id=\\\"upload-waiting\\\">\\n\" +\n    \"        <h2>The <span class=\\\"green\\\">easiest</span> way to share photos.</h2>\\n\" +\n    \"        <h3>\\n\" +\n    \"            <span style=\\\"float:right;\\\">\\n\" +\n    \"                You can also\\n\" +\n    \"                <a href=\\\"#\\\" class=\\\"btn\\\"><i class=\\\"typ typ-cloud-storage\\\"></i> Upload Images</a>\\n\" +\n    \"                or\\n\" +\n    \"                <a href=\\\"#\\\" class=\\\"btn\\\"><i class=\\\"typ typ-camera\\\"></i> Take a Photo</a>\\n\" +\n    \"            </span>\\n\" +\n    \"\\n\" +\n    \"            <i class=\\\"spinner-waiting\\\"></i>\\n\" +\n    \"            Press <span ng-if=\\\"mac\\\" class=\\\"btn btn-cmd\\\">cmd &#8984;</span><span ng-if=\\\"!mac\\\" class=\\\"btn btn-ctrl\\\">Ctrl</span>\\n\" +\n    \"            + <span class=\\\"btn btn-v\\\">V</span> to paste an image.\\n\" +\n    \"        </h3>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"    <div class=\\\"upload-status out\\\" id=\\\"upload-loading\\\">\\n\" +\n    \"        <h3><i class=\\\"spinner-loading\\\"></i> Uploading...</h3>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"    <div class=\\\"upload-status out\\\" id=\\\"upload-error\\\">\\n\" +\n    \"        <h3>Error</h3>\\n\" +\n    \"        <p></p>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"    <div class=\\\"upload-status out\\\" id=\\\"upload-complete\\\">\\n\" +\n    \"        <h3>Uploaded!</h3>\\n\" +\n    \"        <p>\\n\" +\n    \"            <label>\\n\" +\n    \"                Here's your link\\n\" +\n    \"                <input type=\\\"text\\\" id=\\\"newImageURL\\\" class=\\\"green\\\" readonly=\\\"readonly\\\" />\\n\" +\n    \"            </label>\\n\" +\n    \"        </p>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/image-list.html',\n    \"<ng-include src=\\\"'views/partials/albums-sidebar.html'\\\"></ng-include>\\n\" +\n    \"\\n\" +\n    \"<ul ng-if=\\\"images.length > 0\\\" class=\\\"img-grid\\\">\\n\" +\n    \"    <li ng-repeat=\\\"image in images\\\">\\n\" +\n    \"        <a\\n\" +\n    \"            ui-sref=\\\"image({ imageId: image.imageId })\\\"\\n\" +\n    \"            ng-style=\\\"{'background-image': image.thumbnail ? '' : 'url('+ image.image.url + ')'}\\\"\\n\" +\n    \"            >\\n\" +\n    \"            <img ng-if=\\\"image.thumbnail\\\" class=\\\"img-thumb\\\" ng-src=\\\"{{ image.thumbnail.url }}\\\" />\\n\" +\n    \"        </a>\\n\" +\n    \"    </li>\\n\" +\n    \"</ul>\\n\" +\n    \"\\n\" +\n    \"<paginator ng-hide=\\\"totalPages < 2\\\" class=\\\"sidebar sidebar-right\\\" total-pages=\\\"totalPages\\\" current-page=\\\"currentPage\\\" url=\\\"url\\\" change-page=\\\"changePage\\\"></paginator>\\n\"\n  );\n\n\n  $templateCache.put('views/image.html',\n    \"<div ng-if=\\\"image\\\" class=\\\"img-wrapper\\\">\\n\" +\n    \"    <img\\n\" +\n    \"        ng-if=\\\"!loading && image\\\"\\n\" +\n    \"        ng-src=\\\"{{ image.image.url }}\\\"\\n\" +\n    \"        class=\\\"img\\\"\\n\" +\n    \"        id=\\\"img\\\"\\n\" +\n    \"        />\\n\" +\n    \"</div>\\n\" +\n    \"\\n\" +\n    \"<div\\n\" +\n    \"    ng-if=\\\"!loading && image\\\"\\n\" +\n    \"    class=\\\"sidebar sidebar-left sidebar-float img-left-sidebar\\\"\\n\" +\n    \"    ng-class=\\\"{\\n\" +\n    \"        'editable': user && user.userId === image.userId,\\n\" +\n    \"        'cropping': cropping,\\n\" +\n    \"        'annotating': annotating,\\n\" +\n    \"        'revertable': image.hasOriginal\\n\" +\n    \"    }\\\"\\n\" +\n    \"    >\\n\" +\n    \"\\n\" +\n    \"    <div ng-if=\\\"annotating\\\">\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"saveAnnotation()\\\"><i class=\\\"typ typ-tick-outline\\\" ng-hide=\\\"savingAnnotation\\\"></i><i class=\\\"spinner-loading dark\\\" ng-show=\\\"savingAnnotation\\\"></i><span>Save Annotation</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" ng-class=\\\"{'active':annotationColorVisible}\\\" href=\\\"#\\\" ng-click=\\\"showAnnotationColor()\\\"><i class=\\\"typ typ-media-record\\\"></i><span>Pen Colour</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" ng-class=\\\"{'active':annotationSizeVisible}\\\" href=\\\"#\\\" ng-click=\\\"showAnnotationSize()\\\"><i class=\\\"typ typ-brush\\\"></i><span>Pen Size</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"undoAnnotation()\\\"><i class=\\\"typ typ-arrow-back\\\"></i><span>Undo</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"restartAnnotation()\\\"><i class=\\\"typ typ-trash\\\"></i><span>Start Over</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"exitAnnotation()\\\"><i class=\\\"typ typ-times\\\"></i><span>Cancel</span></a>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"    <div ng-if=\\\"cropping\\\">\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"saveCrop()\\\"><i class=\\\"typ typ-tick-outline\\\" ng-hide=\\\"savingCrop\\\"></i><i class=\\\"spinner-loading dark\\\" ng-show=\\\"savingCrop\\\"></i><span>Save Crop</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"exitCrop()\\\"><i class=\\\"typ typ-times\\\"></i><span>Cancel</span></a>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"    <div ng-hide=\\\"cropping || annotating\\\">\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"showTextDialog()\\\"><i class=\\\"typ typ-sort-alphabetically\\\"></i><span>Text Recognition</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"showEmbedDialog()\\\"><i class=\\\"typ typ-code\\\"></i><span>Embed</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"shareOnFb()\\\"><i class=\\\"typ typ-social-facebook\\\"></i><span>Share</span></a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"shareOnTwitter()\\\"><i class=\\\"typ typ-social-twitter\\\"></i><span>Tweet</span></a>\\n\" +\n    \"\\n\" +\n    \"        <hr/>\\n\" +\n    \"\\n\" +\n    \"        <div ng-if=\\\"user && user.userId === image.userId\\\">\\n\" +\n    \"            <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"annotate()\\\"><i class=\\\"typ typ-brush\\\"></i><span>Annotate</span></a>\\n\" +\n    \"            <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"crop()\\\"><i class=\\\"typ typ-scissors-outline\\\"></i><span>Crop</span></a>\\n\" +\n    \"            <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"rotate()\\\"><i class=\\\"typ typ-arrow-sync-outline\\\" ng-hide=\\\"rotating\\\"></i><i class=\\\"spinner-loading dark\\\" ng-show=\\\"rotating\\\"></i><span>Rotate</span></a>\\n\" +\n    \"            <a class=\\\"btn\\\" href=\\\"#\\\" ng-if=\\\"image.hasOriginal\\\" ng-click=\\\"revert()\\\"><i class=\\\"typ typ-arrow-back\\\" ng-hide=\\\"reverting\\\"></i><i class=\\\"spinner-loading dark\\\" ng-show=\\\"reverting\\\"></i><span>Revert To Original</span></a>\\n\" +\n    \"            <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"showPrivacyDialog()\\\"><i class=\\\"typ typ-lock-closed\\\"></i><span>Privacy</span></a>\\n\" +\n    \"            <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"delete()\\\"><i class=\\\"typ typ-trash\\\" ng-hide=\\\"deleting\\\"></i><i class=\\\"spinner-loading dark\\\" ng-show=\\\"deleting\\\"></i><span>Delete</span></a>\\n\" +\n    \"        </div>\\n\" +\n    \"        <div ng-if=\\\"!user || user.userId !== image.userId\\\">\\n\" +\n    \"            <a class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"showReportDialog()\\\"><i class=\\\"typ typ-flag\\\"></i><span>Report</span></a>\\n\" +\n    \"        </div>\\n\" +\n    \"    </div>\\n\" +\n    \"\\n\" +\n    \"</div>\\n\" +\n    \"<div ng-if=\\\"doodle\\\" ng-show=\\\"annotationColorVisible\\\" class=\\\"ng-hide img-submenu sidebar sidebar-left sidebar-float annotation-color\\\">\\n\" +\n    \"    <a class=\\\"btn\\\" ng-repeat=\\\"color in annotationColors\\\" ng-class=\\\"{'active':doodle.color === '#'+color}\\\" ng-click=\\\"setAnnotationColor(color)\\\"><i class=\\\"typ typ-media-record\\\" ng-style=\\\"{color: '#'+color}\\\"></i></a>\\n\" +\n    \"</div>\\n\" +\n    \"<div ng-if=\\\"doodle\\\" ng-show=\\\"annotationSizeVisible\\\" class=\\\"ng-hide img-submenu sidebar sidebar-left sidebar-float annotation-size\\\">\\n\" +\n    \"    <a class=\\\"btn\\\" ng-repeat=\\\"size in annotationSizes\\\" ng-class=\\\"{'active':doodle.lineThickness === size}\\\" href=\\\"#\\\" ng-click=\\\"setAnnotationSize(size)\\\"><i ng-style=\\\"{height:size+'px'}\\\"></i></a>\\n\" +\n    \"</div>\\n\" +\n    \"\\n\" +\n    \"<div class=\\\"sidebar sidebar-right img-right-sidebar sidebar-scrolling\\\" ng-if=\\\"albumImages.length > 0\\\">\\n\" +\n    \"    <div class=\\\"scroller\\\">\\n\" +\n    \"    <ul>\\n\" +\n    \"        <li>In This Album</li>\\n\" +\n    \"        <li ng-repeat=\\\"albumImage in albumImages\\\" ng-class=\\\"{active: imageId == albumImage.imageId}\\\">\\n\" +\n    \"            <a ui-sref=\\\"image({ imageId: albumImage.imageId, albumId: albumId })\\\"><img ng-src=\\\"{{ albumImage.thumbnail.url }}\\\" /></a>\\n\" +\n    \"        </li>\\n\" +\n    \"    </ul>\\n\" +\n    \"    </div>\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/modals/image-embed.html',\n    \"<div class=\\\"modal\\\" ng-click=\\\"close()\\\" id=\\\"image-embed-modal\\\">\\n\" +\n    \"    <div class=\\\"modal-content\\\" ng-click=\\\"$event.stopPropagation()\\\">\\n\" +\n    \"\\n\" +\n    \"        <h2><i class=\\\"typ typ-export\\\"></i> Link To <small>this image.</small></h2>\\n\" +\n    \"\\n\" +\n    \"        <div class=\\\"container-fluid\\\">\\n\" +\n    \"            <div class=\\\"row\\\">\\n\" +\n    \"                <div class=\\\"col-sm-6\\\">\\n\" +\n    \"\\n\" +\n    \"                    <div class=\\\"form-group\\\">\\n\" +\n    \"                        <h4>Markdown Link <small>e.g. for Reddit comments</small></h4>\\n\" +\n    \"                        <textarea rows=\\\"2\\\" class=\\\"form-control\\\" readonly=\\\"readonly\\\">[{{image.url}}]({{image.url}}</textarea>\\n\" +\n    \"                    </div>\\n\" +\n    \"\\n\" +\n    \"                    <div class=\\\"form-group\\\">\\n\" +\n    \"                        <p><small><a href=\\\"http://redditenhancementsuite.com/\\\">Reddit Enhancement Suite</a> supports CtrlV, so you can also just use this link in Reddit comments:</small></p>\\n\" +\n    \"                        <input type=\\\"text\\\" class=\\\"form-control\\\" readonly=\\\"readonly\\\" value=\\\"{{image.url}}\\\" />\\n\" +\n    \"                    </div>\\n\" +\n    \"\\n\" +\n    \"                    <div class=\\\"form-group\\\">\\n\" +\n    \"                        <h4>Markdown Image <small>e.g. for GitHub/BitBucket READMEs</small></h4>\\n\" +\n    \"                        <textarea rows=\\\"3\\\" class=\\\"form-control\\\" readonly=\\\"readonly\\\">[![{{ image.title }}]({{image.image.url}})]({{image.url}})</textarea>\\n\" +\n    \"                    </div>\\n\" +\n    \"\\n\" +\n    \"                </div>\\n\" +\n    \"                <div class=\\\"col-sm-6\\\">\\n\" +\n    \"\\n\" +\n    \"                    <div class=\\\"form-group\\\">\\n\" +\n    \"                        <h4>BBCode <small>for forums</small></h4>\\n\" +\n    \"                        <textarea rows=\\\"3\\\" class=\\\"form-control\\\" readonly=\\\"readonly\\\">[url={{image.url}}][img]{{image.image.url}}[/img]{{image.title}}[/url]</textarea>\\n\" +\n    \"                    </div>\\n\" +\n    \"\\n\" +\n    \"                    <div class=\\\"form-group\\\">\\n\" +\n    \"                        <h4>HTML <small>for websites</small></h4>\\n\" +\n    \"                        <textarea rows=\\\"5\\\" class=\\\"form-control\\\" readonly=\\\"readonly\\\">&lt;a href=&quot;{{image.url}}&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;{{image.image.url}}&quot; style=&quot;max-width:900px;&quot; alt=&quot;CtrlV.in Image Hosting&quot; /&gt;&lt;/a&gt;</textarea>\\n\" +\n    \"                    </div>\\n\" +\n    \"\\n\" +\n    \"                </div>\\n\" +\n    \"            </div>\\n\" +\n    \"        </div>\\n\" +\n    \"\\n\" +\n    \"    </div>\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/modals/image-privacy.html',\n    \"<div class=\\\"modal\\\" ng-click=\\\"close()\\\" id=\\\"image-privacy-modal\\\">\\n\" +\n    \"    <div class=\\\"modal-content\\\" ng-click=\\\"$event.stopPropagation()\\\">\\n\" +\n    \"\\n\" +\n    \"        <div class=\\\"container-fluid\\\" >\\n\" +\n    \"\\n\" +\n    \"            <div class=\\\"alert alert-warning\\\" ng-if=\\\"image.albumId\\\">\\n\" +\n    \"                This image is part of an album. Go to the <a href=\\\"#\\\">albums settings</a> to make the album anonyous and/or password protected.\\n\" +\n    \"            </div>\\n\" +\n    \"\\n\" +\n    \"            <div class=\\\"row\\\" ng-if=\\\"!image.albumId\\\">\\n\" +\n    \"                <div class=\\\"col-sm-6\\\">\\n\" +\n    \"\\n\" +\n    \"                    <h2><i class=\\\"typ typ-user\\\"></i> Show Username <small>on this image.</small></h2>\\n\" +\n    \"\\n\" +\n    \"                    <div class=\\\"form-group\\\">\\n\" +\n    \"                        <div class=\\\"row\\\">\\n\" +\n    \"                            <div class=\\\"col-xs-6\\\">\\n\" +\n    \"                                <a ng-click=\\\"setAnon(0);\\\" class=\\\"btn btn-block\\\" ng-class=\\\"{'active': !image.anonymous}\\\"><i class=\\\"typ typ-user\\\"></i>Yes</a>\\n\" +\n    \"                            </div>\\n\" +\n    \"                            <div class=\\\"col-xs-6\\\">\\n\" +\n    \"                                <a ng-click=\\\"setAnon(1);\\\" class=\\\"btn btn-block\\\" ng-class=\\\"{'active': image.anonymous}\\\"><i class=\\\"typ typ-cancel-outline\\\"></i>No</a>\\n\" +\n    \"                            </div>\\n\" +\n    \"                        </div>\\n\" +\n    \"                    </div>\\n\" +\n    \"\\n\" +\n    \"                </div>\\n\" +\n    \"                <div class=\\\"col-sm-6\\\">\\n\" +\n    \"\\n\" +\n    \"                    <h2><i class=\\\"typ typ-lock-closed\\\"></i> Password Protect <small>this image.</small></h2>\\n\" +\n    \"\\n\" +\n    \"                    <div class=\\\"form-group\\\">\\n\" +\n    \"                        <label>Enter a password that will be required for other people to view this image.</label>\\n\" +\n    \"                        (You will always be able to see it without the password.)\\n\" +\n    \"                        <input type=\\\"password\\\" class=\\\"form-control\\\" placeholder=\\\"Password\\\" />\\n\" +\n    \"                    </div>\\n\" +\n    \"\\n\" +\n    \"                    <a class=\\\"btn btn-block\\\">Save</a>\\n\" +\n    \"\\n\" +\n    \"                </div>\\n\" +\n    \"            </div>\\n\" +\n    \"        </div>\\n\" +\n    \"\\n\" +\n    \"    </div>\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/modals/image-text.html',\n    \"<div class=\\\"modal\\\" ng-click=\\\"close()\\\" id=\\\"image-text-modal\\\">\\n\" +\n    \"    <div class=\\\"modal-content\\\" ng-click=\\\"$event.stopPropagation()\\\">\\n\" +\n    \"        <h2><i class=\\\"typ typ-sort-alphabetically\\\"></i> Text <small>found in this image.</small></h2>\\n\" +\n    \"        <div class=\\\"container-fluid\\\">\\n\" +\n    \"\\n\" +\n    \"            <p ng-if=\\\"text.text.text\\\">{{ text.text.text }}</p>\\n\" +\n    \"\\n\" +\n    \"            <div class=\\\"alert alert-warning\\\" ng-if=\\\"text.text === null\\\">\\n\" +\n    \"                <i class=\\\"spinner-loading dark\\\"></i> The image is currently being scanned for text.\\n\" +\n    \"            </div>\\n\" +\n    \"\\n\" +\n    \"            <div class=\\\"alert alert-danger\\\" ng-if=\\\"text.text.text.length < 1\\\">\\n\" +\n    \"                No text was found in the image.\\n\" +\n    \"            </div>\\n\" +\n    \"\\n\" +\n    \"        </div>\\n\" +\n    \"    </div>\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/modals/login.html',\n    \"<div class=\\\"modal\\\" ng-click=\\\"close()\\\">\\n\" +\n    \"    <div class=\\\"modal-content\\\" ng-click=\\\"$event.stopPropagation()\\\">\\n\" +\n    \"\\n\" +\n    \"        <div class=\\\"container-fluid\\\">\\n\" +\n    \"            <div class=\\\"row\\\">\\n\" +\n    \"                <div class=\\\"col-sm-6\\\">\\n\" +\n    \"                    <form ng-submit=\\\"login()\\\">\\n\" +\n    \"                        <h2>Login <small>to you CtrlV account.</small></h2>\\n\" +\n    \"\\n\" +\n    \"                        <div class=\\\"form-group\\\" ng-class=\\\"{'has-error': loginData.errors.username}\\\">\\n\" +\n    \"                            <label class=\\\"control-label\\\"><i class=\\\"typ typ-user\\\"></i> Username\\n\" +\n    \"                                <input class=\\\"form-control\\\" type=\\\"text\\\" ng-model=\\\"loginData.username\\\" name=\\\"username\\\" />\\n\" +\n    \"                            </label>\\n\" +\n    \"\\n\" +\n    \"                            <span ng-if=\\\"loginData.errors.username\\\" class=\\\"help-block\\\">{{ loginData.errors.username.join(' ') }}</span>\\n\" +\n    \"\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div class=\\\"form-group\\\" ng-class=\\\"{'has-error': loginData.errors.password}\\\">\\n\" +\n    \"                            <label class=\\\"control-label\\\"><i class=\\\"typ typ-key\\\"></i> Password\\n\" +\n    \"                                <input class=\\\"form-control\\\" type=\\\"password\\\" ng-model=\\\"loginData.password\\\" name=\\\"password\\\" />\\n\" +\n    \"                            </label>\\n\" +\n    \"\\n\" +\n    \"                            <span ng-if=\\\"loginData.errors.password\\\" class=\\\"help-block\\\">{{ loginData.errors.password.join(' ') }}</span>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div class=\\\"form-group\\\">\\n\" +\n    \"                            <label>\\n\" +\n    \"                                <a href=\\\"#\\\" ng-click=\\\"forgot()\\\"><i class=\\\"typ typ-warning-outline\\\"></i> Forgot you password?</a>\\n\" +\n    \"                            </label>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div class=\\\"form-group\\\">\\n\" +\n    \"                            <label>\\n\" +\n    \"                                <a href=\\\"#\\\" ng-click=\\\"fb()\\\"><i class=\\\"typ typ-social-facebook\\\"></i> Used to login with Facebook?</a>\\n\" +\n    \"                            </label>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div ng-if=\\\"loginData.errors.general\\\" class=\\\"form-group has-error\\\">\\n\" +\n    \"                            <span class=\\\"help-block\\\"><i class=\\\"typ typ-warning\\\"></i> {{ loginData.errors.general }}</span>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <button class=\\\"btn btn-block\\\">\\n\" +\n    \"                            <i class=\\\"spinner-loading dark\\\" ng-show=\\\"loginData.loading\\\"></i>\\n\" +\n    \"                            <span ng-hide=\\\"loginData.loading\\\">Login</span>\\n\" +\n    \"                        </button>\\n\" +\n    \"                    </form>\\n\" +\n    \"                </div>\\n\" +\n    \"\\n\" +\n    \"                <div class=\\\"col-sm-6\\\">\\n\" +\n    \"                    <form ng-submit=\\\"signup()\\\">\\n\" +\n    \"                        <h2>Create <small>a new CtrlV account.</small></h2>\\n\" +\n    \"\\n\" +\n    \"                        <div class=\\\"form-group\\\" ng-class=\\\"{'has-error': signupData.errors.username}\\\">\\n\" +\n    \"                            <label class=\\\"control-label\\\"><i class=\\\"typ typ-user\\\"></i> Username\\n\" +\n    \"                                <input class=\\\"form-control\\\" type=\\\"text\\\" ng-model=\\\"signupData.username\\\" name=\\\"username\\\" />\\n\" +\n    \"                            </label>\\n\" +\n    \"\\n\" +\n    \"                            <span ng-if=\\\"signupData.errors.username\\\" class=\\\"help-block\\\">{{ signupData.errors.username.join(' ') }}</span>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div class=\\\"form-group\\\" ng-class=\\\"{'has-error': signupData.errors.username}\\\">\\n\" +\n    \"                            <label class=\\\"control-label\\\"><i class=\\\"typ typ-key\\\"></i> Password\\n\" +\n    \"                                <input class=\\\"form-control\\\" type=\\\"password\\\" ng-model=\\\"signupData.password\\\" name=\\\"password\\\" />\\n\" +\n    \"                            </label>\\n\" +\n    \"\\n\" +\n    \"                            <span ng-if=\\\"signupData.errors.password\\\" class=\\\"help-block\\\">{{ signupData.errors.password.join(' ') }}</span>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div class=\\\"form-group\\\" ng-class=\\\"{'has-error': signupData.errors.email}\\\">\\n\" +\n    \"                            <label class=\\\"control-label\\\"><i class=\\\"typ typ-mail\\\"></i> Email Address\\n\" +\n    \"                                <input class=\\\"form-control\\\" type=\\\"email\\\" ng-model=\\\"signupData.email\\\" name=\\\"email\\\" />\\n\" +\n    \"                            </label>\\n\" +\n    \"\\n\" +\n    \"                            <span ng-if=\\\"signupData.errors.email\\\" class=\\\"help-block\\\">{{ signupData.errors.email.join(' ') }}</span>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <div ng-if=\\\"signupData.errors.general\\\" class=\\\"form-group has-error\\\">\\n\" +\n    \"                            <span class=\\\"help-block\\\"><i class=\\\"typ typ-warning\\\"></i> {{ signupData.errors.general }}</span>\\n\" +\n    \"                        </div>\\n\" +\n    \"\\n\" +\n    \"                        <button class=\\\"btn btn-block\\\">\\n\" +\n    \"                            <i class=\\\"spinner-loading dark\\\" ng-show=\\\"signupData.loading\\\"></i>\\n\" +\n    \"                            <span ng-hide=\\\"signupData.loading\\\">Signup</span>\\n\" +\n    \"                        </button>\\n\" +\n    \"                    </form>\\n\" +\n    \"                </div>\\n\" +\n    \"\\n\" +\n    \"            </div>\\n\" +\n    \"        </div>\\n\" +\n    \"    </div>\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/partials/albums-sidebar.html',\n    \"<div class=\\\"album-list-sidebar sidebar sidebar-left sidebar-scrolling\\\" ng-if=\\\"albums.length > 0\\\">\\n\" +\n    \"    <div class=\\\"scroller\\\">\\n\" +\n    \"    <ul>\\n\" +\n    \"        <li>Albums</li>\\n\" +\n    \"\\n\" +\n    \"        <li>\\n\" +\n    \"            <a ng-click=\\\"changeUser($event, user.username)\\\" ui-sref=\\\"user({username: user.username})\\\">Unsorted</a>\\n\" +\n    \"        </li>\\n\" +\n    \"\\n\" +\n    \"        <li ng-repeat=\\\"album in albums\\\" ng-class=\\\"{active: albumId == albums.albumId}\\\">\\n\" +\n    \"            <a ng-click=\\\"changeAlbum($event, album.albumId)\\\" ui-sref=\\\"album({albumId: album.albumId})\\\"><img alt=\\\"{{ album.title }}\\\" /></a>\\n\" +\n    \"        </li>\\n\" +\n    \"    </ul>\\n\" +\n    \"    </div>\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('views/partials/footer.html',\n    \"<footer>\\n\" +\n    \"\\n\" +\n    \"    <!--<div style=\\\"float:left;\\\">\\n\" +\n    \"        View:\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\">Grid (Classic)</a>\\n\" +\n    \"        <a class=\\\"btn\\\" href=\\\"#\\\">Columns</a>\\n\" +\n    \"    </div>-->\\n\" +\n    \"\\n\" +\n    \"    <ul class=\\\"links\\\">\\n\" +\n    \"        <li>Created by <a href=\\\"https://themediadudes.com\\\">The Media Dudes</a></li>\\n\" +\n    \"        <li><a href=\\\"https://api.ctrlv.in/docs\\\"><i class=\\\"typ typ-flow-switch\\\"></i> API</a></li>\\n\" +\n    \"        <li><a href=\\\"mailto:help@ctrlv.in\\\"><i class=\\\"typ typ-mail\\\"></i> Contact Us</a></li>\\n\" +\n    \"        <li><a href=\\\"https://github.com/antriver/ctrlv-frontend\\\"><i class=\\\"typ typ-social-github\\\"></i> GitHub</a></li>\\n\" +\n    \"        <li><a ui-sref=\\\"help\\\"><i class=\\\"typ typ-info-large-outline\\\"></i> Help</a></li>\\n\" +\n    \"        <li><a ui-sref=\\\"privacy\\\"><i class=\\\"typ typ-lock-closed-outline\\\"></i> Privacy</a></li>\\n\" +\n    \"        <li><a ui-sref=\\\"terms\\\"><i class=\\\"typ typ-sort-alphabetically-outline\\\"></i> Terms of Use</a></li>\\n\" +\n    \"    </ul>\\n\" +\n    \"</footer>\\n\"\n  );\n\n\n  $templateCache.put('views/partials/header.html',\n    \"<header class=\\\"clearfix\\\">\\n\" +\n    \"    <a ui-sref=\\\"home\\\" id=\\\"logo-container\\\">\\n\" +\n    \"        <img src=\\\"/assets/img/ctrlv.svg\\\" id=\\\"logo\\\" />\\n\" +\n    \"    </a>\\n\" +\n    \"\\n\" +\n    \"    <h1 id=\\\"page-title\\\" ng-bind-html=\\\"title\\\" ng-class=\\\"{'with-subtitle': subtitle}\\\"></h1>\\n\" +\n    \"    <h3 id=\\\"page-subtitle\\\" ng-bind-html=\\\"subtitle\\\"></h3>\\n\" +\n    \"\\n\" +\n    \"    <div  id=\\\"current-user\\\">\\n\" +\n    \"        <div ng-if=\\\"user === false\\\">\\n\" +\n    \"            <a id=\\\"login-btn\\\" class=\\\"btn\\\" href=\\\"#\\\" ng-click=\\\"login()\\\"><i class=\\\"typ typ-user\\\"></i> Login or Signup</a>\\n\" +\n    \"        </div>\\n\" +\n    \"        <div ng-if=\\\"user\\\">\\n\" +\n    \"            <h2>Hi <a ui-sref=\\\"user({ username: user.username.toLowerCase() })\\\" ng-bind=\\\"user.username\\\"></a></h2>\\n\" +\n    \"            <ul class=\\\"links\\\">\\n\" +\n    \"                <!--<li><a ui-sref=\\\"user-favourites({ username: user.username.toLowerCase() })\\\"><i class=\\\"typ typ-heart-full-outline\\\"></i> Favourites</a></li>-->\\n\" +\n    \"                <li><a ui-sref=\\\"settings\\\"><i class=\\\"typ typ-spanner\\\"></i> Options</a></li>\\n\" +\n    \"                <li><a href=\\\"#\\\" ng-click=\\\"logout()\\\"><i class=\\\"typ typ-lock-open\\\"></i> Logout</a></li>\\n\" +\n    \"            </ul>\\n\" +\n    \"        </div>\\n\" +\n    \"    </div>\\n\" +\n    \"</header>\\n\"\n  );\n\n\n  $templateCache.put('views/partials/paginator.html',\n    \"<ul>\\n\" +\n    \"    <li ng-repeat=\\\"page in pages track by $index\\\" ng-class=\\\"{'active':currentPage === page}\\\">\\n\" +\n    \"        <a ng-if=\\\"page != '...'\\\" ng-click=\\\"changePage($event, page)\\\" href=\\\"{{url}}/{{page}}\\\">{{ page }}</a>\\n\" +\n    \"        <span ng-if=\\\"page === '...'\\\">...</span>\\n\" +\n    \"    </li>\\n\" +\n    \"</ul>\\n\"\n  );\n\n\n  $templateCache.put('views/user.html',\n    \"<ng-include src=\\\"'views/partials/image-list.html'\\\"></ng-include>\\n\" +\n    \"\\n\" +\n    \"<ng-include src=\\\"'views/partials/albums-sidebar.html'\\\"></ng-include>\\n\"\n  );\n\n}]);\n","app.controller(\n    'HeaderController',\n    function ($scope, $rootScope, ModalService, AuthService) {\n\n        $scope.login = function() {\n            // Just provide a template url, a controller and call 'showModal'.\n            ModalService.showModal({\n                templateUrl: 'views/modals/login.html',\n                controller: 'LoginModalController'\n            }).then(function(modal) {\n                // The modal object has the element built, if this is a bootstrap modal\n                // you can call 'modal' to show it, if it's a custom modal just show or hide\n                // it as you need to.\n                //modal.element.modal();\n                modal.close.then(function(result) {\n                    $scope.message = result ? \"You said Yes\" : \"You said No\";\n                });\n            });\n        };\n\n        $scope.logout = function() {\n            AuthService.logout();\n        };\n\n        $scope.signup = function() {\n            alert('signup');\n        };\n\n    }\n);\n","app.controller(\n    'HomeController',\n    function ($scope, $rootScope, $timeout) {\n\n        $rootScope.title = '';\n        $rootScope.subtitle = '';\n\n        var sprites = [];\n        for (var i = 0; i < 20; i++) {\n            sprites.push('<span class=\"homesprite homesprite-' + i + '\"></span>');\n        }\n        sprites.shuffle();\n        $scope.sprites = sprites.join('');\n\n        $scope.mac = navigator.platform === \"MacIntel\";\n\n        $timeout(function() {\n            $scope.test = true;\n        }, 1000);\n    }\n);\n","app.controller(\n    'ImageController',\n    function ($scope, $rootScope, $state, $element, $stateParams, $compile, AuthService, ImageResource, AlbumResource, ModalService) {\n\n        $scope.albumId = null;\n        $scope.albumImages = [];\n        $scope.image = null;\n        $scope.imageId = $stateParams.imageId;\n        $scope.editing = false;\n\n        $rootScope.loading = true;\n        $rootScope.title = '';\n        $rootScope.subtitle = '';\n\n        $scope.init = function () {\n\n            if ($stateParams.albumId) {\n                $scope.loadAlbumImages($stateParams.albumId);\n            }\n\n            ImageResource.get({imageId: $stateParams.imageId}, function (response) {\n                $scope.image = response.image;\n                $rootScope.loading = false;\n\n                // TODO: If the image is passworded show login prompt\n                // Show errors\n                // If anon or passworded, refresh on logout\n\n                var title = '';\n                if ($scope.image.title) {\n                    title = $scope.image.title;\n                } else {\n                    title = '<i class=\"typ typ-image\"></i> Image #' + $scope.image.imageId;\n                }\n                $rootScope.title = title;\n\n                var subtitle = '<span>';\n                if ($scope.image.userId) {\n                    subtitle += '<i class=\"typ typ-user\"></i> By <a ui-sref=\"user({username: image.user.username.toLowerCase()})\">' + $scope.image.user.username + '</a>';\n                }\n                subtitle += '<i class=\"typ typ-time\"></i> <span title=\"' + moment($scope.image.createdAt).format(\"dddd, MMMM Do YYYY, h:mm:ss a\") + '\">' + moment($scope.image.createdAt).fromNow() + '</span>';\n\n                if ($scope.image.album) {\n                    subtitle += '<i class=\"typ typ-folder-open\"></i> In <a ui-sref=\"album({albumId: image.album.albumId})\">' + $scope.image.album.title + '</a>';\n                }\n                subtitle += '</span>';\n\n                $rootScope.subtitle = $compile(subtitle)($scope)[0].innerHTML;\n\n                if ($scope.image.albumId && $scope.image.albumId !== $scope.albumId) {\n                    $scope.loadAlbumImages($scope.image.albumId);\n                }\n            });\n        };\n\n        $scope.loadAlbumImages = function (albumId) {\n            $scope.albumId = albumId;\n            // Get the images in the album to show on the left\n            AlbumResource.getImages({albumId: albumId}, function (data) {\n                $scope.albumImages = data.images;\n            });\n        };\n\n        /**\n         * Sidebar Buttons\n         */\n\n        $scope.showTextDialog = function () {\n            ModalService.showModal({\n                templateUrl: 'views/modals/image-text.html',\n                controller: function ($scope, close, image) {\n                    $scope.image = image;\n                    $scope.text = ImageResource.getText({imageId: image.imageId});\n                    $scope.close = close;\n                },\n                inputs: {\n                    image: $scope.image\n                }\n            });\n        };\n\n        $scope.showEmbedDialog = function () {\n            ModalService.showModal({\n                templateUrl: 'views/modals/image-embed.html',\n                controller: function ($scope, close, image) {\n                    $scope.image = image;\n                    $scope.close = close;\n                },\n                inputs: {\n                    image: $scope.image\n                }\n            });\n        };\n\n        $scope.shareOnFb = function () {\n            var url = 'https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent($scope.image.url);\n            window.open(url);\n        };\n\n        $scope.shareOnTwitter = function () {\n            var url = 'https://twitter.com/home?status=' + encodeURIComponent($scope.image.url);\n            window.open(url);\n        };\n\n        /**\n         * Annotating\n         */\n\n        $scope.annotating = false;\n        $scope.savingAnnotation = false;\n        $scope.annotationColorVisible = false;\n        $scope.annotationSizeVisible = false;\n        $scope.annotationColors = [\n            '000000',\n            'B2B2B2',\n            '823914',\n            'CC0000',\n            'FF7519',\n            'FFCC66',\n            'FFFF00',\n            '009933',\n            '99FF66',\n            '3333FF',\n            '99CCFF',\n            '66FFFF',\n            '9933FF',\n            'FF3399',\n            'FF99FF',\n            'ffffff',\n        ];\n        $scope.annotationSizes = [\n            2,\n            5,\n            15,\n            40\n        ];\n\n        /**\n         * @type {Doodle}\n         */\n        $scope.doodle = null;\n\n        $scope.annotate = function () {\n            var element = document.createElement('annotator');\n            element.setAttribute('doodle', 'doodle');\n            var annotator = angular.element(element);\n\n            $element.append($compile(annotator)($scope));\n            $scope.annotating = true;\n        };\n\n        $scope.showAnnotationColor = function () {\n            // Toggle display of the color picker\n            $scope.annotationColorVisible = $scope.annotationColorVisible ? false : true;\n            $scope.annotationSizeVisible = false;\n        };\n\n        $scope.setAnnotationColor = function (color) {\n            $scope.doodle.color = '#'+color;\n        };\n\n        $scope.showAnnotationSize = function () {\n            // Toggle display of the size picker\n            $scope.annotationSizeVisible = $scope.annotationSizeVisible ? false : true;\n            $scope.annotationColorVisible = false;\n        };\n\n        $scope.setAnnotationSize = function (px) {\n            $scope.doodle.lineThickness = px;\n        };\n\n        $scope.saveAnnotation = function () {\n\n            if ($scope.savingAnnotation) {\n                return false;\n            }\n\n            var annotation = $scope.doodle.getImage();\n\n            $scope.savingAnnotation = true;\n\n            ImageResource.annotate(\n                {imageId: $scope.imageId},\n                {base64:annotation},\n                function (response) {\n                    $scope.savingAnnotation = false;\n                    $scope.image = response.image;\n                    $scope.exitAnnotation();\n                }, function (response) {\n                    $scope.savingAnnotation = false;\n                    alert(response.data.message);\n                }\n            );\n        };\n\n        $scope.undoAnnotation = function () {\n            $scope.doodle.undo();\n        };\n\n        $scope.restartAnnotation = function () {\n            $scope.doodle.clear();\n        };\n\n        $scope.exitAnnotation = function () {\n            $scope.annotationColorVisible = false;\n            $scope.annotationSizeVisible = false;\n            $scope.annotating = false;\n            $scope.doodle = null;\n            $('annotator').remove();\n        };\n\n        /**\n         * Cropping\n         */\n\n        $scope.cropCoords = null;\n        $scope.cropping = false;\n        $scope.savingCrop = false;\n        $scope.jcrop = null;\n\n        $scope.crop = function () {\n            if ($scope.editing) {\n                return false;\n            }\n            $scope.cropping = true;\n            $scope.jcrop = $.Jcrop('#img', {\n                onChange: function (c) {\n                    $scope.cropCoords = c;\n                }\n            });\n        };\n\n        $scope.saveCrop = function () {\n\n            if ($scope.savingCrop) {\n                return false;\n            }\n\n            // How much is the image scaled on screen\n            var scale = $scope.getImageScale();\n\n            var params = {\n                imageId: $scope.imageId,\n                width: Math.round($scope.cropCoords.w / scale),\n                height: Math.round($scope.cropCoords.h / scale),\n                x: Math.round($scope.cropCoords.x / scale),\n                y: Math.round($scope.cropCoords.y / scale),\n            };\n            $scope.savingCrop = true;\n            ImageResource.crop(\n                params,\n                function (response) {\n                    $scope.exitCrop();\n                    $scope.image = response.image;\n                },\n                function (response) {\n                    $scope.savingCrop = false;\n                    alert(response.data.message);\n                }\n            );\n        };\n\n        $scope.exitCrop = function () {\n            $scope.jcrop.destroy();\n            $scope.cropCoords = null;\n            $scope.cropping = false;\n            $scope.jcrop = null;\n            $scope.savingCrop = false;\n            // Undo what jcrop did\n            $('#img').css({width: '', height: ''});\n        };\n\n        $scope.rotate = function () {\n            if ($scope.editing) {\n                return false;\n            }\n            $scope.editing = true;\n            $scope.rotating = true;\n            ImageResource.rotate(\n                {\n                    imageId: $scope.image.imageId\n                },\n                function (response) {\n                    $scope.editing = false;\n                    $scope.rotating = false;\n                    $scope.image = response.image;\n                },\n                function (response) {\n                    $scope.editing = false;\n                    $scope.rotating = false;\n                    alert(response.data.message);\n                }\n            );\n        };\n\n        $scope.revert = function () {\n            if ($scope.editing) {\n                return false;\n            }\n\n            if (!confirm(\"This will undo and cropping and remove any annotation. Are you sure you want to do this?\")) {\n                return false;\n            }\n\n            $scope.editing = true;\n            $scope.reverting = true;\n            ImageResource.revert(\n                {\n                    imageId: $scope.image.imageId\n                },\n                function (response) {\n                    $scope.editing = false;\n                    $scope.reverting = false;\n                    $scope.image = response.image;\n                },\n                function (response) {\n                    $scope.editing = false;\n                    $scope.reverting = false;\n                    alert(response.data.message);\n                }\n            );\n        };\n\n        $scope.showPrivacyDialog = function () {\n            ModalService.showModal({\n                templateUrl: 'views/modals/image-privacy.html',\n                controller: function ($scope, close, image) {\n                    $scope.image = image;\n                    $scope.close = close;\n\n                    $scope.setAnon = function (anon) {\n                        ImageResource.update({'imageId': $scope.image.imageId},\n                        {\n                            anonymous:anon\n                        }, function(res)\n                        {\n                            $scope.image = res.image;\n                            $scope.$parent.image = res.image;\n                        });\n                    };\n\n                    $scope.setPassword = function () {\n\n                    };\n\n                },\n                inputs: {\n                    image: $scope.image\n                }\n            });\n        };\n\n        $scope.delete = function () {\n            if ($scope.editing) {\n                return false;\n            }\n\n            if (!confirm(\"Are you sure you want to delete this image?\")) {\n                return false;\n            }\n\n            $scope.editing = true;\n            $scope.deleting = true;\n            ImageResource.delete(\n                {\n                    imageId: $scope.image.imageId\n                },\n                function () {\n                    $scope.editing = false;\n                    $scope.deleting = false;\n                    $scope.image = null;\n                },\n                function (response) {\n                    $scope.editing = false;\n                    $scope.deleting = false;\n                    alert(response.data.message);\n                }\n            );\n        };\n\n        $scope.showReportDialog = function () {\n\n        };\n\n        /**\n         * Returns how much the image is scaled to fit on the screen.\n         */\n        $scope.getImageScale = function () {\n            return parseInt($('#img').width()) / $scope.image.image.width;\n        };\n\n        $scope.init();\n    }\n);\n","app.controller(\n    'ImageListController',\n    function ($scope, $rootScope, $state, $stateParams, $compile, AuthService, AlbumResource, UserResource) {\n\n        console.log('ImageListController');\n\n        $rootScope.loading = true;\n        $rootScope.title = '';\n        $rootScope.subtitle = '';\n\n        $scope.mode = $stateParams.mode;\n\n        // Redirect to just /username if we're on /username/1\n        if ($stateParams.page === 1) {\n            $state.go('user', {username: $scope.username});\n            return;\n        }\n\n        /**\n         * Load the user\n         */\n\n        $scope.user = null;\n        $scope.username = $stateParams.username;\n\n        $scope.album = null;\n        $scope.albumId = $stateParams.albumId;\n\n        $scope.albums = [];\n\n\n        function loadAlbum(albumId) {\n            AlbumResource.get({albumId: albumId}, function (album) {\n                console.log(album);\n\n                $scope.album = album;\n                $scope.user = album.user;\n                $scope.albumId = albumId;\n                $scope.albums = album.user.albums;\n\n                $rootScope.title = '<i class=\"typ typ-folder-open\"></i> ' + album.title;\n\n                var subtitle = '<span>';\n                if (album.user) {\n                    subtitle += '<i class=\"typ typ-user\"></i> An Album By <a ng-click=\"changeUser($event, album.user.username)\" ui-sref=\"user({username: album.user.username.toLowerCase()})\">' + album.user.username + '</a>';\n                }\n                subtitle += '</span>';\n                $rootScope.subtitle = $compile(subtitle)($scope)[0].innerHTML;\n            });\n        }\n\n        $scope.changeAlbum = function ($event, albumId) {\n            $event.stopPropagation();\n            $event.preventDefault();\n\n            $scope.mode = 'album';\n            $scope.albumId = albumId;\n            $state.go('album', {albumId: albumId}, {notify: false});\n            loadAlbum(albumId);\n            loadImages(1);\n        };\n\n        function loadUser(username) {\n            $scope.username = username;\n            UserResource.get({username: username}, function (user) {\n                $rootScope.title = '<i class=\"typ typ-user\"></i> ' + user.username + \"'s Images\";\n                $scope.user = user;\n                $scope.albums = user.albums;\n                $scope.url = '/user/' + user.username;\n            });\n        }\n\n        $scope.changeUser = function ($event, username) {\n            $event.stopPropagation();\n            $event.preventDefault();\n\n            $scope.mode = 'user';\n            $scope.username = username;\n            $state.go('user', {username: username}, {notify: false});\n            loadUser(username);\n            loadImages(1);\n        };\n\n        // On pageload\n        switch ($scope.mode) {\n            case 'album':\n                loadAlbum($scope.albumId);\n                break;\n            case 'user':\n                loadUser($scope.username);\n                break;\n        }\n\n\n\n        /**\n         * Load the page of images\n         */\n\n        $scope.images = [];\n        $scope.currentPage = 1;\n        $scope.totalPages = 0;\n\n        function loadImages(page) {\n            $rootScope.loading = true;\n\n            switch ($scope.mode) {\n                case 'album':\n                    AlbumResource.getImages({albumId: $scope.albumId, page: page}, imagesLoadedCallback);\n                    break;\n                case 'user':\n                    UserResource.getImages({username: $scope.username, page: page}, imagesLoadedCallback);\n                    break;\n            }\n        }\n\n        function imagesLoadedCallback(data) {\n            $rootScope.loading = false;\n            $scope.images = data.images;\n            $scope.totalPages = data.lastPage;\n            $scope.currentPage = data.currentPage;\n        }\n\n        $scope.changePage = function ($event, page) {\n            $event.stopPropagation();\n            $event.preventDefault();\n\n            switch ($scope.mode) {\n                case 'album':\n                    $state.go('album-page', {albumId: $scope.albumId, page: page}, {notify: false});\n                    break;\n\n                case 'user':\n                    $state.go('user-page', {username: $scope.username, page: page}, {notify: false});\n                    break;\n            }\n\n            loadImages(page);\n        };\n\n        loadImages($stateParams.page ? $stateParams.page : 1);\n    }\n);\n","app.controller(\n    'LoginModalController',\n    function ($scope, close, AuthService, UserResource) {\n\n        $scope.loginData = {\n            loading: false,\n            username: '',\n            password: '',\n            errors: {}\n        };\n\n        $scope.signupData = {\n            loading: false,\n            username: '',\n            password: '',\n            email: '',\n            errors: {}\n        };\n\n        $scope.fb = function () {\n            alert(':(');\n        };\n\n        $scope.forgot = function () {\n            alert('lol');\n        };\n\n        $scope.login = function () {\n            if ($scope.loginData.loading) {\n                return false;\n            }\n            $scope.loginData.errors = {};\n            $scope.loginData.loading = true;\n\n            AuthService\n                .login($scope.loginData.username, $scope.loginData.password)\n                .then(\n                    function (response) {\n                        $scope.loginData.loading = false;\n\n                        close();\n                    },\n                    function (response) {\n                        $scope.loginData.loading = false;\n\n                        if (\n                            response.messages\n                            &&\n                            (\n                                response.messages.hasOwnProperty('username')\n                                ||\n                                response.messages.hasOwnProperty('password')\n                            )\n                        ) {\n                            $scope.loginData.errors = response.messages;\n                        } else {\n\n                            $scope.loginData.errors = {\n                                general: response.message\n                            };\n                        }\n\n                    }\n                );\n        };\n\n\n        $scope.signup = function () {\n            if ($scope.signupData.loading) {\n                return false;\n            }\n            $scope.signupData.errors = {};\n            $scope.signupData.loading = true;\n\n            UserResource.save({\n                username: $scope.signupData.username,\n                password: $scope.signupData.password,\n                email: $scope.signupData.email,\n            }, function(response) {\n\n                AuthService\n                    .login($scope.signupData.username, $scope.signupData.password)\n                    .then(\n                        function (response) {\n                            $scope.signupData.loading = false;\n                            close();\n                        },\n                        function (response) {\n                            $scope.signupData.loading = false;\n                            $scope.signupData.errors = {\n                                general: response.message\n                            };\n                        }\n                    );\n\n            }, function (response) {\n                $scope.signupData.loading = false;\n\n                response = response.data;\n                if (\n                    response.messages\n                    &&\n                    (\n                        response.messages.hasOwnProperty('username')\n                        ||\n                        response.messages.hasOwnProperty('password')\n                        ||\n                        response.messages.hasOwnProperty('email')\n                    )\n                ) {\n                    $scope.signupData.errors = response.messages;\n                } else {\n\n                    $scope.signupData.errors = {\n                        general: response.message\n                    };\n                }\n            });\n        };\n\n        $scope.close = close;\n\n    }\n);\n","app.directive('annotator', function ($window, debounce) {\n    return {\n        restrict: 'E',\n        controller: function ($scope, $element) {\n\n            var imageEl = $('#img');\n\n            $scope.doodle = new Doodle($element[0]);\n            $scope.doodle.init();\n\n            var moveAndResize = function() {\n                var imgOffset = imageEl.offset();\n                $element.css({\n                    left: imgOffset.left + 1,\n                    top: imgOffset.top + 1,\n                });\n                $scope.doodle.canvas.width = imageEl.width();\n                $scope.doodle.canvas.height = imageEl.height();\n            };\n\n            moveAndResize();\n\n            var debouncedRedraw = debounce(200, function() {\n                $scope.doodle.redraw();\n            });\n\n            angular.element($window).bind('resize', function() {\n                moveAndResize();\n                debouncedRedraw();\n            });\n\n        },\n        scope: {\n            doodle: '=',\n        },\n        template: ''\n    };\n});\n","app.directive('paginator', function factory($window, $timeout, debounce) {\n    return {\n        restrict: 'E',\n        controller: function ($scope, $element) {\n            var calculatePages = function () {\n\n                console.log('calculatePages', $scope.currentPage, $scope.totalPages);\n\n                // Only 1 page - don't need a paginator\n                if ($scope.totalPages <= 1) {\n                    return [1];\n                }\n\n                var pages = [];\n                var i;\n                var paginatorHeight = $element.height();\n\n                // How tall is one link in the paginator\n                var spaceHeight = 46;\n\n                var totalSpaces = Math.floor(paginatorHeight / spaceHeight);\n\n                console.log('paginatorHeight', paginatorHeight);\n                console.log('totalSpaces', totalSpaces);\n\n                // Round down to the next odd number\n                if (totalSpaces % 2 === 0) {\n                    totalSpaces -= 1;\n                }\n\n                // All page numbers fit on screen\n                if ($scope.totalPages <= totalSpaces) {\n                    for (i = 1; i <= $scope.totalPages; i++) {\n                        pages.push(i);\n                    }\n                    return pages;\n                }\n\n                var adjacent = Math.floor((totalSpaces - 5) / 2);\n\n                if ($scope.currentPage <= (adjacent + 3)) {\n                    // Close to the start - don't hide first pages\n                    for (i = 1; i <= totalSpaces - 2; i++) {\n                        pages.push(i);\n                    }\n                    pages.push('...');\n                    pages.push($scope.totalPages);\n\n                } else if ($scope.currentPage >= $scope.totalPages - (adjacent) - 2) {\n                    // Close to the end - don't hide last pages\n                    pages = [1, '...'];\n                    for (i = $scope.totalPages - (adjacent*2) - 2; i <= $scope.totalPages; i++) {\n                        pages.push(i);\n                    }\n\n                } else {\n                    pages = [1, '...'];\n                    for (i = $scope.currentPage - adjacent; i <= $scope.currentPage + adjacent; i++) {\n                        pages.push(i);\n                    }\n                    pages.push('...');\n                    pages.push($scope.totalPages);\n                }\n\n                return pages;\n            };\n\n            $timeout(function() {\n                $scope.pages = calculatePages();\n            }, 50);\n\n            // Recalculate on page change\n            $scope.$watchGroup(['totalPages', 'currentPage'], function () {\n                $timeout(function() {\n                    $scope.pages = calculatePages();\n                }, 50);\n            });\n\n            // Recalculate on window resize\n            var debouncedCalculatePages = debounce(100, function() {\n                $scope.pages = calculatePages();\n            });\n            angular.element($window).bind('resize', function() {\n                debouncedCalculatePages();\n            });\n\n        },\n        scope: {\n            currentPage: '=',\n            totalPages: '=',\n            url: '=',\n            changePage: '=',\n        },\n        templateUrl: 'views/partials/paginator.html'\n    };\n});\n","/**\n * Source: http://stackoverflow.com/a/32574746/710630\n */\n(function () {\n    'use strict';\n\n    app.directive(\n        'stateBodyClass',\n        function ($rootScope) {\n            return {\n                restrict: 'A',\n                scope: {},\n                link: function (scope, elem, attr, ctrl) {\n\n                    $rootScope.$on('$stateChangeSuccess', function (event, toState, toParams, fromState, fromParams) {\n                        var fromClassnames = angular.isDefined(fromState.data) && angular.isDefined(fromState.data.bodyClass) ? fromState.data.bodyClass : null;\n                        var toClassnames = angular.isDefined(toState.data) && angular.isDefined(toState.data.bodyClass) ? toState.data.bodyClass : null;\n\n                        // don't do anything if they are the same\n                        if (fromClassnames != toClassnames) {\n                            if (fromClassnames) {\n                                elem.removeClass(fromClassnames);\n                            }\n\n                            if (toClassnames) {\n                                elem.addClass(toClassnames);\n                            }\n                        }\n                    });\n                }\n            };\n        }\n    );\n\n}());\n","/**\n * Shuffles the items in an array.\n * Source: http://stackoverflow.com/a/10142256/710630\n *\n * @returns {Array}\n */\nArray.prototype.shuffle = function() {\n    var i = this.length, j, temp;\n    if (i === 0) {\n        return this;\n    }\n    while (--i) {\n        j = Math.floor( Math.random() * ( i + 1 ) );\n        temp = this[i];\n        this[i] = this[j];\n        this[j] = temp;\n    }\n    return this;\n};\n","\"use strict\";\n\nvar Doodle = function (element) {\n    this.element = element;\n    this.canvas = null;\n\n    this.lineThickness = 5;\n    this.color = '#000000';\n    this.drawing = false;\n    this.history = [];\n    this.currentData = null;\n\n    var ua = navigator.userAgent.toLowerCase();\n    this.isAndroid = ua.indexOf(\"android\") > -1;\n};\n\n\nDoodle.prototype = {\n\n    init: function () {\n\n        this.canvas = document.createElement('canvas');\n        this.element.appendChild(this.canvas);\n\n        //this.canvas.setAttribute('width', $(this.element).width());\n        //this.canvas.setAttribute('height', $(this.element).height());\n\n        this.context = this.canvas.getContext('2d');\n\n        //Setup a fresh canvas\n        this.color = '#000000';\n        $('#currentColour').css('background-color', this.color);\n        this.clear();\n\n        var self = this;\n\n        // Mouse\n        if (!this.isAndroid) {\n            $(this.canvas).bind('mousedown', function (e) {\n                self.drawStart(e);\n            });\n            $(this.canvas).bind('mousemove', function (e) {\n                self.draw(e);\n            });\n            $(this.canvas).bind('mouseup', function (e) {\n                self.drawEnd(e);\n            });\n            $('body').bind('mouseup', function (e) {\n                self.drawEnd(e);\n            });\n        }\n\n        // Touch\n        $(this.canvas).bind('touchstart', function (e) {\n            self.drawStart(e);\n        });\n        $(this.canvas).bind('touchmove', function (e) {\n            self.draw(e);\n        });\n        $(this.canvas).bind('touchend', function (e) {\n            self.drawEnd(e);\n        });\n    },\n\n    clear: function () {\n        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);\n        this.context.fillStyle = this.color;\n        this.history = [];\n    },\n\n    getImage: function (e) {\n        if (this.history.length < 1) {\n            return false;\n        }\n        return this.canvas.toDataURL(\"image/png\");\n    },\n\n    saveHistoryState: function () {\n        // Limit history size\n        while (this.history.length >= 30) {\n            this.history.shift();\n        }\n        this.history.push(this.context.getImageData(0, 0, this.canvas.width, this.canvas.height));\n    },\n\n    saveCurrentData: function () {\n        this.currentData = this.context.getImageData(0, 0, this.canvas.width, this.canvas.height);\n    },\n\n    undo: function () {\n        if (this.history.length > 0) {\n            var imageData = this.history.pop();\n            this.putImageData(imageData);\n        } else {\n            alert('Nothing to undo!');\n        }\n    },\n\n    redraw: function () {\n        if (this.currentData) {\n            this.putImageData(this.currentData);\n        }\n    },\n\n    putImageData: function (imageData) {\n        if (imageData.width === this.canvas.width) {\n            this.context.putImageData(imageData, 0, 0);\n        } else {\n            // Draw it to a new canvas to resize it\n            var scale = this.canvas.width / imageData.width;\n\n            var newCanvas = $('<canvas>')\n                .attr('width', imageData.width)\n                .attr('height', imageData.height)[0];\n\n            newCanvas.getContext('2d').putImageData(imageData, 0, 0);\n\n            this.context.scale(scale, scale);\n            this.context.drawImage(newCanvas, 0, 0);\n            this.context.scale(1 / scale, 1 / scale);\n        }\n    },\n\n    drawStart: function (e) {\n        if (e) {\n            e.preventDefault();\n        }\n        this.saveHistoryState();\n\n        var x, y;\n        if (e.originalEvent.touches) {\n            x = e.originalEvent.touches[0].pageX - $(this.canvas).offset().left;\n            y = e.originalEvent.touches[0].pageY - $(this.canvas).offset().top;\n        }\n        else {\n            x = e.pageX - $(this.canvas).offset().left;\n            y = e.pageY - $(this.canvas).offset().top;\n        }\n\n        this.drawing = true;\n        $(this.canvas).addClass('drawing');\n\n        this.context.lineWidth = this.lineThickness;\n        this.context.lineCap = \"round\";\n        this.context.lineJoin = \"round\";\n        this.context.strokeStyle = this.color;\n        this.context.fillStyle = this.color;\n\n        this.oldX = x;\n        this.oldY = y;\n\n        // Draw a dot at the current position\n        this.context.beginPath();\n        this.context.arc(x, y, (this.lineThickness / 2), 0, 2 * Math.PI, false);\n        this.context.closePath();\n        this.context.fill();\n\n        this.context.beginPath();\n    },\n\n    draw: function (e) {\n        if (e) {\n            e.preventDefault();\n        }\n\n        var x, y;\n        if (e.originalEvent.touches) {\n            x = e.originalEvent.touches[0].pageX - $(this.canvas).offset().left;\n            y = e.originalEvent.touches[0].pageY - $(this.canvas).offset().top;\n        }\n        else {\n            x = e.pageX - $(this.canvas).offset().left;\n            y = e.pageY - $(this.canvas).offset().top;\n        }\n\n        if (this.drawing) {\n            this.context.moveTo(this.oldX, this.oldY);\n            this.context.lineTo(x, y);\n            this.context.stroke();\n        }\n\n        this.oldX = x;\n        this.oldY = y;\n    },\n\n    drawEnd: function (e) {\n        if (e) {\n            e.preventDefault();\n        }\n\n        if (this.drawing) {\n            this.context.closePath();\n            this.context.stroke();\n            this.drawing = false;\n        }\n\n        this.saveCurrentData();\n\n        $(this.canvas).removeClass('drawing');\n    },\n\n    rgbToHex: function (rgb) {\n        var hexDigits = new Array(\"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"a\", \"b\", \"c\", \"d\", \"e\", \"f\");\n\n        function hex(x) {\n            return isNaN(x) ? \"00\" : hexDigits[(x - x % 16) / 16] + hexDigits[x % 16];\n        }\n\n        rgb = rgb.match(/^rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)$/);\n        return \"#\" + hex(rgb[1]) + hex(rgb[2]) + hex(rgb[3]);\n    }\n};\n","var ImagePaster = (function () {\n    \"use strict\";\n\n    var ImagePaster = function (url) {\n        this.debug = true;\n        this.url = url;\n        this.pasteCatcher = null;\n        this.init();\n    };\n\n    ImagePaster.prototype.log = function (data, extra) {\n        if (this.debug) {\n            console.log(data, extra);\n        }\n    };\n\n    ImagePaster.prototype.init = function () {\n\n        var self = this;\n\n        /**\n         * Firefox allows images to be pasted into contenteditable elements.\n         * So create one of those on the page and make it have focus,\n         * so paste events happen into that\n         */\n\n        // Create paste catcher element\n        self.pasteCatcher = document.createElement('div');\n        self.pasteCatcher.setAttribute('contenteditable', '');\n        self.pasteCatcher.setAttribute('style', 'position:absolute; opacity:0; top:0; left:0; width:0; height:0;');\n        self.pasteCatcher.id = 'paste-catcher';\n        document.body.appendChild(self.pasteCatcher);\n        self.pasteCatcher.focus();\n\n        // Listen for the 'paste' event on the body\n        //if (browserName == 'IE') {\n        //$('body').on('paste', function(event) { self.onPaste(event); });\n        //} else {\n        document.addEventListener('paste', function (event) {\n            self.onPaste(event);\n        });\n        //}\n\n        // Watch for ctrl + v being pressed\n        $(document).on('keydown', function (e) {\n            // 86 = v\n            if (e.which === 86 && (e.ctrlKey || e.metaKey)) {\n                $(document).trigger('ctrlVPressed');\n            }\n        });\n\n        // Focus paste catcher when cmd or ctrlv is pressed\n        $(document).on('ctrlVPressed', function () {\n            self.pasteCatcher.focus();\n        });\n\n    };\n\n    ImagePaster.prototype.onPaste = function (event) {\n\n        var self = this;\n        var done = false;\n        var clipboardData;\n\n        self.log('onPaste', JSON.stringify(event));\n\n        if (event.clipboardData) {\n            // Chrome\n            clipboardData = event.clipboardData;\n        } else if (window.clipboardData) {\n            // IE\n            clipboardData = window.clipboardData;\n        } else {\n            // Firefox\n            //setTimeout(this.checkPasteCatcher, 1);\n        }\n\n        // IE\n        if (event.msConvertURL) {\n            var fileList = clipboardData.files;\n            if (fileList.length > 0) {\n                for (var i = 0; i < fileList.length; i++) {\n                    self.uploadBlob(fileList[i]);\n                    done = true;\n                }\n            }\n        }\n\n        // Check if there is something in the paste event itself\n        if (clipboardData && clipboardData.items) {\n\n            var text;\n            // If there was some text on the clipboard,\n            // it might be a URL. Try and paste that...\n            if ((text = clipboardData.getData(\"text/plain\"))) {\n                self.uploadText(text);\n                self.clearPasteCatcher();\n                return;\n            }\n\n            // Loop through all the clipboardData\n            for (var x = 0; x < clipboardData.items.length; x++) {\n                // If this clipboard item claims to be an image, upload it\n                if (clipboardData.items[x].type.indexOf('image') !== -1) {\n                    self.uploadBlob(clipboardData.items[x].getAsFile());\n                    done = true;\n                }\n            }\n        }\n\n        // If there was nothing found in the clipboard data\n        // fall back to checking if there's anything in the editable element\n        if (done) {\n            self.clearPasteCatcher();\n        } else {\n            setTimeout(\n                function () {\n                    self.checkPasteCatcher();\n                },\n                10\n            );\n        }\n    };\n\n    /**\n     * Check if anything has been pasted into the paste catcher element\n     * (Firefox + Safari?)\n     */\n    ImagePaster.prototype.checkPasteCatcher = function () {\n\n        var text = this.pasteCatcher.innerHTML;\n        var child = this.pasteCatcher.childNodes[0];\n\n        if (child) {\n            if (child.tagName === 'IMG') {\n                if (child.src.indexOf('webkit-fake-url://') != -1) {\n                    this.onFail('Sorry, Safari does not currently support pasting images.');\n                    return false;\n                }\n                this.uploadImage(child.src);\n            } else if (child.tagName === 'A') {\n                this.uploadText(child.href);\n            } else {\n                this.uploadText(text);\n            }\n        }\n\n        this.clearPasteCatcher();\n    };\n\n    ImagePaster.prototype.clearPasteCatcher = function () {\n        var self = this;\n        setTimeout(\n            function () {\n                self.pasteCatcher.innerHTML = '';\n            },\n            1\n        );\n    };\n\n    ImagePaster.prototype.uploadBlob = function (blob) {\n        if (blob) {\n            var self = this;\n            var reader = new FileReader();\n            reader.onload = function (evt) {\n                self.uploadImage(evt.target.result);\n            };\n            reader.readAsDataURL(blob);\n        }\n    };\n\n    ImagePaster.prototype.uploadText = function (text) {\n        return this.upload('text', text);\n\n        /*if (this.validateURL(url)) {\n         upload('url', url);\n         } else {\n         failedUpload(\"Can't upload that. Try pasting an image or URL.\");\n         }*/\n    };\n\n    ImagePaster.prototype.uploadImage = function (base64) {\n        return this.upload('uploadImage', base64);\n\n        /*convertImageToJpeg(base64, function(jpegBase64){\n         upload('base64', jpegBase64);\n         });*/\n    };\n\n    /*ImagePaster.prototype.convertImageToJpeg = function(base64, callback)\n     {\n     //Convert image to a JPG so it's faster to upload\n     var img = new Image();\n     img.onload = function()\n     {\n     var canvas = convertImageToCanvas(this);\n     var data = canvas.toDataURL('image/jpeg' , 0.8);\n     callback(data);\n     };\n     img.src = base64;\n     };*/\n\n    /*ImagePaster.prototype.convertImageToCanvas = function(image)\n     {\n     var canvas = document.createElement(\"canvas\");\n     canvas.width = image.width;\n     canvas.height = image.height;\n\n     var context = canvas.getContext(\"2d\");\n     context.fillStyle = \"#ffffff\";\n     context.fillRect(0,0,image.width,image.height);\n     context.drawImage(image, 0, 0);\n\n     return canvas;\n     };*/\n\n    ImagePaster.prototype.upload = function (format, data) {\n\n        var self = this;\n        $(document).trigger('ctrlvuploadstart');\n\n        var url = this.url;\n        if (typeof url === 'function') {\n            url = url();\n        }\n\n        $.ajax({\n            url: url,\n            timeout: 90000,\n            type: 'POST',\n            data: {\n                format: format,\n                base64: data\n            },\n            error: function (jqXHR, textStatus) {\n                // Turn this error message into something useful\n                var message;\n                switch (textStatus) {\n                    case 'timeout':\n                        message = 'The image took too long to upload';\n                        break;\n                    case 'error':\n\n                        if (jqXHR.responseJSON && jqXHR.responseJSON.message) {\n                            message = 'CtrlV server error (' + jqXHR.responseJSON.errorType + ' ' + jqXHR.responseJSON.message + ')';\n                        } else if (jqXHR.status !== 0) {\n                            message = 'CtrlV server error (' + jqXHR.status + ' ' + jqXHR.statusText + ')';\n                        } else {\n                            message = 'Can\\'t connect to the CtrlV server';\n                        }\n                        break;\n                    case 'abort':\n                        message = 'The upload was cancelled';\n                        break;\n                    case 'parsererror':\n                        message = 'Error uploading: couldn\\'t decode the response from the server';\n                        break;\n                    default:\n                        message = textStatus;\n                        break;\n                }\n\n                self.onFail(message);\n            },\n            success: function (res) {\n                if (res.image) {\n                    $(document).trigger({\n                        type: 'ctrlvuploadcomplete',\n                        image: res.image\n                    });\n                } else {\n                    self.onFail(res.message);\n                }\n            }\n        });\n    };\n\n    ImagePaster.prototype.onFail = function (message) {\n        $(document).trigger({\n            type: 'ctrlvuploaderror',\n            message: message ? message : false\n        });\n    };\n\n    ImagePaster.prototype.validateURL = function (text) {\n        var regex = new RegExp(\"^(http|https|ftp)\\://([a-zA-Z0-9\\.\\-]+(\\:[a-zA-Z0-9\\.&amp;%\\$\\-]+)*@)*((25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9])\\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])|([a-zA-Z0-9\\-]+\\.)*[a-zA-Z0-9\\-]+\\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(\\:[0-9]+)*(/($|[a-zA-Z0-9\\.\\,\\?\\'\\\\\\+&amp;%\\$#\\=~_\\-]+))*$\");\n        return regex.test(text);\n    };\n\n    return ImagePaster;\n}());\n","app.factory(\n    'AlbumResource',\n    function ($resource, AuthService) {\n        return $resource(\n            apiUrl + 'albums/:albumId',\n            {\n                albumId: '@albumId',\n                sessionKey: function() {\n                    return AuthService.getSessionKey() || null;\n                }\n            },\n            {\n                get: {\n                    cache: true,\n                    transformResponse: function(data) {\n                        data = angular.fromJson(data);\n                        return data.album;\n                    }\n                },\n\n                getImages: {\n                    cache: true,\n                    url: apiUrl + 'albums/:albumId/images',\n                    //isArray: true,\n                    transformResponse: function(data) {\n                        var data = angular.fromJson(data);\n                        return data;\n                    }\n                }\n\n            }\n        );\n    }\n);\n","app.factory(\n    'ImageResource',\n    function ($resource, AuthService) {\n        return $resource(\n            apiUrl + 'images/:imageId',\n            {\n                imageId: '@imageId',\n                sessionKey: function() {\n                    return AuthService.getSessionKey() || null;\n                }\n            },\n            {\n                get: {\n                    cache: true,\n                },\n\n                update: {\n                    method: 'PUT'\n                },\n\n                getText: {\n                    url: apiUrl + 'images/:imageId/text',\n                    method: 'GET'\n                },\n\n                annotate: {\n                    url: apiUrl + 'images/:imageId/image',\n                    method: 'PUT',\n                    params: {\n                        action: 'annotate'\n                    }\n                },\n\n                crop: {\n                    url: apiUrl + 'images/:imageId/image',\n                    method: 'PUT',\n                    params: {\n                        action: 'crop'\n                    }\n                },\n\n                revert: {\n                    url: apiUrl + 'images/:imageId/image',\n                    method: 'PUT',\n                    params: {\n                        action: 'revert'\n                    }\n                },\n\n                rotate: {\n                    url: apiUrl + 'images/:imageId/image',\n                    method: 'PUT',\n                    params: {\n                        action: 'rotate',\n                        degrees: 90\n                    }\n                },\n            }\n        );\n    }\n);\n","app.factory(\n    'SessionResource',\n    function ($resource) {\n        return $resource(\n            apiUrl + 'sessions/:sessionKey',\n            {},\n            {\n                get: {\n                    transformResponse: function(data) {\n                        data = angular.fromJson(data);\n                        return data.session;\n                    }\n                }\n            }\n        );\n    }\n);\n","app.factory(\n    'UserResource',\n    function ($resource, AuthService) {\n        return $resource(\n            apiUrl + 'users/:username',\n            {\n                username: '@username',\n                sessionKey: function() {\n                    return AuthService.getSessionKey() || null;\n                }\n            },\n            {\n                get: {\n                    cache: true,\n                    transformResponse: function(data) {\n                        var data = angular.fromJson(data);\n                        return data.user;\n                    }\n                },\n\n                save: {\n                    method: 'POST',\n                    url: apiUrl + 'users'\n                },\n\n                getImages: {\n                    cache: true,\n                    url: apiUrl + 'users/:username/images?page=:page',\n                    /*isArray: true,\n                    transformResponse: function(data) {\n                        var data = angular.fromJson(data);\n                        return data.images;\n                    }*/\n                },\n\n                getAlbums: {\n                    cache: true,\n                    url: apiUrl + 'users/:username/albums',\n                    /*isArray: true,\n                    transformResponse: function(data) {\n                        var data = angular.fromJson(data);\n                        return data;\n                    }*/\n                }\n            }\n        );\n    }\n);\n","app.service(\n    'AuthService',\n    function (localStorageService, SessionResource, $q, $rootScope) {\n\n        var session = null;\n        var sessionKey = null;\n\n        return {\n\n            checkSession: function() {\n                var self = this;\n\n                if (sessionKey = localStorageService.get('sessionKey')) {\n                    SessionResource.get(\n                        {sessionKey: sessionKey},\n                        function (session) {\n                            self.onLogin(session, sessionKey);\n                        },\n                        function() {\n                            self.onLogout();\n                        }\n                    );\n                } else {\n                    self.onLogout();\n                }\n            },\n\n            /**\n             * @param username\n             * @param password\n             * @returns $q\n             */\n            login: function(username, password) {\n                var self = this;\n\n                return $q(function(resolve, reject) {\n\n                    SessionResource.save({\n                        username: username,\n                        password: password\n                    }, function(response) {\n\n                        self.onLogin(response.session, response.sessionKey);\n\n                        // Resolve promise (sends back user)\n                        resolve(response.session.user);\n\n                    }, function (response) {\n                        reject(response.data);\n                    });\n\n                });\n            },\n\n            onLogin: function(newSession, newSessionKey) {\n\n                session = newSession;\n                sessionKey = newSessionKey;\n                localStorageService.set('sessionKey', newSessionKey);\n\n                // Tell everybody we're logged in\n                $rootScope.$broadcast('login', {user: newSession.user});\n\n            },\n\n            logout: function() {\n                var self = this;\n\n                SessionResource.delete({\n                    sessionKey: sessionKey\n                });\n\n                self.onLogout();\n\n            },\n\n            onLogout: function() {\n\n                session = false;\n                sessionKey = false;\n                localStorageService.remove('sessionKey');\n\n                // Tell everybody we're logged in\n                $rootScope.$broadcast('logout');\n\n            },\n\n            getSessionKey: function() {\n                return sessionKey;\n            },\n\n            getUser: function() {\n                if (session === null) {\n                    return null;\n                }\n\n                return session && session.user ? session.user : false;\n            }\n        };\n    }\n);\n","app.service(\n    'ImagePasterService',\n    function($state, AuthService) {\n\n        /**\n         * Add listeners for events that ImagePaster broadcasts.\n         */\n        $(document).on('ctrlvuploadstart', function () {\n            $('.upload-status').addClass('out');\n            $('#upload-loading').removeClass('out');\n        });\n\n        $(document).on('ctrlvuploadcomplete', function (e) {\n            $('.upload-status').addClass('out');\n            $('#upload-complete').removeClass('out');\n            var viewUrl = e.image.url;\n            var imageUrl = e.image.image.url;\n            $('#view-btn').attr('href', viewUrl);\n            $('#uploader').css('background-image', 'url(' + imageUrl + ')');\n\n            $state.go('image', {imageId: e.image.imageId});\n\n        });\n\n        $(document).on('ctrlvuploaderror', function (e) {\n            $('.upload-status').addClass('out');\n            $('#upload-error').removeClass('out').find('p').text(e.message);\n        });\n\n        $(document).on('keyup', function (e) {\n            // Highlighting keys when pressing\n            if (e.which == 91 || e.which === 224) { // cmd\n                $('.btn-cmd').removeClass('active');\n            } else if (e.which == 17) { // ctrl\n                $('.btn-ctrl').removeClass('active');\n            } else if (e.which == 86) { // v\n                $('.btn-v').removeClass('active');\n            }\n        });\n\n        $(document).on('keydown', function (e) {\n            // Highlighting keys when pressing\n            if (e.which == 91 || e.which === 224) { // cmd (91 in\n                $('.btn-cmd').addClass('active');\n            } else if (e.which == 17) { // ctrl\n                $('.btn-ctrl').addClass('active');\n            } else if (e.which == 86) { // v\n                $('.btn-v').addClass('active');\n            }\n        });\n\n        var getImageUploadUrl = function() {\n            var url = apiUrl + 'images';\n\n            var sessionKey;\n            if (sessionKey = AuthService.getSessionKey()) {\n                url += '?sessionKey=' + sessionKey;\n            }\n            return url;\n        };\n\n        return new ImagePaster(getImageUploadUrl);\n    }\n);\n"]}